-----------V6.17-V6.18 START------------------------
CREATE PROCEDURE "ADDVERSIONEXISTS"
  BEGIN ATOMIC
    DECLARE DBVERSION VARCHAR(32);
    DECLARE NUM INT;
    DECLARE TOTAL INT;
    SET DBVERSION = '71.01';
    SET NUM =1;
    SET TOTAL=1;
    IF NOT EXISTS(SELECT * FROM LF_DB_SCRIPT WHERE VERSION=DBVERSION) THEN
      --EMP产品数据库版本信息表
      INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
      VALUES(DBVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,NUM,TOTAL,1,'LINUX版本脚本整合');
    END IF;
  END;
CALL ADDVERSIONEXISTS;
DROP PROCEDURE ADDVERSIONEXISTS;


/*网关升级脚本 START*/    
/** 升级脚本(V4.06.06-V4.06.07) START*/
CREATE PROCEDURE "DELPROC"(IN "PROCNAME1" VARCHAR(20))
  begin
DECLARE STR VARCHAR (256);
DECLARE STR1 VARCHAR (256);
SELECT PROCNAME INTO STR1 FROM SYSCAT.PROCEDURES WHERE  PROCNAME=PROCNAME1;
if  STR1 is not null THEN
  SET STR ='DROP PROCEDURE '||PROCNAME1;
  execute immediate str ;
end if;
end;

CALL DELPROC('GW_H_TRANSFERV1');
CREATE PROCEDURE "GW_H_TRANSFERV1"
 (IN "PIMININDEX" BIGINT,
  IN "PIMAXINDEX" BIGINT
 )
  SPECIFIC "GW_H_TRANSFERV1"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN

	DECLARE	PISTR VARCHAR(4000);
	DECLARE	PITABLENAME VARCHAR(20);
	DECLARE	MINYM INTEGER;
	DECLARE	MAXYM INTEGER;
	DECLARE	CURYM INTEGER;
  DECLARE MAXTIME VARCHAR(32);
  DECLARE MINTIME VARCHAR(32);
	DECLARE BEGTIME VARCHAR(32);
  DECLARE ENDTIME VARCHAR(32);
  --------------------VER 3.1-------------------------------------
  SELECT MIN(SENDTIME),MAX(SENDTIME) INTO MINTIME,MAXTIME FROM GW_MT_TASK_BAK  WHERE ID BETWEEN PIMININDEX AND PIMAXINDEX;

  SET MINYM=CAST((SUBSTR(CHAR(MINTIME),1,4)||SUBSTR(CHAR(MINTIME),6,2))AS INT);
  SET MAXYM=CAST((SUBSTR(CHAR(MAXTIME),1,4)||SUBSTR(CHAR(MAXTIME),6,2))AS INT);

  --转移
  SET CURYM = MINYM;
  WHILE CURYM<=MAXYM DO

  IF CAST(SUBSTR(CAST(CURYM AS CHAR(6)),5,2) AS INT)<>12 THEN
	    SET BEGTIME = SUBSTR(CHAR(CURYM),1,4)||'-'||SUBSTR(CHAR(CURYM),5,2)||'-'||'01 00:00:00.000000';
	    IF CAST(SUBSTR(CAST(CURYM AS CHAR(6)),5,2) AS INT)<9 THEN
	      SET ENDTIME = SUBSTR(CHAR(CURYM),1,4)||'-0'||TRIM(CHAR(INT(SUBSTR(CHAR(CURYM),5,2))+1))||'-'||'01 00:00:00.000000';
		ELSE
		  SET ENDTIME = SUBSTR(CHAR(CURYM),1,4)||'-'||TRIM(CHAR(INT(SUBSTR(CHAR(CURYM),5,2))+1))||'-'||'01 00:00:00.000000';
		END IF;
	  ELSE
	      SET BEGTIME = SUBSTR(CHAR(CURYM),1,4)||'-'||SUBSTR(CHAR(CURYM),5,2)||'-'||'01 00:00:00.000000';
	      SET ENDTIME = TRIM(CHAR(INT(SUBSTR(CHAR(CURYM),1,4))+1))||'-'||'01'||'-'||'01 00:00:00.000000';
	  END IF;

      SET PITABLENAME = 'MTTASK'||CAST(CURYM AS CHAR(6));

      SET PISTR= 'INSERT INTO '||PITABLENAME||' (ID,MDAY,USERID,SPGATE,CPNO,PHONE,SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,SENDSTATUS,SENDFLAG,RECVFLAG,DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,SENDTIME,RECVTIME,MESSAGE,TASKID,ECID,PTMSGID,MOBILEAREA,SPID,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,DOWNTM)
                SELECT ID,INT(DAY(M.SENDTIME)),USERID,SPGATE,CPNO,PHONE,SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,SENDSTATUS,SENDFLAG,RECVFLAG,DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,SENDTIME,RECVTIME,MESSAGE,TASKID,ECID,PTMSGID,MOBILEAREA,SPID,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,DOWNTM
                FROM GW_MT_TASK_BAK  M
                WHERE SENDTIME>='''||BEGTIME||''' AND SENDTIME<'''||ENDTIME||''' AND (M.ID <='||CHAR(PIMAXINDEX)||')  ';
      EXECUTE IMMEDIATE PISTR;

      IF CAST(SUBSTR(CAST(CURYM AS CHAR(6)),5,2) AS INT)=12 THEN
        SET CURYM = CAST(CAST(CAST(SUBSTR(CAST(CURYM AS CHAR(6)),1,4)AS INT)+1 AS CHAR(4))||'01' AS INT);
      ELSE
        SET CURYM = CURYM+1;
      END IF;
  END WHILE;
END;

MERGE INTO  A_GWPARAMCONF A USING (SELECT 'PUSHCONFIG' AS "PARAMITEM",4000 AS "GWTYPE" FROM  SYSIBM.DUAL) B ON (A.PARAMITEM=B.PARAMITEM AND A.GWTYPE=B.GWTYPE)
WHEN NOT MATCHED THEN
INSERT(PARAMITEM, PARAMNAME,  PARAMMEMO,PARAMATTRIBUTE, VALUERANGE,
DEFAULTVALUE,  CONTROLTYPE, GWTYPE, HKPARAMNAME, HKPARAMMEMO, ENPARAMNAME, ENPARAMMEMO)
VALUES('PUSHCONFIG', '推送字段是否为JSON数组',  '推送字段是否为JSON数组(0:字符串,1:JSON数组)',
1, '0,1','0',1,4000,'推送字段是否JSON到M','推送字段是否JSON到M(0:字符串,1:JSON到M)','Whether the push field is a JSON array','Whether the push field is a JSON array (0: string, 1: JSON array)')
ELSE IGNORE;

INSERT INTO A_GWPARAMVALUE(GWNO, GWTYPE, PARAMITEM, PARAMVALUE)
SELECT DISTINCT GWNO,4000,'PUSHCONFIG','0' FROM A_GWPARAMVALUE
WHERE  NOT EXISTS(SELECT * FROM A_GWPARAMVALUE WHERE PARAMITEM='PUSHCONFIG' AND  GWTYPE=4000) AND  GWTYPE=4000;


CALL DELPROC('S_WR_MTTASK');
CREATE PROCEDURE "S_WR_MTTASK"
 (IN "PIUID" INTEGER,
  IN "PIPTMSGID" BIGINT,
  IN "PISENDSTATUS" SMALLINT,
  IN "PIRETFLAG" SMALLINT,
  IN "PIPKTOTAL" SMALLINT,
  IN "PIPHONECOUNT" INTEGER,
  IN "PISPLITLEN" SMALLINT,
  IN "PIMULTILEN1" SMALLINT,
  IN "PIMULTILEN2" SMALLINT,
  IN "PISIGNLEN" SMALLINT,
  IN "PIECID" INTEGER,
  IN "PIUSERID" VARCHAR(11),
  IN "PISPGATE" VARCHAR(21),
  IN "PICPNO" VARCHAR(21),
  IN "PIRECVMTTIME" TIMESTAMP,
  IN "PIMESSAGE" VARCHAR(3000),
  IN "PISHOUJI" VARCHAR(3500),
  IN "PIFEEFLAG" SMALLINT,
  IN "PISENDLEVEL" SMALLINT,
  IN "PITASKID" INTEGER,
  IN "PIERCODE" CHARACTER(7),
  IN "PITPUDHI" SMALLINT,
  IN "PILONGMSGSEQ" SMALLINT,
  IN "PIMSGFMT" SMALLINT,
  IN "PIUNICOM" SMALLINT,
  IN "PIMOBILEAREA" INTEGER,
  IN "PIPKNUMBER" SMALLINT,
  IN "PISVRTYPE" VARCHAR(64),
  IN "PIP1" VARCHAR(64),
  IN "PIP2" VARCHAR(64),
  IN "PIP3" VARCHAR(64),
  IN "PIP4" VARCHAR(64),
  IN "PIUSERMSGID" BIGINT,
  IN "PIMODULEID" INTEGER,
  IN "PIATTIME" BIGINT,
  IN "PIVALIDTIME" BIGINT,
  IN "PISENDTYPE" INTEGER,
  IN "PIBATCHID" BIGINT,
  IN "PIAREACODE" INTEGER,
  IN "PICUSTID" VARCHAR(64),
  IN "PIEXDATA" VARCHAR(64)
 )
  SPECIFIC "S_WR_MTTASK"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN

DECLARE PITMPMSGID BIGINT;
DECLARE PILOCATION INT;
DECLARE PISTART INT;
DECLARE PIRESULTPHONE VARCHAR(21);
DECLARE PISTRSPLIT VARCHAR(2);
DECLARE PILEN INT;
DECLARE PIRESULTMSG VARCHAR(3000);
DECLARE PIPKNUM INT;
DECLARE PITMPNUM INT;
DECLARE GLOBAL TEMPORARY TABLE SESSION.TMPMTTASK(UID INT,
USERID VARCHAR(11),SPGATE VARCHAR(21),CPNO VARCHAR(21),
PHONE VARCHAR(21),PTMSGID BIGINT ,MESSAGE VARCHAR(3000),
SENDSTATUS SMALLINT,RETFLAG SMALLINT,PKNUMBER SMALLINT,
PKTOTAL SMALLINT,RECVMTTIME TIMESTAMP,ECID INT,
FEEFLAG SMALLINT,SENDLEVEL SMALLINT,TASKID INT,ERRORCODE CHAR(7),
TPUDHI SMALLINT,LONGMSGSEQ SMALLINT,MSGFMT SMALLINT,UNICOM SMALLINT,MOBILEAREA INT,
SVRTYPE VARCHAR(64),P1 VARCHAR(64),P2 VARCHAR(64),P3 VARCHAR(64),
P4 VARCHAR(64),USERMSGID BIGINT,MODULEID INT,ATTIME BIGINT,VALIDTIME BIGINT,SENDTYPE INTEGER,AREACODE INTEGER,CUSTID VARCHAR(64),EXDATA VARCHAR(64)) ON COMMIT DELETE ROWS NOT LOGGED WITH REPLACE;

SET PILEN = LENGTH(PIMESSAGE, CODEUNITS32)-PISIGNLEN;
SET PITMPNUM = 0;
SET PIPKNUM = 1;
SET PISTRSPLIT = ',';

IF PIPHONECOUNT < 1 THEN
	RETURN;
END IF;

IF PIMSGFMT=4 OR PIMSGFMT=248 OR PIMSGFMT=246 THEN
	SET PISPLITLEN=140;
	SET PIMULTILEN1=134;
	SET PIMULTILEN2=134;
	SET PISIGNLEN=0;
END IF;

IF PIMSGFMT=25  THEN
		IF NOT EXISTS (SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID) THEN
		   INSERT INTO GW_MT_TASK_BAK(UID,USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
		   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,
		   TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
		   VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI,PIPTMSGID,PIMESSAGE,PISENDSTATUS,PIRETFLAG,PIPKNUMBER,PIPKTOTAL,
		   PIRECVMTTIME,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
		   PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA);
		END IF;
		RETURN;
END IF;

IF PIPHONECOUNT = 1
THEN
	IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
	THEN
		IF PIPKTOTAL = 1
		THEN
			INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE,
			SENDSTATUS, RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,
			TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
			SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
			VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PIPTMSGID, PIMESSAGE,
			PISENDSTATUS, PIRETFLAG, PIPKNUMBER, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,
			PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
			PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA);
		ELSE
			SET PIPKNUM = 1;
			SET PITMPMSGID = PIPTMSGID;
			IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
			THEN
				SET PIRESULTMSG = SUBSTRING(PIMESSAGE,1,PISPLITLEN, CODEUNITS32);
				SET PITMPMSGID = PITMPMSGID;
				IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				THEN
					INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
					RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
					MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
					VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
					PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,
					PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
				END IF;--END OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				IF  PILEN-PISPLITLEN+PISIGNLEN>=0
				  THEN
				    SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN, CODEUNITS32);
				  ELSE
				    SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, 0, CODEUNITS32);
				END IF;
				SET PITMPMSGID = PITMPMSGID+17179869184;
				SET PIPKNUM = PIPKNUM+1;
				IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				THEN
					INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
					RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
					MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
					VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
					PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
					PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
				END IF;--END OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
			ELSE
				WHILE PIPKNUM <= PIPKTOTAL
				DO
					IF PIPKNUM = PIPKTOTAL
					THEN
						SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN, CODEUNITS32);
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					ELSEIF PIPKNUM = PIPKTOTAL-1
					THEN
						IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
						THEN
						    IF  PILEN-(PIPKNUM-1)*PIMULTILEN1-1 >=0 THEN
							   SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1, CODEUNITS32);
							ELSE
							   SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, 0, CODEUNITS32);
							END IF;
							SET PITMPNUM = PILEN-1;
						ELSE
							SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
							SET PITMPNUM = (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
						END IF;--END IF OF IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1;
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					ELSE
						SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					END IF;--END IF OF IF PIPKNUM = PIPKTOTAL
					IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					THEN
						INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
						RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
						MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
						VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
						PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
						PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
					END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					SET PIPKNUM = PIPKNUM+1;
				END WHILE;--END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
			END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1;

			INSERT INTO GW_MT_TASK_BAK (UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
			RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,
			LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
			SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,
			A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME, A.ECID, A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
			A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA FROM SESSION.TMPMTTASK A;
		END IF;--END IF OF IF PIPKTOTAL = 1
	END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
ELSE --
	SET PISHOUJI = PISTRSPLIT||PISHOUJI||PISTRSPLIT;
	SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI, CODEUNITS32);

	IF PIPKTOTAL < 1 --
	THEN
		RETURN;
	END IF;

	IF PIPKTOTAL >= 1 --
	THEN
		WHILE PILOCATION <> 0 --
		DO
			SET PISTART = PILOCATION;
			SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI,PISTART+1, CODEUNITS32);
			IF PILOCATION > 0
			THEN
				SET PIRESULTPHONE = SUBSTRING(PISHOUJI,PISTART+1,PILOCATION-PISTART-1, CODEUNITS32);--
				IF PIRESULTPHONE <> ''
				THEN
					SET PITMPMSGID = PIPTMSGID;
					IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					THEN
						IF PIPKTOTAL = 1
						THEN
							INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
							RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME,ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
							MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
							VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIMESSAGE, PISENDSTATUS,
							PIRETFLAG, PIPKTOTAL, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
							PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
						ELSE
							SET PIPKNUM = 1;
							IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
							THEN
								SET PIRESULTMSG = SUBSTRING(PIMESSAGE,1, PISPLITLEN, CODEUNITS32);--
								SET PITMPMSGID = PITMPMSGID;
								IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								THEN
									INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
									PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
									UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
									VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
									PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
									PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
								END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								IF PILEN-PISPLITLEN+PISIGNLEN>=0 THEN
								  SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN, CODEUNITS32);
								ELSE
								  SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, 0, CODEUNITS32);
								END IF;
								SET PITMPMSGID = PITMPMSGID+17179869184;
								SET PIPKNUM = PIPKNUM+1;
								IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								THEN
									INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
									PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
									UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
									VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS, PIRETFLAG,
									PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
									PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
								END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
							ELSE
								WHILE PIPKNUM <= PIPKTOTAL
								DO
									IF PIPKNUM = PIPKTOTAL
									THEN
										SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN, CODEUNITS32);
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									ELSEIF PIPKNUM = PIPKTOTAL-1
									THEN
										IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
										THEN
											SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1, CODEUNITS32);
											SET PITMPNUM = PILEN-1;
										ELSE
											SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
											SET PITMPNUM = (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
										END IF; --END IF OF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									ELSE
										SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									END IF; --END IF OF IF PIPKNUM = PIPKTOTAL
									IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
									THEN
										INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
										PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
										UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
										VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS, PIRETFLAG,
										PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
										PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
									END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
									SET PIPKNUM = PIPKNUM+1;
								END WHILE;-- END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
							END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
						END	IF;--END IF OF IF PIPKTOTAL = 1
					END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
				END IF; --END IF OF IF PIRESULTPHONE <> ''
				SET PIPTMSGID = PIPTMSGID+1;
			END	IF; --END IF OF IF PILOCATION > 0
		END WHILE; --END WHILE OF WHILE PILOCATION <> 0

		INSERT INTO GW_MT_TASK_BAK (UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
		PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
		UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
		SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,A.PKNUMBER,
		A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
		A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA FROM SESSION.TMPMTTASK A;
	END IF; --END IF OF IF PIPKTOTAL >= 1
END IF; --END IF OF IF PIPHONECOUNT = 1 --
END;

DROP PROCEDURE DELPROC;

BEGIN ATOMIC
DECLARE PIVERSION VARCHAR(32);
SET PIVERSION = '4.06.07';
IF NOT EXISTS (SELECT VERSION FROM VERSION_CMPP WHERE VERSION = PIVERSION) THEN
INSERT INTO VERSION_CMPP (VERSION,VERSIONDATE,UPGRADETIME)
VALUES (PIVERSION,CURRENT DATE,(TRIM(CHAR(YEAR(CURRENT TIMESTAMP)))||'-'|| (CASE MONTH(CURRENT TIMESTAMP) WHEN
1 THEN '01' WHEN 2 THEN '02' WHEN 3 THEN '03' WHEN 4 THEN '04' WHEN 5 THEN '05' WHEN 6 THEN '06'WHEN 7 THEN '07' WHEN 8 THEN '08' WHEN 9 THEN '09'   ELSE
TRIM(CHAR(MONTH(CURRENT TIMESTAMP))) END)||'-'||TRIM(CHAR(DAY(CURRENT TIMESTAMP)))||' '||TRIM(CHAR(HOUR(CURRENT TIMESTAMP)))||':'||TRIM(CHAR(MINUTE(CURRENT TIMESTAMP)))||':'||TRIM(CHAR(SECOND(CURRENT TIMESTAMP)))));
END IF;
END ;
/** 升级脚本(V4.06.06-V4.06.07) END */

/** 升级脚本(V4.06.07-V4.06.08) START */
CREATE PROCEDURE "DELPROC"(IN "PROCNAME1" VARCHAR(30))
  begin
DECLARE STR VARCHAR (256);
DECLARE STR1 VARCHAR (256);
SELECT PROCNAME INTO STR1 FROM SYSCAT.PROCEDURES WHERE  PROCNAME=PROCNAME1;
if  STR1 is not null THEN
  SET STR ='DROP PROCEDURE '||PROCNAME1;
  execute immediate str ;
end if;
end;

CALL DELPROC('DELTABLE');
CREATE PROCEDURE "DELTABLE"(IN "TABLENAME1" VARCHAR(20))
  begin
DECLARE STR VARCHAR (256);
DECLARE STR1 VARCHAR (256);
IF EXISTS (select * from sysibm.systables where TID <> 0 and name = TABLENAME1 ) THEN
  set STR ='drop table '|| TABLENAME1;
  execute immediate str ;
end if;
end;

CALL DELPROC('ADDCOLUMN');
CREATE PROCEDURE ADDCOLUMN (TABLENAME VARCHAR(20),COLUMNNAME VARCHAR(20),COLUMNTYPE VARCHAR(256 ))
BEGIN
DECLARE STR VARCHAR (256);
IF NOT EXISTS ( SELECT * FROM SYSIBM.SYSCOLUMNS WHERE NAME=COLUMNNAME AND TBNAME=TABLENAME ) THEN
  SET STR ='ALTER TABLE ' ||TABLENAME||' ADD COLUMN ' ||COLUMNNAME||'  '|| COLUMNTYPE;
  EXECUTE IMMEDIATE STR ;
  SET STR = 'REORG TABLE '||TABLENAME ;
  CALL SYSPROC .ADMIN_CMD(STR);
END IF;
END;

CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'SUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'LUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );

CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'SUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'LUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );

CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'SUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'LUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );

CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'SUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'LUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );

CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'SUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'LUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );

CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'SUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'LUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );

CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'SUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'LUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );

CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'SUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'LUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );

CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'SUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'LUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );

CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'SUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'LUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );

CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'SUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'LUID1','VARCHAR(64) NOT NULL DEFAULT ''''' );


--(1)当月历史表添加字段，无默认值
CALL DELPROC('ADDCOL_MTTASK_CUR');
CREATE PROCEDURE "ADDCOL_MTTASK_CUR" ( )
BEGIN
DECLARE TABLENAME1 VARCHAR(20);
DECLARE TABLENAME2 VARCHAR(20);
DECLARE STR VARCHAR(256);
DECLARE V_SQL VARCHAR(256);
DECLARE　PICNT　INT　DEFAULT　0;
DECLARE　PICNT2　INT　DEFAULT　0;
DECLARE　AT_END　INT　DEFAULT　0;
DECLARE  NOT_FOUND  CONDITION  FOR  SQLSTATE  '02000';
DECLARE V_STMT statement;
DECLARE CUR_TABLE  cursor with hold for V_STMT ;
DECLARE　CONTINUE　HANDLER　FOR　NOT_FOUND
set AT_END=1;

SET V_SQL ='SELECT TABNAME FROM SYSCAT.TABLES WHERE TABSCHEMA = CURRENT SCHEMA AND  TABNAME=''MTTASK'||CAST((SUBSTR(CHAR(CURRENT TIMESTAMP),1,4)||SUBSTR(CHAR(CURRENT TIMESTAMP),6,2))AS INT)||'''';
prepare V_STMT from V_SQL;

OPEN CUR_TABLE;
set AT_END=0;
FETCH CUR_TABLE INTO TABLENAME2;
WHILE AT_END=0 DO
  BEGIN
  --添加字段
   SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='SUID1' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
      SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN SUID1 VARCHAR(64) ';
      execute immediate str;
    end IF;
   SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='LUID1' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
      SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN LUID1 VARCHAR(64) ';
      execute immediate str;
    end IF;
  END;
  FETCH CUR_TABLE INTO TABLENAME2;
   END WHILE;
CLOSE CUR_TABLE;
END;
CALL "ADDCOL_MTTASK_CUR";
CALL DELPROC('ADDCOL_MTTASK_CUR');


--(2)当前月份以后的历史表添加字段有默认值
CALL DELPROC('ADDCOL_MTTASK');
CREATE PROCEDURE "ADDCOL_MTTASK" ( )
BEGIN
DECLARE TABLENAME1 VARCHAR(20);
DECLARE TABLENAME2 VARCHAR(20);
DECLARE STR VARCHAR(256);
DECLARE V_SQL VARCHAR(256);
DECLARE　PICNT　INT　DEFAULT　0;
DECLARE　PICNT2　INT　DEFAULT　0;
DECLARE　AT_END　INT　DEFAULT　0;
DECLARE  NOT_FOUND  CONDITION  FOR  SQLSTATE  '02000';
DECLARE V_STMT statement;
DECLARE CUR_TABLE  cursor with hold for V_STMT ;
DECLARE　CONTINUE　HANDLER　FOR　NOT_FOUND
set AT_END=1;

SET V_SQL ='SELECT TABNAME FROM SYSCAT.TABLES WHERE TABSCHEMA = CURRENT SCHEMA AND  TABNAME LIKE ''MTTASK%'' AND TABNAME>''MTTASK'||CAST((SUBSTR(CHAR(CURRENT TIMESTAMP),1,4)||SUBSTR(CHAR(CURRENT TIMESTAMP),6,2))AS INT)||'''';
prepare V_STMT from V_SQL;

OPEN CUR_TABLE;
set AT_END=0;
FETCH CUR_TABLE INTO TABLENAME2;
WHILE AT_END=0 DO
  BEGIN
  --添加字段
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='SUID1' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
      SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN SUID1 VARCHAR(64) NOT NULL DEFAULT ''''';
      execute immediate str;
    end IF;
   SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='LUID1' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
      SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN LUID1 VARCHAR(64) NOT NULL DEFAULT ''''';
      execute immediate str;
    end IF;
  END;
  FETCH CUR_TABLE INTO TABLENAME2;
   END WHILE;
CLOSE CUR_TABLE;
END;
CALL "ADDCOL_MTTASK";
CALL DELPROC('ADDCOL_MTTASK');


CALL DELPROC('GW_RD_MTLVLQUEV1');
CREATE PROCEDURE "GW_RD_MTLVLQUEV1"
 (IN "PIDESTUID" INTEGER,
  IN "PISENDLEVEL" INTEGER,
  IN "PIMAXREADCNT" INTEGER,
  IN "PISTRUID" VARCHAR(4000),
  IN "PICURTIME" BIGINT,
  IN P_TABLENO INTEGER
 )
  SPECIFIC "GW_RD_MTLVLQUEV1"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  READS SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
	DECLARE PISQLSTR VARCHAR(6000);
	DECLARE P_TABNAME VARCHAR(6000);
	DECLARE RS1 CURSOR WITH RETURN FOR S1;

	 IF  P_TABLENO>=0  AND   P_TABLENO<=9 THEN
	   SET P_TABNAME='MT_LEVEL'||CAST(P_TABLENO AS CHAR(1))||'_QUEUE';
	 ELSE
	   SET P_TABNAME='MT_LEVEL0_QUEUE';
	 END IF;

	SET PISQLSTR = 'SELECT ID,UID,DESTUID,LOGINUID,ECID,TASKID,FEEFLAG,USERID,SPGATE,CPNO,PHONE,PTMSGID,RETFLAG,TPUDHI,PKNUMBER,PKTOTAL,SENDSTATUS,PHONECOUNT,SPLITFLAG,SENDLEVEL,LONGMSGSEQ,MSGFMT,MESSAGE,SENDTIME AS RECVMTTIME,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1 FROM '||P_TABNAME||' WHERE DESTUID='||
		CAST(PIDESTUID AS CHAR(12))||' AND UID NOT IN ('||PISTRUID||')AND SENDLEVEL='||CAST(PISENDLEVEL AS CHAR(12))||' AND (ATTIME<='||CAST(PICURTIME AS CHAR(20))||' OR ATTIME<0) FETCH FIRST '||CAST(PIMAXREADCNT AS CHAR(12))||' ROW ONLY';
	PREPARE S1 FROM PISQLSTR;
	OPEN RS1;
END;

CALL DELPROC('GW_WR_MTLVLQUEV4');
CREATE PROCEDURE "GW_WR_MTLVLQUEV4"
 (IN "PIUID" INTEGER,
  IN "PIPTMSGID" BIGINT,
  IN "PIRETFLAG" SMALLINT,
  IN "PIPKTOTAL" SMALLINT,
  IN "PIPHONECOUNT" INTEGER,
  IN "PISENDSTATUS" SMALLINT,
  IN "PISPLITFLAG" SMALLINT,
  IN "PIECID" INTEGER,
  IN "PIUSERID" VARCHAR(11),
  IN "PISPGATE" VARCHAR(21),
  IN "PICPNO" VARCHAR(21),
  IN "PIRECVMTTIME" TIMESTAMP,
  IN "PIPHONE" VARCHAR(3500),
  IN "PIMESSAGE" VARCHAR(3000),
  IN "PIFEEFLAG" SMALLINT,
  IN "PIDESTUID" INTEGER,
  IN "PILOGINUID" INTEGER,
  IN "PIPKNUMBER" SMALLINT,
  IN "PISENDLEVEL" SMALLINT,
  IN "PITPUDHI" SMALLINT,
  IN "PITASKID" INTEGER,
  IN "PILONGMSGSEQ" SMALLINT,
  IN "PIMSGFMT" SMALLINT,
  IN "PITOTALCOUNT" INTEGER,
  IN "PISVRTYPE" VARCHAR(64),
  IN "PIP1" VARCHAR(64),
  IN "PIP2" VARCHAR(64),
  IN "PIP3" VARCHAR(64),
  IN "PIP4" VARCHAR(64),
  IN "PIUSERMSGID" BIGINT,
  IN "PIMODULEID" INTEGER,
  IN "PIATTIME" BIGINT,
  IN "PIVALIDTIME" BIGINT,
  IN "PISENDTYPE" INTEGER,
  IN "PIBATCHID" BIGINT,
  IN "PIAREACODE" INTEGER,
  IN "PICUSTID" VARCHAR(64),
  IN "PIEXDATA" VARCHAR(64),
  IN "PILONGMSG" VARCHAR(4000),
  IN "PITMPLID" BIGINT,
  IN "PICHGRADE" SMALLINT,
  IN "PIMSGTYPE" SMALLINT,
  IN "PIRMSVALIDTM" SMALLINT,
  IN "PIPROTOCOLVER" SMALLINT,
  IN "PITMPLTYPE" SMALLINT,
  IN "PITITLE" VARCHAR(40),
  IN "PISHOWAY" VARCHAR(16),
  IN "PIDLDWAY" INTEGER,
  IN "PIDLDNEY" INTEGER,
  IN "PIISFREE" INTEGER,
  IN "PISHOWTIME" BIGINT,
  IN "PISUID1" VARCHAR(64),
  IN "PILUID1" VARCHAR(64),
  IN P_TABLENO INTEGER
 )
  SPECIFIC "GW_WR_MTLVLQUEV4"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
	IF P_TABLENO =0 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL0_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL0_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
   END IF;
ELSEIF P_TABLENO =1 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL1_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL1_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
   END IF;
ELSEIF P_TABLENO =2 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL2_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL2_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
   END IF;
ELSEIF P_TABLENO =3 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL3_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL3_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
   END IF;
ELSEIF P_TABLENO =4 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL4_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL4_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
   END IF;
ELSEIF P_TABLENO =5 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL5_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL5_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
   END IF;
ELSEIF P_TABLENO =6 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL6_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL6_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
   END IF;
ELSEIF P_TABLENO =7 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL7_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL7_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
   END IF;
ELSEIF P_TABLENO =8 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL8_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL8_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
   END IF;
ELSEIF P_TABLENO =9 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL9_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL9_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
   END IF;
END IF;
END;

CALL DELPROC('GW_WR_MTTASKV4');
CREATE PROCEDURE "GW_WR_MTTASKV4"
 (IN "PIUID" INTEGER,
  IN "PIPTMSGID" BIGINT,
  IN "PISENDSTATUS" SMALLINT,
  IN "PIRETFLAG" SMALLINT,
  IN "PIPKTOTAL" SMALLINT,
  IN "PIPHONECOUNT" INTEGER,
  IN "PISPLITLEN" SMALLINT,
  IN "PIMULTILEN1" SMALLINT,
  IN "PIMULTILEN2" SMALLINT,
  IN "PISIGNLEN" SMALLINT,
  IN "PIECID" INTEGER,
  IN "PIUSERID" VARCHAR(11),
  IN "PISPGATE" VARCHAR(21),
  IN "PICPNO" VARCHAR(21),
  IN "PIRECVMTTIME" TIMESTAMP,
  IN "PIMESSAGE" VARCHAR(3000),
  IN "PISHOUJI" VARCHAR(3500),
  IN "PIFEEFLAG" SMALLINT,
  IN "PISENDLEVEL" SMALLINT,
  IN "PITASKID" INTEGER,
  IN "PIERCODE" CHARACTER(7),
  IN "PITPUDHI" SMALLINT,
  IN "PILONGMSGSEQ" SMALLINT,
  IN "PIMSGFMT" SMALLINT,
  IN "PIUNICOM" SMALLINT,
  IN "PIMOBILEAREA" INTEGER,
  IN "PIPKNUMBER" SMALLINT,
  IN "PISVRTYPE" VARCHAR(64),
  IN "PIP1" VARCHAR(64),
  IN "PIP2" VARCHAR(64),
  IN "PIP3" VARCHAR(64),
  IN "PIP4" VARCHAR(64),
  IN "PIUSERMSGID" BIGINT,
  IN "PIMODULEID" INTEGER,
  IN "PIATTIME" BIGINT,
  IN "PIVALIDTIME" BIGINT,
  IN "PISENDTYPE" INTEGER,
  IN "PIBATCHID" BIGINT,
  IN "PIAREACODE" INTEGER,
  IN "PICUSTID" VARCHAR(64),
  IN "PIEXDATA" VARCHAR(64),
  IN "PILONGMSG" VARCHAR(4000),
  IN "PITMPLID" BIGINT,
  IN "PICHGRADE" SMALLINT,
  IN "PIMSGTYPE" SMALLINT,
  IN "PIRMSVALIDTM" SMALLINT,
  IN "PIRMSRPTFLAG" SMALLINT,
  IN "PIPROTOCOLVER" SMALLINT,
  IN "PITMPLTYPE" SMALLINT,
  IN "PITITLE" VARCHAR(40),
  IN "PISHOWAY" VARCHAR(16),
  IN "PIDLDWAY" INTEGER,
  IN "PIDLDNEY" INTEGER,
  IN "PIISFREE" INTEGER,
  IN "PISHOWTIME" BIGINT,
  IN "PISUID1" VARCHAR(64),
  IN "PILUID1" VARCHAR(64)
 )
  SPECIFIC "GW_WR_MTTASKV4"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN

DECLARE PITMPMSGID BIGINT;
DECLARE PILOCATION INT;
DECLARE PISTART INT;
DECLARE PIRESULTPHONE VARCHAR(21);
DECLARE PISTRSPLIT VARCHAR(2);
DECLARE PILEN INT;
DECLARE PIRESULTMSG VARCHAR(3000);
DECLARE PIPKNUM INT;
DECLARE PITMPNUM INT;
DECLARE GLOBAL TEMPORARY TABLE SESSION.TMPMTTASK(UID INT,
USERID VARCHAR(11),SPGATE VARCHAR(21),CPNO VARCHAR(21),
PHONE VARCHAR(21),PTMSGID BIGINT ,MESSAGE VARCHAR(3000),
SENDSTATUS SMALLINT,RETFLAG SMALLINT,PKNUMBER SMALLINT,
PKTOTAL SMALLINT,RECVMTTIME TIMESTAMP,ECID INT,
FEEFLAG SMALLINT,SENDLEVEL SMALLINT,TASKID INT,ERRORCODE CHAR(7),
TPUDHI SMALLINT,LONGMSGSEQ SMALLINT,MSGFMT SMALLINT,UNICOM SMALLINT,MOBILEAREA INT,
SVRTYPE VARCHAR(64),P1 VARCHAR(64),P2 VARCHAR(64),P3 VARCHAR(64),
P4 VARCHAR(64),USERMSGID BIGINT,MODULEID INT,ATTIME BIGINT,VALIDTIME BIGINT,SENDTYPE INTEGER,AREACODE INTEGER,CUSTID VARCHAR(64),EXDATA VARCHAR(64),LONGMSG VARCHAR(4000),TMPLID BIGINT,CHGRADE SMALLINT,MSGTYPE SMALLINT,RMSVALIDTM SMALLINT,RMSRPTFLAG SMALLINT,PROTOCOLVER SMALLINT,TMPLTYPE SMALLINT,TITLE VARCHAR(40),SHOWAY VARCHAR(16),DLDWAY INTEGER,DLDNEY INTEGER,ISFREE INTEGER,SHOWTIME BIGINT,SUID1 VARCHAR(64),LUID1 VARCHAR(64)) ON COMMIT DELETE ROWS NOT LOGGED WITH REPLACE;

SET PILEN = LENGTH(PILONGMSG, CODEUNITS32)-PISIGNLEN;
SET PITMPNUM = 0;
SET PIPKNUM = 1;
SET PISTRSPLIT = ',';

IF PIPHONECOUNT < 1 THEN
	RETURN;
END IF;

IF PIMSGFMT=4 OR PIMSGFMT=248 OR PIMSGFMT=246 THEN
	SET PISPLITLEN=140;
	SET PIMULTILEN1=134;
	SET PIMULTILEN2=134;
	SET PISIGNLEN=0;
END IF;

IF PIMSGFMT=25  THEN
		IF NOT EXISTS (SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID) THEN
		   INSERT INTO GW_MT_TASK_BAK(UID,USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
		   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,
		   TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
		   VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI,PIPTMSGID,PIMESSAGE,PISENDSTATUS,PIRETFLAG,PIPKNUMBER,PIPKTOTAL,
		   PIRECVMTTIME,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
		   PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
		END IF;
		RETURN;
END IF;

IF PIPHONECOUNT = 1
THEN
	IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
	THEN
		IF PIPKTOTAL = 1
		THEN
			INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE,
			SENDSTATUS, RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,
			TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
			SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
			VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PIPTMSGID, PIMESSAGE,
			PISENDSTATUS, PIRETFLAG, PIPKNUMBER, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,
			PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
			PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
		ELSE
			SET PIPKNUM = 1;
			SET PITMPMSGID = PIPTMSGID;
			IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
			THEN
				SET PIRESULTMSG = SUBSTRING(PIMESSAGE,1,PISPLITLEN, CODEUNITS32);
				SET PITMPMSGID = PITMPMSGID;
				IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				THEN
					INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
					RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
					MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
					VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
					PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,
					PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
				END IF;--END OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PIPTMSGID)
				IF  PILEN-PISPLITLEN+PISIGNLEN>=0
				  THEN
				    SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN, CODEUNITS32);
				  ELSE
				    SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, 0, CODEUNITS32);
				END IF;
				SET PITMPMSGID = PITMPMSGID+17179869184;
				SET PIPKNUM = PIPKNUM+1;
				IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				THEN
					INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
					RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
					MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
					VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
					PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
					PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
				END IF;--END OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
			ELSE
				WHILE PIPKNUM <= PIPKTOTAL
				DO
					IF PIPKNUM = PIPKTOTAL
					THEN
						SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN, CODEUNITS32);
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					ELSEIF PIPKNUM = PIPKTOTAL-1
					THEN
						IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
						THEN
						    IF  PILEN-(PIPKNUM-1)*PIMULTILEN1-1 >=0 THEN
							   SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1, CODEUNITS32);
							ELSE
							   SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, 0, CODEUNITS32);
							END IF;
							SET PITMPNUM = PILEN-1;
						ELSE
							SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
							SET PITMPNUM = (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
						END IF;--END IF OF IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1;
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					ELSE
						SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					END IF;--END IF OF IF PIPKNUM = PIPKTOTAL
					IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					THEN
						INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
						RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
						MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
						VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
						PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
						PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
					END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
					SET PIPKNUM = PIPKNUM+1;
				END WHILE;--END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
			END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1;

			INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
			RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,
			LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
			SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,
			A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME, A.ECID, A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
			A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,A.AREACODE,A.CUSTID,A.EXDATA,A.LONGMSG,A.TMPLID,A.CHGRADE,A.MSGTYPE,A.RMSVALIDTM,A.RMSRPTFLAG,A.PROTOCOLVER,A.TMPLTYPE,A.TITLE,A.SHOWAY,A.DLDWAY,A.DLDNEY,A.ISFREE,A.SHOWTIME,A.SUID1,A.LUID1 FROM SESSION.TMPMTTASK A;
		END IF;--END IF OF IF PIPKTOTAL = 1
	END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PIPTMSGID)
ELSE --
	SET PISHOUJI = PISTRSPLIT||PISHOUJI||PISTRSPLIT;
	SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI, CODEUNITS32);

	IF PIPKTOTAL < 1 --
	THEN
		RETURN;
	END IF;

	IF PIPKTOTAL >= 1 --
	THEN
		WHILE PILOCATION <> 0 --
		DO
			SET PISTART = PILOCATION;
			SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI,PISTART+1, CODEUNITS32);
			IF PILOCATION > 0
			THEN
				SET PIRESULTPHONE = SUBSTRING(PISHOUJI,PISTART+1,PILOCATION-PISTART-1, CODEUNITS32);--
				IF PIRESULTPHONE <> ''
				THEN
					SET PITMPMSGID = PIPTMSGID;
					IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					THEN
						IF PIPKTOTAL = 1
						THEN
							INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
							RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME,ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
							MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
							VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIMESSAGE, PISENDSTATUS,
							PIRETFLAG, PIPKTOTAL, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
							PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
						ELSE
							SET PIPKNUM = 1;
							IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
							THEN
								SET PIRESULTMSG = SUBSTRING(PIMESSAGE,1, PISPLITLEN, CODEUNITS32);--
								SET PITMPMSGID = PITMPMSGID;
								IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								THEN
									INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
									PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
									UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
									VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
									PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
									PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
								END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								IF PILEN-PISPLITLEN+PISIGNLEN>=0 THEN
								  SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN, CODEUNITS32);
								ELSE
								  SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, 0, CODEUNITS32);
								END IF;
								SET PITMPMSGID = PITMPMSGID+17179869184;
								SET PIPKNUM = PIPKNUM+1;
								IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								THEN
									INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
									PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
									UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
									VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS, PIRETFLAG,
									PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
									PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
								END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
							ELSE
								WHILE PIPKNUM <= PIPKTOTAL
								DO
									IF PIPKNUM = PIPKTOTAL
									THEN
										SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN, CODEUNITS32);
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									ELSEIF PIPKNUM = PIPKTOTAL-1
									THEN
										IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
										THEN
											SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1, CODEUNITS32);
											SET PITMPNUM = PILEN-1;
										ELSE
											SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
											SET PITMPNUM = (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
										END IF; --END IF OF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									ELSE
										SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									END IF; --END IF OF IF PIPKNUM = PIPKTOTAL
									IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
									THEN
										INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
										PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
										UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
										VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS, PIRETFLAG,
										PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
										PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
									END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
									SET PIPKNUM = PIPKNUM+1;
								END WHILE;-- END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
							END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
						END	IF;--END IF OF IF PIPKTOTAL = 1
					END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
				END IF; --END IF OF IF PIRESULTPHONE <> ''
				SET PIPTMSGID = PIPTMSGID+1;
			END	IF; --END IF OF IF PILOCATION > 0
		END WHILE; --END WHILE OF WHILE PILOCATION <> 0

		INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
		PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
		UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
		SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,A.PKNUMBER,
		A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
		A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,A.AREACODE,A.CUSTID,A.EXDATA,A.LONGMSG,A.TMPLID,A.CHGRADE,A.MSGTYPE,A.RMSVALIDTM,A.RMSRPTFLAG,A.PROTOCOLVER,A.TMPLTYPE,A.TITLE,A.SHOWAY,A.DLDWAY,A.DLDNEY,A.ISFREE,A.SHOWTIME,A.SUID1,A.LUID1 FROM SESSION.TMPMTTASK A;
	END IF; --END IF OF IF PIPKTOTAL >= 1
END IF; --END IF OF IF PIPHONECOUNT = 1 --
END;

CALL DELPROC('GW_WR_MTTASKV5');
CREATE PROCEDURE "GW_WR_MTTASKV5"
 (IN "PIUID" INTEGER,
  IN "PIPTMSGID" BIGINT,
  IN "PISENDSTATUS" SMALLINT,
  IN "PIRETFLAG" SMALLINT,
  IN "PIPKTOTAL" SMALLINT,
  IN "PIPHONECOUNT" INTEGER,
  IN "PISPLITLEN" SMALLINT,
  IN "PIMULTILEN1" SMALLINT,
  IN "PIMULTILEN2" SMALLINT,
  IN "PISIGNLEN" SMALLINT,
  IN "PIECID" INTEGER,
  IN "PIUSERID" VARCHAR(11),
  IN "PISPGATE" VARCHAR(21),
  IN "PICPNO" VARCHAR(21),
  IN "PIRECVMTTIME" TIMESTAMP,
  IN "PIMESSAGE" VARCHAR(3000),
  IN "PISHOUJI" VARCHAR(3500),
  IN "PIFEEFLAG" SMALLINT,
  IN "PISENDLEVEL" SMALLINT,
  IN "PITASKID" INTEGER,
  IN "PIERCODE" CHARACTER(7),
  IN "PITPUDHI" SMALLINT,
  IN "PILONGMSGSEQ" SMALLINT,
  IN "PIMSGFMT" SMALLINT,
  IN "PIUNICOM" SMALLINT,
  IN "PIMOBILEAREA" INTEGER,
  IN "PIPKNUMBER" SMALLINT,
  IN "PISVRTYPE" VARCHAR(64),
  IN "PIP1" VARCHAR(64),
  IN "PIP2" VARCHAR(64),
  IN "PIP3" VARCHAR(64),
  IN "PIP4" VARCHAR(64),
  IN "PIUSERMSGID" BIGINT,
  IN "PIMODULEID" INTEGER,
  IN "PIATTIME" BIGINT,
  IN "PIVALIDTIME" BIGINT,
  IN "PISENDTYPE" INTEGER,
  IN "PIBATCHID" BIGINT,
  IN "PIAREACODE" INTEGER,
  IN "PICUSTID" VARCHAR(64),
  IN "PIEXDATA" VARCHAR(64),
  IN "PISUID1" VARCHAR(64),
  IN "PILUID1" VARCHAR(64)
 )
  SPECIFIC "GW_WR_MTTASKV5"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN

DECLARE PITMPMSGID BIGINT;
DECLARE PILOCATION INT;
DECLARE PISTART INT;
DECLARE PIRESULTPHONE VARCHAR(21);
DECLARE PISTRSPLIT VARCHAR(2);
DECLARE PILEN INT;
DECLARE PIRESULTMSG VARCHAR(3000);
DECLARE PIPKNUM INT;
DECLARE PITMPNUM INT;
DECLARE GLOBAL TEMPORARY TABLE SESSION.TMPMTTASK(UID INT,
USERID VARCHAR(11),SPGATE VARCHAR(21),CPNO VARCHAR(21),
PHONE VARCHAR(21),PTMSGID BIGINT ,MESSAGE VARCHAR(3000),
SENDSTATUS SMALLINT,RETFLAG SMALLINT,PKNUMBER SMALLINT,
PKTOTAL SMALLINT,RECVMTTIME TIMESTAMP,ECID INT,
FEEFLAG SMALLINT,SENDLEVEL SMALLINT,TASKID INT,ERRORCODE CHAR(7),
TPUDHI SMALLINT,LONGMSGSEQ SMALLINT,MSGFMT SMALLINT,UNICOM SMALLINT,MOBILEAREA INT,
SVRTYPE VARCHAR(64),P1 VARCHAR(64),P2 VARCHAR(64),P3 VARCHAR(64),
P4 VARCHAR(64),USERMSGID BIGINT,MODULEID INT,ATTIME BIGINT,VALIDTIME BIGINT,SENDTYPE INTEGER,AREACODE INTEGER,CUSTID VARCHAR(64),EXDATA VARCHAR(64),SUID1 VARCHAR(64),LUID1 VARCHAR(64)) ON COMMIT DELETE ROWS NOT LOGGED WITH REPLACE;

SET PILEN = LENGTH(PIMESSAGE, CODEUNITS32)-PISIGNLEN;
SET PITMPNUM = 0;
SET PIPKNUM = 1;
SET PISTRSPLIT = ',';

IF PIPHONECOUNT < 1 THEN
	RETURN;
END IF;

IF PIMSGFMT=4 OR PIMSGFMT=248 OR PIMSGFMT=246 THEN
	SET PISPLITLEN=140;
	SET PIMULTILEN1=134;
	SET PIMULTILEN2=134;
	SET PISIGNLEN=0;
END IF;

IF PIMSGFMT=25  THEN
		IF NOT EXISTS (SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID) THEN
		   INSERT INTO GW_MT_TASK_BAK(UID,USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
		   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,
		   TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
		   VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI,PIPTMSGID,PIMESSAGE,PISENDSTATUS,PIRETFLAG,PIPKNUMBER,PIPKTOTAL,
		   PIRECVMTTIME,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
		   PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
		END IF;
		RETURN;
END IF;

IF PIPHONECOUNT = 1
THEN
	IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
	THEN
		IF PIPKTOTAL = 1
		THEN
			INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE,
			SENDSTATUS, RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,
			TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
			SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
			VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PIPTMSGID, PIMESSAGE,
			PISENDSTATUS, PIRETFLAG, PIPKNUMBER, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,
			PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
			PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
		ELSE
			SET PIPKNUM = 1;
			SET PITMPMSGID = PIPTMSGID;
			IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
			THEN
				SET PIRESULTMSG = SUBSTRING(PIMESSAGE,1,PISPLITLEN, CODEUNITS32);
				SET PITMPMSGID = PITMPMSGID;
				IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				THEN
					INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
					RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
					MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
					VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
					PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,
					PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
				END IF;--END OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PIPTMSGID)
				IF  PILEN-PISPLITLEN+PISIGNLEN>=0
				  THEN
				    SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN, CODEUNITS32);
				  ELSE
				    SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, 0, CODEUNITS32);
				END IF;
				SET PITMPMSGID = PITMPMSGID+17179869184;
				SET PIPKNUM = PIPKNUM+1;
				IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				THEN
					INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
					RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
					MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
					VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
					PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
					PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
				END IF;--END OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
			ELSE
				WHILE PIPKNUM <= PIPKTOTAL
				DO
					IF PIPKNUM = PIPKTOTAL
					THEN
						SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN, CODEUNITS32);
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					ELSEIF PIPKNUM = PIPKTOTAL-1
					THEN
						IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
						THEN
						    IF  PILEN-(PIPKNUM-1)*PIMULTILEN1-1 >=0 THEN
							   SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1, CODEUNITS32);
							ELSE
							   SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, 0, CODEUNITS32);
							END IF;
							SET PITMPNUM = PILEN-1;
						ELSE
							SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
							SET PITMPNUM = (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
						END IF;--END IF OF IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1;
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					ELSE
						SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					END IF;--END IF OF IF PIPKNUM = PIPKTOTAL
					IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					THEN
						INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
						RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
						MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
						VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
						PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
						PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
					END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
					SET PIPKNUM = PIPKNUM+1;
				END WHILE;--END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
			END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1;

			INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
			RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,
			LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
			SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,
			A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME, A.ECID, A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
			A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,A.AREACODE,A.CUSTID,A.EXDATA,A.SUID1,A.LUID1 FROM SESSION.TMPMTTASK A;
		END IF;--END IF OF IF PIPKTOTAL = 1
	END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PIPTMSGID)
ELSE --
	SET PISHOUJI = PISTRSPLIT||PISHOUJI||PISTRSPLIT;
	SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI, CODEUNITS32);

	IF PIPKTOTAL < 1 --
	THEN
		RETURN;
	END IF;

	IF PIPKTOTAL >= 1 --
	THEN
		WHILE PILOCATION <> 0 --
		DO
			SET PISTART = PILOCATION;
			SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI,PISTART+1, CODEUNITS32);
			IF PILOCATION > 0
			THEN
				SET PIRESULTPHONE = SUBSTRING(PISHOUJI,PISTART+1,PILOCATION-PISTART-1, CODEUNITS32);--
				IF PIRESULTPHONE <> ''
				THEN
					SET PITMPMSGID = PIPTMSGID;
					IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					THEN
						IF PIPKTOTAL = 1
						THEN
							INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
							RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME,ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
							MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
							VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIMESSAGE, PISENDSTATUS,
							PIRETFLAG, PIPKTOTAL, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
							PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
						ELSE
							SET PIPKNUM = 1;
							IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
							THEN
								SET PIRESULTMSG = SUBSTRING(PIMESSAGE,1, PISPLITLEN, CODEUNITS32);--
								SET PITMPMSGID = PITMPMSGID;
								IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								THEN
									INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
									PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
									UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
									VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
									PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
									PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
								END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								IF PILEN-PISPLITLEN+PISIGNLEN>=0 THEN
								  SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN, CODEUNITS32);
								ELSE
								  SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, 0, CODEUNITS32);
								END IF;
								SET PITMPMSGID = PITMPMSGID+17179869184;
								SET PIPKNUM = PIPKNUM+1;
								IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								THEN
									INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
									PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
									UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
									VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS, PIRETFLAG,
									PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
									PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
								END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
							ELSE
								WHILE PIPKNUM <= PIPKTOTAL
								DO
									IF PIPKNUM = PIPKTOTAL
									THEN
										SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN, CODEUNITS32);
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									ELSEIF PIPKNUM = PIPKTOTAL-1
									THEN
										IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
										THEN
											SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1, CODEUNITS32);
											SET PITMPNUM = PILEN-1;
										ELSE
											SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
											SET PITMPNUM = (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
										END IF; --END IF OF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									ELSE
										SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									END IF; --END IF OF IF PIPKNUM = PIPKTOTAL
									IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
									THEN
										INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
										PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
										UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
										VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS, PIRETFLAG,
										PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
										PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
									END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
									SET PIPKNUM = PIPKNUM+1;
								END WHILE;-- END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
							END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
						END	IF;--END IF OF IF PIPKTOTAL = 1
					END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
				END IF; --END IF OF IF PIRESULTPHONE <> ''
				SET PIPTMSGID = PIPTMSGID+1;
			END	IF; --END IF OF IF PILOCATION > 0
		END WHILE; --END WHILE OF WHILE PILOCATION <> 0

		INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
		PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
		UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
		SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,A.PKNUMBER,
		A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
		A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,A.AREACODE,A.CUSTID,A.EXDATA,A.SUID1,A.LUID1 FROM SESSION.TMPMTTASK A;
	END IF; --END IF OF IF PIPKTOTAL >= 1
END IF; --END IF OF IF PIPHONECOUNT = 1 --
END;


CALL DELPROC('GW_WR_MTTASKSRV4');
CREATE PROCEDURE "GW_WR_MTTASKSRV4"
 (IN "PIUID" INTEGER,
  IN "PIPTMSGID" BIGINT,
  IN "PISENDSTATUS" SMALLINT,
  IN "PIRETFLAG" SMALLINT,
  IN "PIPKTOTAL" SMALLINT,
  IN "PIPHONECOUNT" INTEGER,
  IN "PIECID" INTEGER,
  IN "PIUSERID" VARCHAR(11),
  IN "PISPGATE" VARCHAR(21),
  IN "PICPNO" VARCHAR(21),
  IN "PIRECVMTTIME" TIMESTAMP,
  IN "PIMESSAGE" VARCHAR(3000),
  IN "PISHOUJI" VARCHAR(3500),
  IN "PIFEEFLAG" SMALLINT,
  IN "PIPKNUMBER" SMALLINT,
  IN "PISENDLEVEL" SMALLINT,
  IN "PITASKID" INTEGER,
  IN "PIERCODE" CHARACTER(7),
  IN "PITPUDHI" SMALLINT,
  IN "PILONGMSGSEQ" SMALLINT,
  IN "PIMSGFMT" SMALLINT,
  IN "PIUNICOM" SMALLINT,
  IN "PIMOBILEAREA" INTEGER,
  IN "PISVRTYPE" VARCHAR(64),
  IN "PIP1" VARCHAR(64),
  IN "PIP2" VARCHAR(64),
  IN "PIP3" VARCHAR(64),
  IN "PIP4" VARCHAR(64),
  IN "PIUSERMSGID" BIGINT,
  IN "PIMODULEID" INTEGER,
  IN "PIATTIME" BIGINT,
  IN "PIVALIDTIME" BIGINT,
  IN "PISENDTYPE" INTEGER,
  IN "PIBATCHID" BIGINT,
  IN "PIAREACODE" INTEGER,
  IN "PICUSTID" VARCHAR(64),
  IN "PIEXDATA" VARCHAR(64),
  IN "PILONGMSG" VARCHAR(4000),
  IN "PITMPLID" BIGINT,
  IN "PICHGRADE" SMALLINT,
  IN "PIMSGTYPE" SMALLINT,
  IN "PIRMSVALIDTM" SMALLINT,
  IN "PIRMSRPTFLAG" SMALLINT,
  IN "PIPROTOCOLVER" SMALLINT,
  IN "PITMPLTYPE" SMALLINT,
  IN "PITITLE" VARCHAR(40),
  IN "PISHOWAY" VARCHAR(16),
  IN "PIDLDWAY" INTEGER,
  IN "PIDLDNEY" INTEGER,
  IN "PIISFREE" INTEGER,
  IN "PISHOWTIME" BIGINT,
  IN "PISUID1" VARCHAR(64),
  IN "PILUID1" VARCHAR(64)
 )
  SPECIFIC "GW_WR_MTTASKSRV4"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN

DECLARE PILOCATION INT;
DECLARE PISTART INT;
DECLARE PIRESULTPHONE VARCHAR(21);
DECLARE PISTRSPLIT VARCHAR(2);
SET PISTRSPLIT = ',';
--SET PIRECVMTTIME =CURRENT TIMESTAMP;
DECLARE GLOBAL TEMPORARY TABLE SESSION.PITMP(UID INT,USERID VARCHAR(11),SPGATE VARCHAR(21),CPNO VARCHAR(21),PHONE VARCHAR(21),
PTMSGID BIGINT ,MESSAGE VARCHAR(3000),SENDSTATUS SMALLINT,RETFLAG SMALLINT,PKNUMBER SMALLINT,
PKTOTAL SMALLINT,RECVMTTIME TIMESTAMP,ECID INT,FEEFLAG SMALLINT,SENDLEVEL SMALLINT,TASKID INT,ERRORCODE CHAR(7),
TPUDHI SMALLINT,LONGMSGSEQ SMALLINT,MSGFMT SMALLINT,UNICOM SMALLINT,MOBILEAREA INT,
SVRTYPE VARCHAR(64),P1 VARCHAR(64),P2 VARCHAR(64),P3 VARCHAR(64),
P4 VARCHAR(64),USERMSGID BIGINT,MODULEID INT,ATTIME BIGINT,VALIDTIME BIGINT,SENDTYPE INTEGER)ON COMMIT DELETE ROWS NOT LOGGED WITH REPLACE;

IF PIPHONECOUNT < 1 THEN--
	RETURN;
END IF;

IF PIPHONECOUNT = 1 THEN--
	IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID) THEN
		INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG, PKNUMBER,
		PKTOTAL, RECVMTTIME, ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
		SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
		VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PIPTMSGID, PIMESSAGE, PISENDSTATUS, PIRETFLAG, PIPKNUMBER,
		PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG, PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
		PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
	END IF;
ELSE --
	SET PISHOUJI = PISTRSPLIT||PISHOUJI||PISTRSPLIT;
	SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI, CODEUNITS32);
	WHILE PILOCATION <> 0 --
	DO
	  SET PISTART = PILOCATION;
	  SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI,PISTART+1, CODEUNITS32);
	  IF PILOCATION > 0
	  THEN
		  IF PILOCATION-PISTART-1 >=0 THEN
		    SET PIRESULTPHONE = SUBSTRING(PISHOUJI,PISTART+1,PILOCATION-PISTART-1, CODEUNITS32);
		  ELSE
		    SET PIRESULTPHONE = SUBSTRING(PISHOUJI,PISTART+1,0, CODEUNITS32);
		  END IF;
		  IF PIRESULTPHONE <> ''
		  THEN
			  IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID) THEN
				  INSERT INTO SESSION.PITMP(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG, PKNUMBER,
				  PKTOTAL, RECVMTTIME,ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
				  SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
				  VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PIPTMSGID, PIMESSAGE, PISENDSTATUS, PIRETFLAG, PIPKNUMBER,
				  PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG, PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
				  PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
			  END IF;
			  SET PIPTMSGID = PIPTMSGID+1;
		  END IF;
	    END IF;
	 END WHILE;

	 INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG, PKNUMBER,
	 PKTOTAL, RECVMTTIME, ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
	 SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
	 SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,A.PKNUMBER,
	 A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,A.MSGFMT,A.UNICOM,
	 A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1 FROM SESSION.PITMP A;
END IF;
END;

CALL DELPROC('GW_WR_MTTASKSRV5');
CREATE PROCEDURE "GW_WR_MTTASKSRV5"
 (IN "PIUID" INTEGER,
  IN "PIPTMSGID" BIGINT,
  IN "PISENDSTATUS" SMALLINT,
  IN "PIRETFLAG" SMALLINT,
  IN "PIPKTOTAL" SMALLINT,
  IN "PIPHONECOUNT" INTEGER,
  IN "PIECID" INTEGER,
  IN "PIUSERID" VARCHAR(11),
  IN "PISPGATE" VARCHAR(21),
  IN "PICPNO" VARCHAR(21),
  IN "PIRECVMTTIME" TIMESTAMP,
  IN "PIMESSAGE" VARCHAR(3000),
  IN "PISHOUJI" VARCHAR(3500),
  IN "PIFEEFLAG" SMALLINT,
  IN "PIPKNUMBER" SMALLINT,
  IN "PISENDLEVEL" SMALLINT,
  IN "PITASKID" INTEGER,
  IN "PIERCODE" CHARACTER(7),
  IN "PITPUDHI" SMALLINT,
  IN "PILONGMSGSEQ" SMALLINT,
  IN "PIMSGFMT" SMALLINT,
  IN "PIUNICOM" SMALLINT,
  IN "PIMOBILEAREA" INTEGER,
  IN "PISVRTYPE" VARCHAR(64),
  IN "PIP1" VARCHAR(64),
  IN "PIP2" VARCHAR(64),
  IN "PIP3" VARCHAR(64),
  IN "PIP4" VARCHAR(64),
  IN "PIUSERMSGID" BIGINT,
  IN "PIMODULEID" INTEGER,
  IN "PIATTIME" BIGINT,
  IN "PIVALIDTIME" BIGINT,
  IN "PISENDTYPE" INTEGER,
  IN "PIBATCHID" BIGINT,
  IN "PIAREACODE" INTEGER,
  IN "PICUSTID" VARCHAR(64),
  IN "PIEXDATA" VARCHAR(64),
  IN "PISUID1" VARCHAR(64),
  IN "PILUID1" VARCHAR(64)
 )
  SPECIFIC "GW_WR_MTTASKSRV5"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN

DECLARE PILOCATION INT;
DECLARE PISTART INT;
DECLARE PIRESULTPHONE VARCHAR(21);
DECLARE PISTRSPLIT VARCHAR(2);
SET PISTRSPLIT = ',';
--SET PIRECVMTTIME =CURRENT TIMESTAMP;
DECLARE GLOBAL TEMPORARY TABLE SESSION.PITMP(UID INT,USERID VARCHAR(11),SPGATE VARCHAR(21),CPNO VARCHAR(21),PHONE VARCHAR(21),
PTMSGID BIGINT ,MESSAGE VARCHAR(3000),SENDSTATUS SMALLINT,RETFLAG SMALLINT,PKNUMBER SMALLINT,
PKTOTAL SMALLINT,RECVMTTIME TIMESTAMP,ECID INT,FEEFLAG SMALLINT,SENDLEVEL SMALLINT,TASKID INT,ERRORCODE CHAR(7),
TPUDHI SMALLINT,LONGMSGSEQ SMALLINT,MSGFMT SMALLINT,UNICOM SMALLINT,MOBILEAREA INT,
SVRTYPE VARCHAR(64),P1 VARCHAR(64),P2 VARCHAR(64),P3 VARCHAR(64),
P4 VARCHAR(64),USERMSGID BIGINT,MODULEID INT,ATTIME BIGINT,VALIDTIME BIGINT,SENDTYPE INTEGER)ON COMMIT DELETE ROWS NOT LOGGED WITH REPLACE;

IF PIPHONECOUNT < 1 THEN--
	RETURN;
END IF;

IF PIPHONECOUNT = 1 THEN--
	IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID) THEN
		INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG, PKNUMBER,
		PKTOTAL, RECVMTTIME, ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
		SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
		VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PIPTMSGID, PIMESSAGE, PISENDSTATUS, PIRETFLAG, PIPKNUMBER,
		PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG, PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
		PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
	END IF;
ELSE --
	SET PISHOUJI = PISTRSPLIT||PISHOUJI||PISTRSPLIT;
	SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI, CODEUNITS32);
	WHILE PILOCATION <> 0 --
	DO
	  SET PISTART = PILOCATION;
	  SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI,PISTART+1, CODEUNITS32);
	  IF PILOCATION > 0
	  THEN
		  IF PILOCATION-PISTART-1 >=0 THEN
		    SET PIRESULTPHONE = SUBSTRING(PISHOUJI,PISTART+1,PILOCATION-PISTART-1, CODEUNITS32);
		  ELSE
		    SET PIRESULTPHONE = SUBSTRING(PISHOUJI,PISTART+1,0, CODEUNITS32);
		  END IF;
		  IF PIRESULTPHONE <> ''
		  THEN
			  IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID) THEN
				  INSERT INTO SESSION.PITMP(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG, PKNUMBER,
				  PKTOTAL, RECVMTTIME,ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
				  SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
				  VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PIPTMSGID, PIMESSAGE, PISENDSTATUS, PIRETFLAG, PIPKNUMBER,
				  PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG, PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
				  PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
			  END IF;
			  SET PIPTMSGID = PIPTMSGID+1;
		  END IF;
	    END IF;
	 END WHILE;

	 INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG, PKNUMBER,
	 PKTOTAL, RECVMTTIME, ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
	 SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
	 SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,A.PKNUMBER,
	 A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,A.MSGFMT,A.UNICOM,
	 A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1 FROM SESSION.PITMP A;
END IF;
END;

CALL DELPROC('GW_WR_MTTASKBAKV2');
CREATE PROCEDURE GW_WR_MTTASKBAKV2
 (
    IN PIUID         INTEGER,
    IN PIPTMSGID     BIGINT,
    IN PIECID        INTEGER,
    IN PISENDSTATUS  INTEGER,
    IN PIRETFLAG     SMALLINT,
    IN PIPKNUMBER    SMALLINT,
    IN PIPKTOTAL     SMALLINT,
    IN PIFEEFLAG     SMALLINT,
    IN PISENDLEVEL   SMALLINT,
    IN PIRECVMTTIME  TIMESTAMP,
    IN PIUSERID      VARCHAR(11),
    IN PISPGATE      VARCHAR(21),
    IN PICPNO        VARCHAR(21),
    IN PIPHONE       VARCHAR(21),
    IN PIMESSAGE     VARCHAR(3000),
    IN PITASKID      INTEGER,
    IN PIERRORCODE   CHARACTER(7),
    IN PITPUDHI      SMALLINT,
    IN PILONGMSGSEQ  SMALLINT,
    IN PIMSGFMT      SMALLINT,
    IN PIUNICOM      SMALLINT,
    IN PIMOBILEAREA  INTEGER,
    IN PISVRTYPE     VARCHAR(64),
    IN PIP1          VARCHAR(64),
    IN PIP2          VARCHAR(64),
    IN PIP3          VARCHAR(64),
    IN PIP4          VARCHAR(64),
    IN PIUSERMSGID   BIGINT,
    IN PIMODULEID    INTEGER,
    IN PIATTIME      BIGINT,
    IN PIVALIDTIME   BIGINT,
    IN PISENDTYPE    SMALLINT,
    IN PIBATCHID     BIGINT,
    IN PIAREACODE    INTEGER,
    IN PICUSTID VARCHAR(64),
    IN PIEXDATA VARCHAR(64),
	IN PISUID1 VARCHAR(64),
	IN PILUID1 VARCHAR(64)
 )
BEGIN
    DECLARE PICNT INTEGER;
    SELECT COUNT(ID) INTO PICNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID;
  IF PICNT=0 THEN
    INSERT INTO GW_MT_TASK_BAK(UID,PTMSGID,ECID,SENDSTATUS,RETFLAG,PKNUMBER,PKTOTAL,FEEFLAG,SENDLEVEL,
    RECVMTTIME,USERID,SPGATE,CPNO,PHONE,MESSAGE,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,
    MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
    VALUES(PIUID,PIPTMSGID,PIECID,PISENDSTATUS,PIRETFLAG,PIPKNUMBER,PIPKTOTAL,PIFEEFLAG,PISENDLEVEL,PIRECVMTTIME,
    PIUSERID,PISPGATE,PICPNO,PIPHONE,PIMESSAGE,PITASKID,PIERRORCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,
    PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
  END IF;
END;


CALL DELPROC('GW_H_TRANSFERV1');
CREATE PROCEDURE "GW_H_TRANSFERV1"
 (IN "PIMININDEX" BIGINT,
  IN "PIMAXINDEX" BIGINT
 )
  SPECIFIC "GW_H_TRANSFERV1"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN

	DECLARE	PISTR VARCHAR(4000);
	DECLARE	PITABLENAME VARCHAR(20);
	DECLARE	MINYM INTEGER;
	DECLARE	MAXYM INTEGER;
	DECLARE	CURYM INTEGER;
  DECLARE MAXTIME VARCHAR(32);
  DECLARE MINTIME VARCHAR(32);
	DECLARE BEGTIME VARCHAR(32);
  DECLARE ENDTIME VARCHAR(32);
  --------------------VER 3.1-------------------------------------
  SELECT MIN(SENDTIME),MAX(SENDTIME) INTO MINTIME,MAXTIME FROM GW_MT_TASK_BAK  WHERE ID BETWEEN PIMININDEX AND PIMAXINDEX;

  SET MINYM=CAST((SUBSTR(CHAR(MINTIME),1,4)||SUBSTR(CHAR(MINTIME),6,2))AS INT);
  SET MAXYM=CAST((SUBSTR(CHAR(MAXTIME),1,4)||SUBSTR(CHAR(MAXTIME),6,2))AS INT);

  --转移
  SET CURYM = MINYM;
  WHILE CURYM<=MAXYM DO

  IF CAST(SUBSTR(CAST(CURYM AS CHAR(6)),5,2) AS INT)<>12 THEN
	    SET BEGTIME = SUBSTR(CHAR(CURYM),1,4)||'-'||SUBSTR(CHAR(CURYM),5,2)||'-'||'01 00:00:00.000000';
	    IF CAST(SUBSTR(CAST(CURYM AS CHAR(6)),5,2) AS INT)<9 THEN
	      SET ENDTIME = SUBSTR(CHAR(CURYM),1,4)||'-0'||TRIM(CHAR(INT(SUBSTR(CHAR(CURYM),5,2))+1))||'-'||'01 00:00:00.000000';
		ELSE
		  SET ENDTIME = SUBSTR(CHAR(CURYM),1,4)||'-'||TRIM(CHAR(INT(SUBSTR(CHAR(CURYM),5,2))+1))||'-'||'01 00:00:00.000000';
		END IF;
	  ELSE
	      SET BEGTIME = SUBSTR(CHAR(CURYM),1,4)||'-'||SUBSTR(CHAR(CURYM),5,2)||'-'||'01 00:00:00.000000';
	      SET ENDTIME = TRIM(CHAR(INT(SUBSTR(CHAR(CURYM),1,4))+1))||'-'||'01'||'-'||'01 00:00:00.000000';
	  END IF;

      SET PITABLENAME = 'MTTASK'||CAST(CURYM AS CHAR(6));

      SET PISTR= 'INSERT INTO '||PITABLENAME||' (ID,MDAY,USERID,SPGATE,CPNO,PHONE,SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,SENDSTATUS,SENDFLAG,RECVFLAG,DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,SENDTIME,RECVTIME,MESSAGE,TASKID,ECID,PTMSGID,MOBILEAREA,SPID,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,DOWNTM,SUID1,LUID1)
                SELECT ID,INT(DAY(M.SENDTIME)),USERID,SPGATE,CPNO,PHONE,SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,SENDSTATUS,SENDFLAG,RECVFLAG,DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,SENDTIME,RECVTIME,MESSAGE,TASKID,ECID,PTMSGID,MOBILEAREA,SPID,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,DOWNTM,SUID1,LUID1
                FROM GW_MT_TASK_BAK  M
                WHERE SENDTIME>='''||BEGTIME||''' AND SENDTIME<'''||ENDTIME||''' AND (M.ID <='||CHAR(PIMAXINDEX)||')  ';
      EXECUTE IMMEDIATE PISTR;

      IF CAST(SUBSTR(CAST(CURYM AS CHAR(6)),5,2) AS INT)=12 THEN
        SET CURYM = CAST(CAST(CAST(SUBSTR(CAST(CURYM AS CHAR(6)),1,4)AS INT)+1 AS CHAR(4))||'01' AS INT);
      ELSE
        SET CURYM = CURYM+1;
      END IF;
  END WHILE;
END;

CALL DELPROC('GW_WR_MTTASKV1');
CREATE PROCEDURE "GW_WR_MTTASKV1"
 (IN "PIUID" INTEGER,
  IN "PIPTMSGID" BIGINT,
  IN "PISENDSTATUS" SMALLINT,
  IN "PIRETFLAG" SMALLINT,
  IN "PIPKTOTAL" SMALLINT,
  IN "PIPHONECOUNT" INTEGER,
  IN "PISPLITLEN" SMALLINT,
  IN "PIMULTILEN1" SMALLINT,
  IN "PIMULTILEN2" SMALLINT,
  IN "PISIGNLEN" SMALLINT,
  IN "PIECID" INTEGER,
  IN "PIUSERID" VARCHAR(11),
  IN "PISPGATE" VARCHAR(21),
  IN "PICPNO" VARCHAR(21),
  IN "PIRECVMTTIME" TIMESTAMP,
  IN "PIMESSAGE" VARCHAR(3000),
  IN "PISHOUJI" VARCHAR(3500),
  IN "PIFEEFLAG" SMALLINT,
  IN "PISENDLEVEL" SMALLINT,
  IN "PITASKID" INTEGER,
  IN "PIERCODE" CHARACTER(7),
  IN "PITPUDHI" SMALLINT,
  IN "PILONGMSGSEQ" SMALLINT,
  IN "PIMSGFMT" SMALLINT,
  IN "PIUNICOM" SMALLINT,
  IN "PIMOBILEAREA" INTEGER,
  IN "PIPKNUMBER" SMALLINT,
  IN "PISVRTYPE" VARCHAR(64),
  IN "PIP1" VARCHAR(64),
  IN "PIP2" VARCHAR(64),
  IN "PIP3" VARCHAR(64),
  IN "PIP4" VARCHAR(64),
  IN "PIUSERMSGID" BIGINT,
  IN "PIMODULEID" INTEGER,
  IN "PIATTIME" BIGINT,
  IN "PIVALIDTIME" BIGINT,
  IN "PISENDTYPE" INTEGER,
  IN "PIBATCHID" BIGINT,
  IN "PIAREACODE" INTEGER,
  IN "PICUSTID" VARCHAR(64),
  IN "PIEXDATA" VARCHAR(64)
 )
  SPECIFIC "GW_WR_MTTASKV1"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN

DECLARE PITMPMSGID BIGINT;
DECLARE PILOCATION INT;
DECLARE PISTART INT;
DECLARE PIRESULTPHONE VARCHAR(21);
DECLARE PISTRSPLIT VARCHAR(2);
DECLARE PILEN INT;
DECLARE PIRESULTMSG VARCHAR(3000);
DECLARE PIPKNUM INT;
DECLARE PITMPNUM INT;
DECLARE GLOBAL TEMPORARY TABLE SESSION.TMPMTTASK(UID INT,
USERID VARCHAR(11),SPGATE VARCHAR(21),CPNO VARCHAR(21),
PHONE VARCHAR(21),PTMSGID BIGINT ,MESSAGE VARCHAR(3000),
SENDSTATUS SMALLINT,RETFLAG SMALLINT,PKNUMBER SMALLINT,
PKTOTAL SMALLINT,RECVMTTIME TIMESTAMP,ECID INT,
FEEFLAG SMALLINT,SENDLEVEL SMALLINT,TASKID INT,ERRORCODE CHAR(7),
TPUDHI SMALLINT,LONGMSGSEQ SMALLINT,MSGFMT SMALLINT,UNICOM SMALLINT,MOBILEAREA INT,
SVRTYPE VARCHAR(64),P1 VARCHAR(64),P2 VARCHAR(64),P3 VARCHAR(64),
P4 VARCHAR(64),USERMSGID BIGINT,MODULEID INT,ATTIME BIGINT,VALIDTIME BIGINT,SENDTYPE INTEGER,AREACODE INTEGER,CUSTID VARCHAR(64),EXDATA VARCHAR(64)) ON COMMIT DELETE ROWS NOT LOGGED WITH REPLACE;

SET PILEN = LENGTH(PIMESSAGE, CODEUNITS32)-PISIGNLEN;
SET PITMPNUM = 0;
SET PIPKNUM = 1;
SET PISTRSPLIT = ',';

IF PIPHONECOUNT < 1 THEN
	RETURN;
END IF;

IF PIMSGFMT=4 OR PIMSGFMT=248 OR PIMSGFMT=246 THEN
	SET PISPLITLEN=140;
	SET PIMULTILEN1=134;
	SET PIMULTILEN2=134;
	SET PISIGNLEN=0;
END IF;

IF PIMSGFMT=25  THEN
		IF NOT EXISTS (SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID) THEN
		   INSERT INTO GW_MT_TASK_BAK(UID,USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
		   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,
		   TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
		   VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI,PIPTMSGID,PIMESSAGE,PISENDSTATUS,PIRETFLAG,PIPKNUMBER,PIPKTOTAL,
		   PIRECVMTTIME,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
		   PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA);
		END IF;
		RETURN;
END IF;

IF PIPHONECOUNT = 1
THEN
	IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
	THEN
		IF PIPKTOTAL = 1
		THEN
			INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE,
			SENDSTATUS, RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,
			TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
			SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
			VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PIPTMSGID, PIMESSAGE,
			PISENDSTATUS, PIRETFLAG, PIPKNUMBER, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,
			PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
			PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA);
		ELSE
			SET PIPKNUM = 1;
			SET PITMPMSGID = PIPTMSGID;
			IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
			THEN
				SET PIRESULTMSG = SUBSTRING(PIMESSAGE,1,PISPLITLEN, CODEUNITS32);
				SET PITMPMSGID = PITMPMSGID;
				IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				THEN
					INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
					RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
					MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
					VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
					PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,
					PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
				END IF;--END OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				IF  PILEN-PISPLITLEN+PISIGNLEN>=0
				  THEN
				    SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN, CODEUNITS32);
				  ELSE
				    SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, 0, CODEUNITS32);
				END IF;
				SET PITMPMSGID = PITMPMSGID+17179869184;
				SET PIPKNUM = PIPKNUM+1;
				IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				THEN
					INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
					RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
					MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
					VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
					PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
					PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
				END IF;--END OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
			ELSE
				WHILE PIPKNUM <= PIPKTOTAL
				DO
					IF PIPKNUM = PIPKTOTAL
					THEN
						SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN, CODEUNITS32);
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					ELSEIF PIPKNUM = PIPKTOTAL-1
					THEN
						IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
						THEN
						    IF  PILEN-(PIPKNUM-1)*PIMULTILEN1-1 >=0 THEN
							   SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1, CODEUNITS32);
							ELSE
							   SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, 0, CODEUNITS32);
							END IF;
							SET PITMPNUM = PILEN-1;
						ELSE
							SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
							SET PITMPNUM = (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
						END IF;--END IF OF IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1;
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					ELSE
						SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					END IF;--END IF OF IF PIPKNUM = PIPKTOTAL
					IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					THEN
						INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
						RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
						MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
						VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
						PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
						PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
					END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					SET PIPKNUM = PIPKNUM+1;
				END WHILE;--END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
			END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1;

			INSERT INTO GW_MT_TASK_BAK (UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
			RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,
			LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
			SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,
			A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME, A.ECID, A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
			A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA FROM SESSION.TMPMTTASK A;
		END IF;--END IF OF IF PIPKTOTAL = 1
	END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
ELSE --
	SET PISHOUJI = PISTRSPLIT||PISHOUJI||PISTRSPLIT;
	SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI, CODEUNITS32);

	IF PIPKTOTAL < 1 --
	THEN
		RETURN;
	END IF;

	IF PIPKTOTAL >= 1 --
	THEN
		WHILE PILOCATION <> 0 --
		DO
			SET PISTART = PILOCATION;
			SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI,PISTART+1, CODEUNITS32);
			IF PILOCATION > 0
			THEN
				SET PIRESULTPHONE = SUBSTRING(PISHOUJI,PISTART+1,PILOCATION-PISTART-1, CODEUNITS32);--
				IF PIRESULTPHONE <> ''
				THEN
					SET PITMPMSGID = PIPTMSGID;
					IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					THEN
						IF PIPKTOTAL = 1
						THEN
							INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
							RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME,ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
							MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
							VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIMESSAGE, PISENDSTATUS,
							PIRETFLAG, PIPKTOTAL, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
							PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
						ELSE
							SET PIPKNUM = 1;
							IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
							THEN
								SET PIRESULTMSG = SUBSTRING(PIMESSAGE,1, PISPLITLEN, CODEUNITS32);--
								SET PITMPMSGID = PITMPMSGID;
								IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								THEN
									INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
									PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
									UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
									VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
									PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
									PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
								END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								IF PILEN-PISPLITLEN+PISIGNLEN>=0 THEN
								  SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN, CODEUNITS32);
								ELSE
								  SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, 0, CODEUNITS32);
								END IF;
								SET PITMPMSGID = PITMPMSGID+17179869184;
								SET PIPKNUM = PIPKNUM+1;
								IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								THEN
									INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
									PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
									UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
									VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS, PIRETFLAG,
									PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
									PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
								END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
							ELSE
								WHILE PIPKNUM <= PIPKTOTAL
								DO
									IF PIPKNUM = PIPKTOTAL
									THEN
										SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN, CODEUNITS32);
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									ELSEIF PIPKNUM = PIPKTOTAL-1
									THEN
										IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
										THEN
											SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1, CODEUNITS32);
											SET PITMPNUM = PILEN-1;
										ELSE
											SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
											SET PITMPNUM = (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
										END IF; --END IF OF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									ELSE
										SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									END IF; --END IF OF IF PIPKNUM = PIPKTOTAL
									IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
									THEN
										INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
										PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
										UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA)
										VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS, PIRETFLAG,
										PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
										PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA);
									END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
									SET PIPKNUM = PIPKNUM+1;
								END WHILE;-- END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
							END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
						END	IF;--END IF OF IF PIPKTOTAL = 1
					END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
				END IF; --END IF OF IF PIRESULTPHONE <> ''
				SET PIPTMSGID = PIPTMSGID+1;
			END	IF; --END IF OF IF PILOCATION > 0
		END WHILE; --END WHILE OF WHILE PILOCATION <> 0

		INSERT INTO GW_MT_TASK_BAK (UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
		PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
		UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
		SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,A.PKNUMBER,
		A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
		A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA FROM SESSION.TMPMTTASK A;
	END IF; --END IF OF IF PIPKTOTAL >= 1
END IF; --END IF OF IF PIPHONECOUNT = 1 --
END;

MERGE INTO  A_GWPARAMCONF A USING (SELECT 'PUSHCONFIG' AS "PARAMITEM",4000 AS "GWTYPE" FROM  SYSIBM.DUAL) B ON (A.PARAMITEM=B.PARAMITEM AND A.GWTYPE=B.GWTYPE)
WHEN NOT MATCHED THEN
INSERT(PARAMITEM, PARAMNAME,  PARAMMEMO,PARAMATTRIBUTE, VALUERANGE,
DEFAULTVALUE,  CONTROLTYPE, GWTYPE, HKPARAMNAME, HKPARAMMEMO, ENPARAMNAME, ENPARAMMEMO)
VALUES('PUSHCONFIG', '推送字段是否为JSON数组',  '推送字段是否为JSON数组(0:字符串,1:JSON数组)',
1, '0,1','0',1,4000,'推送字段是否JSON到M','推送字段是否JSON到M(0:字符串,1:JSON到M)','Whether the push field is a JSON array','Whether the push field is a JSON array (0: string, 1: JSON array)')
ELSE IGNORE;

INSERT INTO A_GWPARAMVALUE(GWNO, GWTYPE, PARAMITEM, PARAMVALUE)
SELECT DISTINCT GWNO,4000,'PUSHCONFIG','0' FROM A_GWPARAMVALUE
WHERE  NOT EXISTS(SELECT * FROM A_GWPARAMVALUE WHERE PARAMITEM='PUSHCONFIG' AND  GWTYPE=4000) AND  GWTYPE=4000;

CALL DELPROC('GW_LOAD_ECERRCODEBIND');
CREATE PROCEDURE GW_LOAD_ECERRCODEBIND()
SPECIFIC "GW_LOAD_ECERRCODEBIND"
  DYNAMIC RESULT SETS 1
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  READS SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
        DECLARE PISQLSTR VARCHAR(1000);
   	DECLARE RS1 CURSOR WITH RETURN FOR S1;
	SET PISQLSTR = 'SELECT CORP_CODE,STATE_CODE,MAPPING_CODE,STATE_DES  FROM LF_STATECODE';
	PREPARE S1 FROM PISQLSTR;
	OPEN RS1;

END;

DROP PROCEDURE "DELPROC";

BEGIN ATOMIC
DECLARE PIVERSION VARCHAR(32);
SET PIVERSION = '4.06.08';
IF NOT EXISTS (SELECT VERSION FROM VERSION_CMPP WHERE VERSION = PIVERSION) THEN
INSERT INTO VERSION_CMPP (VERSION,VERSIONDATE,UPGRADETIME)
VALUES (PIVERSION,CURRENT DATE,(TRIM(CHAR(YEAR(CURRENT TIMESTAMP)))||'-'|| (CASE MONTH(CURRENT TIMESTAMP) WHEN
1 THEN '01' WHEN 2 THEN '02' WHEN 3 THEN '03' WHEN 4 THEN '04' WHEN 5 THEN '05' WHEN 6 THEN '06'WHEN 7 THEN '07' WHEN 8 THEN '08' WHEN 9 THEN '09'   ELSE
TRIM(CHAR(MONTH(CURRENT TIMESTAMP))) END)||'-'||TRIM(CHAR(DAY(CURRENT TIMESTAMP)))||' '||TRIM(CHAR(HOUR(CURRENT TIMESTAMP)))||':'||TRIM(CHAR(MINUTE(CURRENT TIMESTAMP)))||':'||TRIM(CHAR(SECOND(CURRENT TIMESTAMP)))));
END IF;
END ;
/** 升级脚本(V4.06.07-V4.06.08) END */
/*网关升级脚本 END*/


/*EMP升级脚本 START*/

-- 创建短链接发送任务表
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_URLTASK') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_URLTASK(
      ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER),    -- 主键ID
      TASKID BIGINT DEFAULT 0 NOT NULL,    -- 任务批次号
      SPUSER VARCHAR(11) DEFAULT '' '' NOT NULL, -- SP账号
      CORP_CODE VARCHAR(64) DEFAULT '' '' NOT NULL,    -- 企业编码
      TITLE VARCHAR(64) DEFAULT '' '' NOT NULL,    -- 发送主题
      MSG VARCHAR(2048) NOT NULL,    -- 短信内容
      UTYPE SMALLINT NOT NULL,    -- 1.相同内容短链接发送 2.不同内容短链接发送
      PLAN_TIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
      SUBMIT_TM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL, -- 提交时间
      SEND_TM TIMESTAMP NOT NULL,    -- 发送时间
      HANDLE_NODE VARCHAR(50) DEFAULT '' '' NOT NULL,
      HANDLE_LINE BIGINT DEFAULT 0 NOT NULL,
      SUB_COUNT BIGINT NOT NULL,    -- 提交个数
      SRC_FILE VARCHAR(1024) NOT NULL,    -- 源文件地址
      URL_FILE VARCHAR(1024) NOT NULL,    -- 包含短地址内容文件地址
      STATUS DECIMAL(5) NOT NULL,    -- 状态  无定时     10：未处理   11：处理中   12：处理完成   13 : 处理失败  定时发送   20 ：未处理  21：处理中   22：处理完成   23 : 处理失败
      CREATE_UID DECIMAL(20) NOT NULL,    -- 创建人员ID
      CREATE_TM TIMESTAMP NOT NULL,    -- 创建时间
      UPDATE_UID DECIMAL(20) NOT NULL,    -- 修改人员ID
      UPDATE_TM TIMESTAMP NOT NULL,    -- 修改时间
      NETURL VARCHAR(1024) DEFAULT '''',    -- 企业长地址
      NETURL_ID BIGINT NOT NULL,    -- 企业长地址ID
      DOMAIN_ID BIGINT NOT NULL,
      DOMAIN_URL VARCHAR(256) NOT NULL,    -- 短地址ID
      DOMAIN_EXTEN INT,    -- 短地址扩展部分长度
      DOMAIN_LEN DECIMAL(20) NOT NULL,    -- 短地址总长度
      VALID_DAYS DECIMAL(5) NOT NULL,    -- 有效期
      REMARK VARCHAR(256) DEFAULT '''' NOT NULL,    -- 扩展信息
      REMARK1 VARCHAR(256) NOT NULL   -- 扩展信息2
    )';
      EXECUTE IMMEDIATE
      'CREATE INDEX IX_LF_URLTASK_TASK ON LF_URLTASK(TASKID)'; -- 索引

    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_NETURL') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_NETURL (
        ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER), -- 主键ID
        SRC_URL VARCHAR (1024) DEFAULT '''', -- 源地址
        URL_NAME VARCHAR (200) DEFAULT '''' NOT NULL, -- 连接名称
        URL_MSG VARCHAR (1024) DEFAULT '''' NOT NULL, -- 源地址内容描述
        CORP_CODE VARCHAR (64) DEFAULT 0 NOT NULL, -- 企业编码
        ISPASS INT DEFAULT 0 NOT NULL, -- 审批状态   -3 禁用（未调接口）, -2 禁用  -1:删除   0：未审批, 1：无需审批 ,2：审批通过 （运营商侧）
        URLSTATE INT DEFAULT 0 NOT NULL, -- 长地址状态企业内部维护使用   -2禁用（未调接口）， -1：禁用 0：启用 （用户侧）
        CREATE_UID BIGINT NOT NULL, -- 创建人
        CREATE_TM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL, -- 创建时间
        UPDATE_UID BIGINT NOT NULL, -- 修改人员ID （用户侧）
        UPDATE_TM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL, -- 修改时间 （用户侧）
        AUDIT_UID BIGINT, -- 审核人
        AUDIT_TM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL, -- 审核时间
        STOP_UID BIGINT, -- 禁用人员ID （运营商测）
        STOP_TM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL, -- 禁用时间
        REMARKS VARCHAR (256) DEFAULT '''' NOT NULL, -- 审核意见
        REMARKS1 VARCHAR (256) DEFAULT '''' NOT NULL, -- 预留字段1
        REMARKS2 VARCHAR (256) DEFAULT '''' NOT NULL -- 预留字段2
      )';
      -- 索引
      EXECUTE IMMEDIATE
      'CREATE INDEX IX_LF_NETURL_URLNAME ON LF_NETURL(URL_NAME)';
      EXECUTE IMMEDIATE
      'CREATE INDEX IX_LF_NETURL_CORPCODE ON LF_NETURL(CORP_CODE)';

    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

-- 为了短链创建子草稿箱存储domainid ,neturlid
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_SUB_DRAFTS') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_SUB_DRAFTS (
        ID BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY
                                (START WITH 1, INCREMENT BY 1, NO CACHE, MINVALUE 1, MAXVALUE 9223372036854775807, NO CYCLE, NO ORDER),
        DRAFTID INT NOT NULL DEFAULT 0,
        TYPE INT NOT NULL DEFAULT 0,
        NETURLID INT NOT NULL DEFAULT 0,
        DOMAINID INT NOT NULL DEFAULT 0,
        CREATE_TIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
        UPDATE_TIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_DOMAIN') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_DOMAIN (
        ID BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER), -- 短域名ID
        DOMAIN VARCHAR (256) DEFAULT '''' NOT NULL, -- 短域名
        LEN_ALL INT NOT NULL, -- 总长度
        LEN_EXTEN BIGINT DEFAULT 0 NOT NULL, -- 全局扩展位数
        DTYPE INT DEFAULT 0, -- 域名类别  0 公用  1专用
        FLAG INT DEFAULT 0 NOT NULL, -- 域名状态  0  有效    -1 无效
        VALID_DAYS BIGINT DEFAULT 30 NOT NULL, -- 有效时间，单位天 , 30  ,值不能为0
        CREATE_UID BIGINT NOT NULL, -- 创建人员
        CREATE_TM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL, -- 创建时间
        UPDATE_UID BIGINT NOT NULL, -- 最后修改人员ID
        UPDATE_TM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL, -- 最后修改时间
        REMARK VARCHAR (256) NOT NULL,
        CREATE_USER VARCHAR (64) NOT NULL DEFAULT ''''  -- 创建用户
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_DOMAIN_CORP') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_DOMAIN_CORP (
        CORP_CODE VARCHAR(64) NOT NULL,   -- 企业编码
        DOMAIN_ID BIGINT NOT NULL,    -- 域名ID
        CREATE_UID BIGINT DEFAULT 0 NOT NULL,	-- 创建人
        CREATE_TM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,    -- 创建时间
        UPDATE_UID BIGINT DEFAULT 0 NOT NULL,	-- 修改人
        UPDATE_TM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,    -- 修改时间
        FLAG INT DEFAULT 0 NOT NULL,	-- 状态 0表示启用,1表示禁用
        CREATE_USER VARCHAR(64) DEFAULT '''' NOT NULL -- 创建用户
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

UPDATE LF_THIR_MENUCONTROL SET TID = 106 WHERE TID = 103 AND TITLE = '企业富信';


-- 原本插入数据升级脚本可重复执行判断
CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT 1 FROM LF_THIR_MENUCONTROL WHERE TID = 103)
    THEN
      INSERT INTO LF_THIR_MENUCONTROL(TID, MENU_NUM, TITLE, PRI_MENU, PRI_ORDER, ZH_TW_TITLE, ZH_HK_TITLE) VALUES (103, 26, '企业短链', 96, 395, '企I短', 'Short URL');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

-- 新方式不需要建立存储过程，只需要修改DB2 对应的伪表 <->DUAL(ORACLE,MYSQL)
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3500, 96, 1, '模板内容', '5500-1000-0', '相同内容发送', '短链应用', '5500-1000', '/url_urlSendBatchSMS.htm', '模板内容', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3500);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3501, 96, null, '模板内容', '5500-1000-4', '相同内容发送', '短链应用', '5500-1000', null, '模板内容', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3501);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3502, 96, null, '手动输入内容', '5500-1000-5', '相同内容发送', '短链应用', '5500-1000', null, '手动输入内容', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3502);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3503, 96, null, '手动输入号码', '5500-1000-6', '相同内容发送', '短链应用', '5500-1000', null, '手动输入号码', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3503);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3504, 96, null, '文件导入', '5500-1000-7', '相同内容发送', '短链应用', '5500-1000', null, '文件导入', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3504);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3505, 96, null, '选择人员', '5500-1000-8', '相同内容发送', '短链应用', '5500-1000', null, '选择人员', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3505);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3506, 96, 1, '查看', '5500-1100-0', '不同内容发送', '短链应用', '5500-1100', '/url_urlSendDiffSMS.htm', '查看', 'View', '不同热莅l送', 'Different SMS', '短用', 'Short URL' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3506);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3507, 96, null, '模板内容', '5500-1100-4', '不同内容发送', '短链应用', '5500-1100', null, '模板内容', 'View', '不同热莅l送', 'Different SMS', '短用', 'Short URL' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3507);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3508, 96, null, '手动输入内容', '5500-1100-5', '不同内容发送', '短链应用', '5500-1100', null, '手动输入内容', 'View', '不同热莅l送', 'Different SMS', '短用', 'Short URL' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3508);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3509, 96, 1, '查看', '5500-1200-0', '长链接报备', '短链应用', '5500-1200', '/keep_record.htm', '查看', 'View', 'L接', 'Bei an', '短用', 'Short URL' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3509);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3510, 96, null, '新增', '5500-1200-1', '长链接报备', '短链应用', '5500-1200', null, '新增', 'Add', 'L接', 'Bei an', '短用', 'Short URL' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3510);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3511, 96, 1, '查看', '5600-1000-0', '群发任务查看', '数据查询', '5600-1000', '/surlTaskRecord.htm', '查看', 'View', '群l任詹榭', 'Task Record', '数据查询', 'Data' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3511);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3512, 96, 1, '查看', '5600-1100-0', '批次发送统计', '数据查询', '5600-1100', '/surlBatchRecord.htm', '查看', 'View', '批次l送y', 'Batch Record', '数据查询', 'Data' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3512);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3513, 96, 1, '查看', '5600-1200-0', '发送明细详情', '数据查询', '5600-1200', '/surlSendDetail.htm', '查看', 'View', 'l送明情', 'Batch Record', '数据查询', 'Data' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3513);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3514, 96, 1, '查看', '5600-1300-0', '批次访问统计', '数据查询', '5600-1300', '/surlBatchVisit.htm', '查看', 'View', '批次Ly', 'Batch Visit', '数据查询', 'Data' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3514);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3515, 96, 1, '查看', '5600-1400-0', '链接访问统计', '数据查询', '5600-1400', '/surlLinkVisit.htm', '查看', 'View', '接Ly', 'Link Visit', '数据查询', 'Data' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3515);
/*
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
SELECT 3516, 96, 1, '查看', '5600-1500-0', '区域访问统计', '数据查询', '5600-1500', '/surlZoneVisit.htm', '查看', 'View', '区域访问统计', 'Zone Visit', '数据查询', 'Data' FROM SYSIBM.SYSDUMMY1
WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3516);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
SELECT 3517, 96, 1, '查看', '5600-1600-0', '时段访问统计', '数据查询', '5600-1600', '/surlPeriodVisit.htm', '查看', 'View', '时段访问统计', 'Period Visit', '数据查询', 'Data' FROM SYSIBM.SYSDUMMY1
WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3517);
*/
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3518, 96, 1, '查看', '5600-1700-0', '访问明细详情', '数据查询', '5600-1700', '/surlVisitDetail.htm', '查看', 'View', 'L明情', 'Visit Detail', '数据查询', 'Data' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3518);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3519, 96, 1, '查看', '5700-1000-0', '短域名管理', '短域名管理', '5700-1000', '/surl_manage.htm', '查看', 'View', '短域名管理', 'Visit Detail', '短域名管理', 'Data' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3519);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3520, 96, null, '新建', '5700-1000-1', '短域名管理', '短域名管理', '5700-1000', null, '新建', 'Add', '短域名管理', 'Same SMS', '短域名管理', 'Management' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3520);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3521, 96, null, '修改', '5700-1000-3', '短域名管理', '短域名管理', '5700-1000', null, '修改', 'Edit', '短域名管理', 'Same SMS', '短域名管理', 'Management' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3521);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3522, 96, 1, '查看', '5800-1000-0', '链接地址审核', '长链内容审核', '5800-1000', '/surl_audit.htm', '查看', 'View', '接地址核', 'Visit Detail', '长链内容审核', 'Data' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3522);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3523, 96, 1, '查看', '5700-1200-0', '短链域名绑定', '短域名管理', '5700-1200', '/surl_bind.htm', '查看', 'View', '短域名定', 'Visit Detail', '短域名管理', 'Data' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3523);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3524, 96, null, '新建', '5700-1200-1', '短链域名绑定', '短域名管理', '5700-1200', null, '新建', 'Add', '短域名定', 'Same SMS', '短域名管理', 'Management' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3524);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3525, 96, null, '修改', '5700-1200-3', '短链域名绑定', '短域名管理', '5700-1200', null, '修改', 'Edit', '短域名定', 'Same SMS', '短域名管理', 'Management' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3525);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3526, 96, 1, '查看', '5600-1050-0', '群发任务查看', '数据查询', '5600-1050', '/surl_surlSendedBox.htm', '查看', 'View', '群l任詹榭', 'Task Record', '数据查询', 'Data' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3526);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3500 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3500);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3500 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3500);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3500 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3500);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3501 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3501);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3501 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3501);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3501 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3501);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3502 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3502);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3502 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3502);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3502 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3502);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3503 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3503);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3503 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3503);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3503 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3503);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3504 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3504);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3504 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3504);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3504 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3504);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3505 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3505);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3505 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3505);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3505 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3505);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3506 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3506);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3506 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3506);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3506 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3506);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3507 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3507);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3507 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3507);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3507 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3507);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3508 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3508);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3508 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3508);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3508 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3508);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3509 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3509);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3509 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3509);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3509 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3509);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3510 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3510);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3510 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3510);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3510 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3510);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3511 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3511);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3511 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3511);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3511 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3511);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3512 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3512);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3512 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3512);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3512 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3512);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3513 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3513);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3513 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3513);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3513 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3513);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3514 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3514);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3514 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3514);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3514 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3514);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3515 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3515);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3515 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3515);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3515 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3515);

/*
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3516 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3516);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3516 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3516);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3516 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3516);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3517 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3517);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3517 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3517);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3517 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3517);
*/

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3518 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3518);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3518 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3518);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3518 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3518);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3519 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3519);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3519 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3519);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3519 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3519);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3520 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3520);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3520 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3520);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3520 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3520);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3521 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3521);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3521 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3521);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3521 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3521);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3522 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3522);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3522 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3522);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3522 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3522);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3523 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3523);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3523 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3523);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3523 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3523);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3524 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3524);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3524 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3524);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3524 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3524);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3525 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3525);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3525 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3525);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3525 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3525);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1, 3526 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3526);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2, 3526 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3526);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3, 3526 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 3 AND PRIVILEGE_ID = 3526);


CREATE PROCEDURE "DELPROC"(IN "PROCNAME1" VARCHAR(20))
  begin
    DECLARE STR VARCHAR (256);
    DECLARE STR1 VARCHAR (256);
    SELECT PROCNAME INTO STR1 FROM SYSCAT.PROCEDURES WHERE  PROCNAME=PROCNAME1;
    if  STR1 is not null THEN
      SET STR ='DROP PROCEDURE '||PROCNAME1;
      execute immediate str ;
    end if;
  end;

/**
根据年月创建访问详单历史年月表
*/
CALL DELPROC('CREATEVST_DETAIL');
CREATE PROCEDURE CREATEVST_DETAIL(PIYM INT)
  BEGIN
    DECLARE STR VARCHAR(4000);
    DECLARE TABLENAME VARCHAR(16);

    SET TABLENAME='VST_DETAIL' || PIYM;
    IF NOT EXISTS (SELECT * FROM SYSIBM.SYSTABLES WHERE TID <> 0 AND NAME = TABLENAME) THEN
      SET STR='CREATE TABLE ' || TABLENAME ||
              ' (
                ID BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER),
                PTMSGID BIGINT NOT NULL DEFAULT ''0'',
                VSTMSGID BIGINT NOT NULL DEFAULT ''0'',
                USERID VARCHAR(11) NOT NULL DEFAULT '''',
                ECID INT NOT NULL DEFAULT ''0'',
                PHONE VARCHAR(22) NOT NULL DEFAULT ''ERRPHONE'',
                MOBILEAREA INT NOT NULL DEFAULT ''0'',
                CTTM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
                VSTTM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
                PTCODE VARCHAR(11) NOT NULL DEFAULT '''',
                WGNO INT NOT NULL DEFAULT ''0'',
                SRCADDRESS VARCHAR(64) NOT NULL DEFAULT '''',
                XWAPPROF VARCHAR(512) NOT NULL DEFAULT '''',
                XBROTYPE VARCHAR(512) NOT NULL DEFAULT '''',
                DRS VARCHAR(64) NOT NULL DEFAULT '''',
                TIMES INT NOT NULL DEFAULT ''0'',
                CUSTID VARCHAR(64) NOT NULL DEFAULT '''',
                SURL VARCHAR(64) NOT NULL DEFAULT '''',
                LURL VARCHAR(2048) NOT NULL DEFAULT '''',
                HTTPHEADER VARCHAR(4096) NOT NULL DEFAULT '''',
                EXDATA VARCHAR(2048) NOT NULL DEFAULT '''',
                SRCPT VARCHAR(10) NOT NULL DEFAULT '''',
                SID BIGINT NOT NULL DEFAULT ''0''
               ) IN EMP_TABLESPACE';
      EXECUTE IMMEDIATE STR;

      EXECUTE IMMEDIATE
      'CREATE INDEX IX_' || TABLENAME || '_CUSTID ON ' || TABLENAME || '(CUSTID)';
      EXECUTE IMMEDIATE
      'CREATE INDEX IX_' || TABLENAME || '_PHONE ON ' || TABLENAME || '(PHONE)';
    END IF;
  END;
/**
创建三年访问详单历史年月表
*/
CALL DELPROC('VST_DETAIL_HISTAB');
CREATE PROCEDURE VST_DETAIL_HISTAB()
BEGIN
  DECLARE PINUM  INT;
  DECLARE PICURNUM INT;
  DECLARE PIYM INT;
  DECLARE PITABLENAME VARCHAR(20);
  DECLARE PIDATE TIMESTAMP;

  SET PINUM=36;
  SET PICURNUM=0;

  WHILE PICURNUM<PINUM DO
    SET PIDATE = ADD_MONTHS(CURRENT_TIMESTAMP , PICURNUM);
    SET PIYM= CAST((SUBSTR(CHAR(PIDATE),1,4)||SUBSTR(CHAR(PIDATE),6,2))AS INT);
    SET PITABLENAME='VST_DETAIL' || PIYM;
    IF NOT EXISTS (SELECT NAME FROM SYSIBM.SYSTABLES WHERE TID <> 0 AND Name = UPPER(PITABLENAME)) THEN
      CALL CREATEVST_DETAIL(PIYM);
    END IF;
    SET PICURNUM=PICURNUM+1;
  END WHILE;

END;

CALL VST_DETAIL_HISTAB();
DROP PROCEDURE VST_DETAIL_HISTAB;

UPDATE LF_PRIVILEGE SET MODNAME = '短域名管理' ,ZH_TW_MODNAME = '短域名管理' WHERE PRIVILEGE_ID IN (3519,3520,3521,3523,3524,3525);
UPDATE LF_PRIVILEGE SET MODNAME = '长链内容审核' ,ZH_TW_MODNAME = '长链内容审核',PRIV_CODE = '5800-1000-0', MENUCODE = '5800-1000' WHERE PRIVILEGE_ID = 3522;
UPDATE LF_PRIVILEGE SET MENUNAME = '短链生成状态',ZH_TW_MENUNAME='短链生成状态' WHERE PRIVILEGE_ID = 3511;


-- LF_TEMP_PARAM表增加字段HASLENGTH
CALL DELPROC('COLUMNADD');
CREATE PROCEDURE COLUMNADD()
  BEGIN
    DECLARE NUM INT;
    SELECT COUNT(1) INTO NUM FROM SYSCAT.COLUMNS WHERE COLNAME='HASLENGTH' AND TABNAME='LF_TEMP_PARAM';
    IF NUM = 0 THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMP_PARAM ADD COLUMN HASLENGTH BIGINT NOT NULL WITH DEFAULT 0';
    END IF;
  END;
CALL COLUMNADD();
DROP PROCEDURE COLUMNADD;

-- 更新菜单多语言
UPDATE LF_PRIVILEGE SET ZH_HK_COMMENTS='Template content' WHERE PRIVILEGE_ID IN (3300, 3302);
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS='手虞入热',ZH_HK_COMMENTS='Manual input content' WHERE PRIVILEGE_ID IN (3301, 3303);
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS='手虞入a',ZH_HK_COMMENTS='Manual input phone' WHERE PRIVILEGE_ID = 3304;
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS='文件入',ZH_HK_COMMENTS='Import file' WHERE PRIVILEGE_ID = 3305;
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS='x袢T',ZH_HK_COMMENTS='Choose staff' WHERE PRIVILEGE_ID = 3306;
UPDATE LF_PRIVILEGE SET MENUNAME ='我的场景' ,ZH_TW_COMMENTS = '新建' WHERE PRIVILEGE_ID = '633';
UPDATE LF_PRIVILEGE SET MENUNAME ='我的场景' ,ZH_TW_COMMENTS = '查看' WHERE PRIVILEGE_ID = '634';
UPDATE LF_PRIVILEGE SET MENUNAME ='我的场景' ,ZH_TW_COMMENTS = '删除' WHERE PRIVILEGE_ID = '635';
UPDATE LF_PRIVILEGE SET ZH_HK_MENUNAME = 'Same RMS' WHERE ZH_HK_MENUNAME = 'Same SMS';
UPDATE lf_privilege SET ZH_TW_MENUNAME = '我的鼍' WHERE MENUNAME = '我的场景';

-- 71.01 - 71.02
/*企业富信-批量导入模板发送*/
INSERT INTO lf_privilege (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT '3553', '95', '1', '查看', '5100-1850-0', '批量导入模板发送', '数据查询', '5100-1850', '/importTemplateDetails.htm', '查看', 'View', '批量入模板l送', 'Import Temp And Send', '查', 'Data query' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3553);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2,3553 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3553 AND ROLE_ID=2);

-- 创建模板导入批次表
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_TEMP_IMPORT_BATCH') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_TEMP_IMPORT_BATCH (
        ID             BIGINT                              NOT NULL GENERATED BY DEFAULT AS IDENTITY ( START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER ),
        BATCH          INT                                 NOT NULL DEFAULT 0,
        CORP_CODE      VARCHAR(64)                         NOT NULL DEFAULT '''',
        CORP_NAME      VARCHAR(64)                         NOT NULL DEFAULT '''',
        AMOUNT         BIGINT                              NOT NULL DEFAULT 0,
        SUCCESS_AMOUNT BIGINT                              NOT NULL DEFAULT 0,
        FAIL_AMOUNT    BIGINT                              NOT NULL DEFAULT 0,
        PROCESS_STATUS INT                                 NOT NULL DEFAULT 0,
        TM_NAME        VARCHAR(64)                         NOT NULL DEFAULT '''',
        ADDTIME        TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS();
DROP PROCEDURE ADDTABLEEXISTS;


-- 创建导入详情表
CALL DELPROC('ADDTABLEEXISTS');
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_TEMP_IMPORT_DETAILS') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_TEMP_IMPORT_DETAILS (
        ID            BIGINT                              NOT NULL GENERATED BY DEFAULT AS IDENTITY ( START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER ),
        BATCH         INT                                 NOT NULL DEFAULT 0,
        TM_NAME       VARCHAR(64)                         NOT NULL DEFAULT '''',
        NAME          VARCHAR(64)                         NOT NULL DEFAULT '''',
        PHONE_NUM     VARCHAR(64)                         NOT NULL DEFAULT '''',
        SCORE         VARCHAR(64)                         NOT NULL DEFAULT '''',
        SPTEMPLID     BIGINT                              NOT NULL DEFAULT 0,
        SEND_STATUS   INT                                 NOT NULL DEFAULT 0,
        IMPORT_STATUS INT                                 NOT NULL DEFAULT 0,
        CAUSE         VARCHAR(64)                         NOT NULL DEFAULT '''',
        IMAGE_SRC     VARCHAR(64)                         NOT NULL DEFAULT '''',
        VIDEO_SRC     VARCHAR(64)                         NOT NULL DEFAULT '''',
        CORP_CODE     VARCHAR(64)                         NOT NULL DEFAULT '''',
        ADDTIME       TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS();
DROP PROCEDURE ADDTABLEEXISTS;

-- LF_TEMPLATE 添加SOURCE 字段[富信模板来源]
CALL DELPROC('COLUMNADD');
CREATE PROCEDURE COLUMNADD()
  BEGIN
    DECLARE NUM INT;
    SELECT COUNT(1) INTO NUM FROM SYSCAT.COLUMNS WHERE COLNAME='SOURCE' AND TABNAME='LF_TEMPLATE';
    IF NUM = 0 THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMPLATE ADD COLUMN SOURCE INT DEFAULT 2 NOT NULL';
    END IF;
  END;
CALL COLUMNADD();
DROP PROCEDURE COLUMNADD;

-- LF_SUB_TEMPLATE 修改 ENDJSON 长度 (不需要操作该字段，该字段已经废弃)
-- CALL DELPROC('SCHEMA_CHANGE');
-- CREATE PROCEDURE SCHEMA_CHANGE()
--   BEGIN
--     IF EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='ENDJSON' AND TABNAME='LF_SUB_TEMPLATE') THEN
--       ALTER TABLE LF_SUB_TEMPLATE ALTER COLUMN ENDJSON SET DATA TYPE BLOB;
--     END IF;
--   END;
-- CALL SCHEMA_CHANGE();
-- DROP PROCEDURE SCHEMA_CHANGE;

-- LF_SUB_TEMPLATE 添加H5TYPE 字段[H5长页短页]
CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='H5TYPE' AND TABNAME='LF_SUB_TEMPLATE') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_SUB_TEMPLATE ADD COLUMN H5TYPE INT NOT NULL WITH DEFAULT 0';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

-- LF_SUB_TEMPLATE 添加APP字段[H5封面JSON] (同ENDJSON字段一样，该字段被废弃)
CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='APP' AND TABNAME='LF_SUB_TEMPLATE') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_SUB_TEMPLATE
        ADD COLUMN APP VARCHAR(2000) NOT NULL DEFAULT ''''';
        END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

-- LF_SUB_TEMPLATE 添加H5URL字段[H5生成的HTML服务器地址]
CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='H5URL' AND TABNAME='LF_SUB_TEMPLATE') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_SUB_TEMPLATE
        ADD COLUMN H5URL VARCHAR(255) NOT NULL DEFAULT '' ''';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;



-- 创建素材表
CALL DELPROC('ADDTABLEEXISTS');
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_FODDER') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_FODDER (
        ID        BIGINT                     NOT NULL GENERATED BY DEFAULT AS IDENTITY ( START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER ),
        USER_ID   BIGINT DEFAULT 0           NOT NULL,
        URL       VARCHAR(200) DEFAULT '' '' NOT NULL,
        FO_TYPE   INT DEFAULT 0              NOT NULL,
        FO_SIZE   INT DEFAULT 0              NOT NULL,
        WIDTH     INT DEFAULT 0              NOT NULL,
        HEIGHT    INT DEFAULT 0              NOT NULL,
        DURATION  INT DEFAULT 0              NOT NULL,
        FO_STATUS INT DEFAULT 0              NOT NULL,
        RADIO     VARCHAR(50) DEFAULT '' ''  NOT NULL,
        ORIGINAL  VARCHAR(200) DEFAULT '' '' NOT NULL
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

-- LF_FODDER 添加FIRSTFRAMEPATH字段
CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='FIRSTFRAMEPATH' AND TABNAME='LF_FODDER') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_FODDER
        ADD COLUMN FIRSTFRAMEPATH VARCHAR(64) NOT NULL DEFAULT ''''';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

-- 模板参数表（LF_TEMP_PARAM) 修改 REGCONTENT 长度
CALL DELPROC('SCHEMA_CHANGE');
CREATE PROCEDURE SCHEMA_CHANGE()
  BEGIN
    IF EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='REGCONTENT' AND TABNAME='LF_TEMP_PARAM') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMP_PARAM ALTER COLUMN REGCONTENT SET DATA TYPE VARCHAR(50)';
    END IF;
  END;
CALL SCHEMA_CHANGE();
DROP PROCEDURE SCHEMA_CHANGE;

-- 为 MT_DATAREPORT 表添加 RECFAIL字段
CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='RECFAIL' AND TABNAME='MT_DATAREPORT') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE MT_DATAREPORT ADD COLUMN RECFAIL INT NOT NULL WITH DEFAULT 0';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

CALL DELPROC('GW_H_STATISTIV3');
CREATE PROCEDURE "GW_H_STATISTIV3"
  (IN "PIPROCESSFLAG" INTEGER,
   IN "ISP1" INTEGER,
   IN "ISP2" INTEGER,
   IN "ISP3" INTEGER,
   IN "ISP4" INTEGER
  )
  SPECIFIC "GW_H_STATISTIV3"
LANGUAGE SQL
NOT DETERMINISTIC
CALLED ON NULL INPUT
EXTERNAL ACTION
OLD SAVEPOINT LEVEL
MODIFIES SQL DATA
INHERIT SPECIAL REGISTERS
  BEGIN
    DECLARE STR VARCHAR(4000);
    DECLARE BEGTIME VARCHAR(32);
    DECLARE ENDTIME VARCHAR(32);
    DECLARE MAXIYMD INTEGER;
    DECLARE DIFFDATE INTEGER;
    DECLARE MINTMIYMD INTEGER;
    DECLARE MAXTMIYMD INTEGER;

    DECLARE GLOBAL TEMPORARY TABLE SESSION.TEMP_STATISTICS (
      USERID VARCHAR(11),
      TASKID INTEGER,
      SPGATE VARCHAR(21),
      SPISUNCM INTEGER,
      SPID VARCHAR(32),
      SVRTYPE VARCHAR(64),
      P1 VARCHAR(64),
      P2 VARCHAR(64),
      P3 VARCHAR(64),
      P4 VARCHAR(64),
      IYMD INTEGER,
      IYEAR INTEGER,
      IMONTH INTEGER,
      IHOUR INTEGER,
      ICOUNT INTEGER,
      SUCC INTEGER,
      FAIL INTEGER,
      RECFAIL INTEGER,
      NRET INTEGER,
      MOBILEAREA INTEGER,
      SENDTYPE INTEGER,
      BATCHID BIGINT,AREACODE INTEGER,TMPLID BIGINT,CHGRADE SMALLINT,MSGTYPE SMALLINT) ON COMMIT DELETE ROWS NOT LOGGED WITH REPLACE;

    SELECT  COALESCE(MAX(IYMD),20000101)  INTO MAXIYMD FROM MT_DATAREPORT ;
    SET DIFFDATE=days(CURRENT DATE - 2 days) - days(date(SUBSTR(CHAR(MAXIYMD),1,4)||'-'||SUBSTR(CHAR(MAXIYMD),5,2)||'-'||SUBSTR(CHAR(MAXIYMD),7,2)));
    IF DIFFDATE>0 THEN
      SET PIPROCESSFLAG=PIPROCESSFLAG+DIFFDATE;
    END IF;

    SET BEGTIME = TRIM(CAST((CURRENT DATE - PIPROCESSFLAG DAYS) AS CHAR(32)))||' 00:00:00.000000';
    SET ENDTIME = TRIM(CAST((CURRENT DATE) AS CHAR(32)))||' 00:00:00.000000';

    SET STR= 'INSERT INTO SESSION.TEMP_STATISTICS(USERID,TASKID,SPGATE,SPISUNCM,SPID,SVRTYPE,P1,P2,P3,P4,IYMD,IYEAR,IMONTH,IHOUR,ICOUNT,SUCC,FAIL,RECFAIL,NRET,MOBILEAREA,SENDTYPE,BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE)
               SELECT  USERID,TASKID,SPGATE,UNICOM,SPID,SVRTYPE';
    IF ISP1 =1 THEN
      SET STR=STR||' ,P1';
    ELSE
      SET STR=STR||','' '' AS P1';
    END IF;
    IF ISP2 =1 THEN
      SET STR=STR||' ,P2';
    ELSE
      SET STR=STR||','' '' AS P2';
    END IF;
    IF ISP3 =1 THEN
      SET STR=STR||' ,P3';
    ELSE
      SET STR=STR||','' '' AS P3';
    END IF;
    IF ISP4 =1 THEN
      SET STR=STR||' ,P4';
    ELSE
      SET STR=STR||','' '' AS P4';
    END IF;

    SET STR=STR||', INT(DATE(SENDTIME)) AS IYMD,
               INT(YEAR(SENDTIME)) AS IYEAR,
               INT(MONTH(SENDTIME)) AS MON,
               INT(HOUR(SENDTIME)) AS HOUR,
               COUNT(ID),
			         VALUE(COUNT(CASE TRIM(ERRORCODE) WHEN ''DELIVRD'' THEN 1 WHEN ''0'' THEN 1 ELSE NULL END),0),
			         VALUE(COUNT(CASE SUBSTR(ERRORCODE,1,3) WHEN ''E1:'' THEN 1 WHEN ''E2:'' THEN 1 ELSE NULL END),0),
					 VALUE(COUNT(CASE SUBSTR(ERRORCODE,1,3) WHEN ''E2:'' THEN 1 ELSE NULL END),0),
			         VALUE(COUNT(CASE LENGTH(TRIM(ERRORCODE))  WHEN 0 THEN 1 ELSE NULL END ),0),
			         MOBILEAREA,
			         SENDTYPE,
			         BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE
               FROM GW_MT_TASK_BAK
               WHERE SENDTIME BETWEEN '''||BEGTIME|| ''' AND '''||ENDTIME||''' GROUP BY
               USERID,TASKID,SPGATE,UNICOM,SPID,SVRTYPE';
    IF ISP1 =1 THEN
      SET STR=STR||' ,P1';
    END IF;
    IF ISP2 =1 THEN
      SET STR=STR||' ,P2';
    END IF;
    IF ISP3 =1 THEN
      SET STR=STR||' ,P3';
    END IF;
    IF ISP4 =1 THEN
      SET STR=STR||' ,P4';
    END IF;
    SET STR=STR||',MOBILEAREA,SENDTYPE,BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE,
               INT(DATE(SENDTIME)),
               INT(YEAR(SENDTIME)),
               INT(MONTH(SENDTIME)),
               INT(HOUR(SENDTIME))';

    EXECUTE IMMEDIATE STR;
    --插入或更新统计表
    SELECT MIN(IYMD) , MAX(IYMD) INTO MINTMIYMD,MAXTMIYMD FROM SESSION.TEMP_STATISTICS;
    DELETE FROM MT_DATAREPORT WHERE IYMD BETWEEN MINTMIYMD AND MAXTMIYMD;

    INSERT INTO MT_DATAREPORT(USERID,TASKID,SPGATE,SPISUNCM,SPID,SVRTYPE,P1,P2,P3,P4,IYMD,IHOUR,IMONTH,Y,ICOUNT,RSUCC,RFAIL1,RFAIL2,RECFAIL,RNRET,SENDTYPE, MOBILEAREA,BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE)
      SELECT T.USERID,T.TASKID,T.SPGATE,T.SPISUNCM,T.SPID,T.SVRTYPE,T.P1,T.P2,T.P3,T.P4,T.IYMD,T.IHOUR,T.IMONTH,T.IYEAR,T.ICOUNT,T.SUCC,T.FAIL,(T.ICOUNT-T.SUCC-T.FAIL-T.NRET),T.RECFAIL,T.NRET, T.SENDTYPE, T.MOBILEAREA,T.BATCHID ,T.AREACODE, T.TMPLID,T.CHGRADE,T.MSGTYPE
      FROM SESSION.TEMP_STATISTICS  T;
    COMMIT;
  END;

-- 我的场景增加权限菜单
-- 新建权限
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3551 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE ROLE_ID = 1 AND PRIVILEGE_ID = 3551);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3551 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE ROLE_ID = 2 AND PRIVILEGE_ID = 3551);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3551 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER WHERE ROLE_ID = 4 AND PRIVILEGE_ID = 3551);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3554, 94, '审核状态', '5100-1300-4', '我的场景', '富信应用', '5100-1300', ' ', '审核状态', 'auth', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3554);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3554 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3554);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3554 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3554);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3554 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3554);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3555, 94, '立即发送', '5100-1300-5', '我的场景', '富信应用', '5100-1300', ' ', '立即发送', 'send', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3555);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3555 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3555);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3555 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3555);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3555 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3555);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3556, 94, '预览', '5100-1300-6', '我的场景', '富信应用', '5100-1300', ' ', '预览', 'preview', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3556);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3556 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3556);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3556 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3556);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3556 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3556);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3557, 94, '复制', '5100-1300-7', '我的场景', '富信应用', '5100-1300', ' ', '复制', 'copy', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3557);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3557 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3557);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3557 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3557);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3557 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3557);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3558, 94, '导出', '5100-1300-8', '我的场景', '富信应用', '5100-1300', ' ', '导出', 'export', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3558);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3558 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3558);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3558 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3558);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3558 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3558);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3559, 94, '详情', '5100-1300-9', '我的场景', '富信应用', '5100-1300', ' ', '详情', 'detail', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3559);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3559 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3559);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3559 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3559);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3559 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3559);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3560, 94, '复制链接', '5100-1300-10', '我的场景', '富信应用', '5100-1300', ' ', '复制链接', 'link', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3560);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3560 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3560);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3560 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3560);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3560 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3560);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3561, 94, '启用禁用', '5100-1300-11', '我的场景', '富信应用', '5100-1300', ' ', '启用禁用', 'state', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3561);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3561 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3561);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3561 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3561);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3561 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3561);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3562, 94, '快捷场景', '5100-1300-12', '我的场景', '富信应用', '5100-1300', ' ', '快捷场景', 'shortSence', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3562);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3562 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3562);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3562 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3562);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3562 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3562);

-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
-- SELECT 3563, 94, '行业用途', '5100-1300-13', '我的场景', '富信应用', '5100-1300', ' ', '行业用途', 'industryAnduse', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
-- WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3563);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3563 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3563);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3563 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3563);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 3, 3563 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3563);

--  模板库增加权限菜单
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3564, 94, '审核状态', '5100-1350-4', '模板库', '富信应用', '5100-1350', ' ', '审核状态', 'auth', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3564);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3564 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3564);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3564 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3564);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3564 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3564);

-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
-- SELECT 3565, 94, '立即发送', '5100-1350-5', '模板库', '富信应用', '5100-1350', ' ', '立即发送', 'send', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
-- WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3565);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3565 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3565);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3565 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3565);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3565 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3565);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3566, 94, '预览', '5100-1350-6', '模板库', '富信应用', '5100-1350', ' ', '预览', 'preview', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3566);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3566 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3566);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3566 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3566);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3566 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3566);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3567, 94, '复制', '5100-1350-7', '模板库', '富信应用', '5100-1350', ' ', '复制', 'copy', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3567);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3567 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3567);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3567 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3567);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3567 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3567);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3568, 94, '导出', '5100-1350-8', '模板库', '富信应用', '5100-1350', ' ', '导出', 'export', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3568);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3568 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3568);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3568 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3568);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3568 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3568);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3569, 94, '详情', '5100-1350-9', '模板库', '富信应用', '5100-1350', ' ', '详情', 'detail', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3569);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3569 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3569);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3569 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3569);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3569 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3569);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3570, 94, '复制链接', '5100-1350-10', '模板库', '富信应用', '5100-1350', ' ', '复制链接', 'link', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3570);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3570 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3570);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3570 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3570);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3570 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3570);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3571, 94, '启用禁用', '5100-1350-11', '模板库', '富信应用', '5100-1350', ' ', '启用禁用', 'state', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3571);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3571 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3571);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3571 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3571);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3571 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3571);

-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
-- SELECT 3572, 94, '快捷场景', '5100-1350-12', '模板库', '富信应用', '5100-1350', ' ', '快捷场景', 'shortSence', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
-- WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3572);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3572 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3572);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3572 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3572);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3572 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3572);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3573, 94, '行业用途', '5100-1350-13', '模板库', '富信应用', '5100-1350', ' ', '行业用途', 'industryAnduse', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3573);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3573 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3573);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3573 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3573);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3573 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3573);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3574, 94, '编辑', '5100-1350-3', '模板库', '富信应用', '5100-1350', ' ', '编辑', 'edit', '模板', 'update', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3574);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3574 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3574);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3574 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3574);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3574 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3574);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3575, 94, '编辑', '5100-1300-3', '我的场景', '富信应用', '5100-1300', ' ', '编辑', 'edit', '我的鼍', 'update', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3575);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3575 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3575);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3575 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3575);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3575 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3575);

-- 整理老企业富信新加权限菜单不全
CALL DELPROC('MODIFY_MENU');
CREATE PROCEDURE MODIFY_MENU(IN_STATEMENT VARCHAR(600))
  BEGIN
    DECLARE CORPCODE VARCHAR(64);
    DECLARE AT_END INT DEFAULT 0;
    DECLARE ROLEID INT;
    DECLARE NUM INT;
    DECLARE PRIVILEGEID INT;
    DECLARE SQLSTMT VARCHAR(2000) DEFAULT '';
    DECLARE RS1 CURSOR WITH RETURN FOR S1;
    DECLARE CORPCURSOR CURSOR WITH RETURN FOR SELECT CORP.CORP_CODE FROM LF_CORP CORP;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET AT_END = 1;
    SET SQLSTMT = ' SELECT DISTINCT PRIVILEGE_ID FROM LF_PRIVILEGE WHERE PRIVILEGE_ID IN(' || IN_STATEMENT || ')';
    PREPARE S1 FROM SQLSTMT;

    OPEN CORPCURSOR;
    WRAPPER_LOOP: LOOP
      FETCH CORPCURSOR INTO CORPCODE;
      IF(AT_END<>0) THEN
        LEAVE WRAPPER_LOOP;
      END IF;

      IF CORPCODE<>'100000' THEN
        SELECT MIN(ROLE_ID) INTO ROLEID FROM LF_USER2ROLE WHERE USER_ID = (SELECT USER_ID FROM LF_SYSUSER WHERE CORP_CODE = CORPCODE AND upper(USER_NAME) = 'ADMIN') AND ROLE_ID NOT IN (1,2,4);
        OPEN RS1;
        INS_LOOP: LOOP
          FETCH RS1 INTO PRIVILEGEID;
          IF (AT_END<>0) THEN
            LEAVE INS_LOOP;
          END IF;

          IF(PRIVILEGEID > 0 AND ROLEID > 0) THEN
            SELECT COUNT(*) INTO NUM FROM LF_IMPOWER WHERE ROLE_ID =ROLEID AND PRIVILEGE_ID =PRIVILEGEID;
            IF (NUM = 0) THEN
            INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(ROLEID,PRIVILEGEID);
           END IF;
          END IF;
        END LOOP;
        CLOSE RS1;
      END IF;
      SET AT_END=0;
    END LOOP;
    CLOSE CORPCURSOR;
  END;
CALL MODIFY_MENU('3554,3555,3556,3557,3558,3559,3560,3561,3562,3563,3565,3566,3568,3569,3570,3571,3572,3573,3575,3576,3577,3578,3579,3580,3581,3582,3583,3584,3585,3586,3587');

-- -- 企业定制场景菜单
-- INSERT INTO LF_PRIVILEGE ( PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME )
--   SELECT  '3576', '94', '1', '查看', '5100-1351-0', '企业定制场景', '富信应用', '5100-1351', '/toCorpCustomTpIndex.meditorPage', '查看', 'View', '企I定制鼍', 'Corp Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
--   WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3576);
--
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3576 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3576);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3576 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3576);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3576 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3576);
--
-- -- 企业定制场景 按钮权限
--
-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--   SELECT 3577, 94, '编辑', '5100-1351-3', '企业定制场景', '富信应用', '5100-1351', ' ', '编辑', 'industryAnduse', '企I定制鼍', 'update', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
--   WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3577);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3577 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3577);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3577 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3577);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3577 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3577);
--
-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--   SELECT 3578, 94, '审核状态', '5100-1351-4', '企业定制场景', '富信应用', '5100-1351', ' ', '审核状态', 'auth', '企I定制鼍', 'Corp Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
--   WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3578);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3578 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3578);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3578 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3578);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3578 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3578);
--
-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--   SELECT 3579, 94, '立即发送', '5100-1351-5', '企业定制场景', '富信应用', '5100-1351', ' ', '立即发送', 'send', '企I定制鼍', 'Corp Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
--   WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3579);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3579 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3579);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3579 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3579);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3579 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3579);
--
-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--   SELECT 3580, 94, '预览', '5100-1351-6', '企业定制场景', '富信应用', '5100-1351', ' ', '预览', 'preview', '企I定制鼍', 'Corp Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
--   WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3580);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3580 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3580);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3580 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3580);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3580 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3580);
--
-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--   SELECT 3581, 94, '复制', '5100-1351-7', '企业定制场景', '富信应用', '5100-1351', ' ', '复制', 'copy', '企I定制鼍', 'Corp Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
--   WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3581);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3581 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3581);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3581 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3581);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3581 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3581);
--
-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--   SELECT 3582, 94, '导出', '5100-1351-8', '企业定制场景', '富信应用', '5100-1351', ' ', '导出', 'export', '企I定制鼍', 'Corp Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
--   WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3582);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3582 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3582);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3582 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3582);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3582 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3582);
--
-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--   SELECT 3583, 94, '详情', '5100-1351-9', '企业定制场景', '富信应用', '5100-1351', ' ', '详情', 'detail', '企I定制鼍', 'Corp Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
--   WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3583);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3583 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3583);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3583 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3583);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3583 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3583);
--
-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--   SELECT 3584, 94, '复制链接', '5100-1351-10', '企业定制场景', '富信应用', '5100-1351', ' ', '复制链接', 'link', '企I定制鼍', 'Corp Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
--   WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3584);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3584 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3584);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3584 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3584);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3584 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3584);
--
-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--   SELECT 3586, 94, '启用禁用', '5100-1351-11', '企业定制场景', '富信应用', '5100-1351', ' ', '启用禁用', 'state', '企I定制鼍', 'Corp Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
--   WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3586);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3586 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3586);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3586 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3586);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3586 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3586);
--
-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--   SELECT 3587, 94, '快捷场景', '5100-1351-12', '企业定制场景', '富信应用', '5100-1351', ' ', '快捷场景', 'shortSence', '企I定制鼍', 'Corp Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
--   WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3587);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3587 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3587);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3587 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3587);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3587 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3587);
--
-- -- 整理老企业企业富信 新加权限菜单不全
-- CALL MODIFY_MENU('3576,3577,3578,3579,3580,3581,3582,3583,3584,3585,3586,3587');

--  模板表 (LF_TEMPLATE)添加是否RCOS同步来的公共素材字段 ISMATERIAL 0―否 ，1-是
CALL DELPROC('SCHEMA_CHANGE');
CREATE PROCEDURE SCHEMA_CHANGE()
  BEGIN
    IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='ISMATERIAL' AND TABNAME='LF_TEMPLATE')
    THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMPLATE ADD COLUMN ISMATERIAL INT NOT NULL DEFAULT 0';
    END IF;
  END;
CALL SCHEMA_CHANGE();
DROP PROCEDURE SCHEMA_CHANGE;

CALL DELPROC('SCHEMA_CHANGE');
CREATE PROCEDURE SCHEMA_CHANGE()
  BEGIN
    IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='RCOS_TMPSTATE' AND TABNAME='LF_TEMPLATE')
    THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMPLATE ADD COLUMN RCOS_TMPSTATE INT NOT NULL DEFAULT 1';
    END IF;
  END;
CALL SCHEMA_CHANGE();
DROP PROCEDURE SCHEMA_CHANGE;


-- 创建LF_THIR_CROP表
CALL DELPROC('ADDTABLEEXISTS');
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_THIR_CORP') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_THIR_CORP (
        ID        BIGINT      NOT NULL GENERATED BY DEFAULT AS IDENTITY ( START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER ),
        MENU_NUM  INT         NOT NULL DEFAULT 0,
        CORP_CODE VARCHAR(64) NOT NULL DEFAULT ''''
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

--  创建LF_WEBCONFIG表
CALL DELPROC('ADDTABLEEXISTS');
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_WEBCONFIG') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_WEBCONFIG (
        ID          INT           NOT NULL GENERATED BY DEFAULT AS IDENTITY ( START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER ),
        CONFIG_NAME VARCHAR(255)  NOT NULL DEFAULT '''',
        JSON_CONFIG VARCHAR(2000) NOT NULL DEFAULT '''',
        CORP_CODE   VARCHAR(64)   NOT NULL DEFAULT NULL
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

INSERT INTO LF_WEBCONFIG (ID, CONFIG_NAME, JSON_CONFIG, CORP_CODE) SELECT '1', 'modulePer', '[{"type":11,"suppStyle":[]}]', '100001' FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS ( SELECT 1 FROM lf_webconfig WHERE CONFIG_NAME = 'modulePer' AND CORP_CODE = '100001' );

-- 创建企业同步状态表
CALL DELPROC('ADDTABLEEXISTS');
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_TEMP_SYNCH') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_TEMP_SYNCH (
        ID BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY ( START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER ),
        SP_TEMPLID BIGINT DEFAULT NOT NULL UNIQUE,
        COUNT INT NOT NULL DEFAULT 0,
        SYNSTATUS SMALLINT NOT NULL DEFAULT 0,
        CAUSE VARCHAR(64) NOT NULL DEFAULT '''',
        UPDATE_TIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
        PRIMARY KEY (ID)
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='SHOWNUM' AND TABNAME='LF_SYSUSER') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_SYSUSER ADD SHOWNUM INT DEFAULT 0 NOT NULL';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;
-- LF_URLTASK表添加STR_TASKID字段
CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='STR_TASKID' AND TABNAME='LF_URLTASK') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_URLTASK ADD COLUMN STR_TASKID VARCHAR(20) DEFAULT '' '' NOT NULL';
      EXECUTE IMMEDIATE 'CREATE INDEX IX_URLTASK_STRTASKID ON LF_URLTASK(STR_TASKID)';
      EXECUTE IMMEDIATE 'UPDATE LF_URLTASK SET STR_TASKID=TASKID';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

--  我的场景增加权限菜单

-- 新建权限
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3551 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER WHERE ROLE_ID = 1 AND PRIVILEGE_ID = 3551);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3551 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER WHERE ROLE_ID = 2 AND PRIVILEGE_ID = 3551);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3551 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER WHERE ROLE_ID = 4 AND PRIVILEGE_ID = 3551);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3554, 94, '审核状态', '5100-1300-4', '我的场景', '富信应用', '5100-1300', ' ', '审核状态', 'auth', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3554);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3554 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3554);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3554 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3554);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3554 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3554);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3555, 94, '立即发送', '5100-1300-5', '我的场景', '富信应用', '5100-1300', ' ', '立即发送', 'send', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3555);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3555 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3555);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3555 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3555);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3555 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3555);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3556, 94, '预览', '5100-1300-6', '我的场景', '富信应用', '5100-1300', ' ', '预览', 'preview', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3556);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3556 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3556);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3556 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3556);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3556 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3556);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3557, 94, '复制', '5100-1300-7', '我的场景', '富信应用', '5100-1300', ' ', '复制', 'copy', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3557);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3557 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3557);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3557 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3557);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3557 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3557);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3558, 94, '导出', '5100-1300-8', '我的场景', '富信应用', '5100-1300', ' ', '导出', 'export', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3558);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3558 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3558);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3558 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3558);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3558 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3558);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3559, 94, '详情', '5100-1300-9', '我的场景', '富信应用', '5100-1300', ' ', '详情', 'detail', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3559);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3559 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3559);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3559 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3559);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3559 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3559);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3560, 94, '复制链接', '5100-1300-10', '我的场景', '富信应用', '5100-1300', ' ', '复制链接', 'link', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3560);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3560 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3560);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3560 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3560);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3560 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3560);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3561, 94, '启用禁用', '5100-1300-11', '我的场景', '富信应用', '5100-1300', ' ', '启用禁用', 'state', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3561);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3561 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3561);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3561 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3561);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3561 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3561);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3562, 94, '快捷场景', '5100-1300-12', '我的场景', '富信应用', '5100-1300', ' ', '快捷场景', 'shortSence', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3562);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3562 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3562);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3562 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3562);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3562 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3562);

-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
-- SELECT 3563, 94, '行业用途', '5100-1300-13', '我的场景', '富信应用', '5100-1300', ' ', '行业用途', 'industryAnduse', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
-- WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3563);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3563 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3563);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3563 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3563);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 3, 3563 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3563);

--  模板库增加权限菜单
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3564, 94, '审核状态', '5100-1350-4', '模板库', '富信应用', '5100-1350', ' ', '审核状态', 'auth', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3564);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3564 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3564);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3564 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3564);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3564 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3564);

-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
-- SELECT 3565, 94, '立即发送', '5100-1350-5', '模板库', '富信应用', '5100-1350', ' ', '立即发送', 'send', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
-- WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3565);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3565 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3565);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3565 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3565);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3565 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3565);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3566, 94, '预览', '5100-1350-6', '模板库', '富信应用', '5100-1350', ' ', '预览', 'preview', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3566);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3566 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3566);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3566 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3566);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3566 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3566);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3567, 94, '复制', '5100-1350-7', '模板库', '富信应用', '5100-1350', ' ', '复制', 'copy', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3567);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3567 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3567);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3567 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3567);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3567 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3567);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3568, 94, '导出', '5100-1350-8', '模板库', '富信应用', '5100-1350', ' ', '导出', 'export', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3568);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3568 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3568);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3568 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3568);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3568 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3568);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3569, 94, '详情', '5100-1350-9', '模板库', '富信应用', '5100-1350', ' ', '详情', 'detail', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3569);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3569 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3569);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3569 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3569);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3569 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3569);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3570, 94, '复制链接', '5100-1350-10', '模板库', '富信应用', '5100-1350', ' ', '复制链接', 'link', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3570);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3570 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3570);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3570 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3570);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3570 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3570);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3571, 94, '启用禁用', '5100-1350-11', '模板库', '富信应用', '5100-1350', ' ', '启用禁用', 'state', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3571);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3571 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3571);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3571 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3571);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3571 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3571);

-- INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
-- SELECT 3572, 94, '快捷场景', '5100-1350-12', '模板库', '富信应用', '5100-1350', ' ', '快捷场景', 'shortSence', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
-- WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3572);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3572 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3572);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3572 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3572);
-- INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3572 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3572);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3573, 94, '行业用途', '5100-1350-13', '模板库', '富信应用', '5100-1350', ' ', '行业用途', 'industryAnduse', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3573);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3573 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3573);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3573 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3573);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3573 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3573);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3574, 94, '编辑', '5100-1350-3', '模板库', '富信应用', '5100-1350', ' ', '编辑', 'edit', '模板', 'Common scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3574);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3574 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3574);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3574 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3574);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3574 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3574);


INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3575, 94, '编辑', '5100-1300-3', '我的场景', '富信应用', '5100-1300', ' ', '编辑', 'edit', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3575);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3575 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3575);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3575 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3575);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3575 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3575);

CALL MODIFY_MENU('3554,3555,3556,3557,3558,3559,3560,3561,3562,3563,3565,3566,3568,3569,3570,3571,3572,3573,3575');

-- 定制场景菜单
INSERT INTO lf_privilege ( PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME )
  SELECT  '3576', '94', '1', '查看', '5100-1351-0', '定制场景', '富信应用', '5100-1351', '/toCorpCustomTpIndex.meditorPage', '查看', 'View', '定制鼍', ' Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3576);

INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3576 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3576);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3576 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3576);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3576 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3576);


-- 定制场景 按钮权限

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3577, 94, '编辑', '5100-1351-3', '定制场景', '富信应用', '5100-1351', ' ', '编辑', 'edit', '定制鼍', 'Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3577);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3577 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3577);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3577 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3577);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3577 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3577);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3578, 94, '审核状态', '5100-1351-4', '定制场景', '富信应用', '5100-1351', ' ', '审核状态', 'auth', '定制鼍', ' Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3578);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3578 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3578);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3578 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3578);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3578 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3578);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3579, 94, '立即发送', '5100-1351-5', '定制场景', '富信应用', '5100-1351', ' ', '立即发送', 'send', '定制鼍', ' Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3579);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3579 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3579);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3579 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3579);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3579 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3579);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3580, 94, '预览', '5100-1351-6', '定制场景', '富信应用', '5100-1351', ' ', '预览', 'preview', '定制鼍', ' Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3580);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3580 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3580);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3580 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3580);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3580 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3580);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3581, 94, '复制', '5100-1351-7', '定制场景', '富信应用', '5100-1351', ' ', '复制', 'copy', '定制鼍', ' Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3581);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3581 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3581);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3581 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3581);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3581 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3581);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3582, 94, '导出', '5100-1351-8', '定制场景', '富信应用', '5100-1351', ' ', '导出', 'export', '定制鼍', ' Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3582);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3582 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3582);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3582 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3582);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3582 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3582);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3583, 94, '详情', '5100-1351-9', '定制场景', '富信应用', '5100-1351', ' ', '详情', 'detail', '定制鼍', ' Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3583);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3583 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3583);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3583 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3583);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3583 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3583);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3584, 94, '复制链接', '5100-1351-10', '定制场景', '富信应用', '5100-1351', ' ', '复制链接', 'link', '定制鼍', ' Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3584);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3584 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3584);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3584 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3584);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3584 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3584);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3586, 94, '启用禁用', '5100-1351-11', '定制场景', '富信应用', '5100-1351', ' ', '启用禁用', 'state', '定制鼍', ' Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3586);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3586 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3586);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3586 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3586);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3586 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3586);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3587, 94, '快捷场景', '5100-1351-12', '定制场景', '富信应用', '5100-1351', ' ', '快捷场景', 'shortSence', '定制鼍', ' Custom Template', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3587);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3587 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3587);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3587 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3587);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3587 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3587);

CALL MODIFY_MENU('3576,3577,3578,3579,3580,3581,3582,3583,3584,3585,3586,3587');

--  模板表 (LF_TEMPLATE)添加是否RCOS同步来的公共素材字段 ISMATERIAL 0―否 ，1-是
-- CALL DELPROC('SCHEMA_CHANGE');
-- CREATE PROCEDURE SCHEMA_CHANGE()
--   BEGIN
--     IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='ISMATERIAL' AND TABNAME='LF_TEMPLATE')
--     THEN
--       EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMPLATE ADD COLUMN ISMATERIAL INT NOT NULL DEFAULT 0';
--     END IF;
--   END;
-- CALL SCHEMA_CHANGE();
-- DROP PROCEDURE SCHEMA_CHANGE;

-- 去掉 模板库 中的新建、复制 按钮权限
DELETE FROM LF_IMPOWER WHERE PRIVILEGE_ID IN(3551,3567);
DELETE FROM LF_PRIVILEGE WHERE PRIVILEGE_ID IN(3551,3567);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 3588, 94, '模板共享', '5100-1300-13', '我的场景', '富信应用', '5100-1300', ' ', '模板共享', 'templateShare', '我的鼍', 'My scene', '富信用', 'Rich Media' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3588);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 3588 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 3588);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 3588 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 3588);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 3588 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 3588);

-- lf_temp_synch[模板同步状态记录表]添加 ISMATERIAL 字段[是否素材：0-否，1-是]
CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='ISMATERIAL' AND TABNAME='LF_TEMP_SYNCH') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMP_SYNCH ADD COLUMN ISMATERIAL INT NOT NULL DEFAULT 0';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;


-- 给表LF_TEMPCONTENT的TMID字段,添加索引 INDEX_TMID_TEMPCONTENT
CALL DELPROC('LF_TEMPCONTENT');
CREATE PROCEDURE ADDINDEX(TABLENAME VARCHAR(20),IDXNAME VARCHAR(100),CLUNAME VARCHAR(200))
begin
DECLARE STR VARCHAR (256);
DECLARE STR1 VARCHAR (256);
SELECT INDNAME INTO STR1 FROM SYSCAT.INDEXES WHERE TABNAME=UPPER(TABLENAME) AND INDNAME=UPPER(IDXNAME);
if  STR1 is  null THEN
  SET STR = ' CREATE INDEX '||UPPER(IDXNAME)||' ON '||UPPER(TABLENAME)||' ('||UPPER(CLUNAME)||' ASC) PCTFREE 10 ALLOW REVERSE SCANS';
EXECUTE IMMEDIATE STR;
end if;
END;

CALL ADDINDEX('LF_TEMPCONTENT','INDEX_TMID_TEMPCONTENT','TMID');
DROP PROCEDURE ADDINDEX;


-- 长沙项目部同步过来的脚本

/*查询统计-数据查询－系统下行导出记录：/sta_stateCode.htm*/
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE)
  SELECT 128, 27, 1, '查看', '1520-1300-0', '系统下行导出记录', '数据查询', '1520-1300', '/que_mtRptRecord.htm' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=128);

/*查询统计-数据查询－系统下行导出记录  加权限*/
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1,128 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=128 AND ROLE_ID=1);

/*查询统计-数据查询－系统下行导出记录  加权限*/
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2,128 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=128 AND ROLE_ID=2);

/*查询统计-数据查询－系统下行导出记录  加权限*/
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 4,128 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=128 AND ROLE_ID=4);


/** 操作员导入脚本 **/
INSERT INTO LF_PRIVILEGE(PRIVILEGE_ID,RESOURCE_ID,COMMENTS,PRIV_CODE,MENUNAME,MODNAME,MENUCODE,ZH_TW_COMMENTS,ZH_HK_COMMENTS,ZH_TW_MENUNAME,ZH_HK_MENUNAME,ZH_TW_MODNAME,ZH_HK_MODNAME)
  SELECT 777,10,'文件导入','1600-1200-8','操作员管理','操作员管理','1600-1200','文件入','Import file','操作T管理','Operator','操作T管理','Operator' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=777);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 1,777 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=1 AND PRIVILEGE_ID=777);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 2,777 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=2 AND PRIVILEGE_ID=777);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 4,777 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=4 AND PRIVILEGE_ID=777);



/** 业务类型导入脚本 **/
INSERT INTO LF_PRIVILEGE(PRIVILEGE_ID,RESOURCE_ID,COMMENTS,PRIV_CODE,MENUNAME,MODNAME,MENUCODE,ZH_TW_COMMENTS,ZH_HK_COMMENTS,ZH_TW_MENUNAME,ZH_HK_MENUNAME,ZH_TW_MODNAME,ZH_HK_MODNAME)
  SELECT 108,8,'文件导入','1400-1400-4','业务类型管理','参数维护','1400-1400','文件入','Import file','I疹型管理','Business type','稻So','Parameter' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=108);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 1,108 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=1 AND PRIVILEGE_ID=108);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 2,108 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=2 AND PRIVILEGE_ID=108);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 4,108 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=4 AND PRIVILEGE_ID=108);


/** 机构管理导入脚本 **/
INSERT INTO LF_PRIVILEGE(PRIVILEGE_ID,RESOURCE_ID,COMMENTS,PRIV_CODE,MENUNAME,MODNAME,MENUCODE,ZH_TW_COMMENTS,ZH_HK_COMMENTS,ZH_TW_MENUNAME,ZH_HK_MENUNAME,ZH_TW_MODNAME,ZH_HK_MODNAME)
  SELECT 205,10,'文件导入','1600-1000-4','机构管理','操作员管理','1600-1000','文件С','Import file','C管理','Organization','操作T管理','Operator' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=205);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 1,205 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=1 AND PRIVILEGE_ID=205);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 2,205 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=2 AND PRIVILEGE_ID=205);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 4,205 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=4 AND PRIVILEGE_ID=205);


/** 机构管理导出脚本 **/
INSERT INTO LF_PRIVILEGE(PRIVILEGE_ID,RESOURCE_ID,COMMENTS,PRIV_CODE,MENUNAME,MODNAME,MENUCODE,ZH_TW_COMMENTS,ZH_HK_COMMENTS,ZH_TW_MENUNAME,ZH_HK_MENUNAME,ZH_TW_MODNAME,ZH_HK_MODNAME)
  SELECT 206,10,'导出','1600-1000-5','机构管理','操作员管理','1600-1000','С','Export','C管理','Organization','操作T管理','Operator' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=206);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 1,206 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=1 AND PRIVILEGE_ID=206);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 2,206 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=2 AND PRIVILEGE_ID=206);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID)
  SELECT 4,206 FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE ROLE_ID=4 AND PRIVILEGE_ID=206);

/*创建导出记录表*/
CALL DELPROC('ADDTABLEEXISTS');
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='A_RPTRECORD') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE A_RPTRECORD (
        ID DECIMAL(20) NOT NULL GENERATED BY DEFAULT AS IDENTITY
                                  (START WITH 1, INCREMENT BY 1, NO CACHE, MINVALUE 1, MAXVALUE 9223372036854775807, NO CYCLE, NO ORDER),
        FILENAME VARCHAR(256) NOT NULL DEFAULT '''',
        USERID VARCHAR(256) NOT NULL DEFAULT '''',
        STATUS CHAR(1) NOT NULL DEFAULT '''',
        CREATETIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
        GENERATETIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
        DOWNLOADTIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;


/*短信黑名单删除记录表*/
CALL DELPROC('ADDTABLEEXISTS');
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='PB_BLACK_DEL') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE PB_BLACK_DEL (
        ID DECIMAL(20) NOT NULL GENERATED BY DEFAULT AS IDENTITY
                          (START WITH 1, INCREMENT BY 1, NO CACHE, MINVALUE 1, MAXVALUE 9223372036854775807, NO CYCLE, NO ORDER),
        OPERATEID VARCHAR(21) NOT NULL DEFAULT '''',
        PHONE BIGINT NOT NULL DEFAULT 0,
        OPTTIME TIMESTAMP NOT NULL DEFAULT CURRENT TIMESTAMP ,
        TASKID VARCHAR(40) NOT NULL DEFAULT ''''
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;


INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
SELECT '3593', '6', NULL, '删除记录', '1900-1260-5', '短信黑名单', '信息安全', '1900-1260', null,'h除', 'Delete Record', '短信黑名', 'SMS blacklist', '信息安全', 'Information security' FROM SYSIBM.SYSDUMMY1
WHERE NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3593);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1,3593 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3593 AND ROLE_ID=1);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2,3593 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3593 AND ROLE_ID=2);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3,3593 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3593 AND ROLE_ID=3);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 4,3593 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3593 AND ROLE_ID=4);

/*新增状态码映射字段*/
CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='MAPPING_CODE' AND TABNAME='LF_STATECODE') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_STATECODE ADD COLUMN MAPPING_CODE VARCHAR(64) NOT NULL DEFAULT ''''';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

/*新增状态码管理权限*/
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
SELECT '3589', '8', NULL, '新建', '1400-1350-1', '状态码管理', '参数维护', '1400-1350', NULL, '新建', 'Add', 'Ba管理', 'Status code', '稻So', 'Parameter' FROM SYSIBM.SYSDUMMY1
WHERE NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3589);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1,3589 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3589 AND ROLE_ID=1);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2,3589 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3589 AND ROLE_ID=2);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3,3589 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3589 AND ROLE_ID=3);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 4,3589 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3589 AND ROLE_ID=4);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
SELECT '3590', '8', NULL, '导入', '1400-1350-2', '状态码管理', '参数维护', '1400-1350', NULL, '入', 'Import', 'Ba管理', 'Status code', '稻So', 'Parameter' FROM SYSIBM.SYSDUMMY1
WHERE NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3590);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1,3590 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3590 AND ROLE_ID=1);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2,3590 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3590 AND ROLE_ID=2);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3,3590 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3590 AND ROLE_ID=3);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 4,3590 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3590 AND ROLE_ID=4);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
SELECT '3591', '8', NULL, '下载导入模板', '1400-1350-3', '状态码管理', '参数维护', '1400-1350', NULL, '下d入模板', 'Download import template', 'Ba管理', 'Status code', '稻So', 'Parameter' FROM SYSIBM.SYSDUMMY1
WHERE NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3591);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1,3591 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3591 AND ROLE_ID=1);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2,3591 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3591 AND ROLE_ID=2);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3,3591 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3591 AND ROLE_ID=3);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 4,3591 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3591 AND ROLE_ID=4);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
SELECT '3592', '8', NULL, '导出', '1400-1350-4', '状态码管理', '参数维护', '1400-1350', NULL, 'С', 'Export', 'Ba管理', 'Status code', '稻So', 'Parameter' FROM SYSIBM.SYSDUMMY1
WHERE NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3592);

INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 1,3592 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3592 AND ROLE_ID=1);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 2,3592 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3592 AND ROLE_ID=2);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 3,3592 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3592 AND ROLE_ID=3);
INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) SELECT 4,3592 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3592 AND ROLE_ID=4);

CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='SHARE_STATUS' AND TABNAME='LF_UDGROUP') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_UDGROUP ADD COLUMN SHARE_STATUS SMALLINT NOT NULL DEFAULT 0';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='CREATETIME' AND TABNAME='LF_UDGROUP') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_UDGROUP ADD COLUMN CREATETIME TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

/* 短信是否分批发送 */
INSERT INTO LF_CORP_CONF(CORP_CODE,PARAM_KEY,PARAM_VALUE) SELECT '100001','sms.split',0 FROM SYSIBM.SYSDUMMY1
WHERE NOT EXISTS(SELECT * FROM LF_CORP_CONF WHERE PARAM_KEY='sms.split');

UPDATE LF_SPEUICFG SET DISPCONTENT='11111000' WHERE CORPCODE IN ('100001');

/*查询统计-数据查询－系统下行导出记录：菜单国际化*/
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME='系y下行R出',ZH_HK_MENUNAME='Export record of system MT',
	ZH_TW_MODNAME='查',ZH_HK_MODNAME='Data query',ZH_TW_COMMENTS='查看',ZH_HK_COMMENTS='View'
WHERE PRIVILEGE_ID=128;

-- 移动办公增加超大文件相关菜单
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID,OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 707, 1, 1, '查看', '1050-1250-0', '超大文件导入', '企业短信', '1050-1250', '/ssm_dxzsBigFileExport.htm', '查看', 'View', '超大文件入', 'Big file import', '企I短信', 'Customer service SMS' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 707);

INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 707 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 707);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 707 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 707);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 707 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 707);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID,OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 1074, 1, NULL, '批量输入', '1050-1000-2', '相同内容群发', '企业短信', '1050-1000', NULL, '批量入', 'Bulk input', '相同热萑喊l', 'Same content', '企I短信', 'Customer service SMS' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 1074);

INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 1074 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 1074);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 1074 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 1074);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 1074 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 1074);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID,OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 1075, 1, NULL, '超大文件', '1050-1000-3', '相同内容群发', '企业短信', '1050-1000', NULL, '超大文件', 'Big file', '相同热萑喊l', 'Same content', '企I短信', 'Customer service SMS' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 1075);

INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 1075 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 1075);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 1075 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 1075);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 1075 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 1075);

-- 移动客服增加超大文件相关菜单
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID,OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 706, 22, 1, '查看', '2300-1450-0', '超大文件导入', '客服短信', '2300-1450', '/ssm_dxkfBigFileExport.htm', '查看', 'View', '超大文件入', 'Big file import', '客服短信', 'Customer service SMS' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 706);

INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 706 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 706);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 706 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 706);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 706 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 706);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID,OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 1076, 22, NULL, '批量输入', '2300-1100-2', '相同内容群发', '客服短信', '2300-1100', NULL, '批量入', 'Bulk input', '相同热萑喊l', 'Same content', '客服短信', 'Customer service SMS' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 1076);

INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID,OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 1077, 22, NULL, '超大文件', '2300-1100-3', '相同内容群发', '客服短信', '2300-1100', NULL, '超大文件', 'Big file', '相同热萑喊l', 'Same content', '客服短信', 'Customer service SMS' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 1077);

INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 1076 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 1076);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 1076 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 1076);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 1076 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 1076);

INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 1077 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 1077);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 1077 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 1077);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 1077 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 1077);

--新加超大文件权限菜单不全
CALL MODIFY_MENU('707,1074,1075,706,1076,1077');


/*超大文件记录表*/
CALL DELPROC('ADDTABLEEXISTS');
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_BIGFILE') THEN
      EXECUTE IMMEDIATE
      'CREATE TABLE LF_BIGFILE (
        ID            DECIMAL(20)                 NOT NULL GENERATED BY DEFAULT AS IDENTITY
                                                             ( START WITH 1, INCREMENT BY 1, NO CACHE, MINVALUE 1, MAXVALUE 9223372036854775807, NO CYCLE, NO ORDER ), -- 主键ID(页面上显示“文件批次”)
        FILE_NAME     VARCHAR(64) DEFAULT '' ''   NOT NULL, -- 文件批次名称
        SUB_COUNT     DECIMAL(20) DEFAULT 0       NOT NULL, -- 提交总数
        EFF_COUNT     DECIMAL(20) DEFAULT 0       NOT NULL, -- 有效号码数
        BLA_COUNT     DECIMAL(20) DEFAULT 0       NOT NULL, -- 黑名单数量
        REP_COUNT     DECIMAL(20) DEFAULT 0       NOT NULL, -- 重复号码数
        ERR_COUNT     DECIMAL(20) DEFAULT 0       NOT NULL, -- 格式错误号码数
        OPR_NUM       VARCHAR(50) DEFAULT '' ''   NOT NULL, -- 按照移动,联通,电信,国际的顺序用英文逗号分隔
        HANDLE_STATUS INT DEFAULT 0               NOT NULL, -- 1.上传中 2.上传成功(有效号码、黑名单、重复号码、格式错误号码已处理完成) 3.上传失败
        FILE_STATUS   INT DEFAULT 0               NOT NULL, -- 1.启用 2.禁用
        TASKID        VARCHAR(1024) DEFAULT '' '' NOT NULL, -- 发送过该超大文件的任务号，用逗号分隔
        UPLOAD_NUM    INT DEFAULT 0               NOT NULL, -- 原始上传文件个数
        EFF_NUM       INT DEFAULT 0               NOT NULL, -- 拆分出来的有效号码文件个数
        HANDLE_NODE   VARCHAR(50) DEFAULT '' ''   NOT NULL, -- 上传WEB节点
        USERID        DECIMAL(20) DEFAULT 0       NOT NULL, -- 操作员ID
        USER_NAME     VARCHAR(64) DEFAULT '' ''   NOT NULL, -- 操作员名称
        BUS_ID        DECIMAL(20) DEFAULT 0       NOT NULL, -- 业务类型ID
        BUS_NAME      VARCHAR(32) DEFAULT '' ''   NOT NULL, -- 业务名称
        BUS_CODE      VARCHAR(64) DEFAULT '' ''   NOT NULL, -- 业务编码
        DEP_ID        DECIMAL(20) DEFAULT 0       NOT NULL, -- 机构ID
        CREATE_TIME   TIMESTAMP                   NOT NULL DEFAULT CURRENT_TIMESTAMP, -- 上传时间
        UPDATE_TIME   TIMESTAMP                   NOT NULL DEFAULT CURRENT_TIMESTAMP, -- 修改时间
        FILE_URL      VARCHAR(512) DEFAULT '' ''  NOT NULL, -- 有效拆分文件1
        FILE_URL2     VARCHAR(512) DEFAULT '' ''  NOT NULL, -- 有效拆分文件2
        FILE_URL3     VARCHAR(512) DEFAULT '' ''  NOT NULL, -- 有效拆分文件3
        FILE_URL4     VARCHAR(512) DEFAULT '' ''  NOT NULL, -- 有效拆分文件4
        FILE_URL5     VARCHAR(512) DEFAULT '' ''  NOT NULL, -- 有效拆分文件5
        FILE_URL6     VARCHAR(512) DEFAULT '' ''  NOT NULL, -- 有效拆分文件6
        FILE_URL7     VARCHAR(512) DEFAULT '' ''  NOT NULL, -- 有效拆分文件7
        FILE_URL8     VARCHAR(512) DEFAULT '' ''  NOT NULL, -- 有效拆分文件8
        FILE_URL9     VARCHAR(512) DEFAULT '' ''  NOT NULL, -- 有效拆分文件9
        VIEW_URL      VARCHAR(512) DEFAULT '' ''  NOT NULL, -- 预览号码文件路径(只预览10个号码)
        BAD_URL       VARCHAR(512) DEFAULT '' ''  NOT NULL, -- 错误号码文件路径（黑名单、重复号码、格式错误）
        CORP_CODE     VARCHAR(64) DEFAULT '' ''   NOT NULL, -- 企业编码
        REMARK        VARCHAR(512) DEFAULT '' ''  NOT NULL
      )';
      EXECUTE IMMEDIATE 'CREATE INDEX IX_LF_BIGFILE_USERID ON LF_BIGFILE(USERID)';
      EXECUTE IMMEDIATE 'CREATE INDEX IX_LF_BIGFILE_DEP_ID ON LF_BIGFILE(DEP_ID)';
      EXECUTE IMMEDIATE 'CREATE INDEX IX_LF_BIGFILE_CORPCODE ON LF_BIGFILE(CORP_CODE)';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

/*修改下行记录导出菜单名称*/
UPDATE LF_PRIVILEGE SET MENUNAME='系统下行记录导出',ZH_TW_MENUNAME='系y下行R出',ZH_HK_MENUNAME='Record export of system MT' WHERE PRIVILEGE_ID=128;

CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='PHONENUM' AND TABNAME='LF_MTTASK') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_MTTASK ADD COLUMN PHONENUM INT NOT NULL DEFAULT -1';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='SENDNUM' AND TABNAME='LF_MTTASK') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_MTTASK ADD COLUMN SENDNUM INT NOT NULL DEFAULT -1';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

-- 下发完成时间,由网关同步
CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='FINISHTIME' AND TABNAME='LF_MTTASK') THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_MTTASK ADD FINISHTIME TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP';
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

CALL SYSPROC.ADMIN_CMD('REORG TABLE LF_MTTASK');

-- 网关调用该储存过程，更新web的表
CALL DELPROC('GW_UPLFMTTASK_P1');
CREATE PROCEDURE "GW_UPLFMTTASK_P1"
 (IN "PITASKID" INTEGER,
  IN "PIPHONENUM" INTEGER,
  IN "PISENDNUM" INTEGER
 )
  SPECIFIC "GW_UPLFMTTASK_P1"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
	IF PIPHONENUM<>0 THEN
	UPDATE LF_MTTASK SET PHONENUM=PIPHONENUM,SENDNUM=SENDNUM+PISENDNUM,FINISHTIME=current timestamp WHERE TASKID=PITASKID;
	ELSE
	UPDATE LF_MTTASK SET SENDNUM=SENDNUM+PISENDNUM,FINISHTIME=current timestamp WHERE TASKID=PITASKID;
	END IF;
END;

-- 将企业流量暂时关闭
UPDATE LF_REVIEWSWITCH SET SWITCH_TYPE = 2 WHERE INFO_TYPE = 7;


CALL DELPROC('ADDCOL');
CREATE PROCEDURE ADDCOL()
  BEGIN
    DECLARE MTID BIGINT DEFAULT 107;
    IF EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE COLNAME='TID' AND TABNAME='LF_THIR_MENUCONTROL') THEN
      SELECT MAX(TID) INTO MTID FROM LF_THIR_MENUCONTROL;
      EXECUTE IMMEDIATE 'ALTER TABLE LF_THIR_MENUCONTROL ALTER TID RESTART WITH ' || BIGINT(MTID+1);
    END IF;
  END;
CALL ADDCOL();
DROP PROCEDURE ADDCOL;

/* 添加我的快捷菜单的脚本 */
INSERT INTO LF_THIR_MENUCONTROL (MENU_NUM,TITLE,PRI_MENU,PRI_ORDER,ZH_TW_TITLE,ZH_HK_TITLE)
  SELECT 25,'企业富信',93,60,'企I富信','Multimedia' FROM SYSIBM.SYSDUMMY1
  WHERE NOT EXISTS (SELECT * FROM LF_THIR_MENUCONTROL WHERE MENU_NUM=25 AND PRI_MENU=93);

-- 批量补发
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
  SELECT 129, 27, NULL, '批量补发', '1520-1200-1', '系统下行记录', '数据查询', '1520-1200', NULL, '批量al', 'Batch Send', '系y下行', 'MT record', '查', 'Data query' FROM SYSIBM.SYSDUMMY1
    WHERE NOT EXISTS(SELECT 1 FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 129);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 1, 129 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 1 AND PRIVILEGE_ID = 129);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 2, 129 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 2 AND PRIVILEGE_ID = 129);
INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) SELECT 4, 129 FROM SYSIBM.SYSDUMMY1 WHERE NOT EXISTS (SELECT 1 FROM LF_IMPOWER where ROLE_ID = 4 AND PRIVILEGE_ID = 129);

-- 标准版删除添加的无效企业
DELETE FROM LF_CORP WHERE CORP_CODE = '290000';

-- drop the common procedure delproc at last;
DROP PROCEDURE DELPROC;

CREATE PROCEDURE "ADDVERSIONEXISTS"
  BEGIN ATOMIC
    DECLARE VERSIONSTR VARCHAR(32);
    DECLARE DBVERSION VARCHAR(32);
    DECLARE WBSVERSION VARCHAR(32);
    DECLARE SPGATEVERSION VARCHAR(32);
    DECLARE NUM INT;
    DECLARE TOTAL INT;
    SET VERSIONSTR = '7.3.0.515';
    SET DBVERSION = '73.00';
    SET WBSVERSION = '8.6.1.216';
    SET SPGATEVERSION = '6.1.50.342';
    SET NUM =3;
    SET TOTAL=3;
    --EMP产品版本记录
    --EMP-WEB
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,1000,VERSIONSTR,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP-WEB');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=VERSIONSTR WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000;
    END IF;
    --EMP_GATEWAY
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,2000,WBSVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP_GATEWAY');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=WBSVERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000;
    END IF;
    --SMT_SPGATE
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,3000,SPGATEVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'SMT_SPGATE');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=SPGATEVERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000;
    END IF;
    --EMP产品版本历史记录
    --EMP-WEB
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=VERSIONSTR AND PRODUCT_ID=1000 AND PROCESS_ID=1000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO,ISRELEASE,VERSIONINFO)
      VALUES(1000,1000,VERSIONSTR,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP-WEB',1,'1、WEB多语言功能实现<br />2、网关多语言功能。<br />');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP,ISRELEASE=1,VERSIONINFO='1、WEB多语言功能实现<br />2、网关多语言功能。<br />' WHERE VERSION=VERSIONSTR AND PRODUCT_ID=1000 AND PROCESS_ID=1000;
    END IF;
    --EMP_GATEWAY
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=WBSVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=2000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,2000,WBSVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP_GATEWAY');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP WHERE VERSION=WBSVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=2000;
    END IF;
    --SMT_SPGATE
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=SPGATEVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=3000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,3000,SPGATEVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'SMT_SPGATE');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP WHERE VERSION=SPGATEVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=3000;
    END IF;
    IF NOT EXISTS(SELECT * FROM LF_DB_SCRIPT WHERE VERSION=DBVERSION AND CURRENT_NO=NUM AND TOTAL=TOTAL)
    THEN
      --EMP产品数据库版本信息表
      INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
      VALUES(DBVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,NUM,TOTAL,2,'版本号更改');
    ELSE
      UPDATE LF_DB_SCRIPT SET STATE=2,UPDATETIME=CURRENT TIMESTAMP,MEMO='版本号更改' WHERE  VERSION=DBVERSION AND CURRENT_NO=NUM AND TOTAL=TOTAL;
    END IF;
  END;
CALL ADDVERSIONEXISTS;
DROP PROCEDURE ADDVERSIONEXISTS;

/*EMP升级脚本 END*/
