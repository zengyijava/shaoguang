-----------V71.00-V73.00 START------------------------
DECLARE COUNTNUM INT;
        DBVERSIONSTR VARCHAR2(32);
        NUMNO INT;
        TOTALINT INT;
BEGIN
  DBVERSIONSTR:='73.00';
  NUMNO:=1;
  TOTALINT:=1;
  SELECT COUNT(*) INTO COUNTNUM FROM LF_DB_SCRIPT WHERE VERSION=DBVERSIONSTR;
  IF COUNTNUM=0 THEN
    --EMP产品数据库版本信息表
    INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
    VALUES(DBVERSIONSTR,SYSDATE,SYSDATE,NUMNO,TOTALINT,1,'Web脚本更新');
    COMMIT;
  END IF;
END;
/

/*网关升级脚本   START*/   
/** 升级脚本(V4.06.05-V4.06.06) START */
CREATE OR REPLACE PROCEDURE GW_H_TRANSFERV1(MININDEX IN NUMBER,
                                     MAXINDEX IN NUMBER,
                                     PROCESSFLAG IN NUMBER,
                                     LOTSIZE IN NUMBER) IS
PISTR VARCHAR2(4000);
PITABLENAME VARCHAR2(20);
MINYM NUMBER;
MAXYM NUMBER;
CURYM NUMBER;
BEGIN
  --------------------VER 3.1-------------------------------------
   SELECT CAST(TO_CHAR(MAX(SENDTIME),'YYYYMM')AS INT),CAST(TO_CHAR(MIN(SENDTIME),'YYYYMM')AS INT) INTO MAXYM,MINYM FROM GW_MT_TASK_BAK WHERE ID BETWEEN MININDEX AND MAXINDEX;

   CURYM := MINYM;
   WHILE CURYM<=MAXYM LOOP
      PITABLENAME := 'MTTASK'||CAST(CURYM AS CHAR);

      PISTR:= 'INSERT INTO '||PITABLENAME||' NOLOGGING (ID,MDAY,USERID,SPGATE,CPNO,PHONE,SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,
      PKTOTAL,SENDSTATUS,SENDFLAG,RECVFLAG,DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,SENDTIME,RECVTIME,MESSAGE,TASKID,
      ECID,PTMSGID,MOBILEAREA,SPID,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,DOWNTM)
      SELECT ID,TO_NUMBER(TO_CHAR(M.SENDTIME,''DD'')),USERID,SPGATE,CPNO,PHONE,SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,
      SENDSTATUS,SENDFLAG,RECVFLAG,DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,SENDTIME,RECVTIME,MESSAGE,TASKID,ECID,
      PTMSGID,MOBILEAREA,SPID,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,DOWNTM
      FROM GW_MT_TASK_BAK M
      WHERE CAST(TO_CHAR(SENDTIME,''YYYYMM'')AS INT) ='||CURYM||' AND (M.ID <='||MAXINDEX||') ';
      --DBMS_OUTPUT.PUT_LINE(PISTR);
      EXECUTE IMMEDIATE PISTR;

      IF CAST(SUBSTR(CAST(CURYM AS CHAR),5,2) AS INT)=12 THEN
        CURYM := CAST(CAST(CAST(SUBSTR(CAST(CURYM AS CHAR),1,4)AS INT)+1 AS CHAR)||'01' AS INT);
      ELSE
        CURYM := CURYM+1;
      END IF;
   END LOOP;
END GW_H_TRANSFERV1;

/

MERGE INTO  A_GWPARAMCONF A USING (SELECT 'PUSHCONFIG' AS "PARAMITEM",4000 AS "GWTYPE" FROM  DUAL) B ON (A.PARAMITEM=B.PARAMITEM AND A.GWTYPE=B.GWTYPE)
WHEN NOT MATCHED THEN 
INSERT (PARAMITEM, PARAMNAME,  PARAMMEMO,PARAMATTRIBUTE, VALUERANGE,
DEFAULTVALUE,  CONTROLTYPE, GWTYPE, HKPARAMNAME, HKPARAMMEMO, ENPARAMNAME, ENPARAMMEMO)
VALUES('PUSHCONFIG', '推送字段是否为JSON数组',  '推送字段是否为JSON数组(0:字符串,1:JSON数组)',
1, '0,1','0',1,4000,'推送字段是否JSON到M','推送字段是否JSON到M(0:字符串,1:JSON到M)','Whether the push field is a JSON array','Whether the push field is a JSON array (0: string, 1: JSON array)');


INSERT INTO A_GWPARAMVALUE(GWNO, GWTYPE, PARAMITEM, PARAMVALUE)
SELECT DISTINCT GWNO,4000,'PUSHCONFIG','0' FROM A_GWPARAMVALUE 
WHERE  NOT EXISTS(SELECT * FROM A_GWPARAMVALUE WHERE PARAMITEM='PUSHCONFIG'  AND  GWTYPE=4000) AND  GWTYPE=4000;

commit;
/

CREATE OR REPLACE PROCEDURE S_WR_MTTASK
 (
    PIUID          IN NUMBER,
    PIPTMSGID      IN NUMBER,
    PISENDSTATUS   IN NUMBER,
    PIRETFLAG      IN NUMBER,
    PIPKTOTAL      IN NUMBER,
    PIPHONECOUNT   IN NUMBER,
    PISPLITLEN_P   IN NUMBER,
    PIMULTILEN1_P  IN NUMBER,
    PIMULTILEN2_P  IN NUMBER,
    PISIGNLEN_P    IN NUMBER,
    PIECID         IN NUMBER,
    PIUSERID       IN VARCHAR2,
    PISPGATE       IN VARCHAR2,
    PICPNO         IN VARCHAR2,
    PIRECVMTTIME   IN VARCHAR2,
    PIMESSAGE      IN VARCHAR2,
    PISHOUJI       IN VARCHAR2,
    PIFEEFLAG      IN NUMBER,
    PISENDLEVEL    IN NUMBER,
    PITASKID       IN NUMBER,
    PIERCODE       IN VARCHAR2,
    PITPUDHI       IN NUMBER,
    PILONGMSGSEQ   IN NUMBER,
    PIMSGFMT       IN NUMBER,
    PIUNICOM       IN NUMBER,
    PIMOBILEAREA   IN NUMBER,
    PIPKNUMBER     IN NUMBER,
    PISVRTYPE      IN VARCHAR2,
    PIP1      IN VARCHAR2,
    PIP2      IN VARCHAR2,
    PIP3      IN VARCHAR2,
    PIP4      IN VARCHAR2,
    PIUSERMSGID    IN NUMBER DEFAULT 0,
    PIMODULEID     IN NUMBER DEFAULT 0,
    PIATTIME       IN NUMBER DEFAULT 0,
    PIVALIDTIME    IN NUMBER DEFAULT 0,
    PISENDTYPE     IN NUMBER DEFAULT 1,
    PIBATCHID      IN NUMBER DEFAULT 0,
    PIAREACODE     IN NUMBER DEFAULT 0,
	PICUSTID      IN VARCHAR2,
	PIEXDATA      IN VARCHAR2
 )
AS
--临时变量
PITMPMSGID NUMBER(22,0);
PILOCATION PLS_INTEGER;
PISTART PLS_INTEGER;
PIRESULTPHONE VARCHAR(21);
PISTRSPLIT VARCHAR(2);
PILEN PLS_INTEGER;
PIRESULTMSG VARCHAR(720);
PIPKNUM PLS_INTEGER;
PITMPNUM PLS_INTEGER;
ICOUNT PLS_INTEGER;
PISHOUJI_P VARCHAR2(3500);
PIRECVMTTIME_P TIMESTAMP(6);
PIPTMSGID_P NUMBER(22,0);

PISPLITLEN PLS_INTEGER;
PIMULTILEN1 PLS_INTEGER;
PIMULTILEN2 PLS_INTEGER;
PISIGNLEN PLS_INTEGER;

BEGIN
--变量赋值
PILEN := LENGTH(PIMESSAGE)-PISIGNLEN_P;
PITMPNUM := 0;
PIPKNUM := 1;
PISTRSPLIT := ',';
PISHOUJI_P :=PISHOUJI;
PIPTMSGID_P:=PIPTMSGID;


IF PIRECVMTTIME IS NULL THEN
   PIRECVMTTIME_P:=SYSTIMESTAMP;
ELSE
   PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
END IF;
--清空临时表,如果临时表不存在直接返回不处理
/*SELECT  COUNT(*) INTO ICOUNT FROM USER_TABLES T WHERE UPPER(T.TABLE_NAME)=UPPER('TMP_MTTASK');
IF ICOUNT>0 THEN
    EXECUTE IMMEDIATE 'TRUNCATE TABLE TMP_MTTASK';
ELSE
  RETURN;
END IF;
*/
--验证手机号合法性
IF (PISHOUJI_P IS NULL) THEN
  PISHOUJI_P := ' ';
END IF;
IF /*(PISHOUJI_P IS NULL) OR */(PIPHONECOUNT < 1) THEN
   RETURN;
END IF;

--变量赋值
IF PIMSGFMT=4 OR PIMSGFMT=248 OR PIMSGFMT=246 THEN
  PISPLITLEN:=140;
  PIMULTILEN1:=134;
  PIMULTILEN2:=134;
  PISIGNLEN:=0;
ELSE
  PISPLITLEN  :=PISPLITLEN_P;
  PIMULTILEN1 :=PIMULTILEN1_P;
  PIMULTILEN2 :=PIMULTILEN2_P;
  PISIGNLEN   :=PISIGNLEN_P;
END IF;
IF PIMSGFMT=25 THEN
  SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;
  IF ICOUNT<1 THEN
    INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
    RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
    UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
    VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PIPTMSGID_P,NVL(PIMESSAGE,' '),PISENDSTATUS,
    PIRETFLAG,PIPKNUMBER,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
    PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA);
  END IF;
  RETURN;
END IF;
IF PIPHONECOUNT = 1 --单发
THEN
 SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;
  --IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID_P)
  IF ICOUNT<1 THEN
    IF PIPKTOTAL = 1 THEN
      INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
      RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
      UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
      VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PIPTMSGID_P,NVL(PIMESSAGE,' '),PISENDSTATUS,
      PIRETFLAG,PIPKTOTAL,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
      PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA);
    ELSE
      PIPKNUM := 1;
      PITMPMSGID := PIPTMSGID_P;
      IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1 THEN
        PIRESULTMSG := SUBSTR(PIMESSAGE,1,PISPLITLEN);
        PITMPMSGID := PITMPMSGID;
        ICOUNT:=0;
        SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PITMPMSGID;
        IF ICOUNT<1 THEN
          INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
          RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
          UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
          VALUES(PIUID, PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
          PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
          PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
        END IF;
        PIRESULTMSG := SUBSTR(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN);
        PITMPMSGID := PITMPMSGID+17179869184;
        PIPKNUM := PIPKNUM+1;
        ICOUNT:=0;
        SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
        IF ICOUNT<1 THEN
          INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
          RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
          UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
          VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
          PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
          PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
        END IF;
      ELSE
        WHILE PIPKNUM <= PIPKTOTAL LOOP
          IF PIPKNUM = PIPKTOTAL THEN
             PIRESULTMSG := SUBSTR(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN);
             PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
          ELSIF PIPKNUM = PIPKTOTAL-1 THEN
            IF ((PILEN-(PIPKNUM-1)*PIMULTILEN1) > PIMULTILEN2) AND ((PILEN-(PIPKNUM-1)*PIMULTILEN1) <= PIMULTILEN1) THEN
               PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1);
               PITMPNUM := PILEN-1;
               --DBMS_OUTPUT.PUT_LINE('123');
            ELSE
               PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
               DBMS_OUTPUT.PUT_LINE(PIRESULTMSG);
               PITMPNUM := (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
               --DBMS_OUTPUT.PUT_LINE('456');
            END IF;
            PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
          ELSE
               PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
               PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
               --DBMS_OUTPUT.PUT_LINE(PIRESULTMSG);
          END IF;
          ICOUNT:=0;
          SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
          IF ICOUNT<1 THEN
            INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
            RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
            UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
            VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
            PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
            PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
          END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
          --EXECUTE IMMEDIATE STR;
          PIPKNUM := PIPKNUM+1;
        END LOOP;--END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
      END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1;
      INSERT INTO GW_MT_TASK_BAK ("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
      RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
      UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
      SELECT A."UID",A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,NVL(A.MESSAGE,' '),A.SENDSTATUS,A.RETFLAG,
      A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
      A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA FROM TMP_MTTASK A;
      COMMIT;
    END IF;--END IF OF IF PIPKTOTAL = 1
  --ELSE  --MSGID存在是写入MSGIDTEST表
  --  INSERT INTO MSGIDTEST(MSGID) VALUES(PIPTMSGID);
  END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID_P)
ELSE --群发
    PISHOUJI_P := PISTRSPLIT||PISHOUJI_P||PISTRSPLIT;
    PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT);
  IF PIPKTOTAL < 1 THEN--没有短信内容
    RETURN;
  END IF;

  IF PIPKTOTAL >= 1 --需要拆分长短信
  THEN
    WHILE PILOCATION <> 0 LOOP--拆分手机号码
        PISTART := PILOCATION;
        PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT,PISTART+1);
      IF PILOCATION > 0 THEN
        PIRESULTPHONE := SUBSTR(PISHOUJI_P,PISTART+1,PILOCATION-PISTART-1);--拆分后的字符
        IF (PIRESULTPHONE IS NULL) THEN
          PIRESULTPHONE := ' ';
        END IF;
        PITMPMSGID := PIPTMSGID_P;
        ICOUNT:=0;
        SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
        IF ICOUNT<1 THEN
          IF PIPKTOTAL = 1 THEN
            INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
            RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
            UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
            VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIMESSAGE,PISENDSTATUS,
            PIRETFLAG, PIPKTOTAL,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
            PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
          ELSE
            PIPKNUM := 1;
            IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1 THEN
              PIRESULTMSG := SUBSTR(PIMESSAGE,1, PISPLITLEN);--拆分后的字符
              PITMPMSGID := PITMPMSGID;
              ICOUNT:=0;
              SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
              IF ICOUNT<1 THEN
                INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                VALUES(PIUID,PIUSERID, PISPGATE,PICPNO,PIRESULTPHONE, PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                PIRETFLAG, PIPKNUM, PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
              END IF;
              PIRESULTMSG := SUBSTR(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN);
              PITMPMSGID := PITMPMSGID+17179869184;
              PIPKNUM := PIPKNUM+1;
              ICOUNT:=0;
              SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
              IF ICOUNT<1 THEN
                INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
              END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
            ELSE
              WHILE PIPKNUM <= PIPKTOTAL LOOP--PIPKNUM:1    PIPKTOTAL 2
                IF PIPKNUM = PIPKTOTAL THEN
                  PIRESULTMSG := SUBSTR(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN);
                  PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
                ELSIF PIPKNUM = PIPKTOTAL-1 THEN
                  IF ((PILEN-(PIPKNUM-1)*PIMULTILEN1) > PIMULTILEN2) AND ((PILEN-(PIPKNUM-1)*PIMULTILEN1) <= PIMULTILEN1) THEN
                    PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1);
                    PITMPNUM := PILEN-1;
                  ELSE
                    PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
                    PITMPNUM := (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
                     ----第一条
                  END IF; --END IF OF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
                  PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
                ELSE
                  PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
                  PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
                END IF; --END IF OF IF PIPKNUM = PIPKTOTAL
                ICOUNT:=0;
                SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
                IF ICOUNT<1 THEN
                  INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                  RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                  UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                  VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                  PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                  PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
                END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
                PIPKNUM := PIPKNUM+1;
              END LOOP;-- END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
            END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
          END  IF;--END IF OF IF PIPKTOTAL = 1
        END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
        PIPTMSGID_P := PIPTMSGID_P+1;
      END  IF; --END IF OF IF PILOCATION > 0
    END LOOP; --END WHILE OF WHILE PILOCATION <> 0
      INSERT INTO GW_MT_TASK_BAK ("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
      RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
      UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
      SELECT A."UID",A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,NVL(A.MESSAGE,' '),A.SENDSTATUS,A.RETFLAG,
      A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,A.MSGFMT,A.UNICOM,
      A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA FROM TMP_MTTASK A;
      COMMIT;
   END IF; --END IF OF IF PIPKTOTAL >= 1
END IF; --END IF OF IF PIPHONECOUNT = 1 --单发
END;
/

-------------------增加版本信息-------------------------------------------
DECLARE
  VERSION INT;
BEGIN
  SELECT COUNT(*) INTO VERSION FROM VERSION_CMPP WHERE VERSION='4.06.06';
  IF VERSION < 1 THEN
    INSERT INTO VERSION_CMPP (VERSION,VERSIONDATE,UPGRADETIME)
    VALUES ('4.06.06',TO_CHAR(SYSDATE,'YYYY-MM-DD'),TO_CHAR(SYSDATE,'HH24:MI:SS'));
  END IF;
  COMMIT;
END;
/
/** 升级脚本(V4.06.05-V4.06.06) END */

/** 升级脚本(V4.06.06-V4.06.07) START */
DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='GW_MT_TASK_BAK' AND COLUMN_NAME='SUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE GW_MT_TASK_BAK ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='GW_MT_TASK_BAK' AND COLUMN_NAME='LUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE GW_MT_TASK_BAK ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL0_QUEUE' AND COLUMN_NAME='SUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL0_QUEUE ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL0_QUEUE' AND COLUMN_NAME='LUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL0_QUEUE ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL1_QUEUE' AND COLUMN_NAME='SUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL1_QUEUE ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL1_QUEUE' AND COLUMN_NAME='LUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL1_QUEUE ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL2_QUEUE' AND COLUMN_NAME='SUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL2_QUEUE ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL2_QUEUE' AND COLUMN_NAME='LUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL2_QUEUE ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL3_QUEUE' AND COLUMN_NAME='SUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL3_QUEUE ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL3_QUEUE' AND COLUMN_NAME='LUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL3_QUEUE ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL4_QUEUE' AND COLUMN_NAME='SUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL4_QUEUE ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL4_QUEUE' AND COLUMN_NAME='LUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL4_QUEUE ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL5_QUEUE' AND COLUMN_NAME='SUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL5_QUEUE ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL5_QUEUE' AND COLUMN_NAME='LUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL5_QUEUE ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL6_QUEUE' AND COLUMN_NAME='SUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL6_QUEUE ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL6_QUEUE' AND COLUMN_NAME='LUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL6_QUEUE ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL7_QUEUE' AND COLUMN_NAME='SUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL7_QUEUE ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL7_QUEUE' AND COLUMN_NAME='LUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL7_QUEUE ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL8_QUEUE' AND COLUMN_NAME='SUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL8_QUEUE ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL8_QUEUE' AND COLUMN_NAME='LUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL8_QUEUE ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL9_QUEUE' AND COLUMN_NAME='SUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL9_QUEUE ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

DECLARE I INT;
BEGIN
  SELECT COUNT(*) INTO I FROM USER_TAB_COLS WHERE TABLE_NAME='MT_LEVEL9_QUEUE' AND COLUMN_NAME='LUID1';
  IF I=0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_LEVEL9_QUEUE ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
  END IF;
END;
/

--（1）当月历史表添加字段不加默认值
DECLARE
  PITABLENAME VARCHAR2(20);
  PITABLE VARCHAR2(20);
  PISTR VARCHAR2(256);
  PICNT NUMBER(11);
  V_SQL VARCHAR2(256);
  CUR_TABLE SYS_REFCURSOR;
BEGIN
  PITABLENAME :='MTTASK'|| TO_CHAR(add_months(sysdate,-0),'YYYYMM');
  V_SQL:='SELECT TABLE_NAME FROM USER_TABLES T WHERE T.TABLE_NAME LIKE ''MTTASK%'' AND T.TABLE_NAME ='''||PITABLENAME||'''';
  OPEN CUR_TABLE FOR V_SQL ;
  LOOP
    FETCH CUR_TABLE INTO PITABLE;
    EXIT WHEN CUR_TABLE%NOTFOUND;

    SELECT COUNT (*) INTO PICNT FROM USER_TAB_COLUMNS WHERE TABLE_NAME = PITABLE AND COLUMN_NAME = 'SUID1';
    IF PICNT=0 THEN
      PISTR:='ALTER TABLE '||PITABLE||' ADD SUID1 VARCHAR2(64) ';
      EXECUTE IMMEDIATE PISTR;
    END IF;

    SELECT COUNT (*) INTO PICNT FROM USER_TAB_COLUMNS WHERE TABLE_NAME = PITABLE AND COLUMN_NAME = 'LUID1';
    IF PICNT=0 THEN
      PISTR:='ALTER TABLE '||PITABLE||' ADD LUID1 VARCHAR2(64) ';
      EXECUTE IMMEDIATE PISTR;
    END IF;

  END LOOP;
  CLOSE CUR_TABLE;
END;
/

--（2）当月以后的历史表添加字段，字段有默认值
DECLARE
  PITABLENAME VARCHAR2(20);
  PITABLE VARCHAR2(20);
  PISTR VARCHAR2(256);
  PICNT NUMBER(11);
  V_SQL VARCHAR2(256);
  CUR_TABLE SYS_REFCURSOR;
BEGIN
  PITABLENAME :='MTTASK'|| TO_CHAR(add_months(sysdate,-1),'YYYYMM');
  V_SQL:='SELECT TABLE_NAME FROM USER_TABLES T WHERE T.TABLE_NAME LIKE ''MTTASK%'' AND T.TABLE_NAME >'''||PITABLENAME||'''';
  OPEN CUR_TABLE FOR V_SQL ;
  LOOP
    FETCH CUR_TABLE INTO PITABLE;
    EXIT WHEN CUR_TABLE%NOTFOUND;

    SELECT COUNT (*) INTO PICNT FROM USER_TAB_COLUMNS WHERE TABLE_NAME = PITABLE AND COLUMN_NAME = 'SUID1';
    IF PICNT=0 THEN
      PISTR:='ALTER TABLE '||PITABLE||' ADD SUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
      EXECUTE IMMEDIATE PISTR;
    END IF;

    SELECT COUNT (*) INTO PICNT FROM USER_TAB_COLUMNS WHERE TABLE_NAME = PITABLE AND COLUMN_NAME = 'LUID1';
    IF PICNT=0 THEN
      PISTR:='ALTER TABLE '||PITABLE||' ADD LUID1 VARCHAR2(64) DEFAULT ('' '') NOT NULL';
      EXECUTE IMMEDIATE PISTR;
    END IF;

  END LOOP;
  CLOSE CUR_TABLE;
END;
/


CREATE OR REPLACE PROCEDURE GW_RD_MTLVLQUEV1
(
  PIDESTUID      IN NUMBER,
  PISENDLEVEL    IN NUMBER,
  PIMAXREADCNT   IN NUMBER,
  PISTRUID       IN VARCHAR2,
  SPCURTIME      IN NUMBER DEFAULT 0,
  PITABLENO      IN NUMBER,
  OUT_CURSOR     OUT SYS_REFCURSOR
)
AS
  PISQLSTR VARCHAR2(4000);
BEGIN
  PISQLSTR :=
        'SELECT /*+RULE*/ ID,"UID",DESTUID,LOGINUID,ECID,TASKID,FEEFLAG,USERID,SPGATE,CPNO,PHONE,PTMSGID,'
        ||'RETFLAG,TPUDHI,PKNUMBER,PKTOTAL,SENDSTATUS,PHONECOUNT,SPLITFLAG,SENDLEVEL,LONGMSGSEQ,MSGFMT,MESSAGE,'
        ||'TO_DATE(TO_CHAR(SENDTIME, ''YYYY-MM-DD HH24:MI:SS''),''YYYY-MM-DD HH24:MI:SS'') AS RECVMTTIME, '
        ||'SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1 '
        ||'FROM MT_LEVEL'||PITABLENO||'_QUEUE WHERE DESTUID='||PIDESTUID||' AND "UID" NOT IN('||PISTRUID||')
  AND SENDLEVEL='||PISENDLEVEL ||'AND (ATTIME<='||SPCURTIME||'OR ATTIME<0) AND ROWNUM<='||PIMAXREADCNT||'';
  --DBMS_OUTPUT.PUT_LINE(PISQLSTR);
  --EXECUTE IMMEDIATE PISQLSTR;
  --返回给上层数据
  OPEN OUT_CURSOR FOR PISQLSTR;
END;
/


CREATE OR REPLACE PROCEDURE GW_WR_MTLVLQUEV4
(
  PIUID        IN NUMBER,
  PIPTMSGID    IN NUMBER,
  PIRETFLAG    IN NUMBER,
  PIPKTOTAL    IN NUMBER,
  PIPHONECOUNT IN NUMBER,
  PISENDSTATUS IN NUMBER,
  PISPLITFLAG  IN NUMBER,
  PIECID       IN NUMBER,
  PIUSERID     IN VARCHAR2,
  PISPGATE     IN VARCHAR2,
  PICPNO       IN VARCHAR2,
  PIRECVMTTIME IN VARCHAR2,
  PIPHONE      IN VARCHAR2,
  PIMESSAGE    IN VARCHAR2,
  PIFEEFLAG    IN NUMBER,
  PIDESTUID    IN NUMBER,
  PILOGINUID   IN NUMBER,
  PIPKNUMBER   IN NUMBER,
  PISENDLEVEL  IN NUMBER,
  PITPUDHI     IN NUMBER,
  PITASKID     IN NUMBER,
  PILONGMSGSEQ IN NUMBER,
  PIMSGFMT     IN NUMBER,
  PITOTALCOUNT IN NUMBER,
  PISVRTYPE      IN VARCHAR2,
  PIP1           IN VARCHAR2,
  PIP2           IN VARCHAR2,
  PIP3           IN VARCHAR2,
  PIP4           IN VARCHAR2,
  PIUSERMSGID    IN NUMBER DEFAULT 0,
  PIMODULEID     IN NUMBER DEFAULT 0,
  PIATTIME       IN NUMBER DEFAULT 0,
  PIVALIDTIME    IN NUMBER DEFAULT 0,
  PISENDTYPE     IN NUMBER DEFAULT 1,
  PIBATCHID      IN NUMBER DEFAULT 0,
  PIAREACODE     IN NUMBER DEFAULT 0,
  PICUSTID       IN MT_LEVEL0_QUEUE.CUSTID%TYPE,
  PIEXDATA       IN MT_LEVEL0_QUEUE.EXDATA%TYPE,
  PILONGMSG 	  IN VARCHAR2,
  PITMPLID	   	  IN NUMBER,
  PICHGRADE	  IN NUMBER,
  PIMSGTYPE	  IN NUMBER,
  PIRMSVALIDTM   IN NUMBER,
  PIPROTOCOLVER  IN NUMBER,
  PITMPLTYPE	  IN NUMBER,
  PITITLE        IN VARCHAR2,
  PISHOWAY       IN VARCHAR2,
  PIDLDWAY       IN NUMBER,
  PIDLDNEY       IN NUMBER,
  PIISFREE       IN NUMBER,
  PISHOWTIME     IN NUMBER,
  PISUID1		  IN VARCHAR2,
  PILUID1		  IN VARCHAR2,
  PITABLENO   	  IN NUMBER
)
AS
  PIRECVMTTIME_P TIMESTAMP(6);
  ICOUNT PLS_INTEGER;
BEGIN
  IF PITABLENO = 0 THEN
    ICOUNT:=0;
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM MT_LEVEL0_QUEUE WHERE PTMSGID = PIPTMSGID;
    IF ICOUNT<1 THEN
      IF (PIRECVMTTIME IS NULL) THEN
        PIRECVMTTIME_P:=SYSTIMESTAMP;
      ELSE
        PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
      END IF;
      INSERT INTO /*+APPEND*/ MT_LEVEL0_QUEUE("UID", USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
                                              PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,TASKID,LONGMSGSEQ,
                                              MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT, PIPHONECOUNT,
             PIRECVMTTIME_P, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,PITPUDHI,PISENDLEVEL,PITASKID,
             PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
  ELSIF PITABLENO = 1 THEN
    ICOUNT:=0;
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM MT_LEVEL1_QUEUE WHERE PTMSGID = PIPTMSGID;
    IF ICOUNT<1 THEN
      IF (PIRECVMTTIME IS NULL) THEN
        PIRECVMTTIME_P:=SYSTIMESTAMP;
      ELSE
        PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
      END IF;
      INSERT INTO /*+APPEND*/ MT_LEVEL1_QUEUE("UID", USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
                                              PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,TASKID,LONGMSGSEQ,
                                              MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT, PIPHONECOUNT,
             PIRECVMTTIME_P, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,PITPUDHI,PISENDLEVEL,PITASKID,
             PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
  ELSIF PITABLENO = 2 THEN
    ICOUNT:=0;
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM MT_LEVEL2_QUEUE WHERE PTMSGID = PIPTMSGID;
    IF ICOUNT<1 THEN
      IF (PIRECVMTTIME IS NULL) THEN
        PIRECVMTTIME_P:=SYSTIMESTAMP;
      ELSE
        PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
      END IF;
      INSERT INTO /*+APPEND*/ MT_LEVEL2_QUEUE("UID", USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
                                              PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,TASKID,LONGMSGSEQ,
                                              MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT, PIPHONECOUNT,
             PIRECVMTTIME_P, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,PITPUDHI,PISENDLEVEL,PITASKID,
             PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
  ELSIF PITABLENO = 3 THEN
    ICOUNT:=0;
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM MT_LEVEL3_QUEUE WHERE PTMSGID = PIPTMSGID;
    IF ICOUNT<1 THEN
      IF (PIRECVMTTIME IS NULL) THEN
        PIRECVMTTIME_P:=SYSTIMESTAMP;
      ELSE
        PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
      END IF;
      INSERT INTO /*+APPEND*/ MT_LEVEL3_QUEUE("UID", USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
                                              PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,TASKID,LONGMSGSEQ,
                                              MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT, PIPHONECOUNT,
             PIRECVMTTIME_P, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,PITPUDHI,PISENDLEVEL,PITASKID,
             PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
  ELSIF PITABLENO = 4 THEN
    ICOUNT:=0;
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM MT_LEVEL4_QUEUE WHERE PTMSGID = PIPTMSGID;
    IF ICOUNT<1 THEN
      IF (PIRECVMTTIME IS NULL) THEN
        PIRECVMTTIME_P:=SYSTIMESTAMP;
      ELSE
        PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
      END IF;
      INSERT INTO /*+APPEND*/ MT_LEVEL4_QUEUE("UID", USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
                                              PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,TASKID,LONGMSGSEQ,
                                              MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT, PIPHONECOUNT,
             PIRECVMTTIME_P, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,PITPUDHI,PISENDLEVEL,PITASKID,
             PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
  ELSIF PITABLENO = 5 THEN
    ICOUNT:=0;
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM MT_LEVEL5_QUEUE WHERE PTMSGID = PIPTMSGID;
    IF ICOUNT<1 THEN
      IF (PIRECVMTTIME IS NULL) THEN
        PIRECVMTTIME_P:=SYSTIMESTAMP;
      ELSE
        PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
      END IF;
      INSERT INTO /*+APPEND*/ MT_LEVEL5_QUEUE("UID", USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
                                              PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,TASKID,LONGMSGSEQ,
                                              MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT, PIPHONECOUNT,
             PIRECVMTTIME_P, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,PITPUDHI,PISENDLEVEL,PITASKID,
             PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
  ELSIF PITABLENO = 6 THEN
    ICOUNT:=0;
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM MT_LEVEL6_QUEUE WHERE PTMSGID = PIPTMSGID;
    IF ICOUNT<1 THEN
      IF (PIRECVMTTIME IS NULL) THEN
        PIRECVMTTIME_P:=SYSTIMESTAMP;
      ELSE
        PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
      END IF;
      INSERT INTO /*+APPEND*/ MT_LEVEL6_QUEUE("UID", USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
                                              PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,TASKID,LONGMSGSEQ,
                                              MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT, PIPHONECOUNT,
             PIRECVMTTIME_P, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,PITPUDHI,PISENDLEVEL,PITASKID,
             PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
  ELSIF PITABLENO = 7 THEN
    ICOUNT:=0;
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM MT_LEVEL7_QUEUE WHERE PTMSGID = PIPTMSGID;
    IF ICOUNT<1 THEN
      IF (PIRECVMTTIME IS NULL) THEN
        PIRECVMTTIME_P:=SYSTIMESTAMP;
      ELSE
        PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
      END IF;
      INSERT INTO /*+APPEND*/ MT_LEVEL7_QUEUE("UID", USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
                                              PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,TASKID,LONGMSGSEQ,
                                              MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT, PIPHONECOUNT,
             PIRECVMTTIME_P, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,PITPUDHI,PISENDLEVEL,PITASKID,
             PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
  ELSIF PITABLENO = 8 THEN
    ICOUNT:=0;
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM MT_LEVEL8_QUEUE WHERE PTMSGID = PIPTMSGID;
    IF ICOUNT<1 THEN
      IF (PIRECVMTTIME IS NULL) THEN
        PIRECVMTTIME_P:=SYSTIMESTAMP;
      ELSE
        PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
      END IF;
      INSERT INTO /*+APPEND*/ MT_LEVEL8_QUEUE("UID", USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
                                              PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,TASKID,LONGMSGSEQ,
                                              MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT, PIPHONECOUNT,
             PIRECVMTTIME_P, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,PITPUDHI,PISENDLEVEL,PITASKID,
             PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
  ELSIF PITABLENO = 9 THEN
    ICOUNT:=0;
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM MT_LEVEL9_QUEUE WHERE PTMSGID = PIPTMSGID;
    IF ICOUNT<1 THEN
      IF (PIRECVMTTIME IS NULL) THEN
        PIRECVMTTIME_P:=SYSTIMESTAMP;
      ELSE
        PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
      END IF;
      INSERT INTO /*+APPEND*/ MT_LEVEL9_QUEUE("UID", USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
                                              PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,TASKID,LONGMSGSEQ,
                                              MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT, PIPHONECOUNT,
             PIRECVMTTIME_P, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,PITPUDHI,PISENDLEVEL,PITASKID,
             PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
  END IF;
END;
/

CREATE OR REPLACE PROCEDURE GW_WR_MTTASKV4
(
  PIUID          IN NUMBER,
  PIPTMSGID      IN NUMBER,
  PISENDSTATUS   IN NUMBER,
  PIRETFLAG      IN NUMBER,
  PIPKTOTAL      IN NUMBER,
  PIPHONECOUNT   IN NUMBER,
  PISPLITLEN_P   IN NUMBER,
  PIMULTILEN1_P  IN NUMBER,
  PIMULTILEN2_P  IN NUMBER,
  PISIGNLEN_P    IN NUMBER,
  PIECID         IN NUMBER,
  PIUSERID       IN VARCHAR2,
  PISPGATE       IN VARCHAR2,
  PICPNO         IN VARCHAR2,
  PIRECVMTTIME   IN VARCHAR2,
  PIMESSAGE      IN VARCHAR2,
  PISHOUJI       IN VARCHAR2,
  PIFEEFLAG      IN NUMBER,
  PISENDLEVEL    IN NUMBER,
  PITASKID       IN NUMBER,
  PIERCODE       IN VARCHAR2,
  PITPUDHI       IN NUMBER,
  PILONGMSGSEQ   IN NUMBER,
  PIMSGFMT       IN NUMBER,
  PIUNICOM       IN NUMBER,
  PIMOBILEAREA   IN NUMBER,
  PIPKNUMBER     IN NUMBER,
  PISVRTYPE      IN VARCHAR2,
  PIP1      IN VARCHAR2,
  PIP2      IN VARCHAR2,
  PIP3      IN VARCHAR2,
  PIP4      IN VARCHAR2,
  PIUSERMSGID    IN NUMBER DEFAULT 0,
  PIMODULEID     IN NUMBER DEFAULT 0,
  PIATTIME       IN NUMBER DEFAULT 0,
  PIVALIDTIME    IN NUMBER DEFAULT 0,
  PISENDTYPE     IN NUMBER DEFAULT 1,
  PIBATCHID      IN NUMBER DEFAULT 0,
  PIAREACODE     IN NUMBER DEFAULT 0,
  PICUSTID       IN VARCHAR2,
  PIEXDATA       IN VARCHAR2,
  PILONGMSG 	   IN VARCHAR2,
  PITMPLID	   IN NUMBER,
  PICHGRADE	   IN NUMBER,
  PIMSGTYPE	   IN NUMBER,
  PIRMSVALIDTM   IN NUMBER,
  PIRMSRPTFLAG   IN NUMBER,
  PIPROTOCOLVER  IN NUMBER,
  PITMPLTYPE	  IN NUMBER,
  PITITLE        IN VARCHAR2,
  PISHOWAY       IN VARCHAR2,
  PIDLDWAY       IN NUMBER,
  PIDLDNEY       IN NUMBER,
  PIISFREE       IN NUMBER,
  PISHOWTIME     IN NUMBER,
  PISUID1		   IN VARCHAR2,
  PILUID1		   IN VARCHAR2
)
AS
  --临时变量
  PITMPMSGID NUMBER(22,0);
  PILOCATION PLS_INTEGER;
  PISTART PLS_INTEGER;
  PIRESULTPHONE VARCHAR(21);
  PISTRSPLIT VARCHAR(2);
  PILEN PLS_INTEGER;
  PIRESULTMSG VARCHAR(720);
  PIPKNUM PLS_INTEGER;
  PITMPNUM PLS_INTEGER;
  ICOUNT PLS_INTEGER;
  PISHOUJI_P VARCHAR2(3500);
  PIRECVMTTIME_P TIMESTAMP(6);
  PIPTMSGID_P NUMBER(22,0);

  PISPLITLEN PLS_INTEGER;
  PIMULTILEN1 PLS_INTEGER;
  PIMULTILEN2 PLS_INTEGER;
  PISIGNLEN PLS_INTEGER;

BEGIN
  --变量赋值
  PILEN := LENGTH(PILONGMSG)-PISIGNLEN_P;
  PITMPNUM := 0;
  PIPKNUM := 1;
  PISTRSPLIT := ',';
  PISHOUJI_P :=PISHOUJI;
  PIPTMSGID_P:=PIPTMSGID;


  IF PIRECVMTTIME IS NULL THEN
    PIRECVMTTIME_P:=SYSTIMESTAMP;
  ELSE
    PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
  END IF;
  --清空临时表,如果临时表不存在直接返回不处理
  /*SELECT  COUNT(*) INTO ICOUNT FROM USER_TABLES T WHERE UPPER(T.TABLE_NAME)=UPPER('TMP_MTTASK');
  IF ICOUNT>0 THEN
      EXECUTE IMMEDIATE 'TRUNCATE TABLE TMP_MTTASK';
  ELSE
    RETURN;
  END IF;
  */
  --验证手机号合法性
  IF (PISHOUJI_P IS NULL) THEN
    PISHOUJI_P := ' ';
  END IF;
  IF /*(PISHOUJI_P IS NULL) OR */(PIPHONECOUNT < 1) THEN
    RETURN;
  END IF;

  --变量赋值
  IF PIMSGFMT=4 OR PIMSGFMT=248 OR PIMSGFMT=246 THEN
    PISPLITLEN:=140;
    PIMULTILEN1:=134;
    PIMULTILEN2:=134;
    PISIGNLEN:=0;
  ELSE
    PISPLITLEN  :=PISPLITLEN_P;
    PIMULTILEN1 :=PIMULTILEN1_P;
    PIMULTILEN2 :=PIMULTILEN2_P;
    PISIGNLEN   :=PISIGNLEN_P;
  END IF;
  IF PIMSGFMT=25 THEN
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;
    IF ICOUNT<1 THEN
      INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                 RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                 UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PIPTMSGID_P,NVL(PIMESSAGE,' '),PISENDSTATUS,
             PIRETFLAG,PIPKNUMBER,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
             PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
    RETURN;
  END IF;
  IF PIPHONECOUNT = 1 --单发
  THEN
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;
    --IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PIPTMSGID_P)
    IF ICOUNT<1 THEN
      IF PIPKTOTAL = 1 THEN
        INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
        VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PIPTMSGID_P,NVL(PIMESSAGE,' '),PISENDSTATUS,
               PIRETFLAG,PIPKTOTAL,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
               PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
      ELSE
        PIPKNUM := 1;
        PITMPMSGID := PIPTMSGID_P;
        IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1 THEN
          PIRESULTMSG := SUBSTR(PIMESSAGE,1,PISPLITLEN);
          PITMPMSGID := PITMPMSGID;
          ICOUNT:=0;
          SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PITMPMSGID;
          IF ICOUNT<1 THEN
            INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
            VALUES(PIUID, PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                   PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                   PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
          END IF;
          PIRESULTMSG := SUBSTR(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN);
          PITMPMSGID := PITMPMSGID+17179869184;
          PIPKNUM := PIPKNUM+1;
          ICOUNT:=0;
          SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
          IF ICOUNT<1 THEN
            INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
            VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                   PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                   PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
          END IF;
        ELSE
          WHILE PIPKNUM <= PIPKTOTAL LOOP
            IF PIPKNUM = PIPKTOTAL THEN
              PIRESULTMSG := SUBSTR(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN);
              PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
            ELSIF PIPKNUM = PIPKTOTAL-1 THEN
              IF ((PILEN-(PIPKNUM-1)*PIMULTILEN1) > PIMULTILEN2) AND ((PILEN-(PIPKNUM-1)*PIMULTILEN1) <= PIMULTILEN1) THEN
                PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1);
                PITMPNUM := PILEN-1;
                --DBMS_OUTPUT.PUT_LINE('123');
              ELSE
                PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
                DBMS_OUTPUT.PUT_LINE(PIRESULTMSG);
                PITMPNUM := (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
                --DBMS_OUTPUT.PUT_LINE('456');
              END IF;
              PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
            ELSE
              PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
              PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              --DBMS_OUTPUT.PUT_LINE(PIRESULTMSG);
            END IF;
            ICOUNT:=0;
            SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
            IF ICOUNT<1 THEN
              INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                     RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                     UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
              VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                     PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                     PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
            END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
            --EXECUTE IMMEDIATE STR;
            PIPKNUM := PIPKNUM+1;
          END LOOP;--END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
        END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1;
        INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
        SELECT A."UID",A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,NVL(A.MESSAGE,' '),A.SENDSTATUS,A.RETFLAG,
               A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
               A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1 FROM TMP_MTTASK A;
        COMMIT;
      END IF;--END IF OF IF PIPKTOTAL = 1
    --ELSE  --MSGID存在是写入MSGIDTEST表
    --  INSERT INTO MSGIDTEST(MSGID) VALUES(PIPTMSGID);
    END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID_P)
  ELSE --群发
    PISHOUJI_P := PISTRSPLIT||PISHOUJI_P||PISTRSPLIT;
    PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT);
    IF PIPKTOTAL < 1 THEN--没有短信内容
      RETURN;
    END IF;

    IF PIPKTOTAL >= 1 --需要拆分长短信
    THEN
      WHILE PILOCATION <> 0 LOOP--拆分手机号码
      PISTART := PILOCATION;
      PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT,PISTART+1);
      IF PILOCATION > 0 THEN
        PIRESULTPHONE := SUBSTR(PISHOUJI_P,PISTART+1,PILOCATION-PISTART-1);--拆分后的字符
        IF (PIRESULTPHONE IS NULL) THEN
          PIRESULTPHONE := ' ';
        END IF;
        PITMPMSGID := PIPTMSGID_P;
        ICOUNT:=0;
        SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
        IF ICOUNT<1 THEN
          IF PIPKTOTAL = 1 THEN
            INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
            VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIMESSAGE,PISENDSTATUS,
                   PIRETFLAG, PIPKTOTAL,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                   PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
          ELSE
            PIPKNUM := 1;
            IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1 THEN
              PIRESULTMSG := SUBSTR(PIMESSAGE,1, PISPLITLEN);--拆分后的字符
              PITMPMSGID := PITMPMSGID;
              ICOUNT:=0;
              SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
              IF ICOUNT<1 THEN
                INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                       RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                       UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                VALUES(PIUID,PIUSERID, PISPGATE,PICPNO,PIRESULTPHONE, PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                       PIRETFLAG, PIPKNUM, PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                       PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
              END IF;
              PIRESULTMSG := SUBSTR(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN);
              PITMPMSGID := PITMPMSGID+17179869184;
              PIPKNUM := PIPKNUM+1;
              ICOUNT:=0;
              SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
              IF ICOUNT<1 THEN
                INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                       RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                       UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                       PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                       PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
              END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
            ELSE
              WHILE PIPKNUM <= PIPKTOTAL LOOP--PIPKNUM:1    PIPKTOTAL 2
              IF PIPKNUM = PIPKTOTAL THEN
                PIRESULTMSG := SUBSTR(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN);
                PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              ELSIF PIPKNUM = PIPKTOTAL-1 THEN
                IF ((PILEN-(PIPKNUM-1)*PIMULTILEN1) > PIMULTILEN2) AND ((PILEN-(PIPKNUM-1)*PIMULTILEN1) <= PIMULTILEN1) THEN
                  PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1);
                  PITMPNUM := PILEN-1;
                ELSE
                  PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
                  PITMPNUM := (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
                  ----第一条
                END IF; --END IF OF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
                PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              ELSE
                PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
                PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              END IF; --END IF OF IF PIPKNUM = PIPKTOTAL
              ICOUNT:=0;
              SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
              IF ICOUNT<1 THEN
                INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                       RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                       UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                       PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                       PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
              END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
              PIPKNUM := PIPKNUM+1;
              END LOOP;-- END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
            END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
          END  IF;--END IF OF IF PIPKTOTAL = 1
        END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
        PIPTMSGID_P := PIPTMSGID_P+1;
      END  IF; --END IF OF IF PILOCATION > 0
      END LOOP; --END WHILE OF WHILE PILOCATION <> 0
      INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                 RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                 UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      SELECT A."UID",A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,NVL(A.MESSAGE,' '),A.SENDSTATUS,A.RETFLAG,
             A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,A.MSGFMT,A.UNICOM,
             A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1 FROM TMP_MTTASK A;
      COMMIT;
    END IF; --END IF OF IF PIPKTOTAL >= 1
  END IF; --END IF OF IF PIPHONECOUNT = 1 --单发
END;

/

CREATE OR REPLACE PROCEDURE GW_WR_MTTASKV5
(
  PIUID          IN NUMBER,
  PIPTMSGID      IN NUMBER,
  PISENDSTATUS   IN NUMBER,
  PIRETFLAG      IN NUMBER,
  PIPKTOTAL      IN NUMBER,
  PIPHONECOUNT   IN NUMBER,
  PISPLITLEN_P   IN NUMBER,
  PIMULTILEN1_P  IN NUMBER,
  PIMULTILEN2_P  IN NUMBER,
  PISIGNLEN_P    IN NUMBER,
  PIECID         IN NUMBER,
  PIUSERID       IN VARCHAR2,
  PISPGATE       IN VARCHAR2,
  PICPNO         IN VARCHAR2,
  PIRECVMTTIME   IN VARCHAR2,
  PIMESSAGE      IN VARCHAR2,
  PISHOUJI       IN VARCHAR2,
  PIFEEFLAG      IN NUMBER,
  PISENDLEVEL    IN NUMBER,
  PITASKID       IN NUMBER,
  PIERCODE       IN VARCHAR2,
  PITPUDHI       IN NUMBER,
  PILONGMSGSEQ   IN NUMBER,
  PIMSGFMT       IN NUMBER,
  PIUNICOM       IN NUMBER,
  PIMOBILEAREA   IN NUMBER,
  PIPKNUMBER     IN NUMBER,
  PISVRTYPE      IN VARCHAR2,
  PIP1      IN VARCHAR2,
  PIP2      IN VARCHAR2,
  PIP3      IN VARCHAR2,
  PIP4      IN VARCHAR2,
  PIUSERMSGID    IN NUMBER DEFAULT 0,
  PIMODULEID     IN NUMBER DEFAULT 0,
  PIATTIME       IN NUMBER DEFAULT 0,
  PIVALIDTIME    IN NUMBER DEFAULT 0,
  PISENDTYPE     IN NUMBER DEFAULT 1,
  PIBATCHID      IN NUMBER DEFAULT 0,
  PIAREACODE     IN NUMBER DEFAULT 0,
  PICUSTID       IN VARCHAR2,
  PIEXDATA       IN VARCHAR2,
  PISUID1       IN VARCHAR2,
  PILUID1       IN VARCHAR2
)
AS
  --临时变量
  PITMPMSGID NUMBER(22,0);
  PILOCATION PLS_INTEGER;
  PISTART PLS_INTEGER;
  PIRESULTPHONE VARCHAR(21);
  PISTRSPLIT VARCHAR(2);
  PILEN PLS_INTEGER;
  PIRESULTMSG VARCHAR(720);
  PIPKNUM PLS_INTEGER;
  PITMPNUM PLS_INTEGER;
  ICOUNT PLS_INTEGER;
  PISHOUJI_P VARCHAR2(3500);
  PIRECVMTTIME_P TIMESTAMP(6);
  PIPTMSGID_P NUMBER(22,0);

  PISPLITLEN PLS_INTEGER;
  PIMULTILEN1 PLS_INTEGER;
  PIMULTILEN2 PLS_INTEGER;
  PISIGNLEN PLS_INTEGER;

BEGIN
  --变量赋值
  PILEN := LENGTH(PIMESSAGE)-PISIGNLEN_P;
  PITMPNUM := 0;
  PIPKNUM := 1;
  PISTRSPLIT := ',';
  PISHOUJI_P :=PISHOUJI;
  PIPTMSGID_P:=PIPTMSGID;


  IF PIRECVMTTIME IS NULL THEN
    PIRECVMTTIME_P:=SYSTIMESTAMP;
  ELSE
    PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
  END IF;
  --清空临时表,如果临时表不存在直接返回不处理
  /*SELECT  COUNT(*) INTO ICOUNT FROM USER_TABLES T WHERE UPPER(T.TABLE_NAME)=UPPER('TMP_MTTASK');
  IF ICOUNT>0 THEN
      EXECUTE IMMEDIATE 'TRUNCATE TABLE TMP_MTTASK';
  ELSE
    RETURN;
  END IF;
  */
  --验证手机号合法性
  IF (PISHOUJI_P IS NULL) THEN
    PISHOUJI_P := ' ';
  END IF;
  IF /*(PISHOUJI_P IS NULL) OR */(PIPHONECOUNT < 1) THEN
    RETURN;
  END IF;

  --变量赋值
  IF PIMSGFMT=4 OR PIMSGFMT=248 OR PIMSGFMT=246 THEN
    PISPLITLEN:=140;
    PIMULTILEN1:=134;
    PIMULTILEN2:=134;
    PISIGNLEN:=0;
  ELSE
    PISPLITLEN  :=PISPLITLEN_P;
    PIMULTILEN1 :=PIMULTILEN1_P;
    PIMULTILEN2 :=PIMULTILEN2_P;
    PISIGNLEN   :=PISIGNLEN_P;
  END IF;
  IF PIMSGFMT=25 THEN
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;
    IF ICOUNT<1 THEN
      INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                 RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                 UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
      VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PIPTMSGID_P,NVL(PIMESSAGE,' '),PISENDSTATUS,
             PIRETFLAG,PIPKNUMBER,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
             PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
    END IF;
    RETURN;
  END IF;
  IF PIPHONECOUNT = 1 --单发
  THEN
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;
    --IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PIPTMSGID_P)
    IF ICOUNT<1 THEN
      IF PIPKTOTAL = 1 THEN
        INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
        VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PIPTMSGID_P,NVL(PIMESSAGE,' '),PISENDSTATUS,
               PIRETFLAG,PIPKTOTAL,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
               PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
      ELSE
        PIPKNUM := 1;
        PITMPMSGID := PIPTMSGID_P;
        IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1 THEN
          PIRESULTMSG := SUBSTR(PIMESSAGE,1,PISPLITLEN);
          PITMPMSGID := PITMPMSGID;
          ICOUNT:=0;
          SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PITMPMSGID;
          IF ICOUNT<1 THEN
            INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
            VALUES(PIUID, PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                   PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                   PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
          END IF;
          PIRESULTMSG := SUBSTR(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN);
          PITMPMSGID := PITMPMSGID+17179869184;
          PIPKNUM := PIPKNUM+1;
          ICOUNT:=0;
          SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
          IF ICOUNT<1 THEN
            INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
            VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                   PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                   PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
          END IF;
        ELSE
          WHILE PIPKNUM <= PIPKTOTAL LOOP
            IF PIPKNUM = PIPKTOTAL THEN
              PIRESULTMSG := SUBSTR(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN);
              PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
            ELSIF PIPKNUM = PIPKTOTAL-1 THEN
              IF ((PILEN-(PIPKNUM-1)*PIMULTILEN1) > PIMULTILEN2) AND ((PILEN-(PIPKNUM-1)*PIMULTILEN1) <= PIMULTILEN1) THEN
                PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1);
                PITMPNUM := PILEN-1;
                --DBMS_OUTPUT.PUT_LINE('123');
              ELSE
                PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
                DBMS_OUTPUT.PUT_LINE(PIRESULTMSG);
                PITMPNUM := (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
                --DBMS_OUTPUT.PUT_LINE('456');
              END IF;
              PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
            ELSE
              PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
              PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              --DBMS_OUTPUT.PUT_LINE(PIRESULTMSG);
            END IF;
            ICOUNT:=0;
            SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
            IF ICOUNT<1 THEN
              INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                     RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                     UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
              VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                     PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                     PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
            END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
            --EXECUTE IMMEDIATE STR;
            PIPKNUM := PIPKNUM+1;
          END LOOP;--END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
        END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1;
        INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
        SELECT A."UID",A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,NVL(A.MESSAGE,' '),A.SENDSTATUS,A.RETFLAG,
               A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
               A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1 FROM TMP_MTTASK A;
        COMMIT;
      END IF;--END IF OF IF PIPKTOTAL = 1
    --ELSE  --MSGID存在是写入MSGIDTEST表
    --  INSERT INTO MSGIDTEST(MSGID) VALUES(PIPTMSGID);
    END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID_P)
  ELSE --群发
    PISHOUJI_P := PISTRSPLIT||PISHOUJI_P||PISTRSPLIT;
    PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT);
    IF PIPKTOTAL < 1 THEN--没有短信内容
      RETURN;
    END IF;

    IF PIPKTOTAL >= 1 --需要拆分长短信
    THEN
      WHILE PILOCATION <> 0 LOOP--拆分手机号码
      PISTART := PILOCATION;
      PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT,PISTART+1);
      IF PILOCATION > 0 THEN
        PIRESULTPHONE := SUBSTR(PISHOUJI_P,PISTART+1,PILOCATION-PISTART-1);--拆分后的字符
        IF (PIRESULTPHONE IS NULL) THEN
          PIRESULTPHONE := ' ';
        END IF;
        PITMPMSGID := PIPTMSGID_P;
        ICOUNT:=0;
        SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
        IF ICOUNT<1 THEN
          IF PIPKTOTAL = 1 THEN
            INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
            VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIMESSAGE,PISENDSTATUS,
                   PIRETFLAG, PIPKTOTAL,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                   PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
          ELSE
            PIPKNUM := 1;
            IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1 THEN
              PIRESULTMSG := SUBSTR(PIMESSAGE,1, PISPLITLEN);--拆分后的字符
              PITMPMSGID := PITMPMSGID;
              ICOUNT:=0;
              SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
              IF ICOUNT<1 THEN
                INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                       RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                       UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                VALUES(PIUID,PIUSERID, PISPGATE,PICPNO,PIRESULTPHONE, PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                       PIRETFLAG, PIPKNUM, PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                       PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
              END IF;
              PIRESULTMSG := SUBSTR(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN);
              PITMPMSGID := PITMPMSGID+17179869184;
              PIPKNUM := PIPKNUM+1;
              ICOUNT:=0;
              SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
              IF ICOUNT<1 THEN
                INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                       RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                       UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                       PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                       PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
              END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
            ELSE
              WHILE PIPKNUM <= PIPKTOTAL LOOP--PIPKNUM:1    PIPKTOTAL 2
              IF PIPKNUM = PIPKTOTAL THEN
                PIRESULTMSG := SUBSTR(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN);
                PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              ELSIF PIPKNUM = PIPKTOTAL-1 THEN
                IF ((PILEN-(PIPKNUM-1)*PIMULTILEN1) > PIMULTILEN2) AND ((PILEN-(PIPKNUM-1)*PIMULTILEN1) <= PIMULTILEN1) THEN
                  PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1);
                  PITMPNUM := PILEN-1;
                ELSE
                  PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
                  PITMPNUM := (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
                  ----第一条
                END IF; --END IF OF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
                PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              ELSE
                PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
                PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              END IF; --END IF OF IF PIPKNUM = PIPKTOTAL
              ICOUNT:=0;
              SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
              IF ICOUNT<1 THEN
                INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                       RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                       UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                       PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                       PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
              END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
              PIPKNUM := PIPKNUM+1;
              END LOOP;-- END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
            END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
          END  IF;--END IF OF IF PIPKTOTAL = 1
        END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
        PIPTMSGID_P := PIPTMSGID_P+1;
      END  IF; --END IF OF IF PILOCATION > 0
      END LOOP; --END WHILE OF WHILE PILOCATION <> 0
      INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                 RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                 UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
      SELECT A."UID",A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,NVL(A.MESSAGE,' '),A.SENDSTATUS,A.RETFLAG,
             A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,A.MSGFMT,A.UNICOM,
             A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1 FROM TMP_MTTASK A;
      COMMIT;
    END IF; --END IF OF IF PIPKTOTAL >= 1
  END IF; --END IF OF IF PIPHONECOUNT = 1 --单发
END;

/

CREATE OR REPLACE PROCEDURE GW_WR_MTTASKSRV4
(
  PIUID          IN NUMBER,
  PIPTMSGID      IN NUMBER,
  PISENDSTATUS   IN NUMBER,
  PIRETFLAG      IN NUMBER,
  PIPKTOTAL      IN NUMBER,
  PIPHONECOUNT   IN NUMBER,
  PIECID         IN NUMBER,
  PIUSERID       IN VARCHAR2,
  PISPGATE       IN VARCHAR2,
  PICPNO         IN VARCHAR2,
  PIRECVMTTIME   IN VARCHAR2,
  PIMESSAGE      IN VARCHAR2,
  PISHOUJI       IN VARCHAR2,
  PIFEEFLAG      IN NUMBER,
  PIPKNUMBER     IN NUMBER,
  PISENDLEVEL    IN NUMBER,
  PITASKID       IN NUMBER,
  PIERCODE       IN VARCHAR2,
  PITPUDHI       IN NUMBER,
  PILONGMSGSEQ   IN NUMBER,
  PIMSGFMT       IN NUMBER,
  PIUNICOM       IN NUMBER,
  PIMOBILEAREA   IN NUMBER,
  PISVRTYPE      IN VARCHAR2,
  PIP1           IN VARCHAR2,
  PIP2           IN VARCHAR2,
  PIP3           IN VARCHAR2,
  PIP4           IN VARCHAR2,
  PIUSERMSGID    IN NUMBER DEFAULT 0,
  PIMODULEID     IN NUMBER DEFAULT 0,
  PIATTIME       IN NUMBER DEFAULT 0,
  PIVALIDTIME    IN NUMBER DEFAULT 0,
  PISENDTYPE     IN NUMBER DEFAULT 1,
  PIBATCHID      IN NUMBER DEFAULT 0,
  PIAREACODE     IN NUMBER DEFAULT 0,
  PICUSTID       IN VARCHAR2,
  PIEXDATA       IN VARCHAR2,
  PILONGMSG 	   IN VARCHAR2,
  PITMPLID	   IN NUMBER,
  PICHGRADE	   IN NUMBER,
  PIMSGTYPE	   IN NUMBER,
  PIRMSVALIDTM   IN NUMBER,
  PIRMSRPTFLAG   IN NUMBER,
  PIPROTOCOLVER  IN NUMBER,
  PITMPLTYPE	  IN NUMBER,
  PITITLE        IN VARCHAR2,
  PISHOWAY       IN VARCHAR2,
  PIDLDWAY       IN NUMBER,
  PIDLDNEY       IN NUMBER,
  PIISFREE       IN NUMBER,
  PISHOWTIME     IN NUMBER,
  PISUID1        IN VARCHAR2,
  PILUID1        IN VARCHAR2
)
AS
  PILOCATION PLS_INTEGER;
  PISTART PLS_INTEGER;
  PIRESULTPHONE VARCHAR2(21);
  PISTRSPLIT VARCHAR2(2);
  PIRECVMTTIME_P TIMESTAMP(6);
  ICOUNT PLS_INTEGER;
  PISHOUJI_P VARCHAR2(3500);
  PIPTMSGID_P NUMBER(22,0);

BEGIN

  PISTRSPLIT := ',';
  PISHOUJI_P := PISHOUJI;
  PIPTMSGID_P:=PIPTMSGID;

  IF PIRECVMTTIME IS NULL THEN
    PIRECVMTTIME_P:=SYSTIMESTAMP;
  ELSE
    PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
  END IF;
  /*
  SELECT  COUNT(*) INTO ICOUNT FROM USER_TABLES T WHERE UPPER(T.TABLE_NAME)=UPPER('TMP_MTTASKSR');
  IF ICOUNT>0 THEN
    EXECUTE IMMEDIATE 'TRUNCATE TABLE TMP_MTTASKSR';
  ELSE
    RETURN;
  END IF;
  */
  IF (PISHOUJI_P IS NULL) THEN
    PISHOUJI_P := ' ';
  END IF;
  IF (PIPHONECOUNT < 1) THEN--手机号码为空
    RETURN;
  END IF;

  IF PIPHONECOUNT = 1 THEN--单发
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;
    IF ICOUNT<1 THEN
      INSERT INTO GW_MT_TASK_BAK("UID",USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE,SENDSTATUS,
                                 RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
                                 MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
      VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI_P, PIPTMSGID_P, PIMESSAGE,PISENDSTATUS,
             PIRETFLAG, PIPKNUMBER, PIPKTOTAL, PIRECVMTTIME_P, PIECID, PIFEEFLAG, PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
             PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,
             PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1);
    END IF;
  ELSE --群发
    PISHOUJI_P := PISTRSPLIT||PISHOUJI_P||PISTRSPLIT;
    PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT);
    WHILE PILOCATION <> 0 LOOP--拆分手机号码
    PISTART := PILOCATION;
    PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT,PISTART+1);
    IF PILOCATION > 0 THEN
      PIRESULTPHONE := SUBSTR(PISHOUJI_P,PISTART+1,PILOCATION-PISTART-1);
      IF (PIRESULTPHONE IS NULL) THEN
        PIRESULTPHONE := ' ';
      END IF;
      ICOUNT:=0;
      SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;

      IF ICOUNT<1 THEN
        INSERT INTO TMP_MTTASKSR("UID",USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE,SENDSTATUS,
                                 RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME,ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
                                 MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
        VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PIPTMSGID_P,PIMESSAGE,PISENDSTATUS,PIRETFLAG,
               PIPKNUMBER,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,
               PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
      END IF;
      PIPTMSGID_P := PIPTMSGID_P+1;
    END IF;
    END LOOP;
    INSERT INTO GW_MT_TASK_BAK("UID",USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE,SENDSTATUS, RETFLAG,
                               PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                               UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,SUID1,LUID1)
    SELECT A."UID",A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,
           A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,A.MSGFMT,A.UNICOM,
           A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME,PISUID1,PILUID1 FROM TMP_MTTASKSR A;
    COMMIT;
  END IF;
  EXECUTE IMMEDIATE 'TRUNCATE TABLE TMP_MTTASKSR';
END;
/

CREATE OR REPLACE PROCEDURE GW_WR_MTTASKSRV5
(
  PIUID          IN NUMBER,
  PIPTMSGID      IN NUMBER,
  PISENDSTATUS   IN NUMBER,
  PIRETFLAG      IN NUMBER,
  PIPKTOTAL      IN NUMBER,
  PIPHONECOUNT   IN NUMBER,
  PIECID         IN NUMBER,
  PIUSERID       IN VARCHAR2,
  PISPGATE       IN VARCHAR2,
  PICPNO         IN VARCHAR2,
  PIRECVMTTIME   IN VARCHAR2,
  PIMESSAGE      IN VARCHAR2,
  PISHOUJI       IN VARCHAR2,
  PIFEEFLAG      IN NUMBER,
  PIPKNUMBER     IN NUMBER,
  PISENDLEVEL    IN NUMBER,
  PITASKID       IN NUMBER,
  PIERCODE       IN VARCHAR2,
  PITPUDHI       IN NUMBER,
  PILONGMSGSEQ   IN NUMBER,
  PIMSGFMT       IN NUMBER,
  PIUNICOM       IN NUMBER,
  PIMOBILEAREA   IN NUMBER,
  PISVRTYPE      IN VARCHAR2,
  PIP1           IN VARCHAR2,
  PIP2           IN VARCHAR2,
  PIP3           IN VARCHAR2,
  PIP4           IN VARCHAR2,
  PIUSERMSGID    IN NUMBER DEFAULT 0,
  PIMODULEID     IN NUMBER DEFAULT 0,
  PIATTIME       IN NUMBER DEFAULT 0,
  PIVALIDTIME    IN NUMBER DEFAULT 0,
  PISENDTYPE     IN NUMBER DEFAULT 1,
  PIBATCHID      IN NUMBER DEFAULT 0,
  PIAREACODE     IN NUMBER DEFAULT 0,
  PICUSTID       IN VARCHAR2,
  PIEXDATA       IN VARCHAR2,
  PISUID1        IN VARCHAR2,
  PILUID1        IN VARCHAR2
)
AS
  PILOCATION PLS_INTEGER;
  PISTART PLS_INTEGER;
  PIRESULTPHONE VARCHAR2(21);
  PISTRSPLIT VARCHAR2(2);
  PIRECVMTTIME_P TIMESTAMP(6);
  ICOUNT PLS_INTEGER;
  PISHOUJI_P VARCHAR2(3500);
  PIPTMSGID_P NUMBER(22,0);

BEGIN

  PISTRSPLIT := ',';
  PISHOUJI_P := PISHOUJI;
  PIPTMSGID_P:=PIPTMSGID;

  IF PIRECVMTTIME IS NULL THEN
    PIRECVMTTIME_P:=SYSTIMESTAMP;
  ELSE
    PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
  END IF;
  /*
  SELECT  COUNT(*) INTO ICOUNT FROM USER_TABLES T WHERE UPPER(T.TABLE_NAME)=UPPER('TMP_MTTASKSR');
  IF ICOUNT>0 THEN
    EXECUTE IMMEDIATE 'TRUNCATE TABLE TMP_MTTASKSR';
  ELSE
    RETURN;
  END IF;
  */
  IF (PISHOUJI_P IS NULL) THEN
    PISHOUJI_P := ' ';
  END IF;
  IF (PIPHONECOUNT < 1) THEN--手机号码为空
    RETURN;
  END IF;

  IF PIPHONECOUNT = 1 THEN--单发
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;
    IF ICOUNT<1 THEN
      INSERT INTO GW_MT_TASK_BAK("UID",USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE,SENDSTATUS,
                                 RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
                                 MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
      VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI_P, PIPTMSGID_P, PIMESSAGE,PISENDSTATUS,
             PIRETFLAG, PIPKNUMBER, PIPKTOTAL, PIRECVMTTIME_P, PIECID, PIFEEFLAG, PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
             PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,
             PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
    END IF;
  ELSE --群发
    PISHOUJI_P := PISTRSPLIT||PISHOUJI_P||PISTRSPLIT;
    PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT);
    WHILE PILOCATION <> 0 LOOP--拆分手机号码
    PISTART := PILOCATION;
    PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT,PISTART+1);
    IF PILOCATION > 0 THEN
      PIRESULTPHONE := SUBSTR(PISHOUJI_P,PISTART+1,PILOCATION-PISTART-1);
      IF (PIRESULTPHONE IS NULL) THEN
        PIRESULTPHONE := ' ';
      END IF;
      ICOUNT:=0;
      SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;

      IF ICOUNT<1 THEN
        INSERT INTO TMP_MTTASKSR("UID",USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE,SENDSTATUS,
                                 RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME,ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
                                 MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
        VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PIPTMSGID_P,PIMESSAGE,PISENDSTATUS,PIRETFLAG,
               PIPKNUMBER,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,
               PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
      END IF;
      PIPTMSGID_P := PIPTMSGID_P+1;
    END IF;
    END LOOP;
    INSERT INTO GW_MT_TASK_BAK("UID",USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE,SENDSTATUS, RETFLAG,
                               PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                               UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
    SELECT A."UID",A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,
           A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,A.MSGFMT,A.UNICOM,
           A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1 FROM TMP_MTTASKSR A;
    COMMIT;
  END IF;
  EXECUTE IMMEDIATE 'TRUNCATE TABLE TMP_MTTASKSR';
END;
/

CREATE OR REPLACE PROCEDURE GW_WR_MTTASKBAKV2
(
  PIUID         IN GW_MT_TASK_BAK."UID"%TYPE,
  PIPTMSGID     IN GW_MT_TASK_BAK.PTMSGID%TYPE,
  PIECID        IN GW_MT_TASK_BAK.ECID%TYPE,
  PISENDSTATUS  IN GW_MT_TASK_BAK.SENDSTATUS%TYPE,
  PIRETFLAG     IN GW_MT_TASK_BAK.RETFLAG%TYPE,
  PIPKNUMBER    IN GW_MT_TASK_BAK.PKNUMBER%TYPE,
  PIPKTOTAL     IN GW_MT_TASK_BAK.PKTOTAL%TYPE,
  PIFEEFLAG     IN GW_MT_TASK_BAK.FEEFLAG%TYPE,
  PISENDLEVEL   IN GW_MT_TASK_BAK.SENDLEVEL%TYPE,
  PIRECVMTTIME  IN GW_MT_TASK_BAK.RECVMTTIME%TYPE,
  PIUSERID      IN GW_MT_TASK_BAK.USERID%TYPE,
  PISPGATE      IN GW_MT_TASK_BAK.SPGATE%TYPE,
  PICPNO        IN GW_MT_TASK_BAK.CPNO%TYPE,
  PIPHONE       IN GW_MT_TASK_BAK.PHONE%TYPE,
  PIMESSAGE     IN GW_MT_TASK_BAK.MESSAGE%TYPE,
  PITASKID      IN GW_MT_TASK_BAK.TASKID%TYPE,
  PIERRORCODE   IN GW_MT_TASK_BAK.ERRORCODE%TYPE,
  PITPUDHI      IN GW_MT_TASK_BAK.TPUDHI%TYPE,
  PILONGMSGSEQ  IN GW_MT_TASK_BAK.LONGMSGSEQ%TYPE,
  PIMSGFMT      IN GW_MT_TASK_BAK.MSGFMT%TYPE,
  PIUNICOM      IN GW_MT_TASK_BAK.UNICOM%TYPE,
  PIMOBILEAREA  IN GW_MT_TASK_BAK.MOBILEAREA%TYPE,
  PISVRTYPE     IN GW_MT_TASK_BAK.SVRTYPE%TYPE,
  PIP1          IN GW_MT_TASK_BAK.P1%TYPE,
  PIP2          IN GW_MT_TASK_BAK.P2%TYPE,
  PIP3          IN GW_MT_TASK_BAK.P3%TYPE,
  PIP4          IN GW_MT_TASK_BAK.P4%TYPE,
  PIUSERMSGID   IN GW_MT_TASK_BAK.USERMSGID%TYPE,
  PIMODULEID    IN GW_MT_TASK_BAK.MODULEID%TYPE,
  PIATTIME      IN GW_MT_TASK_BAK.ATTIME%TYPE,
  PIVALIDTIME   IN GW_MT_TASK_BAK.VALIDTIME%TYPE,
  PISENDTYPE    IN GW_MT_TASK_BAK.SENDTYPE%TYPE,
  PIBATCHID     IN GW_MT_TASK_BAK.BATCHID%TYPE,
  PIAREACODE    IN GW_MT_TASK_BAK.AREACODE%TYPE,
  PICUSTID     IN GW_MT_TASK_BAK.CUSTID%TYPE,
  PIEXDATA    IN GW_MT_TASK_BAK.EXDATA%TYPE,
  PISUID1    IN GW_MT_TASK_BAK.SUID1%TYPE,
  PILUID1    IN GW_MT_TASK_BAK.LUID1%TYPE
)
AS
  PICNT NUMBER;
BEGIN
  SELECT COUNT(ID) INTO PICNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID;
  IF PICNT=0 THEN
    INSERT INTO GW_MT_TASK_BAK("UID",PTMSGID,ECID,SENDSTATUS,RETFLAG,PKNUMBER,PKTOTAL,FEEFLAG,SENDLEVEL,
                               RECVMTTIME,USERID,SPGATE,CPNO,PHONE,MESSAGE,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,
                               MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,SUID1,LUID1)
    VALUES(PIUID,PIPTMSGID,PIECID,PISENDSTATUS,PIRETFLAG,PIPKNUMBER,PIPKTOTAL,PIFEEFLAG,PISENDLEVEL,PIRECVMTTIME,
           PIUSERID,PISPGATE,PICPNO,PIPHONE,PIMESSAGE,PITASKID,PIERRORCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,
           PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PISUID1,PILUID1);
  END IF;
END;
/
CREATE OR REPLACE PROCEDURE GW_DELWAIT
AS
  --批量转移临时变量
  PI_CURINDEX           NUMBER;
  PI_MININDEX           NUMBER;
  PI_MAXINDEX           NUMBER;
  EACHMAX               NUMBER; --每次处理最大数
  PIERROR VARCHAR2(4000);
BEGIN
  EACHMAX:= 500000;

  --删除文件发送请求历史表数据
  SELECT MIN(ID),MAX(ID) INTO PI_MININDEX,PI_MAXINDEX FROM BATCH_MT_REQ_HIS
  WHERE RECVTIME<TO_DATE(TO_CHAR(SYSDATE-60,'YYYY-MM-DD'),'YYYY-MM-DD HH24:MI:SS ');
  PI_CURINDEX:=PI_MININDEX;
  WHILE PI_CURINDEX<PI_MAXINDEX LOOP
    IF PI_MAXINDEX-PI_CURINDEX>=EACHMAX THEN
      PI_CURINDEX:=PI_CURINDEX+EACHMAX;
    ELSE
      PI_CURINDEX:=PI_MAXINDEX;
    END IF;
    BEGIN
      DELETE FROM BATCH_MT_REQ_HIS WHERE ID<=PI_CURINDEX;
    EXCEPTION WHEN OTHERS THEN
      PIERROR:=SQLERRM;
      INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('SMS','短信删除BATCH_MT_REQ_HIS表记录',PIERROR);

      COMMIT;
    END;--END OF EXCEPTION
  END LOOP;

  IF TO_CHAR(SYSDATE,'DD')='01' THEN

    SELECT MIN(ID),MAX(ID) INTO PI_MININDEX,PI_MAXINDEX FROM MO_WAIT_A
    WHERE DELIVERTIME<TO_DATE(TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYY-MM-DD'),'YYYY-MM-DD HH24:MI:SS');
    PI_CURINDEX:=PI_MININDEX;
    WHILE PI_CURINDEX<PI_MAXINDEX LOOP
      IF PI_MAXINDEX-PI_CURINDEX>=EACHMAX THEN
        PI_CURINDEX:=PI_CURINDEX+EACHMAX;
      ELSE
        PI_CURINDEX:=PI_MAXINDEX;
      END IF;
      BEGIN
        DELETE FROM MO_WAIT_A WHERE ID<=PI_CURINDEX;
      EXCEPTION WHEN OTHERS THEN
        PIERROR:=SQLERRM;
        INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('SMS','短信删除MO_WAIT_A表记录',PIERROR);
        COMMIT;
      END;--END OF EXCEPTION
    END LOOP;

    SELECT MIN(ID),MAX(ID) INTO PI_MININDEX,PI_MAXINDEX FROM RPT_WAIT_A
    WHERE RECVTIME<TO_DATE(TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYY-MM-DD'),'YYYY-MM-DD HH24:MI:SS');
    PI_CURINDEX:=PI_MININDEX;
    WHILE PI_CURINDEX<PI_MAXINDEX LOOP
      IF PI_MAXINDEX-PI_CURINDEX>=EACHMAX THEN
        PI_CURINDEX:=PI_CURINDEX+EACHMAX;
      ELSE
        PI_CURINDEX:=PI_MAXINDEX;
      END IF;
      BEGIN
        DELETE FROM RPT_WAIT_A WHERE ID<=PI_CURINDEX;
      EXCEPTION WHEN OTHERS THEN
        PIERROR:=SQLERRM;
        INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('SMS','短信删除RPT_WAIT_A表记录',PIERROR);
        COMMIT;
      END;--END OF EXCEPTION
    END LOOP;

    SELECT MIN(ID),MAX(ID) INTO PI_MININDEX,PI_MAXINDEX FROM RPT_WAIT_B
    WHERE RECVTIME<TO_DATE(TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYY-MM-DD'),'YYYY-MM-DD HH24:MI:SS');
    PI_CURINDEX:=PI_MININDEX;
    WHILE PI_CURINDEX<PI_MAXINDEX LOOP
      IF PI_MAXINDEX-PI_CURINDEX>=EACHMAX THEN
        PI_CURINDEX:=PI_CURINDEX+EACHMAX;
      ELSE
        PI_CURINDEX:=PI_MAXINDEX;
      END IF;
      BEGIN
        DELETE FROM RPT_WAIT_B WHERE ID<=PI_CURINDEX;
      EXCEPTION WHEN OTHERS THEN
        PIERROR:=SQLERRM;
        INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('SMS','短信删除RPT_WAIT_B表记录',PIERROR);
        COMMIT;
      END;--END OF EXCEPTION
    END LOOP;
    COMMIT;
  END IF;
END;
/

CREATE OR REPLACE PROCEDURE GW_H_TRANSFERV1(MININDEX IN NUMBER,
                                            MAXINDEX IN NUMBER,
                                            PROCESSFLAG IN NUMBER,
                                            LOTSIZE IN NUMBER) IS
  PISTR VARCHAR2(4000);
  PITABLENAME VARCHAR2(20);
  MINYM NUMBER;
  MAXYM NUMBER;
  CURYM NUMBER;
BEGIN
  --------------------VER 3.1-------------------------------------
  SELECT CAST(TO_CHAR(MAX(SENDTIME),'YYYYMM')AS INT),CAST(TO_CHAR(MIN(SENDTIME),'YYYYMM')AS INT) INTO MAXYM,MINYM FROM GW_MT_TASK_BAK WHERE ID BETWEEN MININDEX AND MAXINDEX;

  CURYM := MINYM;
  WHILE CURYM<=MAXYM LOOP
    PITABLENAME := 'MTTASK'||CAST(CURYM AS CHAR);

    PISTR:= 'INSERT INTO '||PITABLENAME||' NOLOGGING (ID,MDAY,USERID,SPGATE,CPNO,PHONE,SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,
      PKTOTAL,SENDSTATUS,SENDFLAG,RECVFLAG,DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,SENDTIME,RECVTIME,MESSAGE,TASKID,
      ECID,PTMSGID,MOBILEAREA,SPID,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,DOWNTM,SUID1,LUID1)
      SELECT ID,TO_NUMBER(TO_CHAR(M.SENDTIME,''DD'')),USERID,SPGATE,CPNO,PHONE,SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,
      SENDSTATUS,SENDFLAG,RECVFLAG,DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,SENDTIME,RECVTIME,MESSAGE,TASKID,ECID,
      PTMSGID,MOBILEAREA,SPID,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME,DOWNTM,SUID1,LUID1
      FROM GW_MT_TASK_BAK M
      WHERE CAST(TO_CHAR(SENDTIME,''YYYYMM'')AS INT) ='||CURYM||' AND (M.ID <='||MAXINDEX||') ';
    --DBMS_OUTPUT.PUT_LINE(PISTR);
    EXECUTE IMMEDIATE PISTR;

    IF CAST(SUBSTR(CAST(CURYM AS CHAR),5,2) AS INT)=12 THEN
      CURYM := CAST(CAST(CAST(SUBSTR(CAST(CURYM AS CHAR),1,4)AS INT)+1 AS CHAR)||'01' AS INT);
    ELSE
      CURYM := CURYM+1;
    END IF;
  END LOOP;
END GW_H_TRANSFERV1;

/

CREATE OR REPLACE PROCEDURE GW_WR_MTTASKV1
(
  PIUID          IN NUMBER,
  PIPTMSGID      IN NUMBER,
  PISENDSTATUS   IN NUMBER,
  PIRETFLAG      IN NUMBER,
  PIPKTOTAL      IN NUMBER,
  PIPHONECOUNT   IN NUMBER,
  PISPLITLEN_P   IN NUMBER,
  PIMULTILEN1_P  IN NUMBER,
  PIMULTILEN2_P  IN NUMBER,
  PISIGNLEN_P    IN NUMBER,
  PIECID         IN NUMBER,
  PIUSERID       IN VARCHAR2,
  PISPGATE       IN VARCHAR2,
  PICPNO         IN VARCHAR2,
  PIRECVMTTIME   IN VARCHAR2,
  PIMESSAGE      IN VARCHAR2,
  PISHOUJI       IN VARCHAR2,
  PIFEEFLAG      IN NUMBER,
  PISENDLEVEL    IN NUMBER,
  PITASKID       IN NUMBER,
  PIERCODE       IN VARCHAR2,
  PITPUDHI       IN NUMBER,
  PILONGMSGSEQ   IN NUMBER,
  PIMSGFMT       IN NUMBER,
  PIUNICOM       IN NUMBER,
  PIMOBILEAREA   IN NUMBER,
  PIPKNUMBER     IN NUMBER,
  PISVRTYPE      IN VARCHAR2,
  PIP1      IN VARCHAR2,
  PIP2      IN VARCHAR2,
  PIP3      IN VARCHAR2,
  PIP4      IN VARCHAR2,
  PIUSERMSGID    IN NUMBER DEFAULT 0,
  PIMODULEID     IN NUMBER DEFAULT 0,
  PIATTIME       IN NUMBER DEFAULT 0,
  PIVALIDTIME    IN NUMBER DEFAULT 0,
  PISENDTYPE     IN NUMBER DEFAULT 1,
  PIBATCHID      IN NUMBER DEFAULT 0,
  PIAREACODE     IN NUMBER DEFAULT 0,
  PICUSTID      IN VARCHAR2,
  PIEXDATA      IN VARCHAR2
)
AS
  --临时变量
  PITMPMSGID NUMBER(22,0);
  PILOCATION PLS_INTEGER;
  PISTART PLS_INTEGER;
  PIRESULTPHONE VARCHAR(21);
  PISTRSPLIT VARCHAR(2);
  PILEN PLS_INTEGER;
  PIRESULTMSG VARCHAR(720);
  PIPKNUM PLS_INTEGER;
  PITMPNUM PLS_INTEGER;
  ICOUNT PLS_INTEGER;
  PISHOUJI_P VARCHAR2(3500);
  PIRECVMTTIME_P TIMESTAMP(6);
  PIPTMSGID_P NUMBER(22,0);

  PISPLITLEN PLS_INTEGER;
  PIMULTILEN1 PLS_INTEGER;
  PIMULTILEN2 PLS_INTEGER;
  PISIGNLEN PLS_INTEGER;

BEGIN
  --变量赋值
  PILEN := LENGTH(PIMESSAGE)-PISIGNLEN_P;
  PITMPNUM := 0;
  PIPKNUM := 1;
  PISTRSPLIT := ',';
  PISHOUJI_P :=PISHOUJI;
  PIPTMSGID_P:=PIPTMSGID;


  IF PIRECVMTTIME IS NULL THEN
    PIRECVMTTIME_P:=SYSTIMESTAMP;
  ELSE
    PIRECVMTTIME_P:=TO_TIMESTAMP(PIRECVMTTIME,'YYYY-MM-DD HH24:MI:SS.FF');
  END IF;
  --清空临时表,如果临时表不存在直接返回不处理
  /*SELECT  COUNT(*) INTO ICOUNT FROM USER_TABLES T WHERE UPPER(T.TABLE_NAME)=UPPER('TMP_MTTASK');
  IF ICOUNT>0 THEN
      EXECUTE IMMEDIATE 'TRUNCATE TABLE TMP_MTTASK';
  ELSE
    RETURN;
  END IF;
  */
  --验证手机号合法性
  IF (PISHOUJI_P IS NULL) THEN
    PISHOUJI_P := ' ';
  END IF;
  IF /*(PISHOUJI_P IS NULL) OR */(PIPHONECOUNT < 1) THEN
    RETURN;
  END IF;

  --变量赋值
  IF PIMSGFMT=4 OR PIMSGFMT=248 OR PIMSGFMT=246 THEN
    PISPLITLEN:=140;
    PIMULTILEN1:=134;
    PIMULTILEN2:=134;
    PISIGNLEN:=0;
  ELSE
    PISPLITLEN  :=PISPLITLEN_P;
    PIMULTILEN1 :=PIMULTILEN1_P;
    PIMULTILEN2 :=PIMULTILEN2_P;
    PISIGNLEN   :=PISIGNLEN_P;
  END IF;
  IF PIMSGFMT=25 THEN
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;
    IF ICOUNT<1 THEN
      INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                 RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                 UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
      VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PIPTMSGID_P,NVL(PIMESSAGE,' '),PISENDSTATUS,
             PIRETFLAG,PIPKNUMBER,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
             PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA);
    END IF;
    RETURN;
  END IF;
  IF PIPHONECOUNT = 1 --单发
  THEN
    SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID_P;
    --IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID_P)
    IF ICOUNT<1 THEN
      IF PIPKTOTAL = 1 THEN
        INSERT INTO GW_MT_TASK_BAK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
        VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PIPTMSGID_P,NVL(PIMESSAGE,' '),PISENDSTATUS,
               PIRETFLAG,PIPKTOTAL,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
               PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA);
      ELSE
        PIPKNUM := 1;
        PITMPMSGID := PIPTMSGID_P;
        IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1 THEN
          PIRESULTMSG := SUBSTR(PIMESSAGE,1,PISPLITLEN);
          PITMPMSGID := PITMPMSGID;
          ICOUNT:=0;
          SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID=PITMPMSGID;
          IF ICOUNT<1 THEN
            INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
            VALUES(PIUID, PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                   PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                   PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
          END IF;
          PIRESULTMSG := SUBSTR(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN);
          PITMPMSGID := PITMPMSGID+17179869184;
          PIPKNUM := PIPKNUM+1;
          ICOUNT:=0;
          SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
          IF ICOUNT<1 THEN
            INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
            VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                   PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                   PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
          END IF;
        ELSE
          WHILE PIPKNUM <= PIPKTOTAL LOOP
            IF PIPKNUM = PIPKTOTAL THEN
              PIRESULTMSG := SUBSTR(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN);
              PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
            ELSIF PIPKNUM = PIPKTOTAL-1 THEN
              IF ((PILEN-(PIPKNUM-1)*PIMULTILEN1) > PIMULTILEN2) AND ((PILEN-(PIPKNUM-1)*PIMULTILEN1) <= PIMULTILEN1) THEN
                PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1);
                PITMPNUM := PILEN-1;
                --DBMS_OUTPUT.PUT_LINE('123');
              ELSE
                PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
                DBMS_OUTPUT.PUT_LINE(PIRESULTMSG);
                PITMPNUM := (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
                --DBMS_OUTPUT.PUT_LINE('456');
              END IF;
              PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
            ELSE
              PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
              PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              --DBMS_OUTPUT.PUT_LINE(PIRESULTMSG);
            END IF;
            ICOUNT:=0;
            SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
            IF ICOUNT<1 THEN
              INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                     RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                     UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
              VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI_P,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                     PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                     PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
            END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
            --EXECUTE IMMEDIATE STR;
            PIPKNUM := PIPKNUM+1;
          END LOOP;--END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
        END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1;
        INSERT INTO GW_MT_TASK_BAK ("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                    RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                    UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
        SELECT A."UID",A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,NVL(A.MESSAGE,' '),A.SENDSTATUS,A.RETFLAG,
               A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
               A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA FROM TMP_MTTASK A;
        COMMIT;
      END IF;--END IF OF IF PIPKTOTAL = 1
    --ELSE  --MSGID存在是写入MSGIDTEST表
    --  INSERT INTO MSGIDTEST(MSGID) VALUES(PIPTMSGID);
    END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID_P)
  ELSE --群发
    PISHOUJI_P := PISTRSPLIT||PISHOUJI_P||PISTRSPLIT;
    PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT);
    IF PIPKTOTAL < 1 THEN--没有短信内容
      RETURN;
    END IF;

    IF PIPKTOTAL >= 1 --需要拆分长短信
    THEN
      WHILE PILOCATION <> 0 LOOP--拆分手机号码
      PISTART := PILOCATION;
      PILOCATION := INSTR(PISHOUJI_P,PISTRSPLIT,PISTART+1);
      IF PILOCATION > 0 THEN
        PIRESULTPHONE := SUBSTR(PISHOUJI_P,PISTART+1,PILOCATION-PISTART-1);--拆分后的字符
        IF (PIRESULTPHONE IS NULL) THEN
          PIRESULTPHONE := ' ';
        END IF;
        PITMPMSGID := PIPTMSGID_P;
        ICOUNT:=0;
        SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
        IF ICOUNT<1 THEN
          IF PIPKTOTAL = 1 THEN
            INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                   UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
            VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIMESSAGE,PISENDSTATUS,
                   PIRETFLAG, PIPKTOTAL,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                   PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
          ELSE
            PIPKNUM := 1;
            IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1 THEN
              PIRESULTMSG := SUBSTR(PIMESSAGE,1, PISPLITLEN);--拆分后的字符
              PITMPMSGID := PITMPMSGID;
              ICOUNT:=0;
              SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
              IF ICOUNT<1 THEN
                INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                       RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                       UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                VALUES(PIUID,PIUSERID, PISPGATE,PICPNO,PIRESULTPHONE, PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                       PIRETFLAG, PIPKNUM, PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                       PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
              END IF;
              PIRESULTMSG := SUBSTR(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN);
              PITMPMSGID := PITMPMSGID+17179869184;
              PIPKNUM := PIPKNUM+1;
              ICOUNT:=0;
              SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
              IF ICOUNT<1 THEN
                INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                       RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                       UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                       PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                       PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
              END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
            ELSE
              WHILE PIPKNUM <= PIPKTOTAL LOOP--PIPKNUM:1    PIPKTOTAL 2
              IF PIPKNUM = PIPKTOTAL THEN
                PIRESULTMSG := SUBSTR(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN);
                PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              ELSIF PIPKNUM = PIPKTOTAL-1 THEN
                IF ((PILEN-(PIPKNUM-1)*PIMULTILEN1) > PIMULTILEN2) AND ((PILEN-(PIPKNUM-1)*PIMULTILEN1) <= PIMULTILEN1) THEN
                  PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1);
                  PITMPNUM := PILEN-1;
                ELSE
                  PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
                  PITMPNUM := (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
                  ----第一条
                END IF; --END IF OF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
                PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              ELSE
                PIRESULTMSG := SUBSTR(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1);
                PITMPMSGID := PIPTMSGID_P+(PIPKNUM-1)*17179869184;
              END IF; --END IF OF IF PIPKNUM = PIPKTOTAL
              ICOUNT:=0;
              SELECT COUNT(PTMSGID) INTO ICOUNT FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID;
              IF ICOUNT<1 THEN
                INSERT INTO TMP_MTTASK("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                       RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                       UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
                VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PIRESULTPHONE,PITMPMSGID,PIRESULTMSG,PISENDSTATUS,
                       PIRETFLAG,PIPKNUM,PIPKTOTAL,PIRECVMTTIME_P,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
                       PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
              END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
              PIPKNUM := PIPKNUM+1;
              END LOOP;-- END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
            END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
          END  IF;--END IF OF IF PIPKTOTAL = 1
        END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
        PIPTMSGID_P := PIPTMSGID_P+1;
      END  IF; --END IF OF IF PILOCATION > 0
      END LOOP; --END WHILE OF WHILE PILOCATION <> 0
      INSERT INTO GW_MT_TASK_BAK ("UID",USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
                                  RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
                                  UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA)
      SELECT A."UID",A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,NVL(A.MESSAGE,' '),A.SENDSTATUS,A.RETFLAG,
             A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,A.MSGFMT,A.UNICOM,
             A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA FROM TMP_MTTASK A;
      COMMIT;
    END IF; --END IF OF IF PIPKTOTAL >= 1
  END IF; --END IF OF IF PIPHONECOUNT = 1 --单发
END;
/

MERGE INTO  A_GWPARAMCONF A USING (SELECT 'PUSHCONFIG' AS "PARAMITEM",4000 AS "GWTYPE" FROM  DUAL) B ON (A.PARAMITEM=B.PARAMITEM AND A.GWTYPE=B.GWTYPE)
WHEN NOT MATCHED THEN
  INSERT (PARAMITEM, PARAMNAME,  PARAMMEMO,PARAMATTRIBUTE, VALUERANGE,
          DEFAULTVALUE,  CONTROLTYPE, GWTYPE, HKPARAMNAME, HKPARAMMEMO, ENPARAMNAME, ENPARAMMEMO)
  VALUES('PUSHCONFIG', '推送字段是否为JSON数组',  '推送字段是否为JSON数组(0:字符串,1:JSON数组)',
         1, '0,1','0',1,4000,'推送字段是否JSON到M','推送字段是否JSON到M(0:字符串,1:JSON到M)','Whether the push field is a JSON array','Whether the push field is a JSON array (0: string, 1: JSON array)');

INSERT INTO A_GWPARAMVALUE(GWNO, GWTYPE, PARAMITEM, PARAMVALUE)
SELECT DISTINCT GWNO,4000,'PUSHCONFIG','0' FROM A_GWPARAMVALUE
WHERE  NOT EXISTS(SELECT * FROM A_GWPARAMVALUE WHERE PARAMITEM='PUSHCONFIG'  AND  GWTYPE=4000) AND  GWTYPE=4000;

commit;
/

CREATE OR REPLACE PROCEDURE GW_LOAD_ECERRCODEBIND
(
  OUT_CURSOR OUT SYS_REFCURSOR
)
AS
BEGIN
  OPEN OUT_CURSOR FOR
    SELECT CORP_CODE,STATE_CODE,MAPPING_CODE,STATE_DES  FROM LF_STATECODE;
END;
/

-------------------增加版本信息-------------------------------------------
DECLARE
  VERSION INT;
BEGIN
  SELECT COUNT(*) INTO VERSION FROM VERSION_CMPP WHERE VERSION='4.06.07';
  IF VERSION < 1 THEN
    INSERT INTO VERSION_CMPP (VERSION,VERSIONDATE,UPGRADETIME)
    VALUES ('4.06.07',TO_CHAR(SYSDATE,'YYYY-MM-DD'),TO_CHAR(SYSDATE,'HH24:MI:SS'));
  END IF;
  COMMIT;
END;
/

CREATE OR REPLACE PROCEDURE COMPILE_PROCEDURE
AS
  V_SQL VARCHAR2(2000);
BEGIN

  FOR V IN (SELECT * FROM USER_OBJECTS WHERE OBJECT_TYPE IN ('PROCEDURE','TRIGGER') AND STATUS='INVALID' AND OBJECT_NAME NOT LIKE '%BIN$%')
    LOOP
      V_SQL:= 'ALTER  '||V.OBJECT_TYPE||' '|| V.OBJECT_NAME||' COMPILE';
      EXECUTE IMMEDIATE V_SQL;
    END LOOP;
END;
/
CALL COMPILE_PROCEDURE();
/
/** 升级脚本(V4.06.06-V4.06.07) END */
/*网关升级脚本   END*/

/*EMP升级脚本    START*/

-- V71.00 -> V71.01 Start
-- 创建增加序列的存储过程
CREATE OR REPLACE PROCEDURE ADDSEQUENCEBYNAME(SEQNAME IN NVARCHAR2) AUTHID CURRENT_USER
IS
NUM NUMBER(11);
SQLSTR VARCHAR2(1000);
BEGIN
    ---判断序列 seq_name_1 是否存在（区分大小写）
    SELECT COUNT(1) INTO NUM FROM USER_SEQUENCES WHERE SEQUENCE_NAME = UPPER(SEQNAME);
    ----如果不存在则创建
    IF NUM = 0 THEN
      SQLSTR:= 'CREATE SEQUENCE ' || SEQNAME ||
        ' MINVALUE 1
        MAXVALUE 999999999999999999999999999
        START WITH 1
        INCREMENT BY 1
        CACHE 20';
       EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/
-- 创建触发器
CREATE OR REPLACE PROCEDURE ADDTRIGGERBYNAME(TABLENAME IN NVARCHAR2,COLNAME IN NVARCHAR2,SEQNAME IN NVARCHAR2) AUTHID CURRENT_USER
IS
NUM NUMBER(11);
SQLSTR VARCHAR2(1000);
BEGIN
    ---判断触发器是否存在（区分大小写）
    SELECT COUNT(1) INTO NUM FROM USER_OBJECTS WHERE OBJECT_TYPE = 'TRIGGER' AND OBJECT_NAME = 'TIG_'||UPPER(TABLENAME);
    IF NUM = 0 THEN
      SQLSTR:= 'CREATE TRIGGER TIG_' || TABLENAME ||
        ' BEFORE INSERT ON '||TABLENAME||' FOR EACH ROW ' ||
         'BEGIN IF(:NEW.'||COLNAME||' IS NULL) THEN ' ||
          'SELECT '||SEQNAME||'.NEXTVAL INTO :NEW.'||COLNAME||' FROM DUAL;' ||
           'END IF;' ||
            'END;';
       EXECUTE IMMEDIATE SQLSTR;
     END IF;
END;
/
-- LF_TEMP_PARAM表增加字段HASLENGTH
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_TEMP_PARAM' AND COLUMN_NAME ='HASLENGTH';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMP_PARAM ADD HASLENGTH NUMBER(11) DEFAULT 0 NOT NULL';
    END IF;
END;
/

-- 屏蔽企业流量
UPDATE LF_REVIEWSWITCH SET SWITCH_TYPE = 2 WHERE INFO_TYPE = 7;

-- 添加接收失败数
-- LF_TEMP_PARAM表增加字段HASLENGTH
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'MT_DATAREPORT' AND COLUMN_NAME ='RECFAIL';
  IF NUM = 0 THEN
    EXECUTE IMMEDIATE 'ALTER TABLE MT_DATAREPORT ADD RECFAIL NUMBER(11) DEFAULT 0 NOT NULL';
  END IF;
END;
/


DROP PROCEDURE GW_H_STATISTIV3;
CREATE OR REPLACE PROCEDURE GW_H_STATISTIV3(PROCESSFLAG IN NUMBER,ISP1 IN NUMBER,ISP2 IN NUMBER,ISP3 IN NUMBER,ISP4 IN NUMBER)
AUTHID CURRENT_USER
IS
   STR VARCHAR2(4000);
   TABLENAME VARCHAR2(20);
   ISEXIST NUMBER;
   MAXIYMD NUMBER;
   DIFFDATE NUMBER;
   CURPROCESSFLAG NUMBER;
BEGIN
  --------------------VER 3.2-------------------------------------
--删除临时
          TABLENAME :='TMEP_STATISTICS';
          ISEXIST:=0;
          SELECT COUNT(TABLE_NAME) INTO ISEXIST FROM USER_TABLES WHERE TABLE_NAME=UPPER(TABLENAME);
          IF(ISEXIST>0) THEN
            BEGIN
                  STR := 'DROP TABLE '||TABLENAME;
                  EXECUTE IMMEDIATE STR;
            END;
          END IF;
--创建临时表

      --  SPISUNCM NUMBER(11),
 STR :='CREATE GLOBAL TEMPORARY TABLE '|| TABLENAME ||'(
        USERID VARCHAR2(11),
        TASKID NUMBER(11),
        SPGATE VARCHAR2(21),
        SPISUNCM NUMBER(11),
        SPID VARCHAR2(32),
        SVRTYPE VARCHAR2(64),
        P1 VARCHAR2(64),
        P2 VARCHAR2(64),
        P3 VARCHAR2(64),
        P4 VARCHAR2(64),
        IYMD NUMBER(11),
        IYEAR NUMBER(11),
        IMONTH NUMBER(11),
        IHOUR NUMBER(11),
        ICOUNT NUMBER(11),
        SUCC NUMBER(11),
        FAIL NUMBER(11),
    RECFAIL NUMBER(11),
        NRET NUMBER(11),
        SENDTYPE NUMBER(11),
        MOBILEAREA NUMBER(11),
        BATCHID NUMBER(22),
        AREACODE NUMBER(11),
    TMPLID NUMBER(22),
    CHGRADE NUMBER(11),
    MSGTYPE NUMBER(11)
 )';

--DBMS_OUTPUT.PUT_LINE(STR);
 EXECUTE IMMEDIATE STR;
 --统计
  CURPROCESSFLAG:=PROCESSFLAG;
  SELECT NVL(MAX(IYMD),20000101) INTO MAXIYMD  FROM MT_DATAREPORT;
  DIFFDATE:= TO_DATE(TO_CHAR(SYSDATE-2,'YYYY-MM-DD'),'YYYY-MM-DD HH24:MI:SS')-to_date(MAXIYMD,'YYYY-MM-DD HH24:MI:SS') ;
  IF DIFFDATE>0 THEN
          CURPROCESSFLAG:=CURPROCESSFLAG+DIFFDATE;
  END IF;
 STR:= 'INSERT INTO  '|| TABLENAME ||' (USERID,TASKID,SPGATE,SPISUNCM,SPID,SVRTYPE,P1,P2,P3,P4,IYMD,IYEAR,IMONTH,IHOUR,ICOUNT,SUCC,FAIL,RECFAIL,NRET,SENDTYPE,MOBILEAREA,BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE)
               SELECT  USERID,TASKID,SPGATE,UNICOM,SPID,SVRTYPE';
               IF ISP1=1 THEN
                  STR:=STR||',P1';
                ELSE
                  STR:=STR||','' '' AS P1';
                END IF;
               IF ISP2=1 THEN
                  STR:=STR||',P2';
                ELSE
                  STR:=STR||','' '' AS P2';
                END IF;
                IF ISP3=1 THEN
                  STR:=STR||',P3';
                ELSE
                  STR:=STR||','' '' AS P3';
                END IF;
                IF ISP4=1 THEN
                  STR:=STR||',P4';
                ELSE
                  STR:=STR||','' '' AS P4';
                END IF;

               STR:=STR||',
               TO_NUMBER(TO_CHAR(SENDTIME,''YYYYMMDD'')) AS IYMD,
               TO_NUMBER(TO_CHAR(SENDTIME,''YYYY'')) AS IYEAR,
               TO_NUMBER(TO_CHAR(SENDTIME,''MM'')) AS MON,
               TO_NUMBER(TO_CHAR(SENDTIME,''HH24'')) AS HOUR,
               COUNT(ID),
               NVL(COUNT(CASE TRIM(ERRORCODE) WHEN ''DELIVRD'' THEN 1 WHEN ''0'' THEN 1 ELSE NULL END),0),
               NVL(COUNT(CASE SUBSTR(ERRORCODE,1,3) WHEN ''E1:'' THEN 1 WHEN ''E2:'' THEN 1 ELSE NULL END),0),
         NVL(COUNT(CASE SUBSTR(ERRORCODE,1,3)  WHEN ''E2:'' THEN 1 ELSE NULL END),0),
               NVL(COUNT(CASE NVL(TRIM(ERRORCODE),''0'') WHEN ''0'' THEN 1 ELSE NULL END),0),
               SENDTYPE,
               MOBILEAREA,
               BATCHID,
               AREACODE,
         TMPLID,
         CHGRADE,
         MSGTYPE
               FROM GW_MT_TASK_BAK
               WHERE  SENDTIME >=  '|| 'TO_DATE(TO_CHAR(SYSDATE-'||CURPROCESSFLAG||',''YYYY-MM-DD''),''YYYY-MM-DD HH24:MI:SS '') '|| ' AND SENDTIME < '|| 'TO_DATE(TO_CHAR(SYSDATE,''YYYY-MM-DD''),''YYYY-MM-DD HH24:MI:SS '')' ||'
               GROUP BY USERID,TASKID,SPGATE,UNICOM,SPID,SVRTYPE';
                 IF ISP1=1 THEN
                  STR:=STR||',P1';
                 END IF;
                IF ISP2=1 THEN
                  STR:=STR||',P2';
                 END IF;
                IF ISP3=1 THEN
                  STR:=STR||',P3';
                 END IF;
                 IF ISP4=1 THEN
                  STR:=STR||',P4';
                 END IF;
               STR:=STR||',SENDTYPE,MOBILEAREA,BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE,
               TO_NUMBER(TO_CHAR(SENDTIME,''YYYYMMDD'')),
               TO_NUMBER(TO_CHAR(SENDTIME,''YYYY'')),
               TO_NUMBER(TO_CHAR(SENDTIME,''MM'')),
               TO_NUMBER(TO_CHAR(SENDTIME,''HH24''))';
        -- DBMS_OUTPUT.PUT_LINE(STR);

 EXECUTE IMMEDIATE STR;
       --SELECT MIN(),MAX() INTO  FROM TMEP_STATISTICS
 --插入或更新统计表
       STR:='DELETE FROM MT_DATAREPORT WHERE EXISTS (SELECT IYMD FROM '||TABLENAME||' A WHERE A.IYMD=MT_DATAREPORT.IYMD)';
      -- EXECUTE IMMEDIATE STR;

       --STR:='DELETE FROM MT_DATAREPORT WHERE IYMD BETWEEN CAST(TO_CHAR(SYSDATE-'||PROCESSFLAG||',''YYYYMMDD'') AS INT) AND CAST(TO_CHAR(SYSDATE,''YYYYMMDD'') AS INT)' ;
       EXECUTE IMMEDIATE STR;

       STR:='INSERT INTO MT_DATAREPORT M
       (USERID,TASKID,SPGATE,SPISUNCM,SPID,SVRTYPE,P1,P2,P3,P4,IYMD,IHOUR,IMONTH,Y,ICOUNT,RSUCC,RFAIL1,RFAIL2,RECFAIL,RNRET,SENDTYPE,MOBILEAREA,BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE)
       SELECT T.USERID,T.TASKID,T.SPGATE,T.SPISUNCM,T.SPID,T.SVRTYPE,T.P1,T.P2,T.P3,T.P4,T.IYMD,T.IHOUR,T.IMONTH,T.IYEAR,T.ICOUNT,T.SUCC,T.FAIL,
       (T.ICOUNT-T.SUCC-T.FAIL-T.NRET),T.RECFAIL,T.NRET,T.SENDTYPE,T.MOBILEAREA,T.BATCHID,T.AREACODE,T.TMPLID,T.CHGRADE,T.MSGTYPE FROM '|| TABLENAME ||'  T';

--DBMS_OUTPUT.PUT_LINE(STR);
 EXECUTE IMMEDIATE STR;

 EXECUTE IMMEDIATE  'DROP TABLE '||TABLENAME;
 COMMIT;
END ;
/

-- 短链相关脚本 start
-- 创建短链接发送任务表
DECLARE NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_URLTASK';
    IF NUM = 0 THEN
      SQLSTR := 'CREATE TABLE LF_URLTASK (
      ID NUMBER(18) NOT NULL,    -- 主键ID
      TASKID NUMBER(18) DEFAULT 0 NOT NULL,    -- 任务批次号
      SPUSER VARCHAR2(11) DEFAULT '' '' NOT NULL, --SP账号
      CORP_CODE VARCHAR2(64) DEFAULT '' '' NOT NULL,    -- 企业编码
      TITLE VARCHAR2(64) DEFAULT '' '' NOT NULL,    -- 发送主题
      MSG VARCHAR2(2048) NOT NULL,    -- 短信内容
      UTYPE NUMBER(5) NOT NULL,    -- 1.相同内容短链接发送 2.不同内容短链接发送
      PLAN_TIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,
      SUBMIT_TM TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,    -- 提交时间
      SEND_TM TIMESTAMP(6) NOT NULL,    -- 发送时间
      HANDLE_NODE VARCHAR2(50) DEFAULT '' '' NOT NULL,
      HANDLE_LINE NUMBER(18) DEFAULT 0 NOT NULL,
      SUB_COUNT NUMBER(18) DEFAULT 0 NOT NULL,    -- 提交个数
      SRC_FILE VARCHAR2(1024) DEFAULT '' '' NOT NULL,    -- 源文件地址
      URL_FILE VARCHAR2(1024) DEFAULT '' '' NOT NULL,    -- 包含短地址内容文件地址
      STATUS NUMBER(5) DEFAULT 0 NOT NULL,    -- 状态  无定时     10：未处理   11：处理中   12：处理完成   13 : 处理失败  定时发送   20 ：未处理  21：处理中   22：处理完成   23 : 处理失败
      CREATE_UID NUMBER(20) DEFAULT 0 NOT NULL,    -- 创建人员ID
      CREATE_TM TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,    -- 创建时间
      UPDATE_UID NUMBER(20) DEFAULT 0 NOT NULL,    -- 修改人员ID
      UPDATE_TM TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,    -- 修改时间
      NETURL VARCHAR2(1024) DEFAULT '' '',    -- 企业长地址
      NETURL_ID NUMBER(18) DEFAULT 0 NOT NULL,    -- 企业长地址ID
      DOMAIN_ID NUMBER(18) DEFAULT 0 NOT NULL,
      DOMAIN_URL VARCHAR2(256) DEFAULT '' '' NOT NULL,    -- 短地址ID
      DOMAIN_EXTEN NUMBER(11),    -- 短地址扩展部分长度
      DOMAIN_LEN NUMBER(20) DEFAULT 0 NOT NULL,    -- 短地址总长度
      VALID_DAYS NUMBER(5) DEFAULT 0 NOT NULL,    -- 有效期
      REMARK VARCHAR2(256) DEFAULT '' '' NOT NULL,    -- 扩展信息
      REMARK1 VARCHAR2(256) NOT NULL    -- 扩展信息2
    ) TABLESPACE EMP_TABLESPACE
      PCTFREE 10
      INITRANS 1
      MAXTRANS 255
      STORAGE
      (
        INITIAL 64K
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
      )';
      EXECUTE IMMEDIATE SQLSTR;
      SQLSTR := 'ALTER TABLE LF_URLTASK
      ADD CONSTRAINT PK_LF_URLTASK PRIMARY KEY (ID)
      USING INDEX
      TABLESPACE EMP_TABLESPACE
      PCTFREE 10
      INITRANS 2
      MAXTRANS 255
      STORAGE
      (
        INITIAL 64K
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
      )';
      EXECUTE IMMEDIATE SQLSTR;
      SQLSTR := 'CREATE INDEX INDEX_LF_URLTASK_TASKID ON LF_URLTASK (TASKID)
        TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 2
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
      EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/
-- 创建连接地址维护表
DECLARE NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_NETURL';
    IF NUM = 0 THEN
      SQLSTR := 'CREATE TABLE LF_NETURL (
      ID NUMBER(18) NOT NULL,    -- id主键
      SRC_URL VARCHAR2(1024) DEFAULT '' '',    -- 源地址
      URL_NAME VARCHAR2(200) DEFAULT '' '' NOT NULL,    -- 连接名称
      URL_MSG VARCHAR2(1024) DEFAULT '' '' NOT NULL,    -- 源地址内容描述
      CORP_CODE VARCHAR2(64) DEFAULT 0 NOT NULL,    -- 企业编码
      ISPASS NUMBER(11) DEFAULT 0 NOT NULL,    -- 审批状态   -3 禁用（未调接口）, -2 禁用  -1:删除   0：未审批, 1：无需审批 ,2：审批通过 （运营商侧）
      URLSTATE NUMBER(11) DEFAULT 0 NOT NULL,    -- 长地址状态企业内部维护使用   -2禁用（未调接口）， -1：禁用 0：启用 （用户侧）
      CREATE_UID NUMBER(18) NOT NULL,    -- 创建人
      CREATE_TM TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,    -- 创建时间
      UPDATE_UID NUMBER(18) NOT NULL,  -- 修改人员ID （用户侧）
      UPDATE_TM TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,    -- 修改时间 （用户侧）
      AUDIT_UID NUMBER(18) ,--审核人
      AUDIT_TM TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,--审核时间
      STOP_UID NUMBER(18) , -- 禁用人员ID （运营商测）
      STOP_TM TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,-- 禁用时间
      REMARKS VARCHAR2(256) DEFAULT '' '' NOT NULL,    -- 审核意见
      REMARKS1 VARCHAR2(256) DEFAULT '' '' NOT NULL,--预留字段1
      REMARKS2 VARCHAR2(256) DEFAULT '' '' NOT NULL --预留字段2
    ) TABLESPACE EMP_TABLESPACE
      PCTFREE 10
      INITRANS 1
      MAXTRANS 255
      STORAGE
      (
        INITIAL 64K
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
      )';
      EXECUTE IMMEDIATE SQLSTR;
      SQLSTR := 'ALTER TABLE LF_NETURL
      ADD CONSTRAINT PK_LF_NETURL PRIMARY KEY (ID)
      USING INDEX
      TABLESPACE EMP_TABLESPACE
      PCTFREE 10
      INITRANS 2
      MAXTRANS 255
      STORAGE
      (
        INITIAL 64K
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
      )';
      EXECUTE IMMEDIATE SQLSTR;
      SQLSTR := 'CREATE INDEX INDEX_LF_NETURL_URL_NAME ON LF_NETURL (URL_NAME)
        TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 2
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
      EXECUTE IMMEDIATE SQLSTR;
      SQLSTR := 'CREATE INDEX INDEX_LF_NETURL_CORP_CODE ON LF_NETURL (CORP_CODE)
        TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 2
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
      EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/
-- 创建短域名信息表
DECLARE NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_DOMAIN';
    IF NUM = 0 THEN
      SQLSTR := 'CREATE TABLE LF_DOMAIN (
        ID NUMBER(18) NOT NULL,    -- 短域名id
        DOMAIN VARCHAR2(256) DEFAULT '' '' NOT NULL,    -- 短域名
        LEN_ALL NUMBER(11) NOT NULL,    -- 总长度
        LEN_EXTEN NUMBER(18) DEFAULT 0 NOT NULL,    -- 全局扩展位数
        DTYPE NUMBER(11) DEFAULT 0,    -- 域名类别  0 公用  1专用
        FLAG NUMBER(11) DEFAULT 0 NOT NULL,    -- 域名状态  0  有效    -1 无效
        VALID_DAYS NUMBER(18) DEFAULT 30 NOT NULL,    -- 有效时间，单位天 , 30  ,值不能为0
        CREATE_UID NUMBER(18) NOT NULL,    -- 创建人员
        CREATE_TM TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,    -- 创建时间
        UPDATE_UID NUMBER(18) NOT NULL,    -- 最后修改人员ID
        UPDATE_TM TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,    -- 最后修改时间
        REMARK VARCHAR2(256) NOT NULL,
        CREATE_USER VARCHAR2(64) DEFAULT '' '' NOT NULL  -- 创建用户
    ) TABLESPACE EMP_TABLESPACE
      PCTFREE 10
      INITRANS 1
      MAXTRANS 255
      STORAGE
      (
        INITIAL 64K
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
      )';
      EXECUTE IMMEDIATE SQLSTR;
      SQLSTR := 'ALTER TABLE LF_DOMAIN
      ADD CONSTRAINT PK_LF_DOMAIN PRIMARY KEY (ID)
      USING INDEX
      TABLESPACE EMP_TABLESPACE
      PCTFREE 10
      INITRANS 2
      MAXTRANS 255
      STORAGE
      (
        INITIAL 64K
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
      )';
      EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/
-- 创建企业域名映射表
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_DOMAIN_CORP';
    IF NUM = 0 THEN
       EXECUTE IMMEDIATE 'CREATE TABLE LF_DOMAIN_CORP (
        CORP_CODE VARCHAR2(64) NOT NULL,   --企业编码
        DOMAIN_ID NUMBER(18) NOT NULL,    -- 域名ID
        CREATE_UID NUMBER(18) DEFAULT 0 NOT NULL,    -- 创建人
        CREATE_TM TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,   -- 创建时间
        UPDATE_UID NUMBER(18) DEFAULT 0 NOT NULL,   -- 修改人
        UPDATE_TM TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,   -- 修改时间
        FLAG NUMBER(11) DEFAULT 0 NOT NULL,   -- 状态 0表示启用,1表示禁用
        CREATE_USER VARCHAR2(64) DEFAULT '' '' NOT NULL   -- 创建用户
      )TABLESPACE EMP_TABLESPACE
      PCTFREE 10
      INITRANS 1
      MAXTRANS 255
      STORAGE
      (
        INITIAL 64K
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
      )';
    END IF;
END;
/
-- 子草稿箱存储domainid ,neturlid
DECLARE
NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_SUB_DRAFTS';
    IF NUM = 0 THEN
    SQLSTR := 'CREATE TABLE LF_SUB_DRAFTS(
  ID         NUMBER(38) NOT NULL,
  DRAFTID NUMBER(11) DEFAULT 0 NOT NULL,
  TYPE  NUMBER(3) DEFAULT 0 NOT NULL,
  NETURLID  NUMBER(11) DEFAULT 0 NOT NULL,
  DOMAINID  NUMBER(11) DEFAULT 0 NOT NULL,
  CREATE_TIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,
  UPDATE_TIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL
) TABLESPACE EMP_TABLESPACE
  PCTFREE 10
  INITRANS 1
  MAXTRANS 255
  STORAGE
  (
    INITIAL 64K
    MINEXTENTS 1
    MAXEXTENTS UNLIMITED
  )';
   EXECUTE IMMEDIATE SQLSTR;
   SQLSTR := 'ALTER TABLE LF_SUB_DRAFTS
  ADD CONSTRAINT PK_LF_SUB_DRAFTS PRIMARY KEY (ID)
  USING INDEX
  TABLESPACE EMP_TABLESPACE
  PCTFREE 10
  INITRANS 2
  MAXTRANS 255
  STORAGE
  (
    INITIAL 64K
    MINEXTENTS 1
    MAXEXTENTS UNLIMITED
  )';
  EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/
-- 增加短链二级菜单
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM LF_THIR_MENUCONTROL WHERE MENU_NUM = 26 AND PRI_MENU = 96;
    IF NUM = 0 THEN
        INSERT INTO LF_THIR_MENUCONTROL(MENU_NUM, TITLE, PRI_MENU, PRI_ORDER, ZH_TW_TITLE, ZH_HK_TITLE) VALUES (26, '企业短链', 96, 395, '企I短', 'Short URL');
    END IF;
END;
/
-- 添加短链相关
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3500;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3500, 96, 1, '模板内容', '5500-1000-0', '相同内容发送', '短链应用', '5500-1000', '/url_urlSendBatchSMS.htm', '模板内容', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3500);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3500);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3500);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3501;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3501, 96, null, '模板内容', '5500-1000-4', '相同内容发送', '短链应用', '5500-1000', null, '模板内容', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3501);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3501);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3501);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3502;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3502, 96, null, '手动输入内容', '5500-1000-5', '相同内容发送', '短链应用', '5500-1000', null, '手动输入内容', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3502);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3502);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3502);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3503;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3503, 96, null, '手动输入号码', '5500-1000-6', '相同内容发送', '短链应用', '5500-1000', null, '手动输入号码', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3503);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3503);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3503);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3504;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3504, 96, null, '文件导入', '5500-1000-7', '相同内容发送', '短链应用', '5500-1000', null, '文件导入', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3504);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3504);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3504);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3505;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3505, 96, null, '选择人员', '5500-1000-8', '相同内容发送', '短链应用', '5500-1000', null, '选择人员', 'View', '相同热莅l送', 'Same SMS', '短用', 'Short URL');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3505);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3505);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3505);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3506;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3506, 96, 1, '查看', '5500-1100-0', '不同内容发送', '短链应用', '5500-1100', '/url_urlSendDiffSMS.htm', '查看', 'View', '不同热莅l送', 'Different SMS', '短用', 'Short URL');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3506);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3506);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3506);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3507;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3507, 96, null, '模板内容', '5500-1100-4', '不同内容发送', '短链应用', '5500-1100', null, '模板内容', 'View', '不同热莅l送', 'Different SMS', '短用', 'Short URL');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3507);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3507);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3507);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3508;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3508, 96, null, '手动输入内容', '5500-1100-5', '不同内容发送', '短链应用', '5500-1100', null, '手动输入内容', 'View', '不同热莅l送', 'Different SMS', '短用', 'Short URL');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3508);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3508);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3508);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3509;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3509, 96, 1, '查看', '5500-1200-0', '长链接报备', '短链应用', '5500-1200', '/keep_record.htm', '查看', 'View', 'L接', 'Bei an', '短用', 'Short URL');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3509);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3509);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3509);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3510;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3510, 96, null, '新增', '5500-1200-1', '长链接报备', '短链应用', '5500-1200', null, '新增', 'Add', 'L接', 'Bei an', '短用', 'Short URL');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3510);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3510);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3510);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3511;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3511, 96, 1, '查看', '5600-1000-0', '短链生成状态', '数据查询', '5600-1000', '/surlTaskRecord.htm', '查看', 'View', '短生成B', 'Task Record', '数据查询', 'Data');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3511);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3511);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3511);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3512;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3512, 96, 1, '查看', '5600-1100-0', '批次发送统计', '数据查询', '5600-1100', '/surlBatchRecord.htm', '查看', 'View', '批次l送y', 'Batch Record', '数据查询', 'Data');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3512);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3512);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3512);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3513;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3513, 96, 1, '查看', '5600-1200-0', '发送明细详情', '数据查询', '5600-1200', '/surlSendDetail.htm', '查看', 'View', 'l送明情', 'Batch Record', '数据查询', 'Data');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3513);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3513);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3513);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3514;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3514, 96, 1, '查看', '5600-1300-0', '批次访问统计', '数据查询', '5600-1300', '/surlBatchVisit.htm', '查看', 'View', '批次Ly', 'Batch Visit', '数据查询', 'Data');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3514);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3514);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3514);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3515;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3515, 96, 1, '查看', '5600-1400-0', '链接访问统计', '数据查询', '5600-1400', '/surlLinkVisit.htm', '查看', 'View', '接Ly', 'Link Visit', '数据查询', 'Data');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3515);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3515);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3515);
  END IF;
END;
/
-- DECLARE NUM NUMBER;
-- BEGIN
--   SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3516;
--   IF NUM = 0 THEN
--       INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--       VALUES (3516, 96, 1, '查看', '5600-1500-0', '区域访问统计', '数据查询', '5600-1500', '/surlZoneVisit.htm', '查看', 'View', '^域Ly', 'Zone Visit', '数据查询', 'Data');
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3516);
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3516);
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3516);
--   END IF;
-- END;
-- /
-- DECLARE NUM NUMBER;
-- BEGIN
--   SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3517;
--   IF NUM = 0 THEN
--       INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--       VALUES (3517, 96, 1, '查看', '5600-1600-0', '时段访问统计', '数据查询', '5600-1600', '/surlPeriodVisit.htm', '查看', 'View', 'r段Ly', 'Period Visit', '数据查询', 'Data');
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3517);
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3517);
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3517);
--   END IF;
-- END;
-- /
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3518;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3518, 96, 1, '查看', '5600-1700-0', '访问明细详情', '数据查询', '5600-1700', '/surlVisitDetail.htm', '查看', 'View', 'L明情', 'Visit Detail', '数据查询', 'Data');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3518);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3518);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3518);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3519;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3519, 96, 1, '查看', '5700-1000-0', '短域名管理', '短域名管理', '5700-1000', '/surl_manage.htm', '查看', 'View', '短域名管理', 'Visit Detail', '短域名管理', 'Data');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3519);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3519);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3519);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3520;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3520, 96, null, '新建', '5700-1000-1', '短域名管理', '短域名管理', '5700-1000', null, '新建', 'Add', '短域名管理', 'Same SMS', '短域名管理', 'Management');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3520);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3520);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3520);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3521;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3521, 96, null, '修改', '5700-1000-3', '短域名管理', '短域名管理', '5700-1000', null, '修改', 'Edit', '短域名管理', 'Same SMS', '短域名管理', 'Management');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3521);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3521);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3521);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3522;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3522, 96, 1, '查看', '5800-1000-0', '链接地址审核', '长链内容审核', '5800-1000', '/surl_audit.htm', '查看', 'View', '接地址核', 'Visit Detail', 'L热核', 'Data');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3522);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3522);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3522);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3523;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3523, 96, 1, '查看', '5700-1200-0', '短链域名绑定', '短域名管理', '5700-1200', '/surl_bind.htm', '查看', 'View', '短域名定', 'Visit Detail', '短域名管理', 'Data');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3523);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3523);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3523);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3524;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3524, 96, null, '新建', '5700-1200-1', '短链域名绑定', '短域名管理', '5700-1200', null, '新建', 'Add', '短域名定', 'Same SMS', '短域名管理', 'Management');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3524);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3524);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3524);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3525;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3525, 96, null, '修改', '5700-1200-3', '短链域名绑定', '短域名管理', '5700-1200', null, '修改', 'Edit', '短域名定', 'Same SMS', '短域名管理', 'Management');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3525);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3525);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3525);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3526;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3526, 96, 1, '查看', '5600-1050-0', '群发任务查看', '数据查询', '5600-1050', '/surl_surlSendedBox.htm', '查看', 'View', '群l任詹榭', 'Task Record', '数据查询', 'Data');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3526);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3526);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3526);
  END IF;
END;
/
-- 创建存储过程 建立访问历史表
CREATE OR REPLACE PROCEDURE CREATEVST_DETAIL(PIYM NUMBER) AUTHID CURRENT_USER
IS
STR VARCHAR2(4000);
TABLENAME VARCHAR2(22);
BEGIN
  TABLENAME:='VST_DETAIL'||CAST(PIYM AS CHAR);
  STR:= 'CREATE TABLE '||TABLENAME||'(
		   ID NUMBER(18) NOT NULL,
		   PTMSGID NUMBER(18) DEFAULT 0 NOT NULL ,
		   VSTMSGID NUMBER(18) DEFAULT 0 NOT NULL ,
		   SID NUMBER(18) DEFAULT 0 NOT NULL,
		   ECID NUMBER(11) DEFAULT 0 NOT NULL,
		   MOBILEAREA NUMBER(11) DEFAULT 0 NOT NULL,
		   WGNO NUMBER(11) DEFAULT 0 NOT NULL,
		   TIMES NUMBER(11) DEFAULT 0 NOT NULL,
		   USERID VARCHAR2(11) DEFAULT('' '') NOT NULL,
		   PHONE VARCHAR2(22) DEFAULT('' '') NOT NULL,
		   PTCODE VARCHAR2(11) DEFAULT('' '') NOT NULL,
		   SRCADDRESS VARCHAR2(64) DEFAULT('' '') NOT NULL,
		   XWAPPROF VARCHAR2(512) DEFAULT('' '') NOT NULL,
		   XBROTYPE VARCHAR2(512) DEFAULT('' '') NOT NULL,
		   DRS VARCHAR2(64) DEFAULT('' '') NOT NULL,
		   CUSTID VARCHAR2(64) DEFAULT('' '') NOT NULL,
		   SURL VARCHAR2(64) DEFAULT('' '') NOT NULL,
		   LURL VARCHAR2(2048) DEFAULT('' '') NOT NULL,
		   HTTPHEADER VARCHAR2(4000) DEFAULT('' '') NOT NULL,
		   EXDATA VARCHAR2(2048) DEFAULT('' '') NOT NULL,
		   SRCPT VARCHAR2(10) DEFAULT('' '') NOT NULL,
		   CTTM TIMESTAMP(6) DEFAULT SYSDATE NOT NULL,
		   VSTTM TIMESTAMP(6) DEFAULT SYSDATE NOT NULL
	)TABLESPACE EMP_TABLESPACE
      PCTFREE 10
      INITRANS 1
      MAXTRANS 255
      STORAGE
      (
        INITIAL 64K
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
      )';
	EXECUTE IMMEDIATE STR;
	STR := 'ALTER TABLE '|| TABLENAME ||' ADD CONSTRAINT PK_'|| TABLENAME ||' PRIMARY KEY (ID)
      USING INDEX
      TABLESPACE EMP_TABLESPACE
      PCTFREE 10
      INITRANS 2
      MAXTRANS 255
      STORAGE
      (
        INITIAL 64K
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
      )';
  EXECUTE IMMEDIATE STR;
	STR := 'CREATE INDEX INDEX_'|| TABLENAME ||'_CUSTID ON '|| TABLENAME ||'(CUSTID)
        TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 2
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
	EXECUTE IMMEDIATE STR;
	STR := 'CREATE INDEX INDEX_'|| TABLENAME ||'_PHONE ON '|| TABLENAME ||'(PHONE)
        TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 2
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
	EXECUTE IMMEDIATE STR;
END;
/
-- 创建三年的历史表(从当前年月开始)
DECLARE
J NUMBER(11);
PIYMFX VARCHAR2(6);
NUM NUMBER(15);
BEGIN
  J:=0;
  WHILE(J < 36)
    LOOP
      PIYMFX := TO_CHAR(ADD_MONTHS(SYSDATE,J),'yyyymm');
        --判断是否存在
        SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'VST_DETAIL'||PIYMFX;
        IF NUM = 0 THEN
          BEGIN
            CREATEVST_DETAIL(PIYMFX);
            -- 创建序列
            ADDSEQUENCEBYNAME('VST_DETAIL'||PIYMFX||'_S');
            -- 创建触发器
            ADDTRIGGERBYNAME('VST_DETAIL'||PIYMFX, 'ID', 'VST_DETAIL'||PIYMFX||'_S');
            DBMS_OUTPUT.PUT_LINE('创建短链历史访问表成功，表名： VST_DETAIL'||PIYMFX);
            COMMIT;
            EXCEPTION
            WHEN OTHERS THEN
              DBMS_OUTPUT.PUT_LINE('创建三年的短链历史访问表失败，insert VST_DETAIL'||PIYMFX||'异常');
              ROLLBACK;
              RETURN;
          END;
        END IF;
      J := J+1;
    END LOOP;
END;
/
-- 增加序列
CALL ADDSEQUENCEBYNAME('LF_URLTASK_S');
CALL ADDSEQUENCEBYNAME('LF_NETURL_S');
CALL ADDSEQUENCEBYNAME('LF_DOMAIN_S');
CALL ADDSEQUENCEBYNAME('LF_SUB_DRAFTS_S');

-- 增加触发器
CALL ADDTRIGGERBYNAME('LF_URLTASK', 'ID', 'LF_URLTASK_S');
CALL ADDTRIGGERBYNAME('LF_NETURL', 'ID', 'LF_NETURL_S');
CALL ADDTRIGGERBYNAME('LF_DOMAIN', 'ID', 'LF_DOMAIN_S');
CALL ADDTRIGGERBYNAME('LF_SUB_DRAFTS', 'ID', 'LF_SUB_DRAFTS_S');
-- 短链相关脚本 end
-- V71.00 -> V71.01 END

-- V71.01 -> V72.01 START
-- 创建LF_THIR_CROP表
DECLARE NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_THIR_CORP';
    IF NUM = 0 THEN
      SQLSTR := 'CREATE TABLE LF_THIR_CORP(
      ID         NUMBER(38) NOT NULL,
      MENU_NUM   NUMBER(15) DEFAULT 0 NOT NULL,
      CORP_CODE  VARCHAR2(64) DEFAULT '' '' NOT NULL
    ) TABLESPACE EMP_TABLESPACE
      PCTFREE 10
      INITRANS 1
      MAXTRANS 255
      STORAGE
      (
        INITIAL 64K
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
      )';
      EXECUTE IMMEDIATE SQLSTR;
      SQLSTR := 'ALTER TABLE LF_THIR_CORP
      ADD CONSTRAINT PK_LF_THIR_CORP PRIMARY KEY (ID)
      USING INDEX
      TABLESPACE EMP_TABLESPACE
      PCTFREE 10
      INITRANS 2
      MAXTRANS 255
      STORAGE
      (
        INITIAL 64K
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
      )';
      EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/


--  创建LF_WEBCONFIG表
DECLARE NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_WEBCONFIG';
    IF NUM = 0 THEN
      SQLSTR := 'CREATE TABLE LF_WEBCONFIG(
        ID         NUMBER(38) NOT NULL,
        CONFIG_NAME   VARCHAR2(255) DEFAULT '' '' NOT NULL,
        JSON_CONFIG  VARCHAR2(2000) DEFAULT '' '' NOT NULL,
        CORP_CODE  VARCHAR2(64) DEFAULT '' '' NOT NULL
      ) TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 1
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
      EXECUTE IMMEDIATE SQLSTR;
      SQLSTR := 'ALTER TABLE LF_WEBCONFIG
        ADD CONSTRAINT PK_LF_WEBCONFIG PRIMARY KEY (ID)
        USING INDEX
        TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 2
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
      EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/

-- 创建企业同步状态表
DECLARE NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_TEMP_SYNCH';
    IF NUM = 0 THEN
      SQLSTR := 'CREATE TABLE LF_TEMP_SYNCH(
          ID         NUMBER(38) NOT NULL,
          SP_TEMPLID    NUMBER(38) DEFAULT NULL,
          COUNT   NUMBER(5) DEFAULT 0 NOT NULL,
          SYNSTATUS  NUMBER(5) DEFAULT 0 NOT NULL,
          ISMATERIAL  NUMBER(5) DEFAULT 0 NOT NULL, -- lf_temp_synch[模板同步状态记录表]添加 ISMATERIAL 字段[是否素材：0-否，1-是]
          CAUSE  VARCHAR2(64) DEFAULT '' '' NOT NULL,
          UPDATE_TIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL
        ) TABLESPACE EMP_TABLESPACE
          PCTFREE 10
          INITRANS 1
          MAXTRANS 255
          STORAGE
          (
            INITIAL 64K
            MINEXTENTS 1
            MAXEXTENTS UNLIMITED
          )';
       EXECUTE IMMEDIATE SQLSTR;
       SQLSTR := 'ALTER TABLE LF_TEMP_SYNCH
          ADD CONSTRAINT PK_LF_TEMP_SYNCH PRIMARY KEY (ID)
          USING INDEX
          TABLESPACE EMP_TABLESPACE
          PCTFREE 10
          INITRANS 2
          MAXTRANS 255
          STORAGE
          (
            INITIAL 64K
            MINEXTENTS 1
            MAXEXTENTS UNLIMITED
          )';
        EXECUTE IMMEDIATE SQLSTR;
        SQLSTR := 'ALTER TABLE LF_TEMP_SYNCH
          ADD CONSTRAINT UN_LF_TEMP_SYNCH_SP_TEMPLID UNIQUE (SP_TEMPLID)
          USING INDEX
          TABLESPACE EMP_TABLESPACE
          PCTFREE 10
          INITRANS 2
          MAXTRANS 255
          STORAGE
          (
            INITIAL 64K
            MINEXTENTS 1
            MAXEXTENTS UNLIMITED
          )';
      EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/

--增加序列
CALL ADDSEQUENCEBYNAME('LF_THIR_CORP_S');
CALL ADDSEQUENCEBYNAME('LF_TEMP_SYNCH_S');
CALL ADDSEQUENCEBYNAME('LF_WEBCONFIG_S');

-- 去掉 模板库 中的新建、复制 按钮权限
DELETE FROM LF_IMPOWER WHERE PRIVILEGE_ID IN(3551,3567);
DELETE FROM LF_PRIVILEGE WHERE PRIVILEGE_ID IN(3551,3567);

-- 添加字段区分账号能力(短信能力、富信能力及彩信能力)
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'USERDATA' AND COLUMN_NAME ='ACCABILITY';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE USERDATA ADD ACCABILITY NUMBER(11) DEFAULT 0 NOT NULL';
        EXECUTE IMMEDIATE 'UPDATE USERDATA SET ACCABILITY = ACCOUNTTYPE';
    END IF;
END;
/

-- LF_URLTASK添加STR_TASKID字段，添加索引和赋值
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_URLTASK' AND COLUMN_NAME ='STR_TASKID';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_URLTASK ADD STR_TASKID VARCHAR2(20) DEFAULT '' '' NOT NULL';
        EXECUTE IMMEDIATE 'CREATE INDEX IX_URLTASK_STRTASKID ON LF_URLTASK(STR_TASKID)';
        EXECUTE IMMEDIATE 'UPDATE LF_URLTASK SET STR_TASKID=TASKID';
    END IF;
END;
/

-- 我的场景增加权限菜单
-- DECLARE NUM NUMBER;
-- BEGIN
--   SELECT COUNT(1) INTO NUM FROM LF_IMPOWER WHERE PRIVILEGE_ID = 3551 ANd ROLE_ID = 1;
--   IF NUM = 0 THEN
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3551);
--   END IF;
-- END;
-- /
-- DECLARE NUM NUMBER;
-- BEGIN
--   SELECT COUNT(1) INTO NUM FROM LF_IMPOWER WHERE PRIVILEGE_ID = 3551 ANd ROLE_ID = 2;
--   IF NUM = 0 THEN
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3551);
--   END IF;
-- END;
-- /
-- 杭州马拉松相关脚本  Start 加了一个菜单两张表
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3553;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES ('3553', '95', '1', '查看', '5100-1850-0', '批量导入模板发送', '数据查询', '5100-1850', '/importTemplateDetails.htm', '查看', 'View', '批量入模板l送', 'Import Temp And Send', '查', 'Data query');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3553);
  END IF;
END;
/

-- 模板导入批次表
DECLARE NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_TEMP_IMPORT_BATCH';
    IF NUM = 0 THEN
      SQLSTR := 'CREATE TABLE LF_TEMP_IMPORT_BATCH(
          ID         NUMBER(38) NOT NULL,
          BATCH   NUMBER(11) DEFAULT 0 NOT NULL,
          CORP_NAME  VARCHAR2(64) DEFAULT '' '' NOT NULL,
          CORP_CODE  VARCHAR2(64) DEFAULT '' '' NOT NULL,
          AMOUNT  NUMBER(20) DEFAULT 0 NOT NULL,
          SUCCESS_AMOUNT  NUMBER(20) DEFAULT 0 NOT NULL,
          FAIL_AMOUNT NUMBER(20) DEFAULT 0 NOT NULL,
          PROCESS_STATUS NUMBER(11) DEFAULT 0 NOT NULL,
          TM_NAME VARCHAR2(64) DEFAULT '' '' NOT NULL,
          ADDTIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL
        ) TABLESPACE EMP_TABLESPACE
          PCTFREE 10
          INITRANS 1
          MAXTRANS 255
          STORAGE
          (
            INITIAL 64K
            MINEXTENTS 1
            MAXEXTENTS UNLIMITED
          )';
       EXECUTE IMMEDIATE SQLSTR;
       SQLSTR := 'ALTER TABLE LF_TEMP_IMPORT_BATCH
          ADD CONSTRAINT PK_LF_TEMP_IMPORT_BATCH PRIMARY KEY (ID)
          USING INDEX
          TABLESPACE EMP_TABLESPACE
          PCTFREE 10
          INITRANS 2
          MAXTRANS 255
          STORAGE
          (
            INITIAL 64K
            MINEXTENTS 1
            MAXEXTENTS UNLIMITED
          )';
      EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/
-- 创建导入详情表
DECLARE NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_TEMP_IMPORT_DETAILS';
    IF NUM = 0 THEN
      SQLSTR := 'CREATE TABLE LF_TEMP_IMPORT_DETAILS(
        ID         NUMBER(38) NOT NULL,
        BATCH   NUMBER(11) DEFAULT 0 NOT NULL,
        TM_NAME  VARCHAR2(64) DEFAULT '' '' NOT NULL,
        CORP_CODE  VARCHAR2(64) DEFAULT '' '' NOT NULL,
        NAME  VARCHAR2(64) DEFAULT '' '' NOT NULL,
        PHONE_NUM  VARCHAR2(64) DEFAULT '' '' NOT NULL,
        SCORE VARCHAR2(64) DEFAULT '' '' NOT NULL,
        SPTEMPLID NUMBER(20),
        SEND_STATUS NUMBER(11) DEFAULT 0 NOT NULL,
        IMPORT_STATUS NUMBER(11) DEFAULT 0 NOT NULL,
        CAUSE VARCHAR2(64) DEFAULT '' '' NOT NULL,
        IMAGE_SRC VARCHAR2(64) DEFAULT '' '' NOT NULL,
        VIDEO_SRC VARCHAR2(64) DEFAULT '' '' NOT NULL,
        ADDTIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL
      ) TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 1
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
        EXECUTE IMMEDIATE SQLSTR;
        SQLSTR := 'ALTER TABLE LF_TEMP_IMPORT_DETAILS
        ADD CONSTRAINT PK_LF_TEMP_IMPORT_DETAILS PRIMARY KEY (ID)
        USING INDEX
        TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 2
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
        EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/
-- 杭州马拉松相关脚本  End

-- LF_TEMPLATE 添加SOURCE 字段[富信模板来源]
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_TEMPLATE' AND COLUMN_NAME ='SOURCE';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMPLATE ADD SOURCE NUMBER(11) DEFAULT 2 NOT NULL';
    END IF;
END;
/
-- LF_SUB_TEMPLATE 修改 ENDJSON 长度
-- DECLARE NUM NUMBER;
-- BEGIN
--     SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_SUB_TEMPLATE' AND COLUMN_NAME ='ENDJSON';
--     IF NUM = 0 THEN
--         EXECUTE IMMEDIATE 'ALTER TABLE LF_SUB_TEMPLATE MODIFY COLUMN ENDJSON BLOB NOT NULL';
--     END IF;
-- END;
-- /

-- LF_SUB_TEMPLATE 添加H5TYPE 字段[H5长页短页]
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_SUB_TEMPLATE' AND COLUMN_NAME ='H5TYPE';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_SUB_TEMPLATE ADD H5TYPE NUMBER(11) DEFAULT 0 NOT NULL';
    END IF;
END;
/
-- LF_SUB_TEMPLATE 添加APP字段[H5封面JSON]
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_SUB_TEMPLATE' AND COLUMN_NAME ='APP';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_SUB_TEMPLATE ADD APP VARCHAR2(3000) DEFAULT '' '' NOT NULL';
    END IF;
END;
/
-- LF_SUB_TEMPLATE 添加H5URL字段[H5生成的HTML服务器地址]
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_SUB_TEMPLATE' AND COLUMN_NAME ='H5URL';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_SUB_TEMPLATE ADD H5URL VARCHAR2(255) DEFAULT '' '' NOT NULL';
    END IF;
END;
/
-- 创建素材表
DECLARE NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_FODDER';
    IF NUM = 0 THEN
        SQLSTR := 'CREATE TABLE LF_FODDER(
          ID         NUMBER(38) NOT NULL,
          USER_ID   NUMBER(18) DEFAULT 0 NOT NULL,
          URL  VARCHAR2(200) DEFAULT '' '' NOT NULL,
          FO_TYPE NUMBER(11) DEFAULT 0 NOT NULL,
          FO_SIZE NUMBER(11) DEFAULT 0 NOT NULL,
          WIDTH NUMBER(11) DEFAULT 0 NOT NULL,
          HEIGHT NUMBER(11) DEFAULT 0 NOT NULL,
          FO_STATUS NUMBER(11) DEFAULT 0 NOT NULL,
          DURATION NUMBER(11) DEFAULT 0 NOT NULL,
          RADIO  VARCHAR2(50) DEFAULT '' '' NOT NULL,
          ORIGINAL VARCHAR2(200) DEFAULT '' '' NOT NULL,
          FIRSTFRAMEPATH  VARCHAR2(64) DEFAULT '' '' NOT NULL
        ) TABLESPACE EMP_TABLESPACE
          PCTFREE 10
          INITRANS 1
          MAXTRANS 255
          STORAGE
          (
            INITIAL 64K
            MINEXTENTS 1
            MAXEXTENTS UNLIMITED
          )';
   EXECUTE IMMEDIATE SQLSTR;
   SQLSTR := 'ALTER TABLE LF_FODDER
  ADD CONSTRAINT PK_LF_FODDER PRIMARY KEY (ID)
  USING INDEX
  TABLESPACE EMP_TABLESPACE
  PCTFREE 10
  INITRANS 2
  MAXTRANS 255
  STORAGE
  (
    INITIAL 64K
    MINEXTENTS 1
    MAXEXTENTS UNLIMITED
  )';
      EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/

DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3554;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3554, 94, NULL, '审核状态', '5100-1300-4', '我的场景', '富信应用', '5100-1300', NULL, '审核状态', 'auth', '我的鼍', 'My scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3554);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3554);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3554);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3555;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3555, 94, NULL, '立即发送', '5100-1300-5', '我的场景', '富信应用', '5100-1300', NULL, '立即发送', 'send', '我的鼍', 'My scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3555);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3555);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3555);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3556;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3556, 94, NULL, '预览', '5100-1300-6', '我的场景', '富信应用', '5100-1300', NULL, '预览', 'preview', '我的鼍', 'My scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3556);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3556);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3556);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3557;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3557, 94, NULL, '复制', '5100-1300-7', '我的场景', '富信应用', '5100-1300', NULL, '复制', 'copy', '我的鼍', 'My scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3557);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3557);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3557);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3558;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3558, 94, NULL, '导出', '5100-1300-8', '我的场景', '富信应用', '5100-1300', NULL, '导出', 'export', '我的鼍', 'My scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3558);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3558);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3558);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3559;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3559, 94, NULL, '详情', '5100-1300-9', '我的场景', '富信应用', '5100-1300', NULL, '详情', 'detail', '我的鼍', 'My scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3559);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3559);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3559);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3560;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3560, 94, NULL, '复制链接', '5100-1300-10', '我的场景', '富信应用', '5100-1300', NULL, '复制链接', 'link', '我的鼍', 'My scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3560);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3560);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3560);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3561;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3561, 94, NULL, '启用禁用', '5100-1300-11', '我的场景', '富信应用', '5100-1300', NULL, '启用禁用', 'state', '我的鼍', 'My scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3561);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3561);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3561);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3562;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3562, 94, NULL, '快捷场景', '5100-1300-12', '我的场景', '富信应用', '5100-1300', NULL, '快捷场景', 'shortSence', '我的鼍', 'My scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3562);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3562);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3562);
  END IF;
END;
/
-- DECLARE NUM NUMBER;
-- BEGIN
--   SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3563;
--   IF NUM = 0 THEN
--       INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--       VALUES (3563, 94, NULL, '行业用途', '5100-1300-13', '我的场景', '富信应用', '5100-1300', NULL, '行业用途', 'industryAnduse', '我的鼍', 'My scene', '富信用', 'Rich Media');
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3563);
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3563);
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3563);
--   END IF;
-- END;
-- /
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3564;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3564, 94, NULL, '审核状态', '5100-1350-4', '模板库', '富信应用', '5100-1350', NULL, '审核状态', 'auth', '模板', 'Common scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3564);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3564);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3564);
  END IF;
END;
/
-- DECLARE NUM NUMBER;
-- BEGIN
--   SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3565;
--   IF NUM = 0 THEN
--       INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--       VALUES (3565, 94, NULL, '立即发送', '5100-1350-5', '模板库', '富信应用', '5100-1350', NULL, '立即发送', 'send', '模板', 'Common scene', '富信用', 'Rich Media');
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3565);
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3565);
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3565);
--   END IF;
-- END;
-- /
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3566;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3566, 94, NULL, '预览', '5100-1350-6', '模板库', '富信应用', '5100-1350', NULL, '预览', 'preview', '模板', 'Common scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3566);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3566);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3566);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3567;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3567, 94, NULL, '复制', '5100-1350-7', '模板库', '富信应用', '5100-1350', NULL, '复制', 'copy', '模板', 'Common scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3567);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3567);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3567);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3568;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3568, 94, NULL, '导出', '5100-1350-8', '模板库', '富信应用', '5100-1350', NULL, '导出', 'export', '模板', 'Common scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3568);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3568);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3568);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3569;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3569, 94, NULL, '详情', '5100-1350-9', '模板库', '富信应用', '5100-1350', NULL, '详情', 'detail', '模板', 'Common scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3569);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3569);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3569);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3570;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3570, 94, NULL, '复制链接', '5100-1350-10', '模板库', '富信应用', '5100-1350', NULL, '复制链接', 'link', '模板', 'Common scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3570);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3570);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3570);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3571;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3571, 94, NULL, '启用禁用', '5100-1350-11', '模板库', '富信应用', '5100-1350', NULL, '启用禁用', 'state', '模板', 'Common scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3571);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3571);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3571);
  END IF;
END;
/
-- DECLARE NUM NUMBER;
-- BEGIN
--   SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3572;
--   IF NUM = 0 THEN
--       INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
--       VALUES (3572, 94, NULL, '快捷场景', '5100-1350-12', '模板库', '富信应用', '5100-1350', NULL, '快捷场景', 'shortSence', '模板', 'Common scene', '富信用', 'Rich Media');
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3572);
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3572);
--       INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3572);
--   END IF;
-- END;
-- /
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3573;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3573, 94, NULL, '行业用途', '5100-1350-13', '模板库', '富信应用', '5100-1350', NULL, '行业用途', 'industryAnduse', '模板', 'Common scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3573);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3573);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3573);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3574;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3574, 94, NULL, '编辑', '5100-1350-3', '模板库', '富信应用', '5100-1350', NULL, '编辑', 'edit', '模板', 'Common scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3574);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3574);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3574);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3575;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3575, 94, NULL, '编辑', '5100-1300-3', '我的场景', '富信应用', '5100-1300', NULL, '编辑', 'edit', '我的鼍', 'My scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3575);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3575);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3575);
  END IF;
END;
/
-- 定制场景菜单
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3576;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3576, 94, '1', '查看', '5100-1351-0', '定制场景', '富信应用', '5100-1351', '/toCorpCustomTpIndex.meditorPage', '查看', 'View', '定制鼍', ' Custom Template', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3576);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3576);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3576);
  END IF;
END;
/
-- 定制场景 按钮权限
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3577;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3577, 94, NULL, '编辑', '5100-1351-3', '定制场景', '富信应用', '5100-1351', NULL, '编辑', 'edit', '定制鼍', 'Custom Template', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3577);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3577);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3577);
  END IF;
END;
/
-- 定制场景 按钮权限
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3578;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3578, 94, NULL, '审核状态', '5100-1351-4', '定制场景', '富信应用', '5100-1351', NULL, '审核状态', 'auth', '定制鼍', ' Custom Template', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3578);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3578);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3578);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3579;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3579, 94, NULL, '立即发送', '5100-1351-5', '定制场景', '富信应用', '5100-1351', NULL, '立即发送', 'send', '定制鼍', ' Custom Template', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3579);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3579);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3579);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3580;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3580, 94, NULL, '预览', '5100-1351-6', '定制场景', '富信应用', '5100-1351', NULL, '预览', 'preview', '定制鼍', ' Custom Template', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3580);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3580);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3580);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3581;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3581, 94, NULL, '复制', '5100-1351-7', '定制场景', '富信应用', '5100-1351', NULL, '复制', 'copy', '定制鼍', ' Custom Template', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3581);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3581);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3581);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3582;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3582, 94, NULL, '导出', '5100-1351-8', '定制场景', '富信应用', '5100-1351', NULL, '导出', 'export', '定制鼍', ' Custom Template', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3582);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3582);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3582);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3583;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3583, 94, NULL, '详情', '5100-1351-9', '定制场景', '富信应用', '5100-1351', NULL, '详情', 'detail', '定制鼍', ' Custom Template', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3583);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3583);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3583);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3584;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3584, 94, NULL, '复制链接', '5100-1351-10', '定制场景', '富信应用', '5100-1351', NULL, '复制链接', 'link', '定制鼍', ' Custom Template', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3584);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3584);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3584);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3586;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3586, 94, NULL, '启用禁用', '5100-1351-11', '定制场景', '富信应用', '5100-1351', NULL, '启用禁用', 'state', '定制鼍', ' Custom Template', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3586);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3586);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3586);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3587;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3587, 94, NULL, '快捷场景', '5100-1351-12', '定制场景', '富信应用', '5100-1351', NULL, '快捷场景', 'shortSence', '定制鼍', ' Custom Template', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3587);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3587);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3587);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3588;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3588, 94, NULL, '模板共享', '5100-1300-13', '我的场景', '富信应用', '5100-1300', NULL, '模板共享', 'templateShare', '我的鼍', 'My scene', '富信用', 'Rich Media');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3588);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3588);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3588);
  END IF;
END;
/
--  模板表 (LF_TEMPLATE)RCOS 平台同步来的模板状态 ISMATERIAL 0―否 ，1-是
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_TEMPLATE' AND COLUMN_NAME ='ISMATERIAL';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMPLATE ADD ISMATERIAL NUMBER(11) DEFAULT 0 NOT NULL';
    END IF;
END;
/
--  模板表 (LF_TEMPLATE) RCOS 平台同步来的公共素材字段 RCOS_TMPSTATE 0―禁用 ，1-启用
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_TEMPLATE' AND COLUMN_NAME ='RCOS_TMPSTATE';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMPLATE ADD RCOS_TMPSTATE NUMBER(11) DEFAULT 1 NOT NULL';
    END IF;
END;
/
-- V71.01 -> V72.01 END

-- V72.01 -> V73.00 START
-- LF_SYSUSER表增加字段SHOWNUM
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_SYSUSER' AND COLUMN_NAME ='SHOWNUM';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_SYSUSER ADD SHOWNUM NUMBER(11) DEFAULT 0 NOT NULL';
    END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 128;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (128, 27, 1, '查看', '1520-1300-0', '系统下行记录导出', '数据查询', '1520-1300', '/que_mtRptRecord.htm', '查看', 'View', '系y下行R出', 'Record export of system MT', '查', 'Data query');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 128);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 128);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 128);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 777;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (777, 10, NULL, '文件导入', '1600-1200-8', '操作员管理', '操作员管理', '1600-1200', NULL, '文件入', 'Import file', '操作T管理', 'Operator', '操作T管理', 'Operator');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 777);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 777);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 777);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 108;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (108, 8, NULL, '文件导入', '1400-1400-4', '业务类型管理', '参数维护', '1400-1400', NULL, '文件入', 'Import file', 'I疹型管理', 'Business type', '稻So', 'Parameter');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 108);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 108);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 108);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 205;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (205, 10, NULL, '文件导入', '1600-1000-4', '机构管理', '操作员管理', '1600-1000', NULL, '文件С', 'Import file', 'C管理', 'Organization', '操作T管理', 'Operator');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 205);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 205);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 205);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 206;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (206, 10, NULL, '导出', '1600-1000-5', '机构管理', '操作员管理', '1600-1000', NULL, 'С', 'Export', 'C管理', 'Organization', '操作T管理', 'Operator');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 206);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 206);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 206);
  END IF;
END;
/
-- 创建导出记录表
DECLARE
NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'A_RPTRECORD';
    IF NUM = 0 THEN
    SQLSTR := 'CREATE TABLE A_RPTRECORD(
  ID         NUMBER(38) NOT NULL,
  FILENAME  VARCHAR2(256) DEFAULT '' '' NOT NULL,
  USERID  VARCHAR2(256) DEFAULT '' '' NOT NULL,
  STATUS  VARCHAR2(2) DEFAULT '' '' NOT NULL,
  CREATETIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,
  GENERATETIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,
  DOWNLOADTIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL
) TABLESPACE EMP_TABLESPACE
  PCTFREE 10
  INITRANS 1
  MAXTRANS 255
  STORAGE
  (
    INITIAL 64K
    MINEXTENTS 1
    MAXEXTENTS UNLIMITED
  )';
   EXECUTE IMMEDIATE SQLSTR;
   SQLSTR := 'ALTER TABLE A_RPTRECORD
  ADD CONSTRAINT PK_A_RPTRECORD PRIMARY KEY (ID)
  USING INDEX
  TABLESPACE EMP_TABLESPACE
  PCTFREE 10
  INITRANS 2
  MAXTRANS 255
  STORAGE
  (
    INITIAL 64K
    MINEXTENTS 1
    MAXEXTENTS UNLIMITED
  )';
  EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/
CALL ADDSEQUENCEBYNAME('A_RPTRECORD_S');

-- 新增状态码映射字段
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_STATECODE' AND COLUMN_NAME ='MAPPING_CODE';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_STATECODE ADD MAPPING_CODE VARCHAR2(64) DEFAULT '' '' NOT NULL';
    END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_UDGROUP' AND COLUMN_NAME ='SHARE_STATUS';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_UDGROUP ADD SHARE_STATUS NUMBER(6) DEFAULT 0 NOT NULL';
    END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_UDGROUP' AND COLUMN_NAME ='CREATETIME';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_UDGROUP ADD CREATETIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL';
    END IF;
END;
/
-- 创建短信黑名单删除记录表
DECLARE
NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'PB_BLACK_DEL';
    IF NUM = 0 THEN
    SQLSTR := 'CREATE TABLE PB_BLACK_DEL(
  ID         NUMBER(11) NOT NULL,
  OPERATEID  VARCHAR2(21) DEFAULT '' '' NOT NULL,
  PHONE  NUMBER(20) DEFAULT 0 NOT NULL,
  OPTTIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,
  TASKID VARCHAR2(40) DEFAULT '' '' NOT NULL
) TABLESPACE EMP_TABLESPACE
  PCTFREE 10
  INITRANS 1
  MAXTRANS 255
  STORAGE
  (
    INITIAL 64K
    MINEXTENTS 1
    MAXEXTENTS UNLIMITED
  )';
   EXECUTE IMMEDIATE SQLSTR;
   SQLSTR := 'ALTER TABLE PB_BLACK_DEL
  ADD CONSTRAINT PK_PB_BLACK_DEL PRIMARY KEY (ID)
  USING INDEX
  TABLESPACE EMP_TABLESPACE
  PCTFREE 10
  INITRANS 2
  MAXTRANS 255
  STORAGE
  (
    INITIAL 64K
    MINEXTENTS 1
    MAXEXTENTS UNLIMITED
  )';
  EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/
CALL ADDSEQUENCEBYNAME('PB_BLACK_DEL_S');
CALL ADDTRIGGERBYNAME('PB_BLACK_DEL', 'ID', 'PB_BLACK_DEL_S');

-- 添加状态码管理权限
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3589;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3589, 8, 1, '新建', '1400-1350-1', '状态码管理', '参数维护', '1400-1350', NULL, '新建', 'Add', 'Ba管理', 'Status code', '稻So', 'Parameter');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3589);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3589);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3589);
  END IF;
END;
/
-- 添加短信黑名单删除记录权限
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3590;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3590, 8, null, '导入', '1400-1350-2', '状态码管理', '参数维护', '1400-1350', NULL, '入', 'Import', 'Ba管理', 'Status code', '稻So', 'Parameter');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3590);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3590);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3590);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3591;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3591, 8, NULL, '下载导入模板', '1400-1350-3', '状态码管理', '参数维护', '1400-1350', NULL, '下d入模板', 'Download import template', 'Ba管理', 'Status code', '稻So', 'Parameter');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3591);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3591);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3591);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3592;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3592, 8,  NULL, '导出', '1400-1350-4', '状态码管理', '参数维护', '1400-1350', NULL, 'С', 'Export', 'Ba管理', 'Status code', '稻So', 'Parameter');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3592);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3592);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3592);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3593;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3593, 6, NULL, '删除记录', '1900-1260-5', '短信黑名单', '信息安全', '1900-1260', NULL, 'h除', 'Delete Record', '短信黑名', 'SMS blacklist', '信息安全', 'Information security');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3593);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3593);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3593);
  END IF;
END;
/
-- 短信是否分批发送
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_CORP_CONF WHERE PARAM_KEY = 'sms.split';
  IF NUM = 0 THEN
    INSERT INTO LF_CORP_CONF(CORP_CODE,PARAM_KEY,PARAM_VALUE) VALUES ('100001','sms.split',0);
  END IF;
END;
/
-- 初始化脚本的时候要求默认显示个性化界面的关于平台、收藏此页、梦网的cright
UPDATE LF_SPEUICFG SET DISPCONTENT='11111000' WHERE CORPCODE = '100001';

-- 增加超大文件相关菜单以及权限
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 707;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (707, 1, 1, '查看', '1050-1250-0', '超大文件导入', '企业短信', '1050-1250', '/ssm_dxzsBigFileExport.htm', '查看', 'View', '超大文件入', 'Big file import', '企I短信', 'Customer service SMS');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 707);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 707);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 707);
  ELSE
      UPDATE LF_PRIVILEGE SET MENUSITE = '/ssm_dxzsBigFileExport.htm' WHERE MENUNAME = '超大文件导入' AND MODNAME = '企业短信';
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 1074;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (1074, 1, NULL, '批量输入', '1050-1000-2', '相同内容群发', '企业短信', '1050-1000', NULL, '批量入', 'Bulk input', '相同热萑喊l', 'Same content', '企I短信', 'Customer service SMS');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 1074);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 1074);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 1074);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 1075;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (1075, 1, NULL, '超大文件', '1050-1000-3', '相同内容群发', '企业短信', '1050-1000', NULL, '超大文件', 'Big file', '相同热萑喊l', 'Same content', '企I短信', 'Customer service SMS');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 1075);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 1075);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 1075);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 706;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (706, 22, 1, '查看', '2300-1450-0', '超大文件导入', '客服短信', '2300-1450', '/ssm_dxkfBigFileExport.htm', '查看', 'View', '超大文件入', 'Big file import', '客服短信', 'Customer service SMS');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 706);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 706);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 706);
  ELSE
      UPDATE LF_PRIVILEGE SET MENUSITE = '/ssm_dxkfBigFileExport.htm' WHERE MENUNAME = '超大文件导入' AND MODNAME = '客服短信';
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 1076;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (1076, 22, NULL, '批量输入', '2300-1100-2', '相同内容群发', '客服短信', '2300-1100', NULL, '批量入', 'Bulk input', '相同热萑喊l', 'Same content', '客服短信', 'Customer service SMS');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 1076);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 1076);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 1076);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 1077;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (1077, 22, NULL, '超大文件', '2300-1100-3', '相同内容群发', '客服短信', '2300-1100', NULL, '超大文件', 'Big file', '相同热萑喊l', 'Same content', '客服短信', 'Customer service SMS');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 1077);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 1077);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 1077);
  END IF;
END;
/
DECLARE NUM NUMBER;
BEGIN
  SELECT COUNT(1) INTO NUM FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 129;
  IF NUM = 0 THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (129, 27, NULL, '批量补发', '1520-1200-1', '系统下行记录', '数据查询', '1520-1200', NULL, '批量al', 'Batch Send', '系y下行', 'MT record', '查', 'Data query');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 129);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 129);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 129);
  END IF;
END;
/
-- 下发完成时间,由网关同步
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_MTTASK' AND COLUMN_NAME ='FINISHTIME';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_MTTASK ADD FINISHTIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL';
    END IF;
END;
/
-- 整理老企业富信新加权限菜单不全
DECLARE
PRIVILEGEID NUMBER(11);
ROLEID NUMBER(11);
NUM NUMBER(11);
--声明游标(利用笛卡尔积获得lf_impower需要插入的数据)
CURSOR corpCursor IS SELECT ROLE_ID,PRIVILEGE_ID FROM(SELECT MIN( ROLE_ID ) ROLE_ID FROM LF_USER2ROLE LEFT JOIN LF_SYSUSER ON LF_USER2ROLE.USER_ID = LF_SYSUSER.USER_ID
WHERE LF_SYSUSER.USER_NAME = 'ADMIN' AND LF_USER2ROLE.ROLE_ID NOT IN ( 1, 2, 3 ) GROUP BY LF_SYSUSER.CORP_CODE ) A,
( SELECT PRIVILEGE_ID FROM LF_PRIVILEGE WHERE PRIVILEGE_ID IN (129, 706, 1074, 1075, 1076, 1077, 707, 3554, 3555, 3556, 3557, 3558, 3559, 3560, 3561, 3562, 3563, 3565, 3566, 3568,
3569, 3570, 3571, 3572, 3573, 3575, 3576, 3577, 3578, 3579, 3580, 3581, 3582, 3583, 3584, 3585, 3586, 3587) ) B;
corp_record corpCursor%ROWTYPE;
BEGIN
  --打开游标 遍历所有的记录
  OPEN corpCursor;
    LOOP
      BEGIN
        FETCH corpCursor INTO corp_record;
        EXIT WHEN corpCursor%NOTFOUND;
          PRIVILEGEID := corp_record.PRIVILEGE_ID;
          ROLEID := corp_record.ROLE_ID;
          IF PRIVILEGEID > 0 AND ROLEID > 0 THEN
              SELECT COUNT(*) INTO NUM FROM LF_IMPOWER WHERE ROLE_ID = ROLEID AND PRIVILEGE_ID = PRIVILEGEID;
              IF NUM = 0 THEN
                INSERT INTO LF_IMPOWER (ROLE_ID,PRIVILEGE_ID) VALUES(ROLEID,PRIVILEGEID);
                COMMIT;
              END IF;
          END IF;
          EXCEPTION
            WHEN OTHERS THEN
              DBMS_OUTPUT.PUT_LINE('整理老企业富信新加权限菜单不全失败，插入数据到LF_IMPOWER表异常');
              ROLLBACK;
      END;
    END LOOP;
  CLOSE corpCursor;
END;
/

-- 创建超大文件表
DECLARE
NUM NUMBER;
SQLSTR VARCHAR2(4000);
BEGIN
    SELECT COUNT(1) INTO NUM FROM USER_TABLES WHERE TABLE_NAME = 'LF_BIGFILE';
    IF NUM = 0 THEN
    SQLSTR := 'CREATE TABLE LF_BIGFILE (
	ID NUMBER(11) NOT NULL,    -- 主键ID(页面上显示“文件批次”)
	FILE_NAME VARCHAR2(64) DEFAULT '' '' NOT NULL,    -- 文件批次名称
	SUB_COUNT NUMBER(20) DEFAULT 0 NOT NULL,    -- 提交总数
	EFF_COUNT NUMBER(20) DEFAULT 0 NOT NULL,    -- 有效号码数
	BLA_COUNT NUMBER(20) DEFAULT 0 NOT NULL,    -- 黑名单数量
	REP_COUNT NUMBER(20) DEFAULT 0 NOT NULL,    -- 重复号码数
	ERR_COUNT NUMBER(20) DEFAULT 0 NOT NULL,    -- 格式错误号码数
	OPR_NUM VARCHAR2(50) DEFAULT '' '' NOT NULL,    -- 按照移动,联通,电信,国际的顺序用英文逗号分隔
	HANDLE_STATUS NUMBER(5) DEFAULT 0 NOT NULL,    -- 1.上传中 2.上传成功(有效号码、黑名单、重复号码、格式错误号码已处理完成) 3.上传失败
	FILE_STATUS NUMBER(5) DEFAULT 0 NOT NULL,    -- 1.启用 2.禁用
	TASKID VARCHAR2(1024) DEFAULT '' '' NOT NULL,    -- 发送过该超大文件的任务号，用逗号分隔
	UPLOAD_NUM NUMBER(11) DEFAULT 0 NOT NULL,    -- 原始上传文件个数
	EFF_NUM NUMBER(11) DEFAULT 0 NOT NULL,    -- 拆分出来的有效号码文件个数
	HANDLE_NODE VARCHAR2(50) DEFAULT '' '' NOT NULL,    -- 上传WEB节点
	USERID NUMBER(20) DEFAULT 0 NOT NULL,    -- 操作员ID
	USER_NAME VARCHAR2(64) DEFAULT '' '' NOT NULL,    -- 操作员名称
	BUS_ID NUMBER(20) DEFAULT 0 NOT NULL,    -- 业务类型ID
	BUS_NAME VARCHAR2(32) DEFAULT '' '' NOT NULL,    -- 业务名称
	BUS_CODE VARCHAR2(64) DEFAULT '' '' NOT NULL,    -- 业务编码
	DEP_ID NUMBER(20) DEFAULT 0 NOT NULL,    -- 机构ID
	CREATE_TIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,    -- 上传时间
	UPDATE_TIME TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,    -- 修改时间
	FILE_URL VARCHAR2(512) DEFAULT '' '' NOT NULL,    -- 有效拆分文件1
	FILE_URL2 VARCHAR2(512) DEFAULT '' '' NOT NULL,    -- 有效拆分文件2
	FILE_URL3 VARCHAR2(512) DEFAULT '' '' NOT NULL,    -- 有效拆分文件3
	FILE_URL4 VARCHAR2(512) DEFAULT '' '' NOT NULL,    -- 有效拆分文件4
	FILE_URL5 VARCHAR2(512) DEFAULT '' '' NOT NULL,    -- 有效拆分文件5
	FILE_URL6 VARCHAR2(512) DEFAULT '' '' NOT NULL,    -- 有效拆分文件6
	FILE_URL7 VARCHAR2(512) DEFAULT '' '' NOT NULL,    -- 有效拆分文件7
	FILE_URL8 VARCHAR2(512) DEFAULT '' '' NOT NULL,    -- 有效拆分文件8
	FILE_URL9 VARCHAR2(512) DEFAULT '' '' NOT NULL,    -- 有效拆分文件9
	VIEW_URL VARCHAR2(512) DEFAULT '' '' NOT NULL,    -- 预览号码文件路径(只预览10个号码)
	BAD_URL VARCHAR2(512) DEFAULT '' '' NOT NULL,    -- 错误号码文件路径（黑名单、重复号码、格式错误）
	CORP_CODE VARCHAR2(64) DEFAULT '' '' NOT NULL,    -- 企业编码
	REMARK VARCHAR2(512) DEFAULT '' '' NOT NULL
) TABLESPACE EMP_TABLESPACE
  PCTFREE 10
  INITRANS 1
  MAXTRANS 255
  STORAGE
  (
    INITIAL 64K
    MINEXTENTS 1
    MAXEXTENTS UNLIMITED
  )';
   EXECUTE IMMEDIATE SQLSTR;
   SQLSTR := 'ALTER TABLE LF_BIGFILE
  ADD CONSTRAINT PK_LF_BIGFILE PRIMARY KEY (ID)
  USING INDEX
  TABLESPACE EMP_TABLESPACE
  PCTFREE 10
  INITRANS 2
  MAXTRANS 255
  STORAGE
  (
    INITIAL 64K
    MINEXTENTS 1
    MAXEXTENTS UNLIMITED
  )';
  EXECUTE IMMEDIATE SQLSTR;
  SQLSTR := 'CREATE INDEX INDEX_LF_BIGFILE_USERID ON LF_BIGFILE (USERID)
        TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 2
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
  EXECUTE IMMEDIATE SQLSTR;
  SQLSTR := 'CREATE INDEX INDEX_LF_BIGFILE_DEP_ID ON LF_BIGFILE (DEP_ID)
        TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 2
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
  EXECUTE IMMEDIATE SQLSTR;
  SQLSTR := 'CREATE INDEX INDEX_LF_BIGFILE_CORP_CODE ON LF_BIGFILE (CORP_CODE)
        TABLESPACE EMP_TABLESPACE
        PCTFREE 10
        INITRANS 2
        MAXTRANS 255
        STORAGE
        (
          INITIAL 64K
          MINEXTENTS 1
          MAXEXTENTS UNLIMITED
        )';
  EXECUTE IMMEDIATE SQLSTR;
    END IF;
END;
/

CALL ADDSEQUENCEBYNAME('LF_BIGFILE_S');

-- 短信发送任务进度条增加字段
-- 下发手机号码数
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_MTTASK' AND COLUMN_NAME ='PHONENUM';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_MTTASK ADD PHONENUM NUMBER(11) DEFAULT -1 NOT NULL';
    END IF;
END;
/
-- 已下发信息数
DECLARE NUM NUMBER;
BEGIN
    SELECT COUNT(1) INTO NUM FROM COLS WHERE TABLE_NAME = 'LF_MTTASK' AND COLUMN_NAME ='SENDNUM';
    IF NUM = 0 THEN
        EXECUTE IMMEDIATE 'ALTER TABLE LF_MTTASK ADD SENDNUM NUMBER(11) DEFAULT -1 NOT NULL';
    END IF;
END;
/
-- 删除LF_PROCESS无用初始化数据
DELETE FROM LF_PROCESS WHERE PR_ID IN (5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19);
COMMIT;
/

-- 增加网关相关脚本
CREATE OR REPLACE PROCEDURE GW_UPLFMTTASK_P1
(
  PITASKID IN NUMBER,
  PIPHONENUM IN NUMBER,
  PISENDNUM IN NUMBER
 )
AS
BEGIN
	IF PIPHONENUM<>0 THEN
	UPDATE LF_MTTASK SET PHONENUM=PIPHONENUM,SENDNUM=SENDNUM+PISENDNUM,FINISHTIME=systimestamp WHERE TASKID=PITASKID;
	ELSE
	UPDATE LF_MTTASK SET SENDNUM=SENDNUM+PISENDNUM,FINISHTIME=systimestamp WHERE TASKID=PITASKID;
	END IF;
END;
/

-- 删除存储过程
DROP PROCEDURE ADDSEQUENCEBYNAME;
DROP PROCEDURE ADDTRIGGERBYNAME;

-- V72.01 -> V73.00 END
/*EMP升级脚本    END*/

--增加版本信息--
DECLARE COUNTNUM INT;
        VERSIONSTR VARCHAR2(32);
        DBVERSIONSTR VARCHAR2(32);
        WBSVERSIONSTR VARCHAR2(32);
        SPGATEVERSIONSTR VARCHAR2(32);
        NUMNO INT;
        TOTALINT INT;
BEGIN
    VERSIONSTR:='7.3.0.515';
    DBVERSIONSTR:='73.00';
    WBSVERSIONSTR:='8.6.1.216';
    SPGATEVERSIONSTR:='6.1.50.342';
  NUMNO:=1;
  TOTALINT:=1;
  --EMP产品版本记录
  SELECT COUNT(*) INTO COUNTNUM FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000;
  IF COUNTNUM=0 THEN
   --EMP-WEB
   INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
   VALUES(1000,1000,VERSIONSTR,SYSDATE,SYSDATE,'EMP-WEB');
  ELSE
    UPDATE LF_VERSION SET UPDATETIME=SYSDATE,VERSION=VERSIONSTR WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000;
  END IF;
  COMMIT;
  SELECT COUNT(*) INTO COUNTNUM FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000;
  IF COUNTNUM=0 THEN
   --EMP_GATEWARY
   INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
   VALUES(1000,2000,WBSVERSIONSTR,SYSDATE,SYSDATE,'EMP_GATEWARY');
  ELSE
    UPDATE LF_VERSION SET UPDATETIME=SYSDATE,VERSION=WBSVERSIONSTR WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000;
  END IF;
  COMMIT;
  SELECT COUNT(*) INTO COUNTNUM FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000;
  IF COUNTNUM=0 THEN
   --SMT_SPGATE
   INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
   VALUES(1000,3000,SPGATEVERSIONSTR,SYSDATE,SYSDATE,'SMT_SPGATE');
  ELSE
    UPDATE LF_VERSION SET UPDATETIME=SYSDATE,VERSION=SPGATEVERSIONSTR WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000;
  END IF;
  COMMIT;

  --EMP产品版本历史记录
  SELECT COUNT(*) INTO COUNTNUM FROM LF_VERSION_HIS WHERE VERSION=VERSIONSTR AND PRODUCT_ID=1000 AND PROCESS_ID=1000;
  IF COUNTNUM=0 THEN
    --EMP-WEB
    INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO,ISRELEASE,VERSIONINFO)
    VALUES(1000,1000,VERSIONSTR,SYSDATE,SYSDATE,'EMP-WEB',1,'1.优化代码');
  ELSE
    UPDATE LF_VERSION_HIS SET UPDATETIME=SYSDATE,ISRELEASE=1,VERSIONINFO='1.优化代码' WHERE VERSION=VERSIONSTR AND PRODUCT_ID=1000 AND PROCESS_ID=1000;
  END IF;
  COMMIT;

  SELECT COUNT(*) INTO COUNTNUM FROM LF_VERSION_HIS WHERE VERSION=WBSVERSIONSTR AND PRODUCT_ID=1000 AND PROCESS_ID=2000;
  IF COUNTNUM=0 THEN
    --EMP_GATEWARY 
    INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
    VALUES(1000,2000,WBSVERSIONSTR,SYSDATE,SYSDATE,'EMP_GATEWARY');
  ELSE
    UPDATE LF_VERSION_HIS SET UPDATETIME=SYSDATE WHERE VERSION=WBSVERSIONSTR AND PRODUCT_ID=1000 AND PROCESS_ID=2000;
  END IF;
  COMMIT;

  SELECT COUNT(*) INTO COUNTNUM FROM LF_VERSION_HIS WHERE VERSION=SPGATEVERSIONSTR AND PRODUCT_ID=1000 AND PROCESS_ID=3000;
  IF COUNTNUM=0 THEN
    --SMT_SPGATE
    INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
    VALUES(1000,3000,SPGATEVERSIONSTR,SYSDATE,SYSDATE,'SMT_SPGATE');
  ELSE
    UPDATE LF_VERSION_HIS SET UPDATETIME=SYSDATE WHERE VERSION=SPGATEVERSIONSTR AND PRODUCT_ID=1000 AND PROCESS_ID=3000;
  END IF;
  COMMIT;

  SELECT COUNT(*) INTO COUNTNUM FROM LF_DB_SCRIPT WHERE VERSION=DBVERSIONSTR;
  IF COUNTNUM=0 THEN
    --EMP产品数据库版本信息表
    INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
    VALUES(DBVERSIONSTR,SYSDATE,SYSDATE,NUMNO,TOTALINT,2,'网关包更改');
  ELSE
    UPDATE LF_DB_SCRIPT SET STATE=2,UPDATETIME=SYSDATE WHERE  VERSION=DBVERSIONSTR AND CURRENT_NO=NUMNO AND TOTAL=TOTALINT;
  END IF;
  COMMIT;
END;
/

CREATE OR REPLACE PROCEDURE COMPILE_PROCEDURE
AS
  V_SQL VARCHAR2(2000);
BEGIN
  FOR V IN (SELECT * FROM USER_OBJECTS WHERE OBJECT_TYPE IN ('PROCEDURE','TRIGGER') AND STATUS='INVALID' AND OBJECT_NAME NOT LIKE '%BIN$%')
    LOOP
      BEGIN
        V_SQL:= 'ALTER  '||V.OBJECT_TYPE||' '|| V.OBJECT_NAME||' COMPILE';
        EXECUTE IMMEDIATE V_SQL;
        EXCEPTION
          WHEN OTHERS THEN
          DBMS_OUTPUT.PUT_LINE('执行异常');
          CONTINUE;
      END;
    END LOOP;
END;
/
--重新编译所有存储过程和触发器
CALL COMPILE_PROCEDURE();
/
-----------V71.00-V73.00 END------------------------