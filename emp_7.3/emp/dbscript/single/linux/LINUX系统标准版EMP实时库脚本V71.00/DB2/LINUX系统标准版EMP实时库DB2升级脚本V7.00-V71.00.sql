-----------V6.17-V6.18START------------------------
CREATE PROCEDURE "ADDVERSIONEXISTS"
  BEGIN ATOMIC
    DECLARE DBVERSION VARCHAR(32);
    DECLARE NUM INT;
    DECLARE TOTAL INT;
    SET DBVERSION = '71.00';
    SET NUM =1;
    SET TOTAL=1;
    IF NOT EXISTS(SELECT * FROM LF_DB_SCRIPT WHERE VERSION=DBVERSION) THEN
      --EMP产品数据库版本信息表
      INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
      VALUES(DBVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,NUM,TOTAL,1,'LINUX版本脚本整合');
    END IF;
  END;
CALL ADDVERSIONEXISTS;
DROP PROCEDURE ADDVERSIONEXISTS;

/*EMP升级脚本START*/
--LF_SYSUSER新增语言设置字段
CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_SYSUSER ADD LANGUAGE_CODE VARCHAR(10) NOT NULL DEFAULT';
    IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_SYSUSER' AND COLNAME ='LANGUAGE_CODE') THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_SYSUSER;
--LF_PRIVILEGE新增字段 START--------
CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_PRIVILEGE ADD ZH_TW_COMMENTS VARCHAR(512) NOT NULL DEFAULT';
    IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_PRIVILEGE' AND COLNAME ='ZH_TW_COMMENTS')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_PRIVILEGE;

CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_PRIVILEGE ADD ZH_HK_COMMENTS VARCHAR(512) NOT NULL DEFAULT';
    IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_PRIVILEGE' AND COLNAME ='ZH_HK_COMMENTS')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_PRIVILEGE;

CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_PRIVILEGE ADD ZH_TW_MENUNAME VARCHAR(64) NOT NULL DEFAULT';
    IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_PRIVILEGE' AND COLNAME ='ZH_TW_MENUNAME')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_PRIVILEGE;

CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_PRIVILEGE ADD ZH_HK_MENUNAME VARCHAR(64) NOT NULL DEFAULT';
    IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_PRIVILEGE' AND COLNAME ='ZH_HK_MENUNAME')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_PRIVILEGE;

CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_PRIVILEGE ADD ZH_TW_MODNAME VARCHAR(64) NOT NULL DEFAULT';
    IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_PRIVILEGE' AND COLNAME ='ZH_TW_MODNAME')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_PRIVILEGE;

CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_PRIVILEGE ADD ZH_HK_MODNAME VARCHAR(64) NOT NULL DEFAULT';
    IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_PRIVILEGE' AND COLNAME ='ZH_HK_MODNAME')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_PRIVILEGE;
--LF_PRIVILEGE新增字段 END--------

--LF_THIR_MENUCONTROL新增字段START-----
CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_THIR_MENUCONTROL ADD ZH_TW_TITLE VARCHAR(32) NOT NULL DEFAULT';
    IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_THIR_MENUCONTROL' AND COLNAME ='ZH_TW_TITLE')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_THIR_MENUCONTROL;

CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_THIR_MENUCONTROL ADD ZH_HK_TITLE VARCHAR(32) NOT NULL DEFAULT';
    IF NOT EXISTS (SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_THIR_MENUCONTROL' AND COLNAME ='ZH_HK_TITLE')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_THIR_MENUCONTROL;
--LF_THIR_MENUCONTROL新增字段END-----

--更新运营商号段START--
DELETE FROM PB_SERVICETYPE;
INSERT INTO PB_SERVICETYPE (SPISUNCM, SERVICENO, SERVICEINFO)
VALUES (0, '134,135,136,137,138,139,147,150,151,158,159,157,154,152,178,188,187,182,183,184,1705,1703,1706,198', '移动');
INSERT INTO PB_SERVICETYPE (SPISUNCM, SERVICENO, SERVICEINFO)
VALUES (1, '130,131,132,145,155,156,166,185,186,175,176,1707,1708,1709,1713,1715,1716,1717,1718,1719,1712,1704', '联通');
INSERT INTO PB_SERVICETYPE (SPISUNCM, SERVICENO, SERVICEINFO)
VALUES (21, '133,153,189,180,181,1700,177,173,1701,1702,199', '电信');
--END--

--模块菜单英文翻译
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '企IAPP',ZH_HK_TITLE = 'App' WHERE TITLE = '企业APP';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '移I',ZH_HK_TITLE = 'Mobile Business' WHERE TITLE = '移动业务';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '查y',ZH_HK_TITLE = 'Statistics' WHERE TITLE = '查询统计';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '移愚k公',ZH_HK_TITLE = 'Mobile Office' WHERE TITLE = '移动办公';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '移硬视',ZH_HK_TITLE = 'MMS' WHERE TITLE = '移动彩讯';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '移泳W',ZH_HK_TITLE = 'SMS & Wap' WHERE TITLE = '移动网讯';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '在座席',ZH_HK_TITLE = 'Online Seating' WHERE TITLE = '在线座席';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '通信管理',ZH_HK_TITLE = 'Communication' WHERE TITLE = '通信管理';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '系y管理',ZH_HK_TITLE = 'System Management' WHERE TITLE = '系统管理';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '移涌头',ZH_HK_TITLE = 'Mobile Service' WHERE TITLE = '移动客服';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '企I微信',ZH_HK_TITLE = 'WeChat' WHERE TITLE = '企业微信';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '智能引擎',ZH_HK_TITLE = 'Intelligent Engine' WHERE TITLE = '智能引擎';
UPDATE LF_THIR_MENUCONTROL SET ZH_TW_TITLE = '系yO控',ZH_HK_TITLE = 'Monitor' WHERE TITLE = '系统监控';


--更新MODNAME菜单--
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '在座席',ZH_HK_MODNAME = 'Online Seating' WHERE MODNAME = '在线座席';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '操作T管理',ZH_HK_MODNAME = 'Operator' WHERE MODNAME = '操作员管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'WP後端配置',ZH_HK_MODNAME = 'Gateway backend' WHERE MODNAME = '网关后端配置';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '完美通知',ZH_HK_MODNAME = 'Perfect notice' WHERE MODNAME = '完美通知';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'y蟊',ZH_HK_MODNAME = 'Statistical report' WHERE MODNAME = '统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'WjO控',ZH_HK_MODNAME = 'Network monitor' WHERE MODNAME = '网络监控';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '群l管理',ZH_HK_MODNAME = 'Group sending' WHERE MODNAME = '群发管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'I展芾',ZH_HK_MODNAME = 'Business' WHERE MODNAME = '业务管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'T工生日祝福',ZH_HK_MODNAME = 'Staff wishes' WHERE MODNAME = '员工生日祝福';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'W查y',ZH_HK_MODNAME = 'Query statistics' WHERE MODNAME = '网讯查询统计';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'I',ZH_HK_MODNAME = 'Business data' WHERE MODNAME = '业务数据';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '信息l布',ZH_HK_MODNAME = 'Information release' WHERE MODNAME = '信息发布';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '基A',ZH_HK_MODNAME = 'Basic data' WHERE MODNAME = '基础数据';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'T工通管理',ZH_HK_MODNAME = 'Staff address book' WHERE MODNAME = '员工通讯录管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'WP前端配置',ZH_HK_MODNAME = 'Gateway front end' WHERE MODNAME = '网关前端配置';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '稻So',ZH_HK_MODNAME = 'Parameter' WHERE MODNAME = '参数维护';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '信息安全',ZH_HK_MODNAME = 'Information security' WHERE MODNAME = '信息安全';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'O控管理',ZH_HK_MODNAME = 'Monitor setting' WHERE MODNAME = '监控管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'W管理',ZH_HK_MODNAME = 'SMS & Wap' WHERE MODNAME = '网讯管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'O控情',ZH_HK_MODNAME = 'Monitoring detail' WHERE MODNAME = '监控详情';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'W管理',ZH_HK_MODNAME = 'DTU' WHERE MODNAME = '网优管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '短信助手',ZH_HK_MODNAME = 'SMS Assistant' WHERE MODNAME = '短信助手';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'sM查',ZH_HK_MODNAME = 'Signed billing query' WHERE MODNAME = '签约计费查询';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'WP\行O控',ZH_HK_MODNAME = 'Gateway operation monitor' WHERE MODNAME = '网关运行监控';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '客服短信',ZH_HK_MODNAME = 'Customer service SMS' WHERE MODNAME = '客服短信';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '企I微信',ZH_HK_MODNAME = 'WeChat' WHERE MODNAME = '企业微信';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '客羯日祝福',ZH_HK_MODNAME = 'Customer wishes' WHERE MODNAME = '客户生日祝福';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '用艄芾',ZH_HK_MODNAME = 'Subscriber' WHERE MODNAME = '用户管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'O控D',ZH_HK_MODNAME = 'Monitor view' WHERE MODNAME = '监控视图';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'ぬ管理',ZH_HK_MODNAME = 'Account' WHERE MODNAME = '帐号管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '移迂',ZH_HK_MODNAME = 'Mobile finance' WHERE MODNAME = '移动财务';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '客服管理',ZH_HK_MODNAME = 'Customer service' WHERE MODNAME = '客服管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '公告',ZH_HK_MODNAME = 'Notice' WHERE MODNAME = '公告';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '客敉ㄓ管理',ZH_HK_MODNAME = 'Customer address book' WHERE MODNAME = '客户通讯录管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'Wl送',ZH_HK_MODNAME = 'SMS & Wap sending' WHERE MODNAME = '网讯发送';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '微站管理',ZH_HK_MODNAME = 'Micro station' WHERE MODNAME = '微站管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '客服系y',ZH_HK_MODNAME = 'Customer service system' WHERE MODNAME = '客服系统';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '查',ZH_HK_MODNAME = 'Data query' WHERE MODNAME = '数据查询';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = 'sy蟊',ZH_HK_MODNAME = 'Signed statistic' WHERE MODNAME = '签约统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '批管理',ZH_HK_MODNAME = 'Approval' WHERE MODNAME = '审批管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '企I短信',ZH_HK_MODNAME = 'Customer service SMS' WHERE MODNAME = '企业短信';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '彩信用',ZH_HK_MODNAME = 'MMS application' WHERE MODNAME = '彩信应用';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '分析',ZH_HK_MODNAME = 'Data analysis' WHERE MODNAME = '数据分析';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '热莼凸芾',ZH_HK_MODNAME = 'Content reply' WHERE MODNAME = '内容回复管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '企I管理',ZH_HK_MODNAME = 'Enterprise management' WHERE MODNAME = '企业管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MODNAME = '移油镀',ZH_HK_MODNAME = 'Mobile voting' WHERE MODNAME = '移动投票';

--更新MENUNAME菜单--
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I瞻管理',ZH_HK_MENUNAME = 'Business package' WHERE MENUNAME = '业务包管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '角色O置',ZH_HK_MENUNAME = 'Role' WHERE MENUNAME = '角色设置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '操作T角色管理',ZH_HK_MENUNAME = 'Operator role management' WHERE MENUNAME = '操作员角色管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '彩信素材',ZH_HK_MENUNAME = 'MMS material' WHERE MENUNAME = '彩信素材';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '客舨煌热莅l送',ZH_HK_MENUNAME = 'Different content' WHERE MENUNAME = '客户不同内容发送';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '彩信批',ZH_HK_MENUNAME = 'MMS approval' WHERE MENUNAME = '彩信审批';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '模K蹬渲',ZH_HK_MENUNAME = 'Module parameter' WHERE MENUNAME = '模块参数配置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '短信留',ZH_HK_MENUNAME = 'SMS delay record' WHERE MENUNAME = '短信滞留记录';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '上行I沼',ZH_HK_MENUNAME = 'MO service record' WHERE MENUNAME = '上行业务记录';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I毡O控O置',ZH_HK_MENUNAME = 'Business monitor' WHERE MENUNAME = '业务监控设置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '^域段管理',ZH_HK_MENUNAME = 'Zone No. Segment' WHERE MENUNAME = '区域号段管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '群l任詹榭',ZH_HK_MENUNAME = 'Task view' WHERE MENUNAME = '群发任务查看';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'W素材',ZH_HK_MENUNAME = 'Wap material' WHERE MENUNAME = '网讯素材';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '卷管理',ZH_HK_MENUNAME = 'Questionnaire management' WHERE MENUNAME = '问卷管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '地理位置窦',ZH_HK_MENUNAME = 'Location collection' WHERE MENUNAME = '地理位置采集';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '微信P注列表',ZH_HK_MENUNAME = 'WeChat focus list' WHERE MENUNAME = '微信关注列表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '在用翟O置',ZH_HK_MENUNAME = 'Number of online users' WHERE MENUNAME = '在线用户数设置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '微信群lv史',ZH_HK_MENUNAME = 'Sending history' WHERE MENUNAME = '微信群发历史';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '客服列表',ZH_HK_MENUNAME = 'Customer service list' WHERE MENUNAME = '客服列表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I仗撞陀My',ZH_HK_MENUNAME = 'Business plan billing' WHERE MENUNAME = '业务套餐计费统计';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '人收件箱',ZH_HK_MENUNAME = 'Personal inbox' WHERE MENUNAME = '个人收件箱';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'APPl送任詹樵',ZH_HK_MENUNAME = 'Task query' WHERE MENUNAME = 'APP发送任务查询';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I仗撞凸芾',ZH_HK_MENUNAME = 'Business plan' WHERE MENUNAME = '业务套餐管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '套餐指令O置',ZH_HK_MENUNAME = 'Plan instruction' WHERE MENUNAME = '套餐指令设置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '短信模板管理',ZH_HK_MENUNAME = 'SMS template' WHERE MENUNAME = '短信模板管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '模板',ZH_HK_MENUNAME = 'Template' WHERE MENUNAME = '模板编辑';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '尾管理',ZH_HK_MENUNAME = 'Tail number' WHERE MENUNAME = '尾号管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '投票管理',ZH_HK_MENUNAME = 'Voting management' WHERE MENUNAME = '投票管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '^域y蟊',ZH_HK_MENUNAME = 'Zone statistics' WHERE MENUNAME = '区域统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '公ぬ管理',ZH_HK_MENUNAME = 'Official accounts' WHERE MENUNAME = '公众帐号管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '接入~查看嘞',ZH_HK_MENUNAME = 'Access permission' WHERE MENUNAME = '接入账号查看权限';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'W',ZH_HK_MENUNAME = 'SMS & Wap Edit' WHERE MENUNAME = '网讯编辑';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '互禹管理',ZH_HK_MENUNAME = 'Interactive item' WHERE MENUNAME = '互动项管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'W模板',ZH_HK_MENUNAME = 'Wap template' WHERE MENUNAME = '网讯模板';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'W核',ZH_HK_MENUNAME = 'Wap audit' WHERE MENUNAME = '网讯审核';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'SP~O控情',ZH_HK_MENUNAME = 'SP account monitor' WHERE MENUNAME = 'SP账号监控详情';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'W下行',ZH_HK_MENUNAME = 'DTU MT record' WHERE MENUNAME = '网优下行记录';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'yDWe`代a',ZH_HK_MENUNAME = 'MNP Error code' WHERE MENUNAME = '携号转网错误代码';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '用傩',ZH_HK_MENUNAME = 'Subscriber attribute' WHERE MENUNAME = '用户属性';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I核',ZH_HK_MENUNAME = 'Business audit' WHERE MENUNAME = '业务审核';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '通道\行蹬渲',ZH_HK_MENUNAME = 'Channel parameter' WHERE MENUNAME = '通道运行参数配置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '箐N提醒',ZH_HK_MENUNAME = 'Reimbursement' WHERE MENUNAME = '报销提醒';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '定r信息查看',ZH_HK_MENUNAME = 'Timing task' WHERE MENUNAME = '定时信息查看';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'SP~O控',ZH_HK_MENUNAME = 'SP account monitor' WHERE MENUNAME = 'SP账号监控';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '投票y',ZH_HK_MENUNAME = 'Voting statistics' WHERE MENUNAME = '投票统计';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '批流程管理',ZH_HK_MENUNAME = 'Approval Flow' WHERE MENUNAME = '审批流程管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'APP首l布',ZH_HK_MENUNAME = 'Homepage release' WHERE MENUNAME = 'APP首页发布';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I召N尾管理',ZH_HK_MENUNAME = 'Business tail management' WHERE MENUNAME = '业务贴尾管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '通道~O控',ZH_HK_MENUNAME = 'Channel account monitor' WHERE MENUNAME = '通道账号监控';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '\I商段管理',ZH_HK_MENUNAME = 'Number Segment' WHERE MENUNAME = '运营商号段管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '~舫渲/回收',ZH_HK_MENUNAME = 'Account recharge/retrieve' WHERE MENUNAME = '账户充值/回收';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'WP\行蹬渲',ZH_HK_MENUNAME = 'Gateway parameter' WHERE MENUNAME = '网关运行参数配置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '自定x通',ZH_HK_MENUNAME = 'Custom address book' WHERE MENUNAME = '自定义通讯录';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '企I管理',ZH_HK_MENUNAME = 'Business management' WHERE MENUNAME = '企业管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '操作Ty蟊',ZH_HK_MENUNAME = 'Operator statistics' WHERE MENUNAME = '操作员统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '彩信SP~',ZH_HK_MENUNAME = 'MMS SP account' WHERE MENUNAME = '彩信SP账户';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '企I快快伟l',ZH_HK_MENUNAME = 'Enterprise fast single' WHERE MENUNAME = '企业快快单发';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'T工C管理',ZH_HK_MENUNAME = 'Staff organization' WHERE MENUNAME = '员工机构管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '回凸芾',ZH_HK_MENUNAME = 'Reply management' WHERE MENUNAME = '回复管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'r告警情',ZH_HK_MENUNAME = 'Real-time alarm' WHERE MENUNAME = '实时告警详情';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '家代a管理',ZH_HK_MENUNAME = 'Country code' WHERE MENUNAME = '国家代码管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'P注回',ZH_HK_MENUNAME = 'Subscription reply' WHERE MENUNAME = '关注回复';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'l送任詹榭',ZH_HK_MENUNAME = 'Task view' WHERE MENUNAME = '发送任务查看';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '手Ca可',ZH_HK_MENUNAME = 'Phone visible' WHERE MENUNAME = '手机号码可见';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'Wy蟊',ZH_HK_MENUNAME = 'DTU statistics' WHERE MENUNAME = '网优统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '程序O控情',ZH_HK_MENUNAME = 'Program monitor' WHERE MENUNAME = '程序监控详情';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'APPl送查',ZH_HK_MENUNAME = 'Record query' WHERE MENUNAME = 'APP发送记录查询';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '操作日I',ZH_HK_MENUNAME = 'Operation log' WHERE MENUNAME = '操作日志';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'SP~艚定',ZH_HK_MENUNAME = 'SP account binding' WHERE MENUNAME = 'SP账户绑定';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '公告列表',ZH_HK_MENUNAME = 'Notice list' WHERE MENUNAME = '公告列表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'APP企Iぬ管理',ZH_HK_MENUNAME = 'Enterprise account' WHERE MENUNAME = 'APP企业帐号管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '客艉s管理',ZH_HK_MENUNAME = 'Customer contract' WHERE MENUNAME = '客户签约管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'CMy',ZH_HK_MENUNAME = 'Organization billing' WHERE MENUNAME = '机构计费统计';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '短彩SP~',ZH_HK_MENUNAME = 'SP account' WHERE MENUNAME = '短彩SP账户';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '通道~艄芾',ZH_HK_MENUNAME = 'Channel account' WHERE MENUNAME = '通道账户管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '客敉ㄓ',ZH_HK_MENUNAME = 'Customer address book' WHERE MENUNAME = '客户通讯录';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '子工Y',ZH_HK_MENUNAME = 'Electronic payroll' WHERE MENUNAME = '电子工资单';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'oB彩信l送',ZH_HK_MENUNAME = 'Static MMS' WHERE MENUNAME = '静态彩信发送';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '自定倒芾',ZH_HK_MENUNAME = 'Custom parameter' WHERE MENUNAME = '自定参数管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '相同热萑喊l',ZH_HK_MENUNAME = 'Same content' WHERE MENUNAME = '相同内容群发';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'SP~y蟊',ZH_HK_MENUNAME = 'SP account statistics' WHERE MENUNAME = 'SP账号统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'l送v史查',ZH_HK_MENUNAME = 'History query' WHERE MENUNAME = '发送历史查询';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'W回徒y',ZH_HK_MENUNAME = 'Reply statistics' WHERE MENUNAME = '网讯回复统计';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '程序O控O置',ZH_HK_MENUNAME = 'Program monitor' WHERE MENUNAME = '程序监控设置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'W通道管理',ZH_HK_MENUNAME = 'Channel' WHERE MENUNAME = '网优通道管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '建微站',ZH_HK_MENUNAME = 'Create micro station' WHERE MENUNAME = '创建微站';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'Wl送y',ZH_HK_MENUNAME = 'Sending statistics' WHERE MENUNAME = '网讯发送统计';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'v史告警情',ZH_HK_MENUNAME = 'History alarm' WHERE MENUNAME = '历史告警详情';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'W群lv史',ZH_HK_MENUNAME = 'DTU history' WHERE MENUNAME = '网优群发历史';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '短信助手',ZH_HK_MENUNAME = 'SMS Assistant' WHERE MENUNAME = '短信助手';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '自定到y蟊',ZH_HK_MENUNAME = 'Parameter statistics' WHERE MENUNAME = '自定参数统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '充值/回收日I',ZH_HK_MENUNAME = 'Recharge/Recycle log' WHERE MENUNAME = '充值/回收日志';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I漳０迮渲',ZH_HK_MENUNAME = 'Business template' WHERE MENUNAME = '业务模板配置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '客敉速M管理',ZH_HK_MENUNAME = 'Customer refund' WHERE MENUNAME = '客户退费管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '通嘞薰芾',ZH_HK_MENUNAME = 'Permission' WHERE MENUNAME = '通讯录权限管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '下行I毡O控',ZH_HK_MENUNAME = 'MT service monitor' WHERE MENUNAME = '下行业务监控';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I辗杖照I',ZH_HK_MENUNAME = 'Service log' WHERE MENUNAME = '业务服务日志';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'T工不同热莅l送',ZH_HK_MENUNAME = 'Different content' WHERE MENUNAME = '员工不同内容发送';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '源配置',ZH_HK_MENUNAME = 'Data source' WHERE MENUNAME = '数据源配置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '位管理',ZH_HK_MENUNAME = 'Position' WHERE MENUNAME = '职位管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'l送信息查看',ZH_HK_MENUNAME = 'Task view' WHERE MENUNAME = '发送信息查看';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '充值/回收管理',ZH_HK_MENUNAME = 'Recharge/Retrieve management' WHERE MENUNAME = '充值/回收管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '手工群l',ZH_HK_MENUNAME = 'Manual group sending' WHERE MENUNAME = '手工群发';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '~y蟊',ZH_HK_MENUNAME = 'Reconciliation of statistical reports' WHERE MENUNAME = '对账统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'B彩信l送',ZH_HK_MENUNAME = 'Dynamic MMS' WHERE MENUNAME = '动态彩信发送';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '指令路由配置',ZH_HK_MENUNAME = 'Instruction config' WHERE MENUNAME = '指令路由配置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '上行消息',ZH_HK_MENUNAME = 'MO message' WHERE MENUNAME = '上行消息';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '自定x菜',ZH_HK_MENUNAME = 'Custom menu' WHERE MENUNAME = '自定义菜单';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'N尾管理',ZH_HK_MENUNAME = 'Suffix' WHERE MENUNAME = '贴尾管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'SP~充值/回收',ZH_HK_MENUNAME = 'Recharge & Retrieve' WHERE MENUNAME = 'SP账号充值/回收';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'BWl送',ZH_HK_MENUNAME = 'Dynamic SMS & Wap' WHERE MENUNAME = '动态网讯发送';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '微信群l',ZH_HK_MENUNAME = 'Group sending' WHERE MENUNAME = '微信群发';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '毂O控情',ZH_HK_MENUNAME = 'Database monitor' WHERE MENUNAME = '数据库监控详情';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'oBWl送',ZH_HK_MENUNAME = 'Static SMS & Wap' WHERE MENUNAME = '静态网讯发送';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '在用',ZH_HK_MENUNAME = 'Number of online users' WHERE MENUNAME = '在线用户数';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'APP信息l送',ZH_HK_MENUNAME = 'Message sending' WHERE MENUNAME = 'APP信息发送';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '人信息管理',ZH_HK_MENUNAME = 'Personal information' WHERE MENUNAME = '个人信息管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '客羧航M群l',ZH_HK_MENUNAME = 'Group sending' WHERE MENUNAME = '客户群组群发';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '客粝嗤热莅l送',ZH_HK_MENUNAME = 'Same content' WHERE MENUNAME = '客户相同内容发送';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '系y下行',ZH_HK_MENUNAME = 'MT record' WHERE MENUNAME = '系统下行记录';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '完美通知查看',ZH_HK_MENUNAME = 'View notice' WHERE MENUNAME = '完美通知查看';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '在座席',ZH_HK_MENUNAME = 'Online Seating' WHERE MENUNAME = '在线座席';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'C管理',ZH_HK_MENUNAME = 'Organization' WHERE MENUNAME = '机构管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'T工通',ZH_HK_MENUNAME = 'Staff address book' WHERE MENUNAME = '员工通讯录';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '彩信模板批',ZH_HK_MENUNAME = 'MMS template approval' WHERE MENUNAME = '彩信模板审批';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '回款通知',ZH_HK_MENUNAME = 'Notice of return' WHERE MENUNAME = '回款通知';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '上行I展芾',ZH_HK_MENUNAME = 'MO service' WHERE MENUNAME = '上行业务管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '通道管理',ZH_HK_MENUNAME = 'Channel' WHERE MENUNAME = '通道管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '高安全O置',ZH_HK_MENUNAME = 'Security' WHERE MENUNAME = '高级安全设置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'Ba管理',ZH_HK_MENUNAME = 'Status code' WHERE MENUNAME = '状态码管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '代理~管理',ZH_HK_MENUNAME = 'Proxy account' WHERE MENUNAME = '代理账号管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'Wl送查',ZH_HK_MENUNAME = 'Sending query' WHERE MENUNAME = '网讯发送查询';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '主CO控O置',ZH_HK_MENUNAME = 'Host monitor' WHERE MENUNAME = '主机监控设置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '用粼鲩L',ZH_HK_MENUNAME = 'Subscriber growth' WHERE MENUNAME = '用户增长';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'WLy',ZH_HK_MENUNAME = 'Visit statistics' WHERE MENUNAME = '网讯访问统计';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '用袅斜',ZH_HK_MENUNAME = 'Subscriber list' WHERE MENUNAME = '用户列表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '模板批',ZH_HK_MENUNAME = 'Template approval' WHERE MENUNAME = '模板审批';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '建投票',ZH_HK_MENUNAME = 'Create voting' WHERE MENUNAME = '创建投票';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '信息批',ZH_HK_MENUNAME = 'Message approval' WHERE MENUNAME = '信息审批';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'e`ay蟊',ZH_HK_MENUNAME = 'Error code statistics report' WHERE MENUNAME = '错误码统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'APP用艄芾',ZH_HK_MENUNAME = 'APP user' WHERE MENUNAME = 'APP用户管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'APP客舳讼螺d',ZH_HK_MENUNAME = 'APP download' WHERE MENUNAME = 'APP客户端下载';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '人群M',ZH_HK_MENUNAME = 'Personal group' WHERE MENUNAME = '个人群组';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '~敉ǖ琅渲',ZH_HK_MENUNAME = 'Channel config' WHERE MENUNAME = '账户通道配置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '下行I展芾',ZH_HK_MENUNAME = 'MT service' WHERE MENUNAME = '下行业务管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'PI字O置',ZH_HK_MENUNAME = 'Keyword setting' WHERE MENUNAME = '关键字设置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I疹型管理',ZH_HK_MENUNAME = 'Business type' WHERE MENUNAME = '业务类型管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '系y\行O控',ZH_HK_MENUNAME = 'System operation monitor' WHERE MENUNAME = '系统运行监控';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '系y上行',ZH_HK_MENUNAME = 'MO record' WHERE MENUNAME = '系统上行记录';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '完美通知l送',ZH_HK_MENUNAME = 'Send notice' WHERE MENUNAME = '完美通知发送';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '短信l送~艚定',ZH_HK_MENUNAME = 'SMS account binding' WHERE MENUNAME = '短信发送账户绑定';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '群lv史查',ZH_HK_MENUNAME = 'Mass text history' WHERE MENUNAME = '群发历史查询';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '客傩怨芾',ZH_HK_MENUNAME = 'Customer attribute' WHERE MENUNAME = '客户属性管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'Cy蟊',ZH_HK_MENUNAME = 'organization statistics' WHERE MENUNAME = '机构统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '彩信黑名',ZH_HK_MENUNAME = 'MMS blacklist' WHERE MENUNAME = '彩信黑名单';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '核流程管理',ZH_HK_MENUNAME = 'Audit Flow' WHERE MENUNAME = '审核流程管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'wl送',ZH_HK_MENUNAME = 'Overall sent trend' WHERE MENUNAME = '总体发送趋势';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'SP~l送Ρ',ZH_HK_MENUNAME = 'SP account sent contrast' WHERE MENUNAME = 'SP账号发送对比';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I疹型y蟊',ZH_HK_MENUNAME = 'Business statistics' WHERE MENUNAME = '业务类型统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'P注r的回',ZH_HK_MENUNAME = 'Response to attention' WHERE MENUNAME = '关注时的回复';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'SP~O控O置',ZH_HK_MENUNAME = 'SP account monitor' WHERE MENUNAME = 'SP账号监控设置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '群M管理',ZH_HK_MENUNAME = 'Group' WHERE MENUNAME = '群组管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '^域l送Ρ',ZH_HK_MENUNAME = 'Zone sent contrast' WHERE MENUNAME = '区域发送对比';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I疹型l送Ρ',ZH_HK_MENUNAME = 'Business sent contrast' WHERE MENUNAME = '业务类型发送对比';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'PI字回',ZH_HK_MENUNAME = 'Keyword reply' WHERE MENUNAME = '关键字回复';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'O控D',ZH_HK_MENUNAME = 'Monitor view' WHERE MENUNAME = '监控视图';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '主CO控情',ZH_HK_MENUNAME = 'Host monitor' WHERE MENUNAME = '主机监控详情';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'v史消息',ZH_HK_MENUNAME = 'Historical news' WHERE MENUNAME = '历史消息';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'APP短信群lv史',ZH_HK_MENUNAME = 'Group history' WHERE MENUNAME = 'APP短信群发历史';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '客粲M查',ZH_HK_MENUNAME = 'Client billing query' WHERE MENUNAME = '客户计费查询';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '下行留',ZH_HK_MENUNAME = 'MT delay record' WHERE MENUNAME = '下行滞留记录';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '操作T管理',ZH_HK_MENUNAME = 'Operator' WHERE MENUNAME = '操作员管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '不同热萑喊l',ZH_HK_MENUNAME = 'Different content' WHERE MENUNAME = '不同内容群发';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'T工相同热莅l送',ZH_HK_MENUNAME = 'Same content' WHERE MENUNAME = '员工相同内容发送';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '短信黑名',ZH_HK_MENUNAME = 'SMS blacklist' WHERE MENUNAME = '短信黑名单';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '生日祝福管理',ZH_HK_MENUNAME = 'Birthday wishes' WHERE MENUNAME = '生日祝福管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '默J回',ZH_HK_MENUNAME = 'Default reply' WHERE MENUNAME = '默认回复';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'WEB主CWjO控',ZH_HK_MENUNAME = 'Network monitor' WHERE MENUNAME = 'WEB主机网络监控';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '批提醒',ZH_HK_MENUNAME = 'Approval reminder' WHERE MENUNAME = '审批提醒';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '通道~O控情',ZH_HK_MENUNAME = 'Account monitor' WHERE MENUNAME = '通道账号监控详情';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '通道~O控O置',ZH_HK_MENUNAME = 'Account monitor' WHERE MENUNAME = '通道账号监控设置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'W路由定',ZH_HK_MENUNAME = 'Router binding' WHERE MENUNAME = '网优路由绑定';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'yDWa管理',ZH_HK_MENUNAME = 'MNP Number' WHERE MENUNAME = '携号转网号码管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '特殊a管理',ZH_HK_MENUNAME = 'Special number' WHERE MENUNAME = '特殊号码管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '下行I沼',ZH_HK_MENUNAME = 'MT service record' WHERE MENUNAME = '下行业务记录';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'I毡O控情',ZH_HK_MENUNAME = 'Business monitor' WHERE MENUNAME = '业务监控详情';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = 'APP上行查',ZH_HK_MENUNAME = 'MO record' WHERE MENUNAME = 'APP上行记录查询';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '性化界面O置',ZH_HK_MENUNAME = 'Custom UI' WHERE MENUNAME = '个性化界面设置';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '傩怨芾',ZH_HK_MENUNAME = 'Parameter attribute' WHERE MENUNAME = '参数属性管理';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '\I商y蟊',ZH_HK_MENUNAME = 'Mobile operator statistics' WHERE MENUNAME = '运营商统计报表';
UPDATE LF_PRIVILEGE SET ZH_TW_MENUNAME = '\I商N~查看',ZH_HK_MENUNAME = 'Balance view' WHERE MENUNAME = '运营商余额查看';


--更新COMMENTS菜单--
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '配置',ZH_HK_COMMENTS = 'Config' WHERE COMMENTS = '配置';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '新建',ZH_HK_COMMENTS = 'Add' WHERE COMMENTS = '新建';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '重命名',ZH_HK_COMMENTS = 'Rename' WHERE COMMENTS = '重命名';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '管理',ZH_HK_COMMENTS = 'Manage' WHERE COMMENTS = '管理';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '初始化密a',ZH_HK_COMMENTS = 'Reset password' WHERE COMMENTS = '初始化密码';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'EMP用',ZH_HK_COMMENTS = 'EMP application' WHERE COMMENTS = 'EMP应用';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'h除',ZH_HK_COMMENTS = 'Delete' WHERE COMMENTS = '删除';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '查看日I',ZH_HK_COMMENTS = 'View log' WHERE COMMENTS = '查看日志';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'I招畔',ZH_HK_COMMENTS = 'Business information' WHERE COMMENTS = '业务信息';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '新增抵',ZH_HK_COMMENTS = 'Add parameter values' WHERE COMMENTS = '新增参数值';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '手虞入a',ZH_HK_COMMENTS = 'Manual input phone' WHERE COMMENTS = '手动输入号码';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '直B接入',ZH_HK_COMMENTS = 'Direct access' WHERE COMMENTS = '直连接入';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'e管理',ZH_HK_COMMENTS = 'Manage category' WHERE COMMENTS = '类别管理';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'HTTP接入',ZH_HK_COMMENTS = 'HTTP access' WHERE COMMENTS = 'HTTP接入';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '',ZH_HK_COMMENTS = 'Edit' WHERE COMMENTS = '编辑';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '修改抵',ZH_HK_COMMENTS = 'Edit parameter values' WHERE COMMENTS = '修改参数值';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = ']N/恢',ZH_HK_COMMENTS = 'Cancel/Recovery' WHERE COMMENTS = '注销/恢复';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '查看',ZH_HK_COMMENTS = 'View' WHERE COMMENTS = '查看';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '修改',ZH_HK_COMMENTS = 'Edit' WHERE COMMENTS = '修改';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '全局O置',ZH_HK_COMMENTS = 'Global setting' WHERE COMMENTS = '全局设置';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '恢/取消s',ZH_HK_COMMENTS = 'Recovery/Cancel sign' WHERE COMMENTS = '恢复/取消签约';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '手虞入',ZH_HK_COMMENTS = 'Manual input' WHERE COMMENTS = '手动输入';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'h除傩',ZH_HK_COMMENTS = 'Delete Attribute' WHERE COMMENTS = '删除属性';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'EMPl送',ZH_HK_COMMENTS = 'EMP sending' WHERE COMMENTS = 'EMP发送';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'x袢T',ZH_HK_COMMENTS = 'Choose staff' WHERE COMMENTS = '选择人员';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '定',ZH_HK_COMMENTS = 'Bind' WHERE COMMENTS = '绑定';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '修改傩',ZH_HK_COMMENTS = 'Edit attribute' WHERE COMMENTS = '修改属性';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'O置模板',ZH_HK_COMMENTS = 'Set template' WHERE COMMENTS = '设置模板';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '|ll件',ZH_HK_COMMENTS = 'Trigger condition' WHERE COMMENTS = '触发条件';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'DT工',ZH_HK_COMMENTS = 'Turn to staff' WHERE COMMENTS = '转为员工';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '核蹬渲',ZH_HK_COMMENTS = 'Config audit parameter' WHERE COMMENTS = '审核参数配置';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '步E管理',ZH_HK_COMMENTS = 'Manage step' WHERE COMMENTS = '步骤管理';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'DB接入',ZH_HK_COMMENTS = 'DB connection' WHERE COMMENTS = 'DB接入';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '全局蹬渲',ZH_HK_COMMENTS = 'Config global parameters' WHERE COMMENTS = '全局参数配置';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '理',ZH_HK_COMMENTS = 'Process' WHERE COMMENTS = '处理';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '企I所有CN~',ZH_HK_COMMENTS = 'Balance' WHERE COMMENTS = '企业所有机构总余额';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '移除成T',ZH_HK_COMMENTS = 'Remove staff' WHERE COMMENTS = '移除成员';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '修改配置',ZH_HK_COMMENTS = 'Edit configuration' WHERE COMMENTS = '修改配置';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '新增',ZH_HK_COMMENTS = 'Add' WHERE COMMENTS = '新增';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '回收',ZH_HK_COMMENTS = 'Retrieve' WHERE COMMENTS = '回收';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'D椴僮T',ZH_HK_COMMENTS = 'Turn to operator' WHERE COMMENTS = '转为操作员';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '更改B',ZH_HK_COMMENTS = 'Change status' WHERE COMMENTS = '更改状态';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '定子',ZH_HK_COMMENTS = 'Bind subunit' WHERE COMMENTS = '绑定子号';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '添加成T',ZH_HK_COMMENTS = 'Add staff' WHERE COMMENTS = '添加成员';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '重置密a',ZH_HK_COMMENTS = 'Reset password' WHERE COMMENTS = '重置密码';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '文件入',ZH_HK_COMMENTS = 'Import file' WHERE COMMENTS = '文件导入';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '回',ZH_HK_COMMENTS = 'Reply' WHERE COMMENTS = '回复';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'EMP接入',ZH_HK_COMMENTS = 'EMP access' WHERE COMMENTS = 'EMP接入';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'l布',ZH_HK_COMMENTS = 'Release' WHERE COMMENTS = '发布';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'l送',ZH_HK_COMMENTS = 'Send' WHERE COMMENTS = '发送';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '}u',ZH_HK_COMMENTS = 'Copy' WHERE COMMENTS = '复制';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '批量充值',ZH_HK_COMMENTS = 'Recharge' WHERE COMMENTS = '批量充值';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'PS定',ZH_HK_COMMENTS = 'Bind relations' WHERE COMMENTS = '关系绑定';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '退M',ZH_HK_COMMENTS = 'Refund' WHERE COMMENTS = '退费';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '添加傩灾',ZH_HK_COMMENTS = 'Add attribute values' WHERE COMMENTS = '添加属性值';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '添加傩',ZH_HK_COMMENTS = 'Add attribute' WHERE COMMENTS = '添加属性';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'h除傩灾',ZH_HK_COMMENTS = 'Delete Attribute values' WHERE COMMENTS = '删除属性值';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '{整',ZH_HK_COMMENTS = 'Adjust' WHERE COMMENTS = '调整';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'h除抵',ZH_HK_COMMENTS = 'Delete parameter values' WHERE COMMENTS = '删除参数值';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '激活/失效',ZH_HK_COMMENTS = 'Activate/Invalid' WHERE COMMENTS = '激活/失效';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '修改刀x',ZH_HK_COMMENTS = 'Edit parameter definition' WHERE COMMENTS = '修改参数定义';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 's',ZH_HK_COMMENTS = 'Sign' WHERE COMMENTS = '签约';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '充值',ZH_HK_COMMENTS = 'Recharge' WHERE COMMENTS = '充值';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '新增刀x',ZH_HK_COMMENTS = 'Add parameter definition' WHERE COMMENTS = '新增参数定义';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '排序',ZH_HK_COMMENTS = 'Sort' WHERE COMMENTS = '排序';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '模板热',ZH_HK_COMMENTS = 'Template content' WHERE COMMENTS = '模板内容';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '手虞入热',ZH_HK_COMMENTS = 'Manual input content' WHERE COMMENTS = '手动输入内容';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'O置',ZH_HK_COMMENTS = 'Set' WHERE COMMENTS = '设置';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'С',ZH_HK_COMMENTS = 'Export' WHERE COMMENTS = '导出';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = 'y值',ZH_HK_COMMENTS = 'Threshold' WHERE COMMENTS = '阀值';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '手犹砑',ZH_HK_COMMENTS = 'Manual add' WHERE COMMENTS = '手动添加';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '合并',ZH_HK_COMMENTS = 'Merge' WHERE COMMENTS = '合并';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '批量理',ZH_HK_COMMENTS = 'Batch process' WHERE COMMENTS = '批量处理';
UPDATE LF_PRIVILEGE SET ZH_TW_COMMENTS = '嘞藿定',ZH_HK_COMMENTS = 'Bind power' WHERE COMMENTS = '权限绑定';








/*富信模板管理菜单START*/
DELETE FROM LF_THIR_MENUCONTROL WHERE TID = 102;
INSERT INTO LF_THIR_MENUCONTROL(TID, MENU_NUM, TITLE, PRI_MENU, PRI_ORDER, ZH_TW_TITLE, ZH_HK_TITLE) VALUES (102, 25, '企业富信', 95, 80, '企I富信', 'Multimedia');
DELETE FROM LF_THIR_MENUCONTROL WHERE TID = 103;

DELETE FROM LF_IMPOWER WHERE PRIVILEGE_ID IN (3100, 3102);
DELETE FROM LF_PRIVILEGE WHERE PRIVILEGE_ID IN (3100, 3102);
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME) VALUES (3100, 95, 1, '模板内容', '5100-1000-0', '相同内容发送', '富信应用', '5100-1000', '/rms_sameMms.htm', '模板内容', 'View', '相同热莅l送', 'Same SMS', '富信用', 'Multimedia');
INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME) VALUES (3102, 95, 1, '模板内容', '5100-1100-0', '不同内容发送', '富信应用', '5100-1200', '/rms_diffMms.htm', '模板内容', 'View', '不同热莅l送', 'Different SMS', '富信用', 'Multimedia');
INSERT INTO LF_IMPOWER VALUES(1,3100);
INSERT INTO LF_IMPOWER VALUES(2,3100);
INSERT INTO LF_IMPOWER VALUES(4,3100);
INSERT INTO LF_IMPOWER VALUES(1,3102);
INSERT INTO LF_IMPOWER VALUES(2,3102);
INSERT INTO LF_IMPOWER VALUES(4,3102);


CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3101)
    THEN
      INSERT INTO LF_PRIVILEGE VALUES(3101,95,1,'查看','5100-1800-0','容量套餐统计报表','富信应用','5100-1800','/rep_rltcReport.htm','查看','View','容量套餐y蟊','Degree Report','富信用','Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3103)
--     THEN
--       INSERT INTO LF_PRIVILEGE values(3103,95,1,'查看','5100-1900-0','计费档位管理','富信应用','5100-1900','/cha_degreelManage.htm','查看','View','Mn位管理','Degree Manage','富信用','Multimedia');
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3101 AND ROLE_ID=1)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3101);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3101 AND ROLE_ID=2)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3101);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3101 AND ROLE_ID=4)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3101);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3103 AND ROLE_ID=1)
--     THEN
--       INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3103);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3103 AND ROLE_ID=2)
--     THEN
--       INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3103);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3103 AND ROLE_ID=4)
--     THEN
--       INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3103);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

--LF_TEMPLATE新增字段
CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME='LF_TEMPLATE' AND COLNAME='DEGREE')
    THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMPLATE ADD DEGREE int DEFAULT 0 NOT NULL';
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_TEMPLATE;

--LF_TEMPLATE新增字段
CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME='LF_TEMPLATE' AND COLNAME='DEGREE_SIZE')
    THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_TEMPLATE ADD DEGREE_SIZE  bigint DEFAULT 0 NOT NULL';
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_TEMPLATE;

-- 富信模板管理菜单
CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = '634')
    THEN
      INSERT INTO LF_PRIVILEGE VALUES(634,95,1,'查看','5100-1300-0','模板管理','富信应用','5100-1300','/mbgl_template.htm','查看','view','模板管理','Template management','富信用','Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT *  FROM LF_IMPOWER WHERE PRIVILEGE_ID = '634')
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,634);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,634);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,634);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

UPDATE LF_PRIVILEGE SET MODNAME = '富信应用' WHERE RESOURCE_ID = 95;
update LF_PRIVILEGE set menuname='档位统计报表' where menuname='容量套餐统计报表';
update LF_PRIVILEGE set ZH_TW_MENUNAME='档位统计报表' where ZH_TW_MENUNAME='容量套餐y蟊';
update LF_THIR_MENUCONTROL set pri_order = 80 where pri_order = 390;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3104)
    THEN
      insert into LF_PRIVILEGE VALUES(3104,95,1,'查看','5100-1500-0','发送明细查询','富信应用','5100-1500','/cha_sendDetail.htm','查看','View','l送明查','Send Detail','富信用','Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3104 AND ROLE_ID=1)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3104);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3104 AND ROLE_ID=2)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3104);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3104 AND ROLE_ID=4)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3104);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME='LF_MTTASK' AND COLNAME='VALIDTM')
    THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_MTTASK ADD VALIDTM  SMALLINT DEFAULT 48 NOT NULL';
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_MTTASK;

-- 富信模板管理 添加 新建、删除权限
CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = '633')
    THEN
      INSERT INTO LF_PRIVILEGE VALUES(633,95,NULL,'新建','5100-1300-1','模板管理','富信应用','5100-1300',NULL,'新建','Add','模板管理','Template management','富信用','Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = '635')
    THEN
      INSERT INTO LF_PRIVILEGE VALUES(635,95,NULL,'删除','5100-1300-2','模板管理','富信应用','5100-1300',NULL,'删除','Delete','模板管理','Template management','富信用','Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT *  FROM LF_IMPOWER WHERE PRIVILEGE_ID = '633')
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,633);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,633);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,633);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT *  FROM LF_IMPOWER WHERE PRIVILEGE_ID = '635')
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,635);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,635);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,635);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3101)
    THEN
      UPDATE LF_PRIVILEGE SET MENUNAME = '档位统计报表',MENUSITE = '/rep_degreeReport.htm',ZH_TW_MENUNAME = 'n位y蟊',MODNAME = '富信应用',ZH_TW_MODNAME = '富信用' WHERE PRIVILEGE_ID = 3101;
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3103)
    THEN
      UPDATE LF_PRIVILEGE SET MENUSITE = '/rms_degreeManager.htm',ZH_HK_MENUNAME = 'Degree Manager',MODNAME = '富信应用',ZH_TW_MODNAME = '富信用' WHERE PRIVILEGE_ID = 3103;
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3104)
    THEN
      UPDATE LF_PRIVILEGE SET MENUSITE = '/rms_sendDetail.htm',MODNAME = '富信应用',ZH_TW_MODNAME = '富信用' WHERE PRIVILEGE_ID = 3104;
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3105)
--     THEN
--       INSERT INTO LF_PRIVILEGE values(3105,95,null,'新建','5100-1900-1','计费档位管理','富信应用','5100-1900',null,'新建','Add','Mn位管理','Degree Manager','富信用','Multimedia');
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;
--
-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3106)
--     THEN
--       INSERT INTO LF_PRIVILEGE values(3106,95,null,'修改','5100-1900-3','计费档位管理','富信应用','5100-1900',null,'修改','Update','Mn位管理','Degree Manager','富信用','Multimedia');
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3105 AND ROLE_ID=1)
--     THEN
--       INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3105);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3105 AND ROLE_ID=2)
--     THEN
--       INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3105);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3105 AND ROLE_ID=4)
--     THEN
--       INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3105);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3106 AND ROLE_ID=1)
--     THEN
--       INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3106);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;
--
-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3106 AND ROLE_ID=2)
--     THEN
--       INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3106);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3106 AND ROLE_ID=4)
--     THEN
--       INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3106);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID = 3103 AND ROLE_ID != 2)
--     THEN
--       DELETE FROM LF_IMPOWER WHERE PRIVILEGE_ID = 3103 AND ROLE_ID !=2;
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

-- --富信群发任务查看
-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3007)
--     THEN
--       INSERT INTO LF_PRIVILEGE VALUES(3007,100,1,'查看','5100-1400-0','群发任务查看','数据查询','5100-1400','/rmsTaskRecord.htm','查看','View','群l任詹榭','Task view','查','Data Query');
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;
--
-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3007 AND ROLE_ID=1)
--     THEN
--       INSERT INTO LF_IMPOWER VALUES(1,3007);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;
--
-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3007 AND ROLE_ID=2)
--     THEN
--       INSERT INTO LF_IMPOWER VALUES(2,3007);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;
--
-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3007 AND ROLE_ID=3)
--     THEN
--       INSERT INTO LF_IMPOWER VALUES(3,3007);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

-- CREATE PROCEDURE "INSERTDATAEXISTS"
--   BEGIN ATOMIC
--     IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3007 AND ROLE_ID=4)
--     THEN
--       INSERT INTO LF_IMPOWER VALUES(4,3007);
--     END IF;
--   END;
-- CALL INSERTDATAEXISTS;
-- DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME='LF_SPFEE' AND COLNAME='RMS_BALANCE')
    THEN
      EXECUTE IMMEDIATE 'ALTER TABLE LF_SPFEE ADD RMS_BALANCE bigint NOT NULL DEFAULT 0';
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
REORG TABLE LF_SPFEE;

--任务发送控制表
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS(SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_RMSTASK_CTRL')
    THEN
      EXECUTE IMMEDIATE  'CREATE TABLE LF_RMSTASK_CTRL
      (
        ID BIGINT  PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY (
                                        START WITH +1
                                        INCREMENT BY +1
                                        MINVALUE +1
                                        MAXVALUE +2147483647
                                        NO CYCLE
                                        NO CACHE
                                        NO ORDER ),--主键
        TASKID BIGINT  DEFAULT 0 NOT NULL,--任务id
        CURRENT_COUNT BIGINT DEFAULT 0 NOT NULL,--当前发送记录数
        UPDATE_TIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL--修改时间
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;
/*富信模板管理菜单END*/

/*统计报表START*/
-------------------------------------------------------------------------------------------------

CREATE PROCEDURE "IFPROC"
  BEGIN ATOMIC
    IF EXISTS(SELECT PROCNAME FROM SYSCAT.PROCEDURES WHERE PROCNAME='CREATETABLEFX')
    THEN
      EXECUTE IMMEDIATE  'DROP PROCEDURE CREATETABLEFX';
    END IF;
  END;
CALL IFPROC;
DROP PROCEDURE IFPROC;

CREATE  PROCEDURE "CREATETABLEFX"(in "PITYPE" INT,in "PIYM" INT)
  SPECIFIC "SQL151008140458005"
LANGUAGE SQL
NOT DETERMINISTIC
CALLED ON NULL INPUT
EXTERNAL ACTION
OLD SAVEPOINT LEVEL
MODIFIES SQL DATA
INHERIT SPECIAL REGISTERS
  BEGIN ATOMIC
    DECLARE STR VARCHAR(4000);
    DECLARE TABLENAME VARCHAR(22);
    SET TABLENAME='LF_RMS_SYN'||CAST(PIYM AS CHAR(6));
    IF PITYPE=1 AND NOT EXISTS(select * from syscat.tables where tabname = TABLENAME)
    THEN
      SET STR='CREATE TABLE  '||TABLENAME||'(
		   ID BIGINT  PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY (
                    START WITH +1
                    INCREMENT BY +1
                    MINVALUE +1
                    MAXVALUE +2147483647
                    NO CYCLE
                    NO CACHE
                    NO ORDER ),
		   SPISUNCM VARCHAR(4) DEFAULT '''' NOT NULL,
		   USERID VARCHAR(32) DEFAULT '''' NOT NULL,
		   IYMD INT DEFAULT 0 NOT NULL,
		   ICOUNT BIGINT DEFAULT 0 NOT NULL ,
		   RSUCC BIGINT DEFAULT 0 NOT NULL ,
		   RFAIL BIGINT DEFAULT 0 NOT NULL,
		   REQ_TIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
		   CORP_CODE VARCHAR(64) DEFAULT '''' NOT NULL,
		   DEGREE INT DEFAULT 0 NOT NULL,
		   SYN_TIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
           PARAM1 varchar(64) DEFAULT '''' NOT NULL,
           PARAM2 varchar(64) DEFAULT '''' NOT NULL,
           PARAM3 varchar(64) DEFAULT '''' NOT NULL,
           PARAM4 varchar(64) DEFAULT '''' NOT NULL
	)';
      BEGIN
        --select STR;
        --print:STR;
        EXECUTE  IMMEDIATE STR;
      END;
    END IF;
  END;

CREATE PROCEDURE "CREATETABLEFXTMEPLE"
  BEGIN ATOMIC
    DECLARE J INT;
    DECLARE SPTIME TIMESTAMP;
    DECLARE PIYMFX VARCHAR(6);
    DECLARE PITYPEFX INT;
    SET J=0;
    SET SPTIME=CURRENT TIMESTAMP;
    SET J=0;
    WHILE(J < 12) DO

      SET  PIYMFX=CAST(REPLACE(CURRENT DATE+J months,'-','') AS CHAR(6));
      SET PITYPEFX=1;
      WHILE (PITYPEFX<2) DO
        CALL CREATETABLEFX (PITYPEFX,PIYMFX) ;
        SET PITYPEFX=PITYPEFX+1;
      END WHILE;
      SET J = J+1;

    END WHILE;
  END;
CALL CREATETABLEFXTMEPLE;
DROP PROCEDURE CREATETABLEFXTMEPLE;
--富信同步报表数据中间表

CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_RMS_SYN_TEMP') THEN
      EXECUTE IMMEDIATE  'CREATE TABLE LF_RMS_SYN_TEMP
      (
        ID BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY (
                                       START WITH +1
                                       INCREMENT BY +1
                                       MINVALUE +1
                                       MAXVALUE +2147483647
                                       NO CYCLE
                                       NO CACHE
                                       NO ORDER ),--主键
        SPISUNCM VARCHAR(4) DEFAULT '''' NOT NULL,--运营商
        USERID VARCHAR(32) DEFAULT '''' NOT NULL,--SP账号
        IYMD INT DEFAULT 0 NOT NULL,--年月日
        ICOUNT BIGINT DEFAULT 0 NOT NULL,--提交总数
        RSUCC BIGINT DEFAULT 0 NOT NULL,--发送成功数
        RFAIL BIGINT DEFAULT 0 NOT NULL,--接收失败数
        REQ_TIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,--请求时间（入库时间）
        CORP_CODE VARCHAR(64) DEFAULT '''' NOT NULL,--企业编码
        DEGREE INT DEFAULT 0 NOT NULL,--档位
        FLAG INT DEFAULT 0 NOT NULL,--0未结束，1结束
        PARAM1 varchar(64) DEFAULT '''' NOT NULL,
        PARAM2 varchar(64) DEFAULT '''' NOT NULL,
        PARAM3 varchar(64) DEFAULT '''' NOT NULL,
        PARAM4 varchar(64) DEFAULT '''' NOT NULL
      )';
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;


--富信统计表（ 汇总报表）
CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_RMS_REPORT') THEN
      EXECUTE IMMEDIATE  '
      CREATE TABLE LF_RMS_REPORT
      (
        ID BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY (
                                       START WITH +1
                                       INCREMENT BY +1
                                       MINVALUE +1
                                       MAXVALUE +2147483647
                                       NO CYCLE
                                       NO CACHE
                                       NO ORDER ),--主键
        SPISUNCM VARCHAR(4) DEFAULT '''' NOT NULL,--运营商
        USERID VARCHAR(32) DEFAULT '''' NOT NULL,--SP账号
        IYMD INT DEFAULT 0 NOT NULL,--年月日
        ICOUNT BIGINT DEFAULT 0 NOT NULL,--提交总数
        RSUCC BIGINT DEFAULT 0 NOT NULL,--发送成功数
        RFAIL BIGINT DEFAULT 0 NOT NULL,--接收失败数
        CREATE_TIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,--创建时间
        CORP_CODE VARCHAR(64) DEFAULT '''' NOT NULL,--企业编码
        SYN_TIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,--同步时间
        DEGREE INT DEFAULT 0 NOT NULL,--档位
        PARAM1 varchar(64) DEFAULT '''' NOT NULL,--扩展字段
        PARAM2 varchar(64) DEFAULT '''' NOT NULL,
        PARAM3 varchar(64) DEFAULT '''' NOT NULL,
        PARAM4 varchar(64) DEFAULT '''' NOT NULL
      )';
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

--档位表
CREATE PROCEDURE "ADDCOLUMNEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_DEGREE') THEN
      EXECUTE IMMEDIATE  '
      CREATE TABLE LF_DEGREE
      (
        ID BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY (
                                       START WITH +1
                                       INCREMENT BY +1
                                       MINVALUE +1
                                       MAXVALUE +2147483647
                                       NO CYCLE
                                       NO CACHE
                                       NO ORDER ),--主键
        DEGREE INT DEFAULT 0 NOT NULL,--档位,1-5档
        DEGREE_BEGIN VARCHAR(64) DEFAULT '''' NOT NULL,--档位容量开始
        DEGREE_END VARCHAR(64) DEFAULT '''' NOT NULL,--档位容量结束
        VALID_DATE_BEGIN TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,--有效开始时间
        VALID_DATE_END TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,--有效截止时间
        STATUS INT DEFAULT 0 NOT NULL,--状态,0-启用,1-禁用
        USER_ID BIGINT DEFAULT 0 not null,--操作员ID
        CREATE_TIME TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL --记录创建时间
      )';
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;


--存储过程
CREATE PROCEDURE "IFPROC"
  BEGIN ATOMIC
    IF  EXISTS (SELECT PROCNAME FROM SYSCAT.PROCEDURES WHERE PROCNAME='PRO_RMS_SUM')
    THEN
      EXECUTE IMMEDIATE  'DROP  PROCEDURE PRO_RMS_SUM';
    END IF;
  END;
CALL IFPROC;
DROP PROCEDURE IFPROC;

CREATE  PROCEDURE PRO_RMS_SUM(IYMD INT)
  BEGIN ATOMIC
    DECLARE SQLSTR varchar(1000);
    DECLARE TABLE_NAME VARCHAR(25);

    IF IYMD > 0 THEN
      BEGIN
        SET TABLE_NAME='LF_RMS_SYN'||SUBSTR(CAST(IYMD AS CHAR(6)),1,6);
        --1.删除老数据
        SET SQLSTR='delete from LF_RMS_REPORT where IYMD='||CAST(IYMD AS varchar(20));
        EXECUTE IMMEDIATE SQLSTR;
        --2 更新新数据
        SET SQLSTR='insert into LF_RMS_REPORT (SPISUNCM,USERID,IYMD,ICOUNT,RSUCC,RFAIL,SYN_TIME,CORP_CODE,DEGREE,CREATE_TIME,PARAM1,PARAM2,PARAM3,PARAM4)  '
                   ||'select SPISUNCM,USERID,IYMD,ICOUNT,RSUCC,RFAIL,SYN_TIME,CORP_CODE,DEGREE,CURRENT TIMESTAMP ,PARAM1,PARAM2,PARAM3,PARAM4 from '||TABLE_NAME||' where IYMD='||CAST(IYMD AS varchar(20));
        --print SQLSTR
        EXECUTE IMMEDIATE SQLSTR;
      END;
    END IF;
  END;


CREATE PROCEDURE "IFPROC"
  BEGIN ATOMIC
    IF  EXISTS (SELECT PROCNAME FROM SYSCAT.PROCEDURES WHERE PROCNAME='PRO_RMS_TRANSFER')
    THEN
      EXECUTE IMMEDIATE  'DROP PROCEDURE PRO_RMS_TRANSFER';
    END IF;
  END;
CALL IFPROC;
DROP PROCEDURE IFPROC;

CREATE  PROCEDURE PRO_RMS_TRANSFER
  BEGIN ATOMIC
    DECLARE SQLSTR varchar(1000);
    DECLARE IYMD INT;
    DECLARE ERROR	INT;
    DECLARE EXCEPTION_NUMBER INT;
    DECLARE TABLE_NAME VARCHAR(25);
    DECLARE FETCH_STATUS INT DEFAULT 0;
    DECLARE CURIDX CURSOR WITH HOLD FOR SELECT IYMD FROM LF_RMS_SYN_TEMP GROUP BY iymd;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET FETCH_STATUS = 1;

    --1.删除重复数据
    delete from LF_RMS_SYN_TEMP where id not  in( select MAX(t1.id) from LF_RMS_SYN_TEMP t1 group by t1.SPISUNCM,t1.USERID,t1.IYMD,t1.DEGREE);

    --2.数据转移
    OPEN CURIDX;
    FETCH CURIDX INTO IYMD;
    WHILE FETCH_STATUS=0 DO
      IF IYMD > 0 THEN
        SET TABLE_NAME='LF_RMS_SYN'||SUBSTR(CAST(IYMD AS CHAR(6)),1,6);
        --2.1删除老数据
        SET SQLSTR='delete from '||TABLE_NAME||' where IYMD='||CAST(IYMD AS varchar(20));
        EXECUTE IMMEDIATE SQLSTR;
        --2.2 转移临时表数据
        SET SQLSTR='insert into '||TABLE_NAME||' (SPISUNCM,USERID,IYMD,ICOUNT,RSUCC,RFAIL,REQ_TIME,CORP_CODE,DEGREE,SYN_TIME,PARAM1,PARAM2,PARAM3,PARAM4) '
                   ||'select SPISUNCM,USERID,IYMD,ICOUNT,RSUCC,RFAIL,REQ_TIME,CORP_CODE,DEGREE,CURRENT TIMESTAMP ,PARAM1,PARAM2,PARAM3,PARAM4 from LF_RMS_SYN_temp where IYMD='||CAST(IYMD AS varchar(20));
        EXECUTE IMMEDIATE SQLSTR;
        --2.3 删除已转移临时表数据
        SET SQLSTR='delete from LF_RMS_SYN_TEMP where IYMD='||CAST(IYMD AS varchar(20));
        EXECUTE IMMEDIATE SQLSTR;
        --3 执行汇总
        CALL PRO_RMS_SUM(IYMD);
        FETCH CURIDX INTO IYMD;
      END IF;
    END WHILE;
    CLOSE CURIDX;
    --3.数据汇总
  END;

/*统计报表END*/
/*EMP升级脚本 END*/

-----------V6.17-V6.18START------------------------
CREATE PROCEDURE "ADDVERSIONEXISTS"
  BEGIN ATOMIC
    DECLARE DBVERSION VARCHAR(32);
    DECLARE NUM INT;
    DECLARE TOTAL INT;
    SET DBVERSION = '6.17';
    SET NUM =1;
    SET TOTAL=1;
    IF NOT EXISTS(SELECT * FROM LF_DB_SCRIPT WHERE VERSION=DBVERSION)
    THEN
      --EMP产品数据库版本信息表
      INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
      VALUES(DBVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,NUM,TOTAL,1,'版本号更改');
    END IF;
  END;
CALL ADDVERSIONEXISTS;
DROP PROCEDURE ADDVERSIONEXISTS;


UPDATE LF_VERSION_HIS SET ISRELEASE=0 WHERE VERSION='6.6.0.346';

UPDATE LF_PRIVILEGE SET COMMENTS='修改',PRIV_CODE='1900-1480-2' WHERE PRIVILEGE_ID=2847;

CREATE PROCEDURE "ADDVERSIONEXISTS"
  BEGIN ATOMIC
    DECLARE VERSION VARCHAR(32);
    DECLARE DBVERSION VARCHAR(32);
    DECLARE WBSVERSION VARCHAR(32);
    DECLARE SPGATEVERSION VARCHAR(32);
    DECLARE NUM INT;
    DECLARE TOTAL INT;
    SET VERSION = '6.8.0.370';
    SET DBVERSION = '6.18';
    SET WBSVERSION = '8.4.22.187_SP4';
    SET SPGATEVERSION = '6.1.26.318';
    SET NUM =1;
    SET TOTAL=1;
    --EMP产品版本记录
    --EMP-WEB
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,1000,VERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP-WEB');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000;
    END IF;
    --EMP_GATEWAY
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,2000,WBSVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP_GATEWAY');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=WBSVERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000;
    END IF;
    --SMT_SPGATE
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,3000,SPGATEVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'SMT_SPGATE');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=SPGATEVERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000;
    END IF;
    --EMP产品版本历史记录
    --EMP-WEB
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=VERSION AND PRODUCT_ID=1000 AND PROCESS_ID=1000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO,ISRELEASE,VERSIONINFO)
      VALUES(1000,1000,VERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP-WEB',1,'1、WEB多语言功能实现<br />2、网关多语言功能。<br />');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP,ISRELEASE=1,VERSIONINFO='1、WEB多语言功能实现<br />2、网关多语言功能。<br />' WHERE VERSION=VERSION AND PRODUCT_ID=1000 AND PROCESS_ID=1000;
    END IF;
    --EMP_GATEWAY
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=WBSVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=2000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,2000,WBSVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP_GATEWAY');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP WHERE VERSION=WBSVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=2000;
    END IF;
    --SMT_SPGATE
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=SPGATEVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=3000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,3000,SPGATEVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'SMT_SPGATE');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP WHERE VERSION=SPGATEVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=3000;
    END IF;
    IF NOT EXISTS(SELECT * FROM LF_DB_SCRIPT WHERE VERSION=DBVERSION AND CURRENT_NO=NUM AND TOTAL=TOTAL)
    THEN
      --EMP产品数据库版本信息表
      INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
      VALUES(DBVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,NUM,TOTAL,2,'版本号更改');
    ELSE
      UPDATE LF_DB_SCRIPT SET STATE=2,UPDATETIME=CURRENT TIMESTAMP,MEMO='版本号更改' WHERE  VERSION=DBVERSION AND CURRENT_NO=NUM AND TOTAL=TOTAL;
    END IF;
  END;
CALL ADDVERSIONEXISTS;
DROP PROCEDURE ADDVERSIONEXISTS;
-----------V6.17-V6.18END------------------------




----------- V6.18-V6.19START ------------------------
CREATE PROCEDURE "ADDVERSIONEXISTS"
  BEGIN
    DECLARE DBVERSION VARCHAR(32);
    DECLARE NUM INT;
    DECLARE TOTAL INT;
    SET DBVERSION = '6.19';
    SET NUM =1;
    SET TOTAL=1;
    IF NOT EXISTS(SELECT * FROM LF_DB_SCRIPT WHERE VERSION=DBVERSION)
    THEN
      --EMP产品数据库版本信息表
      INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
      VALUES(DBVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,NUM,TOTAL,1,'LINUX版本脚本整合');
    END IF;
  END;
CALL ADDVERSIONEXISTS;
DROP PROCEDURE ADDVERSIONEXISTS;

/* EMP升级脚本START */
CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT * FROM LF_CORP WHERE CORP_CODE='290000')
    THEN
      INSERT INTO LF_CORP(CORP_CODE, CORP_NAME, MOBILE, PHONE, ADDRESS, LINKMAN, E_MAILS, USER_NAME, LGO_URL, ISBALANCE, SUBNO_DIGIT, CUR_SUBNO, CORP_STATE, ISOPENTD) VALUES ('290000', '无效企业', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 0, 4, 0, 1, 0);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

/* 菜单顺序修改 */
UPDATE LF_PRIVILEGE SET PRIV_CODE = '5100-1400-0' , MENUCODE = '5100-1400' WHERE PRIVILEGE_ID = 3107;

/* 不同内容菜单修改  */
UPDATE LF_PRIVILEGE SET COMMENTS = '查看' ,ZH_TW_COMMENTS = '查看' , ZH_HK_COMMENTS = 'View' WHERE PRIVILEGE_ID = 3102;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3300)
    THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3300, 95, null, '模板内容', '5100-1100-4', '不同内容发送', '富信应用', '5100-1200', null, '模板内容', 'View', '不同热莅l送', 'Different SMS', '富信用', 'Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3301)
    THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3301, 95, null, '手动输入内容', '5100-1100-5', '不同内容发送', '富信应用', '5100-1200', null, '模板内容', 'View', '不同热莅l送', 'Different SMS', '富信用', 'Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3300 AND ROLE_ID=1)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3300);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3300 AND ROLE_ID=2)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3300);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3300 AND ROLE_ID=4)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3300);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3301 AND ROLE_ID=1)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3301);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3301 AND ROLE_ID=2)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3301);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3301 AND ROLE_ID=4)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3301);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

/* 相同内容菜单修改*/
update LF_PRIVILEGE set COMMENTS = '查看' ,ZH_TW_COMMENTS = '查看' , ZH_HK_COMMENTS = 'View' where PRIVILEGE_ID = 3100;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3302)
    THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3302, 95, null, '模板内容', '5100-1000-4', '相同内容发送', '富信应用', '5100-1000', null, '模板内容', 'View', '相同热莅l送', 'Same SMS', '富信用', 'Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3303)
    THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3303, 95, null, '手动输入内容', '5100-1000-5', '相同内容发送', '富信应用', '5100-1000', null, '手动输入内容', 'View', '相同热莅l送', 'Same SMS', '富信用', 'Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3304)
    THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3304, 95, null, '手动输入号码', '5100-1000-6', '相同内容发送', '富信应用', '5100-1000', null, '手动输入号码', 'View', '相同热莅l送', 'Same SMS', '富信用', 'Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3305)
    THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3305, 95, null, '文件导入', '5100-1000-7', '相同内容发送', '富信应用', '5100-1000', null, '文件导入', 'View', '相同热莅l送', 'Same SMS', '富信用', 'Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID=3306)
    THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3306, 95, null, '选择人员', '5100-1000-8', '相同内容发送', '富信应用', '5100-1000', null, '选择人员', 'View', '相同热莅l送', 'Same SMS', '富信用', 'Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3302 AND ROLE_ID=1)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3302);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3302 AND ROLE_ID=2)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3302);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3302 AND ROLE_ID=4)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3302);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3303 AND ROLE_ID=1)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3303);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3303 AND ROLE_ID=2)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3303);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3303 AND ROLE_ID=4)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3303);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3304 AND ROLE_ID=1)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3304);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3304 AND ROLE_ID=2)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3304);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3304 AND ROLE_ID=4)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3304);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3305 AND ROLE_ID=1)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3305);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3305 AND ROLE_ID=2)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3305);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3305 AND ROLE_ID=4)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3305);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3306 AND ROLE_ID=1)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3306);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3306 AND ROLE_ID=2)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3306);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID=3306 AND ROLE_ID=4)
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3306);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

/* 存储过程修改 */
CREATE PROCEDURE "UPDATEPROCEDURESEXISTS"
  BEGIN
    IF  EXISTS ( SELECT PROCNAME FROM SYSCAT.PROCEDURES WHERE PROCNAME='PRO_RMS_TRANSFER')
    THEN
      EXECUTE IMMEDIATE  'DROP  PROCEDURE PRO_RMS_TRANSFER';
    END IF;
  END;
CALL UPDATEPROCEDURESEXISTS;
DROP PROCEDURE UPDATEPROCEDURESEXISTS;

CREATE  PROCEDURE PRO_RMS_TRANSFER
  BEGIN ATOMIC
    DECLARE SQLSTR varchar(1000);
    DECLARE IYMD INT;
    DECLARE ERROR	INT;
    DECLARE EXCEPTION_NUMBER INT;
    DECLARE TABLE_NAME VARCHAR(25);
    DECLARE FETCH_STATUS INT DEFAULT 0;
    DECLARE CURIDX CURSOR WITH HOLD FOR SELECT IYMD FROM LF_RMS_SYN_TEMP WHERE iymd<>0 GROUP BY iymd;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET FETCH_STATUS = 1;

    --1.删除重复数据
    delete from LF_RMS_SYN_TEMP where id not  in( select MAX(t1.id) from LF_RMS_SYN_TEMP t1 group by t1.SPISUNCM,t1.USERID,t1.IYMD,t1.DEGREE);

    --2.数据转移

    --2.0删除同步标识数据
    SET TABLE_NAME='LF_RMS_SYN_TEMP';
    SET SQLSTR='delete from '||TABLE_NAME||' where IYMD=0';
    EXECUTE IMMEDIATE SQLSTR;

    OPEN CURIDX;
    FETCH CURIDX INTO IYMD;
    WHILE FETCH_STATUS=0 DO


      IF IYMD > 0 THEN

        --2.1删除老数据
        SET TABLE_NAME='LF_RMS_SYN'||SUBSTR(CAST(IYMD AS CHAR(6)),1,6);
        SET SQLSTR='delete from '||TABLE_NAME||' where IYMD='||CAST(IYMD AS varchar(20));
        EXECUTE IMMEDIATE SQLSTR;
        --2.2 转移临时表数据
        SET SQLSTR='insert into '||TABLE_NAME||' (SPISUNCM,USERID,IYMD,ICOUNT,RSUCC,RFAIL,REQ_TIME,CORP_CODE,DEGREE,SYN_TIME,PARAM1,PARAM2,PARAM3,PARAM4) '
                   ||'select SPISUNCM,USERID,IYMD,ICOUNT,RSUCC,RFAIL,REQ_TIME,CORP_CODE,DEGREE,CURRENT TIMESTAMP ,PARAM1,PARAM2,PARAM3,PARAM4 from LF_RMS_SYN_temp where IYMD='||CAST(IYMD AS varchar(20));
        EXECUTE IMMEDIATE SQLSTR;
        --2.3 删除已转移临时表数据
        SET SQLSTR='delete from LF_RMS_SYN_TEMP where IYMD='||CAST(IYMD AS varchar(20));
        EXECUTE IMMEDIATE SQLSTR;
        --3 执行汇总
        CALL PRO_RMS_SUM(IYMD);
        FETCH CURIDX INTO IYMD;
      END IF;
    END WHILE;
    CLOSE CURIDX;
  END;

/* EMP升级脚本 END */
CREATE PROCEDURE "ADDVERSIONEXISTS"
  BEGIN ATOMIC
    DECLARE VERSION VARCHAR(32);
    DECLARE DBVERSION VARCHAR(32);
    DECLARE WBSVERSION VARCHAR(32);
    DECLARE SPGATEVERSION VARCHAR(32);
    DECLARE NUM INT;
    DECLARE TOTAL INT;
    SET VERSION = '6.8.0.371';
    SET DBVERSION = '6.19';
    SET WBSVERSION = '8.4.22.187_SP4';
    SET SPGATEVERSION = '6.1.26.318';
    SET NUM =1;
    SET TOTAL=1;
    --EMP产品版本记录
    --EMP-WEB
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,1000,VERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP-WEB');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000;
    END IF;
    --EMP_GATEWAY
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,2000,WBSVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP_GATEWAY');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=WBSVERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000;
    END IF;
    --SMT_SPGATE
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,3000,SPGATEVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'SMT_SPGATE');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=SPGATEVERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000;
    END IF;
    --EMP产品版本历史记录
    --EMP-WEB
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=VERSION AND PRODUCT_ID=1000 AND PROCESS_ID=1000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO,ISRELEASE,VERSIONINFO)
      VALUES(1000,1000,VERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP-WEB',1,'1、企业编码以29开头。<br />');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP,ISRELEASE=1,VERSIONINFO='1、企业编码以29开头。<br />' WHERE VERSION=VERSION AND PRODUCT_ID=1000 AND PROCESS_ID=1000;
    END IF;
    --EMP_GATEWAY
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=WBSVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=2000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,2000,WBSVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP_GATEWAY');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP WHERE VERSION=WBSVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=2000;
    END IF;
    --SMT_SPGATE
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=SPGATEVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=3000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,3000,SPGATEVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'SMT_SPGATE');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP WHERE VERSION=SPGATEVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=3000;
    END IF;
    IF NOT EXISTS(SELECT * FROM LF_DB_SCRIPT WHERE VERSION=DBVERSION AND CURRENT_NO=NUM AND TOTAL=TOTAL)
    THEN
      --EMP产品数据库版本信息表
      INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
      VALUES(DBVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,NUM,TOTAL,2,'版本号更改');
    ELSE
      UPDATE LF_DB_SCRIPT SET STATE=2,UPDATETIME=CURRENT TIMESTAMP,MEMO='版本号更改' WHERE  VERSION=DBVERSION AND CURRENT_NO=NUM AND TOTAL=TOTAL;
    END IF;
  END;
CALL ADDVERSIONEXISTS;
DROP PROCEDURE ADDVERSIONEXISTS;
----------- V6.18-V6.19END ------------------------




----------- V6.19-V6.20START ------------------------
CREATE PROCEDURE "ADDVERSIONEXISTS"
  BEGIN ATOMIC
    DECLARE DBVERSION VARCHAR(32);
    DECLARE NUM INT;
    DECLARE TOTAL INT;
    SET DBVERSION = '6.20';
    SET NUM =1;
    SET TOTAL=1;
    IF NOT EXISTS(SELECT * FROM LF_DB_SCRIPT WHERE VERSION=DBVERSION)
    THEN
      --EMP产品数据库版本信息表
      INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
      VALUES(DBVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,NUM,TOTAL,1,'LINUX版本脚本整合');
    END IF;
  END;
CALL ADDVERSIONEXISTS;
DROP PROCEDURE ADDVERSIONEXISTS;

/* EMP升级脚本START */
CREATE PROCEDURE "ADDINDEXEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT * FROM SYSCAT.INDEXES WHERE TABNAME = UPPER('LF_RMS_REPORT') AND INDNAME=UPPER('IND_LF_RMS_REP_IYMD'))
    THEN
      EXECUTE IMMEDIATE 'CREATE INDEX "IND_LF_RMS_REP_IYMD" ON "LF_RMS_REPORT"
      (
        "IYMD" ASC
      )';
    END IF;
  END;
CALL ADDINDEXEXISTS;
DROP PROCEDURE ADDINDEXEXISTS;

CREATE PROCEDURE "ADDINDEXEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT * FROM SYSCAT.INDEXES WHERE TABNAME = UPPER('LF_RMS_REPORT') AND INDNAME=UPPER('IND_LF_RMS_REP_DEG'))
    THEN
      EXECUTE IMMEDIATE 'CREATE INDEX "IND_LF_RMS_REP_DEG" ON "LF_RMS_REPORT"
      (
        "DEGREE" ASC
      )';
    END IF;
  END;
CALL ADDINDEXEXISTS;
DROP PROCEDURE ADDINDEXEXISTS;

CREATE PROCEDURE "ADDINDEXEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT * FROM SYSCAT.INDEXES WHERE TABNAME = UPPER('LF_RMS_REPORT') AND INDNAME=UPPER('IND_LF_RMS_REP_SPCM'))
    THEN
      EXECUTE IMMEDIATE 'CREATE INDEX "IND_LF_RMS_REP_SPCM" ON "LF_RMS_REPORT"
      (
        "SPISUNCM" ASC
      )';
    END IF;
  END;
CALL ADDINDEXEXISTS;
DROP PROCEDURE ADDINDEXEXISTS;

CREATE PROCEDURE "ADDINDEXEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT * FROM SYSCAT.INDEXES WHERE TABNAME = UPPER('LF_RMS_REPORT') AND INDNAME=UPPER('IND_LF_RMS_REP_UID'))
    THEN
      EXECUTE IMMEDIATE 'CREATE INDEX "IND_LF_RMS_REP_UID" ON "LF_RMS_REPORT"
      (
        "USERID" ASC
      )';
    END IF;
  END;
CALL ADDINDEXEXISTS;
DROP PROCEDURE ADDINDEXEXISTS;

/* EMP升级脚本 END */
CREATE PROCEDURE "ADDVERSIONEXISTS"
  BEGIN ATOMIC
    DECLARE VERSION VARCHAR(32);
    DECLARE DBVERSION VARCHAR(32);
    DECLARE WBSVERSION VARCHAR(32);
    DECLARE SPGATEVERSION VARCHAR(32);
    DECLARE NUM INT;
    DECLARE TOTAL INT;
    SET VERSION = '6.8.0.374';
    SET DBVERSION = '6.20';
    SET WBSVERSION = '8.4.22.187_SP4';
    SET SPGATEVERSION = '6.1.26.318';
    SET NUM =1;
    SET TOTAL=1;
    --EMP产品版本记录
    --EMP-WEB
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,1000,VERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP-WEB');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000;
    END IF;
    --EMP_GATEWAY
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,2000,WBSVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP_GATEWAY');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=WBSVERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000;
    END IF;
    --SMT_SPGATE
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,3000,SPGATEVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'SMT_SPGATE');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=SPGATEVERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000;
    END IF;
    --EMP产品版本历史记录
    --EMP-WEB
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=VERSION AND PRODUCT_ID=1000 AND PROCESS_ID=1000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO,ISRELEASE,VERSIONINFO)
      VALUES(1000,1000,VERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP-WEB',1,'1、报表添加索引，优化查询。<br />');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP,ISRELEASE=1,VERSIONINFO='1、报表添加索引，优化查询。<br />' WHERE VERSION=VERSION AND PRODUCT_ID=1000 AND PROCESS_ID=1000;
    END IF;
    --EMP_GATEWAY
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=WBSVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=2000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,2000,WBSVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP_GATEWAY');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP WHERE VERSION=WBSVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=2000;
    END IF;
    --SMT_SPGATE
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=SPGATEVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=3000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,3000,SPGATEVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'SMT_SPGATE');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP WHERE VERSION=SPGATEVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=3000;
    END IF;
    IF NOT EXISTS(SELECT * FROM LF_DB_SCRIPT WHERE VERSION=DBVERSION AND CURRENT_NO=NUM AND TOTAL=TOTAL)
    THEN
      --EMP产品数据库版本信息表
      INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
      VALUES(DBVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,NUM,TOTAL,2,'版本号更改');
    ELSE
      UPDATE LF_DB_SCRIPT SET STATE=2,UPDATETIME=CURRENT TIMESTAMP,MEMO='版本号更改' WHERE  VERSION=DBVERSION AND CURRENT_NO=NUM AND TOTAL=TOTAL;
    END IF;
  END;
CALL ADDVERSIONEXISTS;
DROP PROCEDURE ADDVERSIONEXISTS;
----------- V6.19-V6.20END ------------------------





----------- V6.23-V6.24START -------------------------
CREATE PROCEDURE "ADDVERSIONEXISTS"
  BEGIN ATOMIC
    DECLARE DBVERSION VARCHAR(32);
    DECLARE NUM INT;
    DECLARE TOTAL INT;
    SET DBVERSION = '6.24';
    SET NUM =1;
    SET TOTAL=1;
    IF NOT EXISTS(SELECT * FROM LF_DB_SCRIPT WHERE VERSION=DBVERSION)
    THEN
      --EMP产品数据库版本信息表
      INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
      VALUES(DBVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,NUM,TOTAL,1,'LINUX版本脚本整合');
    END IF;
  END;
CALL ADDVERSIONEXISTS;
DROP PROCEDURE ADDVERSIONEXISTS;

/*网关升级脚本START*/
MERGE INTO  A_GWPARAMCONF A USING (SELECT 'LOADTMPLTIMEINTERVAL' AS "PARAMITEM",4000 AS "GWTYPE" FROM  SYSIBM.DUAL) B ON (A.PARAMITEM=B.PARAMITEM AND A.GWTYPE=B.GWTYPE)
WHEN NOT MATCHED THEN
INSERT(PARAMITEM, PARAMNAME, PARAMATTRIBUTE, PARAMMEMO,DEFAULTVALUE, VALUERANGE,CONTROLTYPE, GWTYPE,HKPARAMNAME,HKPARAMMEMO,ENPARAMNAME,ENPARAMMEMO)
VALUES('LOADTMPLTIMEINTERVAL', '加载模板时间间隔', 1, '从模板表中加载模板到内存中的时间间隔(单位:秒，默认30秒)', '30', '10-3600',0,4000,'加d模板rgg隔','哪０灞碇屑虞d模板到却嬷械rgg隔(挝:秒，默J30秒)',
'Load template interval','The time interval for loading a template from the template table into memory (unit: second, default 30 seconds)')
ELSE IGNORE;

INSERT INTO A_GWPARAMVALUE(GWNO, GWTYPE, PARAMITEM, PARAMVALUE)
SELECT DISTINCT GWNO,4000,'LOADTMPLTIMEINTERVAL','30' FROM A_GWPARAMVALUE
WHERE  NOT EXISTS(SELECT * FROM A_GWPARAMVALUE WHERE PARAMITEM='MORPTPUSHWAY' AND  GWTYPE=4000) AND  GWTYPE=4000;


CREATE PROCEDURE "DELPROC"(IN "PROCNAME1" VARCHAR(20))
  begin
DECLARE STR VARCHAR (256);
DECLARE STR1 VARCHAR (256);
SELECT PROCNAME INTO STR1 FROM SYSCAT.PROCEDURES WHERE  PROCNAME=PROCNAME1;
if  STR1 is not null THEN
  SET STR ='DROP PROCEDURE '||PROCNAME1;
  execute immediate str ;
end if;
end;

CALL DELPROC('DELTABLE');
CREATE PROCEDURE "DELTABLE"(IN "TABLENAME1" VARCHAR(20))
  begin
DECLARE STR VARCHAR (256);
DECLARE STR1 VARCHAR (256);
IF EXISTS (select * from sysibm.systables where TID <> 0 and name = TABLENAME1 ) THEN
  set STR ='drop table '|| TABLENAME1;
  execute immediate str ;
end if;
end;

CALL DELPROC('ADDCOLUMN');
CREATE PROCEDURE ADDCOLUMN (TABLENAME VARCHAR(20),COLUMNNAME VARCHAR(20),COLUMNTYPE VARCHAR(256 ))
BEGIN
DECLARE STR VARCHAR (256);
IF NOT EXISTS ( SELECT * FROM SYSIBM.SYSCOLUMNS WHERE NAME=COLUMNNAME AND TBNAME=TABLENAME ) THEN
  SET STR ='ALTER TABLE ' ||TABLENAME||' ADD COLUMN ' ||COLUMNNAME||'  '|| COLUMNTYPE;
  EXECUTE IMMEDIATE STR ;
  SET STR = 'REORG TABLE '||TABLENAME ;
  CALL SYSPROC .ADMIN_CMD(STR);
END IF;
END;

-- (1)表 GW_MT_TASK_BAK 添加字段
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'LONGMSG','VARCHAR(4000) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'ERRORCODE2','CHARACTER(7) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'DOWNTM','TIMESTAMP NOT NULL DEFAULT CURRENT TIMESTAMP');
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'RMSVALIDTM','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'RMSRPTFLAG','SMALLINT NOT NULL DEFAULT 1');

CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'TMPLTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('GW_MT_TASK_BAK' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');

-- (2)表 MT_LEVEL0_QUEUE 添加字段
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'LONGMSG','VARCHAR(4000) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'RMSVALIDTM','SMALLINT NOT NULL DEFAULT 0');

CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'TMPLTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL0_QUEUE' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');

-- (3)表 MT_LEVEL1_QUEUE 添加字段
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'LONGMSG','VARCHAR(4000) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'RMSVALIDTM','SMALLINT NOT NULL DEFAULT 0');

CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'TMPLTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL1_QUEUE' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');

-- (4)表 MT_LEVEL2_QUEUE 添加字段
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'LONGMSG','VARCHAR(4000) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'RMSVALIDTM','SMALLINT NOT NULL DEFAULT 0');

CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'TMPLTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL2_QUEUE' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');

-- (5)表 MT_LEVEL3_QUEUE 添加字段
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'LONGMSG','VARCHAR(4000) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'RMSVALIDTM','SMALLINT NOT NULL DEFAULT 0');

CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'TMPLTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL3_QUEUE' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');

-- (6)表 MT_LEVEL4_QUEUE 添加字段
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'LONGMSG','VARCHAR(4000) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'RMSVALIDTM','SMALLINT NOT NULL DEFAULT 0');

CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'TMPLTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL4_QUEUE' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');

-- (7)表 MT_LEVEL5_QUEUE 添加字段
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'LONGMSG','VARCHAR(4000) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'RMSVALIDTM','SMALLINT NOT NULL DEFAULT 0');

CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'TMPLTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL5_QUEUE' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');

-- (8)表 MT_LEVEL6_QUEUE 添加字段
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'LONGMSG','VARCHAR(4000) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'RMSVALIDTM','SMALLINT NOT NULL DEFAULT 0');

CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'TMPLTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL6_QUEUE' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');

-- (9)表 MT_LEVEL7_QUEUE 添加字段
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'LONGMSG','VARCHAR(4000) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'RMSVALIDTM','SMALLINT NOT NULL DEFAULT 0');

CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'TMPLTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL7_QUEUE' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');

-- (10)表 MT_LEVEL8_QUEUE 添加字段
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'LONGMSG','VARCHAR(4000) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'RMSVALIDTM','SMALLINT NOT NULL DEFAULT 0');

CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'TMPLTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL8_QUEUE' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');

-- (11)表 MT_LEVEL9_QUEUE 添加字段
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'LONGMSG','VARCHAR(4000) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'RMSVALIDTM','SMALLINT NOT NULL DEFAULT 0');

CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'TMPLTYPE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_LEVEL9_QUEUE' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');


--(12)当月历史表添加字段，无默认值
CALL DELPROC('ADDCOL_MTTASK_CUR');
CREATE PROCEDURE "ADDCOL_MTTASK_CUR" ( )
BEGIN
DECLARE TABLENAME1 VARCHAR(20);
DECLARE TABLENAME2 VARCHAR(20);
DECLARE STR VARCHAR(256);
DECLARE V_SQL VARCHAR(256);
DECLARE　PICNT　INT　DEFAULT　0;
DECLARE　PICNT2　INT　DEFAULT　0;
DECLARE　AT_END　INT　DEFAULT　0;
DECLARE  NOT_FOUND  CONDITION  FOR  SQLSTATE  '02000';
DECLARE V_STMT statement;
DECLARE CUR_TABLE  cursor with hold for V_STMT ;
DECLARE　CONTINUE　HANDLER　FOR　NOT_FOUND
set AT_END=1;

SET V_SQL ='SELECT TABNAME FROM SYSCAT.TABLES WHERE TABSCHEMA = CURRENT SCHEMA AND  TABNAME=''MTTASK'||CAST((SUBSTR(CHAR(CURRENT TIMESTAMP),1,4)||SUBSTR(CHAR(CURRENT TIMESTAMP),6,2))AS INT)||'''';
prepare V_STMT from V_SQL;

OPEN CUR_TABLE;
set AT_END=0;
FETCH CUR_TABLE INTO TABLENAME2;
WHILE AT_END=0 DO
  BEGIN
  --添加字段
   SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='LONGMSG' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
      SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN LONGMSG VARCHAR(4000) ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='TMPLID' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN TMPLID BIGINT ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='CHGRADE' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN CHGRADE SMALLINT ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='MSGTYPE' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN MSGTYPE SMALLINT ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='ERRORCODE2' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN ERRORCODE2 CHARACTER(7) ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='DOWNTM' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN DOWNTM TIMESTAMP ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='RMSVALIDTM' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN RMSVALIDTM SMALLINT ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='RMSRPTFLAG' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN RMSRPTFLAG SMALLINT ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='PROTOCOLVER' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN PROTOCOLVER SMALLINT ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='TMPLTYPE' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN TMPLTYPE SMALLINT ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='TITLE' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
      SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN TITLE VARCHAR(40) ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='SHOWAY' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
      SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN SHOWAY VARCHAR(16) ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='DLDWAY' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN DLDWAY INTEGER ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='DLDNEY' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN DLDNEY INTEGER ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='ISFREE' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN ISFREE INTEGER ';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='SHOWTIME' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN SHOWTIME BIGINT ';
      execute immediate str;
    end IF;
  END;
  FETCH CUR_TABLE INTO TABLENAME2;
   END WHILE;
CLOSE CUR_TABLE;
END;
CALL "ADDCOL_MTTASK_CUR";
CALL DELPROC('ADDCOL_MTTASK_CUR');


--(13)当前月份以后的历史表添加字段有默认值
CALL DELPROC('ADDCOL_MTTASK');
CREATE PROCEDURE "ADDCOL_MTTASK" ( )
BEGIN
DECLARE TABLENAME1 VARCHAR(20);
DECLARE TABLENAME2 VARCHAR(20);
DECLARE STR VARCHAR(256);
DECLARE V_SQL VARCHAR(256);
DECLARE　PICNT　INT　DEFAULT　0;
DECLARE　PICNT2　INT　DEFAULT　0;
DECLARE　AT_END　INT　DEFAULT　0;
DECLARE  NOT_FOUND  CONDITION  FOR  SQLSTATE  '02000';
DECLARE V_STMT statement;
DECLARE CUR_TABLE  cursor with hold for V_STMT ;
DECLARE　CONTINUE　HANDLER　FOR　NOT_FOUND
set AT_END=1;

SET V_SQL ='SELECT TABNAME FROM SYSCAT.TABLES WHERE TABSCHEMA = CURRENT SCHEMA AND  TABNAME LIKE ''MTTASK%'' AND TABNAME>''MTTASK'||CAST((SUBSTR(CHAR(CURRENT TIMESTAMP),1,4)||SUBSTR(CHAR(CURRENT TIMESTAMP),6,2))AS INT)||'''';
prepare V_STMT from V_SQL;

OPEN CUR_TABLE;
set AT_END=0;
FETCH CUR_TABLE INTO TABLENAME2;
WHILE AT_END=0 DO
  BEGIN
  --添加字段
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='LONGMSG' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
      SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN LONGMSG VARCHAR(4000) NOT NULL DEFAULT ''''';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='TMPLID' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN TMPLID BIGINT NOT NULL DEFAULT 0';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='CHGRADE' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN CHGRADE SMALLINT NOT NULL DEFAULT 0';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='MSGTYPE' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN MSGTYPE SMALLINT NOT NULL DEFAULT 0';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='ERRORCODE2' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN ERRORCODE2 CHARACTER(7) NOT NULL DEFAULT ''''';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='DOWNTM' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN DOWNTM TIMESTAMP NOT NULL DEFAULT CURRENT TIMESTAMP';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='RMSVALIDTM' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN RMSVALIDTM SMALLINT NOT NULL DEFAULT 0';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='RMSRPTFLAG' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN RMSRPTFLAG SMALLINT NOT NULL DEFAULT 1';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='PROTOCOLVER' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN PROTOCOLVER SMALLINT NOT NULL DEFAULT 0';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='TMPLTYPE' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN TMPLTYPE SMALLINT NOT NULL DEFAULT 0';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='TITLE' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
      SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN TITLE VARCHAR(40) NOT NULL DEFAULT ''''';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='SHOWAY' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
      SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN SHOWAY VARCHAR(16) NOT NULL DEFAULT ''''';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='DLDWAY' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN DLDWAY INTEGER NOT NULL DEFAULT 0';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='DLDNEY' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN DLDNEY INTEGER NOT NULL DEFAULT 0';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='ISFREE' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN ISFREE INTEGER NOT NULL DEFAULT 0';
      execute immediate str;
    end IF;
  SELECT COUNT(TABNAME) INTO PICNT FROM SYSCAT.COLUMNS WHERE COLNAME='SHOWTIME' AND TABNAME=TABLENAME2 AND tabschema=CURRENT SCHEMA;
   IF PICNT<1 THEN
	  SET STR ='ALTER TABLE '||TABLENAME2||' ADD COLUMN SHOWTIME BIGINT NOT NULL DEFAULT 0';
      execute immediate str;
    end IF;
  END;
  FETCH CUR_TABLE INTO TABLENAME2;
   END WHILE;
CLOSE CUR_TABLE;
END;
CALL "ADDCOL_MTTASK";
CALL DELPROC('ADDCOL_MTTASK');

-- (14)表 MT_DATAREPORT 添加字段
CALL ADDCOLUMN('MT_DATAREPORT' ,'TMPLID','BIGINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_DATAREPORT' ,'CHGRADE','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_DATAREPORT' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0');

-- (15)表 RPT_WAIT_B 添加字段
CALL ADDCOLUMN('RPT_WAIT_B' ,'RPTTYPE','SMALLINT NOT NULL DEFAULT 0');

CALL DELPROC('CREATETABLE');
CREATE PROCEDURE CREATETABLE(PITYPE INTEGER,PIYM INTEGER)
BEGIN

	DECLARE PISTR VARCHAR(4000);
	DECLARE PISTR_1 VARCHAR(256);
	DECLARE PITABLENAME VARCHAR(20);

  IF PITYPE=1 THEN
    SET PITABLENAME='MTTASK'||CAST(PIYM AS CHAR(6));
    SET PISTR='CREATE TABLE '||PITABLENAME||
    '(
    ID         BIGINT NOT NULL,
    MDAY       INTEGER NOT NULL,
    USERID     VARCHAR(11) NOT NULL,
    SPID       VARCHAR(32) NOT NULL DEFAULT '''',
    SPGATE     VARCHAR(21) NOT NULL,
    CPNO       VARCHAR(21) NOT NULL,
    PHONE      VARCHAR(21) NOT NULL,
    SPMSGID    BIGINT NOT NULL,
    RETFLAG    INTEGER NOT NULL,
    FEEFLAG    INTEGER NOT NULL,
    PKNUMBER   INTEGER NOT NULL,
    PKTOTAL    INTEGER NOT NULL,
    SENDSTATUS INTEGER NOT NULL,
    SENDFLAG   INTEGER NOT NULL,
    RECVFLAG   INTEGER NOT NULL,
    DONEDATE   CHAR(10) NOT NULL,
    ERRORCODE  CHAR(7) NOT NULL,
    SENDLEVEL  INTEGER NOT NULL,
    SENDTYPE   INTEGER NOT NULL,
    UNICOM     INTEGER NOT NULL,
    MOBILEAREA INTEGER NOT NULL DEFAULT 0,
    SENDTIME   TIMESTAMP NOT NULL,
    RECVTIME   TIMESTAMP NOT NULL,
    MESSAGE    VARCHAR(3000) NOT NULL,
    TASKID     INTEGER NOT NULL,
    ECID       INTEGER NOT NULL,
    PTMSGID    BIGINT NOT NULL,
    USERMSGID  BIGINT NOT NULL DEFAULT 0,
    MODULEID   INTEGER NOT NULL DEFAULT 0,
    SVRTYPE    VARCHAR(64) NOT NULL DEFAULT '''' ,
    P1         VARCHAR(64) NOT NULL DEFAULT '''' ,
    P2         VARCHAR(64) NOT NULL DEFAULT '''' ,
    P3         VARCHAR(64) NOT NULL DEFAULT '''' ,
    P4         VARCHAR(64) NOT NULL DEFAULT '''' ,
    ATTIME     BIGINT NOT NULL DEFAULT 0,
    VALIDTIME  BIGINT NOT NULL DEFAULT 0,
    BATCHID    BIGINT NOT NULL DEFAULT 0,
    AREACODE   INTEGER NOT NULL DEFAULT 0,
    CUSTID 	   VARCHAR(64) NOT NULL DEFAULT '''',
    EXDATA 	   VARCHAR(64) NOT NULL DEFAULT '''',
	LONGMSG    VARCHAR(4000) NOT NULL DEFAULT '''',
	TMPLID 	   BIGINT NOT NULL,
	CHGRADE    SMALLINT NOT NULL,
	MSGTYPE    SMALLINT NOT NULL,
	ERRORCODE2 CHARACTER(7) NOT NULL DEFAULT '''',
	DOWNTM 	   TIMESTAMP NOT NULL DEFAULT CURRENT TIMESTAMP,
	RMSVALIDTM SMALLINT NOT NULL,
	RMSRPTFLAG SMALLINT NOT NULL,
	PROTOCOLVER SMALLINT NOT NULL DEFAULT 0,
	TMPLTYPE SMALLINT NOT NULL DEFAULT 0,
	TITLE	 VARCHAR(40) NOT NULL DEFAULT '''' ,
	SHOWAY	 VARCHAR(16) NOT NULL DEFAULT '''' ,
	DLDWAY     INTEGER         NOT NULL  DEFAULT 0,
	DLDNEY     INTEGER         NOT NULL  DEFAULT 0,
	ISFREE     INTEGER         NOT NULL  DEFAULT 0,
	SHOWTIME   BIGINT NOT NULL DEFAULT 0
    )
      DATA CAPTURE NONE
    IN TBSPHISTORY';

	EXECUTE IMMEDIATE PISTR;

   SET PISTR_1= 'ALTER TABLE '||PITABLENAME||
    ' LOCKSIZE ROW
    APPEND OFF
    NOT VOLATILE
    LOG INDEX BUILD NULL';

	 EXECUTE IMMEDIATE PISTR_1;


    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'_P1 ON '||PITABLENAME||'(P1)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE UNIQUE INDEX IX_'||PITABLENAME||'_PTID ON '||PITABLENAME||'(PTMSGID)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'_SVRTYPE ON '||PITABLENAME||'(SVRTYPE)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'_TASKID ON '||PITABLENAME||'(TASKID)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'_SENDTIME ON '||PITABLENAME||'(SENDTIME)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'_UID ON '||PITABLENAME||'(USERID)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'_BATCHID ON '||PITABLENAME||'(BATCHID)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'AREACODE ON '||PITABLENAME||'(AREACODE)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'PHONE ON '||PITABLENAME||'(PHONE)';
    EXECUTE IMMEDIATE PISTR_1;

  ELSEIF PITYPE=2 THEN
    SET PITABLENAME='MMSTASK'||CAST(PIYM AS CHAR(6));
    SET PISTR='CREATE TABLE '||PITABLENAME||
    '(
    ID          BIGINT NOT NULL,
    MDAY        INTEGER DEFAULT 0 NOT NULL,
    USERID      VARCHAR(11) NOT NULL DEFAULT '''',
    SPGATE      VARCHAR(21) NOT NULL DEFAULT '''',
    CPNO        VARCHAR(21) NOT NULL DEFAULT '''',
    PHONE       VARCHAR(21) NOT NULL DEFAULT '''',
    SPMSGID     BIGINT DEFAULT 0 NOT NULL,
    RETFLAG     INTEGER DEFAULT 0 NOT NULL,
    FEEFLAG     INTEGER DEFAULT 0 NOT NULL,
    PKNUMBER    INTEGER DEFAULT 0 NOT NULL,
    PKTOTAL     INTEGER DEFAULT 0 NOT NULL,
    SENDSTATUS  INTEGER DEFAULT 0 NOT NULL,
    SENDFLAG    INTEGER DEFAULT 0 NOT NULL,
    RECVFLAG    INTEGER DEFAULT 0 NOT NULL,
    DONEDATE    VARCHAR(10) NOT NULL DEFAULT '''',
    ERRORCODE   VARCHAR(7)  NOT NULL DEFAULT '''' ,
    SENDLEVEL   INTEGER NOT NULL DEFAULT 0,
    SENDTYPE    INTEGER NOT NULL DEFAULT 0,
    UNICOM      INTEGER NOT NULL DEFAULT 0,
    SENDTIME    TIMESTAMP NOT NULL DEFAULT CURRENT TIMESTAMP,
    RECVTIME    TIMESTAMP NOT NULL DEFAULT CURRENT TIMESTAMP,
    MESSAGE     VARCHAR(3000) NOT NULL DEFAULT '''',
    TASKID      INTEGER NOT NULL DEFAULT 0,
    ECID        INTEGER NOT NULL DEFAULT 0,
    PTMSGID     BIGINT  NOT NULL DEFAULT 0,
    SPID        VARCHAR(32) NOT NULL DEFAULT '''',
    MOBILEAREA  INTEGER NOT NULL DEFAULT 0,
    SVRTYPE     VARCHAR(64) NOT NULL DEFAULT '''',
    P1          VARCHAR(64) NOT NULL DEFAULT '''',
    P2          VARCHAR(64) NOT NULL DEFAULT '''',
    P3          VARCHAR(64) NOT NULL DEFAULT '''',
    P4          VARCHAR(64) NOT NULL DEFAULT '''',
    USERMSGID   BIGINT  NOT NULL DEFAULT 0,
    MODULEID    INTEGER NOT NULL DEFAULT 0,
    ATTIME      BIGINT  NOT NULL DEFAULT 0,
    VALIDTIME   BIGINT  NOT NULL DEFAULT 0,
    SPMSGID2    VARCHAR(64) NOT NULL DEFAULT '''',
    JTYPE       INTEGER NOT NULL DEFAULT 0,
    ORDERCPNO   VARCHAR(21) NOT NULL DEFAULT '''',
    PASSTHROUGH INTEGER NOT NULL DEFAULT 0,
    MSGTITLE    VARCHAR(720) NOT NULL DEFAULT '''',
    TMPLID      BIGINT NOT NULL DEFAULT 0,
    MSGTYPE     INTEGER NOT NULL DEFAULT 0,
    ERRORMSG    VARCHAR(256) NOT NULL DEFAULT ''''
    )
      DATA CAPTURE NONE
    IN TBSPHISTORY';
	EXECUTE IMMEDIATE PISTR;

    SET PISTR_1='ALTER TABLE '||PITABLENAME||
    ' LOCKSIZE ROW
    APPEND OFF
    NOT VOLATILE
    LOG INDEX BUILD NULL';

    EXECUTE IMMEDIATE PISTR_1;

    SET PISTR_1='ALTER TABLE '||PITABLENAME||' ADD CONSTRAINT PK_'||PITABLENAME||' PRIMARY KEY (ID)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'_P1 ON '||PITABLENAME||' (P1)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE UNIQUE INDEX IX_'||PITABLENAME||'_PTMSGID ON '||PITABLENAME||' (PTMSGID)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'_SENDTIME ON '||PITABLENAME||' (SENDTIME)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'_SVRTYPE ON '||PITABLENAME||' (SVRTYPE)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'_TASKID ON '||PITABLENAME||' (TASKID)';
    EXECUTE IMMEDIATE PISTR_1;
    SET PISTR_1='CREATE INDEX IX_'||PITABLENAME||'_USERID ON '||PITABLENAME||' (USERID)';
    EXECUTE IMMEDIATE PISTR_1;

  ELSEIF PITYPE=3 THEN
    SET PITABLENAME='MOTASK'||CAST(PIYM AS CHAR(6));
    SET PISTR='CREATE TABLE '||PITABLENAME||
    '(
    ID          BIGINT NOT NULL,
    "UID"       INTEGER NOT NULL,
    USERID      VARCHAR(11) NOT NULL,
    SPNUMBER    VARCHAR(21) NOT NULL,
    SERVICEID   VARCHAR(10) NOT NULL,
    SENDSTATUS  INTEGER NOT NULL,
    DELIVERTIME TIMESTAMP NOT NULL DEFAULT CURRENT TIMESTAMP,
    PHONE       VARCHAR(21) NOT NULL,
    MSGCONTENT  VARCHAR(3000) NOT NULL,
    ECID        INTEGER NOT NULL,
    ORGUID      INTEGER NOT NULL,
    PTMSGID     BIGINT NOT NULL,
    TP_PID      INTEGER NOT NULL,
    TP_UDHI     INTEGER NOT NULL,
    MSGFMT      INTEGER NOT NULL,
    UNICOM      INTEGER NOT NULL DEFAULT 0
    )
      DATA CAPTURE NONE
    IN TBSPHISTORY';

	EXECUTE IMMEDIATE PISTR;

    SET PISTR_1='ALTER TABLE '||PITABLENAME||
    ' LOCKSIZE ROW
    APPEND OFF
    NOT VOLATILE
    LOG INDEX BUILD NULL';

    EXECUTE IMMEDIATE PISTR_1;

    SET PISTR_1='ALTER TABLE '||PITABLENAME||' ADD CONSTRAINT '||PITABLENAME||'_PRIMARY PRIMARY KEY (ID)';
    EXECUTE IMMEDIATE PISTR_1;
  ELSE
     SET PITABLENAME='MMSMOTASK'||CAST(PIYM AS CHAR(6));
     SET PISTR='CREATE TABLE '||PITABLENAME||
     '(
      ID          BIGINT NOT NULL,
      "UID"         INTEGER NOT NULL DEFAULT 0,
      USERID      VARCHAR(11) NOT NULL DEFAULT '''',
      SPNUMBER    VARCHAR(11) NOT NULL DEFAULT '''',
      SERVICEID   VARCHAR(10) NOT NULL DEFAULT '''',
      SENDSTATUS  INTEGER NOT NULL DEFAULT 0,
      DELIVERTIME TIMESTAMP NOT NULL DEFAULT CURRENT TIMESTAMP,
      PHONE       VARCHAR(21) NOT NULL DEFAULT '''',
      MSGCONTENT  VARCHAR(3000) NOT NULL DEFAULT '''',
      ECID        INTEGER NOT NULL DEFAULT 0,
      ORGUID      INTEGER NOT NULL DEFAULT 0,
      PTMSGID     BIGINT NOT NULL DEFAULT 0,
      TP_PID      INTEGER NOT NULL DEFAULT 0,
      TP_UDHI     INTEGER NOT NULL DEFAULT 0,
      MSGFMT      INTEGER NOT NULL DEFAULT 15,
      UNICOM      INTEGER NOT NULL DEFAULT 0 ,
      MSGTYPE     INTEGER NOT NULL DEFAULT 0 ,
      MSGTITLE    VARCHAR(200) NOT NULL DEFAULT '''',
      PASSTHROUGH INTEGER NOT NULL DEFAULT 0
    )
      DATA CAPTURE NONE
    IN TBSPHISTORY';

	EXECUTE IMMEDIATE PISTR;

    SET PISTR_1='ALTER TABLE '||PITABLENAME||
    ' LOCKSIZE ROW
    APPEND OFF
    NOT VOLATILE
    LOG INDEX BUILD NULL';

    EXECUTE IMMEDIATE PISTR_1;

    SET PISTR_1='ALTER TABLE '||PITABLENAME||' ADD CONSTRAINT PK_'||PITABLENAME||' PRIMARY KEY (ID)';
    EXECUTE IMMEDIATE PISTR_1;
  END IF;
  END;

CALL DELTABLE('GW_RMSRPT_RVOK');
CREATE TABLE "GW_RMSRPT_RVOK"
 ("ID"            BIGINT          NOT NULL  GENERATED BY DEFAULT
    AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 100, MINVALUE 1, MAXVALUE 9223372036854775807, NO CYCLE, NO ORDER),
  "USERID"		  VARCHAR(6)	  NOT NULL  DEFAULT '',
  "USERUID"		  INTEGER		  NOT NULL  DEFAULT 0,
  "PTMSGID"       BIGINT          NOT NULL  DEFAULT 0,
  "SPNUMBER"      VARCHAR(21)     NOT NULL  DEFAULT '',
  "PHONE"         VARCHAR(21)     NOT NULL  DEFAULT '',
  "ERRORCODE"	  VARCHAR(7)	  NOT NULL  DEFAULT '',
  "MOBILEAREA"	  INTEGER		  NOT NULL  DEFAULT 0,
  "MOBILETYPE"	  SMALLINT		  NOT NULL  DEFAULT 0,
  "SENDSTATUS"    SMALLINT        NOT NULL  DEFAULT 5,
  "FIRSTDOWNTM"	  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "ENDDOWNTM"	  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "RDNRPTOKTM"	  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "RDNTRANSRPTTM" TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "RECVRDNRPTTM"  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "MOBILECOUNTRY" VARCHAR(10)	  NOT NULL  DEFAULT '',
  "ECID"		  VARCHAR(10)	  NOT NULL  DEFAULT '',
  "MSGTYPE"		  SMALLINT		  NOT NULL  DEFAULT 0,
  "IN_TIME"		  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP
 )
  DATA CAPTURE NONE
 IN "TBSPMTTASKDATA"
 INDEX IN "TBSPMTTASKINDEX";

 ALTER TABLE  "GW_RMSRPT_RVOK"
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  LOG INDEX BUILD NULL;

 ALTER TABLE  "GW_RMSRPT_RVOK"
  ADD CONSTRAINT "GW_RMSRPT_RVOK_PK" PRIMARY KEY
   ("ID"
   );
CREATE INDEX  "IX_GWRMSRPTRVOK_PTMSGID"
  ON  "GW_RMSRPT_RVOK"
 ("PTMSGID" ASC
 )
  PCTFREE 10
  DISALLOW REVERSE SCANS;

CREATE INDEX  "IX_GWRMSRPTRVOK_RECVRDNRPTTM"
  ON  "GW_RMSRPT_RVOK"
 ("RECVRDNRPTTM" ASC
 )
  PCTFREE 10
  DISALLOW REVERSE SCANS;

 CREATE INDEX  "IDX_GWRMSRPTRVOK_INTIME"
  ON  "GW_RMSRPT_RVOK"
 ("IN_TIME" DESC
 )
  PCTFREE 10
  DISALLOW REVERSE SCANS;


CALL DELTABLE('GW_RMSRPT_RVOK_ERR');
CREATE TABLE "GW_RMSRPT_RVOK_ERR"
 ("ID"            BIGINT          NOT NULL  GENERATED BY DEFAULT
    AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 100, MINVALUE 1, MAXVALUE 9223372036854775807, NO CYCLE, NO ORDER),
  "USERID"		  VARCHAR(6)	  NOT NULL  DEFAULT '',
  "USERUID"		  INTEGER		  NOT NULL  DEFAULT 0,
  "PTMSGID"       BIGINT          NOT NULL  DEFAULT 0,
  "SPNUMBER"      VARCHAR(21)     NOT NULL  DEFAULT '',
  "PHONE"         VARCHAR(21)     NOT NULL  DEFAULT '',
  "ERRORCODE"	  VARCHAR(7)	  NOT NULL  DEFAULT '',
  "MOBILEAREA"	  INTEGER		  NOT NULL  DEFAULT 0,
  "MOBILETYPE"	  SMALLINT		  NOT NULL  DEFAULT 0,
  "SENDSTATUS"    SMALLINT        NOT NULL  DEFAULT 5,
  "FIRSTDOWNTM"	  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "ENDDOWNTM"	  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "RDNRPTOKTM"	  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "RDNTRANSRPTTM" TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "RECVRDNRPTTM"  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "MOBILECOUNTRY" VARCHAR(10)	  NOT NULL  DEFAULT '',
  "ECID"		  VARCHAR(10)	  NOT NULL  DEFAULT '',
  "MSGTYPE"		  SMALLINT		  NOT NULL  DEFAULT 0,
  "IN_TIME"		  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP
 )
  DATA CAPTURE NONE
 IN "TBSPMTTASKDATA"
 INDEX IN "TBSPMTTASKINDEX";

 ALTER TABLE  "GW_RMSRPT_RVOK_ERR"
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  LOG INDEX BUILD NULL;

 ALTER TABLE  "GW_RMSRPT_RVOK_ERR"
  ADD CONSTRAINT "GW_RMSRPT_RVOK_ERR_PK" PRIMARY KEY
   ("ID"
   );
CREATE INDEX  "IX_GWRMSRPTRVOKERR_PTMSGID"
  ON  "GW_RMSRPT_RVOK_ERR"
 ("PTMSGID" ASC
 )
  PCTFREE 10
  DISALLOW REVERSE SCANS;

CREATE INDEX  "IX_GWRMSRPTRVOKERR_RECVRDNRPTTM"
  ON  "GW_RMSRPT_RVOK_ERR"
 ("RECVRDNRPTTM" ASC
 )
  PCTFREE 10
  DISALLOW REVERSE SCANS;

 CREATE INDEX  "IDX_GWRMSRPTRVOKERR_INTIME"
  ON  "GW_RMSRPT_RVOK_ERR"
 ("IN_TIME" DESC
 )
  PCTFREE 10
  DISALLOW REVERSE SCANS;


CALL DELTABLE('GW_RMSRPT_RVOK_BAK');
CREATE TABLE "GW_RMSRPT_RVOK_BAK"
 ("ID"            BIGINT          NOT NULL  GENERATED BY DEFAULT
    AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 100, MINVALUE 1, MAXVALUE 9223372036854775807, NO CYCLE, NO ORDER),
  "USERID"		  VARCHAR(6)	  NOT NULL  DEFAULT '',
  "USERUID"		  INTEGER		  NOT NULL  DEFAULT 0,
  "PTMSGID"       BIGINT          NOT NULL  DEFAULT 0,
  "SPNUMBER"      VARCHAR(21)     NOT NULL  DEFAULT '',
  "PHONE"         VARCHAR(21)     NOT NULL  DEFAULT '',
  "ERRORCODE"	  VARCHAR(7)	  NOT NULL  DEFAULT '',
  "MOBILEAREA"	  INTEGER		  NOT NULL  DEFAULT 0,
  "MOBILETYPE"	  SMALLINT		  NOT NULL  DEFAULT 0,
  "SENDSTATUS"    SMALLINT        NOT NULL  DEFAULT 5,
  "FIRSTDOWNTM"	  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "ENDDOWNTM"	  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "RDNRPTOKTM"	  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "RDNTRANSRPTTM" TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "RECVRDNRPTTM"  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP,
  "MOBILECOUNTRY" VARCHAR(10)	  NOT NULL  DEFAULT '',
  "ECID"		  VARCHAR(10)	  NOT NULL  DEFAULT '',
  "MSGTYPE"		  SMALLINT		  NOT NULL  DEFAULT 0,
  "IN_TIME"		  TIMESTAMP		  NOT NULL  DEFAULT CURRENT TIMESTAMP
 )
  DATA CAPTURE NONE
 IN "TBSPMTTASKDATA"
 INDEX IN "TBSPMTTASKINDEX";

 ALTER TABLE  "GW_RMSRPT_RVOK_BAK"
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  LOG INDEX BUILD NULL;

 ALTER TABLE  "GW_RMSRPT_RVOK_BAK"
  ADD CONSTRAINT "GW_RMSRPT_RVOK_BAK_PK" PRIMARY KEY
   ("ID"
   );
CREATE INDEX  "IX_GWRMSRPTRVOKBAK_PTMSGID"
  ON  "GW_RMSRPT_RVOK_BAK"
 ("PTMSGID" ASC
 )
  PCTFREE 10
  DISALLOW REVERSE SCANS;

CREATE INDEX  "IX_GWRMSRPTRVOKBAK_RECVRDNRPTTM"
  ON  "GW_RMSRPT_RVOK_BAK"
 ("RECVRDNRPTTM" ASC
 )
  PCTFREE 10
  DISALLOW REVERSE SCANS;

 CREATE INDEX  "IDX_GWRMSRPTRVOKBAK_INTIME"
  ON  "GW_RMSRPT_RVOK_BAK"
 ("IN_TIME" DESC
 )
  PCTFREE 10
  DISALLOW REVERSE SCANS;


CALL DELPROC('GW_WR_RMSRPT_RVOK');
CREATE PROCEDURE "GW_WR_RMSRPT_RVOK"
 (IN "PIUSERID" INTEGER,
  IN "PIUSERUID" BIGINT,
  IN "PIPTMSGID" SMALLINT,
  IN "PISPNUMBER" SMALLINT,
  IN "PIPHONE" INTEGER,
  IN "PIERRORCODE" SMALLINT,
  IN "PIMOBILEAREA" SMALLINT,
  IN "PIMOBILETYPE" INTEGER,
  IN "PISENDSTATUS" VARCHAR(11),
  IN "PIFIRSTDOWNTM" VARCHAR(21),
  IN "PIENDDOWNTM" VARCHAR(21),
  IN "PIRDNRPTOKTM" TIMESTAMP,
  IN "PIRDNTRANSRPTTM" VARCHAR(3500),
  IN "PIRECVRDNRPTTM" VARCHAR(3000),
  IN "PIMOBILECOUNTRY" SMALLINT,
  IN "PIECID" INTEGER,
  IN "PIMSGTYPE" INTEGER
 )
  SPECIFIC "GW_WR_RMSRPT_RVOK"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
	IF NOT EXISTS (SELECT PTMSGID  FROM GW_RMSRPT_RVOK WHERE PTMSGID = PIPTMSGID ) THEN
     INSERT INTO GW_RMSRPT_RVOK(USERID,USERUID,PTMSGID,SPNUMBER,PHONE,ERRORCODE,MOBILEAREA,MOBILETYPE,SENDSTATUS,FIRSTDOWNTM,ENDDOWNTM,RDNRPTOKTM,
	 RDNTRANSRPTTM,RECVRDNRPTTM,MOBILECOUNTRY,ECID,MSGTYPE )
     VALUES(PIUSERID,PIUSERUID,PIPTMSGID,PISPNUMBER,PIPHONE,PIERRORCODE,PIMOBILEAREA,PIMOBILETYPE,PISENDSTATUS,PIFIRSTDOWNTM,PIENDDOWNTM,PIRDNRPTOKTM,
	 PIRDNTRANSRPTTM,PIRECVRDNRPTTM,PIMOBILECOUNTRY,PIECID,PIMSGTYPE);
	END IF;
END;


CALL DELPROC('GW_DEL_ERR');
CREATE PROCEDURE "GW_DEL_ERR" ( )
  SPECIFIC "GW_DEL_ERR"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
DECLARE STR VARCHAR(3000);
DECLARE STR1 VARCHAR(3000);
DECLARE STR2 VARCHAR(3000);
DECLARE PROCESSFLAG INTEGER;

DECLARE I BIGINT;
DECLARE PIERROR VARCHAR(3000);
 DECLARE PIERROR1 VARCHAR(3000);
 DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
  BEGIN
	GET DIAGNOSTICS EXCEPTION 1 PIERROR = MESSAGE_TEXT;
  END ;
  SET PROCESSFLAG=3;
  SET I=0;
 WHILE ( I<3 ) DO
  SET PIERROR1=NULL; SET PIERROR=NULL;
  SET STR1=' ID,PTMSGID,SPMSGID,SENDSTATUS,SPID,TRANSMTTIME,MTSUBMITTIME,SENDTIME,ERRRESENDCNT,NETERRCNT,SENDRESULT,SPGATESEND,SPNUMBER,PHONE,SENDERRCODE,TPUDHI,TPPID,PKTOTAL,PKNUMBER,LONGMSGSEQ,IN_TIME  ';
  SET STR2='(ID,PTMSGID,SPMSGID,SENDSTATUS,SPID,TRANSMTTIME,MTSUBMITTIME,SENDTIME,ERRRESENDCNT,NETERRCNT,SENDRESULT,SPGATESEND,SPNUMBER,PHONE,SENDERRCODE,TPUDHI,TPPID,PKTOTAL,PKNUMBER,LONGMSGSEQ,IN_TIME ) ';
  SET STR ='INSERT INTO  GW_MTSDOK_ERR'||STR2||' SELECT '||STR1||' FROM GW_MTSDOK WHERE IN_TIME < TIMESTAMP (TRIM(CAST((CURRENT DATE - '||CHAR(PROCESSFLAG)||' DAYS) AS CHAR(32)))||'' 00:00:00.000000'') WITH UR ';    ---不影响mt_task插入  查询  between endid ...maxid
  EXECUTE IMMEDIATE STR;
  SET PIERROR1=PIERROR;


  IF PIERROR1 is null THEN
     DELETE FROM GW_MTSDOK WHERE IN_TIME < TIMESTAMP (TRIM(CAST((CURRENT DATE - PROCESSFLAG DAYS) AS CHAR(32)))||' 00:00:00.000000');
	 SET I=3;
  ELSE
     INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('TRANERR','GW_MTSDOK..TO..GW_MTSDOK_ERR',PIERROR1);
     DELETE FROM GW_MTSDOK_ERR  WHERE EXISTS (SELECT PTMSGID FROM  GW_MTSDOK  B WHERE GW_MTSDOK_ERR.ID=B.ID AND B.IN_TIME < TIMESTAMP (TRIM(CAST((CURRENT DATE - PROCESSFLAG DAYS) AS CHAR(32)))||' 00:00:00.000000') ) ;
     SET I=I+1;
 END IF;
END WHILE;


 SET I=0;
 WHILE ( I<3 ) DO
  SET PIERROR1=NULL; SET PIERROR=NULL;
 SET STR1='ID,PTMSGID,SPMSGID,SENDSTATUS,RECVTIME,DONEDATE,SUBMITDATE,ERRORCODE ,PHONE,SPNUMBER,IN_TIME  ';
 SET STR2='(ID,PTMSGID,SPMSGID,SENDSTATUS,RECVTIME,DONEDATE,SUBMITDATE,ERRORCODE ,PHONE,SPNUMBER,IN_TIME ) ';
 SET STR ='INSERT INTO  GW_RPTRVOK_ERR'||STR2||' SELECT '||STR1||'FROM GW_RPTRVOK WHERE IN_TIME < TIMESTAMP (TRIM(CAST((CURRENT DATE - '||CHAR(PROCESSFLAG)||' DAYS) AS CHAR(32)))||'' 00:00:00.000000'') WITH UR ';    ---不影响mt_task插入  查询  between endid ...maxid
 EXECUTE IMMEDIATE STR;
 SET PIERROR1=PIERROR;
 IF PIERROR1 is null THEN
  DELETE FROM GW_RPTRVOK WHERE IN_TIME < TIMESTAMP (TRIM(CAST((CURRENT DATE - PROCESSFLAG DAYS) AS CHAR(32)))||' 00:00:00.000000');
   SET I=3;
  ELSE
   INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('TRANERR','GW_RPTRVOK..TO..GW_RPTRVOK_ERR',PIERROR1);
    DELETE FROM GW_RPTRVOK_ERR  WHERE EXISTS (SELECT PTMSGID FROM  GW_RPTRVOK  B WHERE GW_RPTRVOK_ERR.ID=B.ID AND B.IN_TIME < TIMESTAMP (TRIM(CAST((CURRENT DATE - PROCESSFLAG DAYS) AS CHAR(32)))||' 00:00:00.000000') ) ;
     SET I=I+1;
 END IF;
END WHILE;



  SET I=0;
 WHILE ( I<3 ) DO
   SET PIERROR1=NULL; SET PIERROR=NULL;
   SET STR1=' ID,PTMSGID,SPMSGID,SENDSTATUS,SENDFLAG,SENDRPTTIME,TRANSRPTTIME,ERRORCODE,PHONE,SPNUMBER,IN_TIME  ';
  SET STR2='(ID,PTMSGID,SPMSGID,SENDSTATUS,SENDFLAG,SENDRPTTIME,TRANSRPTTIME,ERRORCODE,PHONE,SPNUMBER,IN_TIME ) ';
  SET STR ='INSERT INTO  GW_RPTSDOK_ERR'||STR2||' SELECT '||STR1||'FROM GW_RPTSDOK WHERE IN_TIME < TIMESTAMP (TRIM(CAST((CURRENT DATE - '||CHAR(PROCESSFLAG)||' DAYS) AS CHAR(32)))||'' 00:00:00.000000'') WITH UR ';    ---不影响mt_task插入  查询  between endid ...maxid
  EXECUTE IMMEDIATE STR;
  SET PIERROR1=PIERROR;
   IF PIERROR1 is null THEN
     DELETE FROM GW_RPTSDOK WHERE IN_TIME < TIMESTAMP (TRIM(CAST((CURRENT DATE - PROCESSFLAG DAYS) AS CHAR(32)))||' 00:00:00.000000');
    SET I=3;
  ELSE
    INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('TRANERR','GW_RPTSDOK..TO..GW_RPTSDOK_ERR',PIERROR1);
    DELETE FROM GW_RPTSDOK_ERR  WHERE EXISTS (SELECT PTMSGID FROM  GW_RPTSDOK  B WHERE GW_RPTSDOK_ERR.ID=B.ID AND B.IN_TIME < TIMESTAMP (TRIM(CAST((CURRENT DATE - PROCESSFLAG DAYS) AS CHAR(32)))||' 00:00:00.000000') ) ;
     SET I=I+1;
 END IF;
END WHILE;


DELETE FROM GW_TRAN_DEL_LOG WHERE END_TIME<CURRENT TIMESTAMP-90 days WITH UR;
DELETE FROM GW_UPD_DEL_LOG WHERE END_TIME<CURRENT TIMESTAMP-90 days WITH UR;

DELETE FROM GW_MT_TASK_ERR WHERE SENDTIME<CURRENT TIMESTAMP-90 days WITH UR;
DELETE FROM GW_MTSDOK_ERR WHERE IN_TIME<CURRENT TIMESTAMP-90 days WITH UR;
DELETE FROM GW_RPTRVOK_ERR WHERE IN_TIME<CURRENT TIMESTAMP-90 days WITH UR;
DELETE FROM GW_RPTSDOK_ERR WHERE IN_TIME<CURRENT TIMESTAMP-90 days WITH UR;

END;


CALL DELPROC('GW_UPPRMSRPTRVOK');
CREATE PROCEDURE "GW_UPPRMSRPTRVOK"
 (IN "PRETIME" INTEGER,IN "INCRES" BIGINT,IN "STARTTIME" VARCHAR(30)
 )
  SPECIFIC "GW_UPPRMSRPTRVOK"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  begin
DECLARE STR VARCHAR(256);
DECLARE A INTEGER;
DECLARE rows1 INTEGER ;
DECLARE LOGID INTEGER ;
DECLARE I INTEGER DEFAULT 0;
DECLARE J INTEGER DEFAULT 0;
DECLARE REMAINDER INTEGER DEFAULT 0;
DECLARE COUNTID BIGINT DEFAULT 0;
DECLARE MAXID BIGINT DEFAULT 0;
DECLARE CURMINID BIGINT DEFAULT 0;
DECLARE CURMAXID BIGINT DEFAULT 0;
DECLARE MINID BIGINT DEFAULT 0;
DECLARE MINLONG BIGINT DEFAULT 0;
declare  locl result_set_locator varying;
DECLARE PIERROR VARCHAR(3000);
DECLARE CONTINUE HANDLER FOR SQLSTATE '21506'
  BEGIN
	GET DIAGNOSTICS EXCEPTION 1 PIERROR = MESSAGE_TEXT;
  END ;


------------------更新GW_RMSRPT_RVOK表-------------------------------------------


SELECT COALESCE(MIN(ID),0),COALESCE(MAX(ID),0) INTO MINID,MAXID FROM GW_RMSRPT_RVOK WITH UR;

IF ( 0=MAXID and 0=MINID ) THEN
RETURN;
END IF;

SELECT (MAXID-MINID+1)/INCRES,MOD((MAXID-MINID+1),INCRES) INTO J,REMAINDER  FROM SYSIBM.SYSDUMMY1;
IF REMAINDER<>0 THEN
SET J=J+1;END IF;

WHILE (I < J) DO
INSERT INTO GW_UPD_DEL_LOG(OPRTYPE,UPTYPE,COUNTID,ISSUCCES,IN_TIME,END_TIME) VALUES(7,1,0,0,CURRENT TIMESTAMP,CURRENT TIMESTAMP);
SELECT IDENTITY_VAL_LOCAL() INTO LOGID FROM SYSIBM.SYSDUMMY1;
SET CURMINID=MINID+INCRES*I;
SET CURMAXID=CURMINID+INCRES-1;
IF I=J-1 THEN
  SET CURMAXID=MAXID;
END IF;
set PIERROR=null;
MERGE INTO  GW_MT_TASK_BAK AS A using GW_RMSRPT_RVOK AS B on ( A.PTMSGID=B.PTMSGID AND B.ID >= CURMINID AND B.ID <= CURMAXID)
WHEN MATCHED THEN
UPDATE SET  A.ERRORCODE2  =B.ERRORCODE,
      A.DOWNTM      =B.FIRSTDOWNTM;   ---批量 更新   SPMSGID(汇总不考虑)      MT_TASK_BAK增加SPMSGID
GET DIAGNOSTICS rows1 = ROW_COUNT;
IF PIERROR IS NOT NULL THEN
  set PIERROR=null;
  set rows1=null;
--------------若有重复的 则去重 更新
   MERGE INTO  GW_MT_TASK_BAK A using (SELECT  PTMSGID,ERRORCODE,FIRSTDOWNTM  FROM  GW_RMSRPT_RVOK WHERE  ID >= CURMINID AND ID <= CURMAXID GROUP BY PTMSGID,ERRORCODE,FIRSTDOWNTM ) AS  B  on ( A.PTMSGID=B.PTMSGID )
   WHEN MATCHED THEN
   UPDATE SET   A.ERRORCODE2  =B.ERRORCODE,
      A.DOWNTM      =B.FIRSTDOWNTM;
   GET DIAGNOSTICS rows1 = ROW_COUNT;
   UPDATE GW_UPD_DEL_LOG SET UPTYPE=2,COUNTID=rows1, ISSUCCES=1,END_TIME=CURRENT TIMESTAMP WHERE ID=LOGID;
   set rows1=null;
 ELSE
   UPDATE GW_UPD_DEL_LOG SET COUNTID=rows1,ISSUCCES=1, END_TIME=CURRENT TIMESTAMP WHERE ID=LOGID;
END IF;
  set PIERROR=null;
COMMIT;
 -------------删除更新成功的
  INSERT INTO GW_UPD_DEL_LOG(OPRTYPE,UPTYPE,COUNTID,ISSUCCES,IN_TIME,END_TIME) VALUES(8,0,0,0,CURRENT TIMESTAMP,CURRENT TIMESTAMP);
  SELECT IDENTITY_VAL_LOCAL() INTO LOGID FROM SYSIBM.SYSDUMMY1;
  DELETE FROM  GW_RMSRPT_RVOK WHERE EXISTS (SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE GW_RMSRPT_RVOK.PTMSGID =GW_MT_TASK_BAK.PTMSGID AND GW_MT_TASK_BAK.FLAGMTSDOK=1 ) AND ID >= CURMINID AND ID <= CURMAXID;
   GET DIAGNOSTICS rows1 = ROW_COUNT;
  IF PIERROR IS  NULL THEN
   UPDATE GW_UPD_DEL_LOG SET COUNTID=rows1,ISSUCCES=1, END_TIME=CURRENT TIMESTAMP WHERE ID=LOGID;
  END IF;
  SET  MINLONG=TIMESTAMPDIFF(4,CHAR(CURRENT TIMESTAMP - TIMESTAMP(STARTTIME)));
  IF MINLONG>=PRETIME THEN
      SET  I=J;
  ELSE
      SET I=I+1;
 END IF;
COMMIT;
END WHILE;

END;


CALL DELPROC('GW_LOADLFTEMPLATE');
CREATE PROCEDURE GW_LOADLFTEMPLATE()
SPECIFIC "GW_LOADLFTEMPLATE"
  DYNAMIC RESULT SETS 1
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  READS SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
        DECLARE PISQLSTR VARCHAR(1000);
   	DECLARE RS1 CURSOR WITH RETURN FOR S1;
	SET PISQLSTR = 'SELECT TM_ID,USER_ID,TM_NAME,TM_MSG,DSFLAG,TM_STATE,ADDTIME,ISPASS,TMP_TYPE,BIZ_CODE,CORP_CODE,PARAMCNT,TM_CODE,SP_TEMPLID,DEGREE,RMSRESSIZE,H5RESSIZE,ISPUBLIC,PARAMSNUM,VER  FROM LF_TEMPLATE WHERE TM_STATE=1 AND (TMP_TYPE=3 OR TMP_TYPE=11)';
	PREPARE S1 FROM PISQLSTR;
	OPEN RS1;

END;



CALL DELPROC('GW_H_STATISTIV3');
CREATE PROCEDURE "GW_H_STATISTIV3"
 (IN "PIPROCESSFLAG" INTEGER,
  IN "ISP1" INTEGER,
  IN "ISP2" INTEGER,
  IN "ISP3" INTEGER,
  IN "ISP4" INTEGER
 )
  SPECIFIC "GW_H_STATISTIV3"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
	DECLARE STR VARCHAR(4000);
	DECLARE BEGTIME VARCHAR(32);
	DECLARE ENDTIME VARCHAR(32);
	DECLARE MAXIYMD INTEGER;
	DECLARE DIFFDATE INTEGER;
	DECLARE MINTMIYMD INTEGER;
	DECLARE MAXTMIYMD INTEGER;

	DECLARE GLOBAL TEMPORARY TABLE SESSION.TEMP_STATISTICS (
	USERID VARCHAR(11),
	TASKID INTEGER,
	SPGATE VARCHAR(21),
	SPISUNCM INTEGER,
	SPID VARCHAR(32),
	SVRTYPE VARCHAR(64),
	P1 VARCHAR(64),
	P2 VARCHAR(64),
	P3 VARCHAR(64),
	P4 VARCHAR(64),
    IYMD INTEGER,
	IYEAR INTEGER,
	IMONTH INTEGER,
	IHOUR INTEGER,
	ICOUNT INTEGER,
	SUCC INTEGER,
	FAIL INTEGER,
	NRET INTEGER,
	MOBILEAREA INTEGER,
	SENDTYPE INTEGER,
	BATCHID BIGINT,AREACODE INTEGER,TMPLID BIGINT,CHGRADE SMALLINT,MSGTYPE SMALLINT) ON COMMIT DELETE ROWS NOT LOGGED WITH REPLACE;

     SELECT  COALESCE(MAX(IYMD),20000101)  INTO MAXIYMD FROM MT_DATAREPORT ;
	SET DIFFDATE=days(CURRENT DATE - 2 days) - days(date(SUBSTR(CHAR(MAXIYMD),1,4)||'-'||SUBSTR(CHAR(MAXIYMD),5,2)||'-'||SUBSTR(CHAR(MAXIYMD),7,2)));
	IF DIFFDATE>0 THEN
          SET PIPROCESSFLAG=PIPROCESSFLAG+DIFFDATE;
	END IF;

	SET BEGTIME = TRIM(CAST((CURRENT DATE - PIPROCESSFLAG DAYS) AS CHAR(32)))||' 00:00:00.000000';
	SET ENDTIME = TRIM(CAST((CURRENT DATE) AS CHAR(32)))||' 00:00:00.000000';



	SET STR= 'INSERT INTO SESSION.TEMP_STATISTICS(USERID,TASKID,SPGATE,SPISUNCM,SPID,SVRTYPE,P1,P2,P3,P4,IYMD,IYEAR,IMONTH,IHOUR,ICOUNT,SUCC,FAIL,NRET,MOBILEAREA,SENDTYPE,BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE)
               SELECT  USERID,TASKID,SPGATE,UNICOM,SPID,SVRTYPE';
			   IF ISP1 =1 THEN
			    SET STR=STR||' ,P1';
			   ELSE
			    SET STR=STR||','' '' AS P1';
			   END IF;
			   IF ISP2 =1 THEN
			    SET STR=STR||' ,P2';
			   ELSE
			    SET STR=STR||','' '' AS P2';
			   END IF;
			   IF ISP3 =1 THEN
			    SET STR=STR||' ,P3';
			   ELSE
			    SET STR=STR||','' '' AS P3';
			   END IF;
			   IF ISP4 =1 THEN
			    SET STR=STR||' ,P4';
			   ELSE
			    SET STR=STR||','' '' AS P4';
			   END IF;

               SET STR=STR||', INT(DATE(SENDTIME)) AS IYMD,
               INT(YEAR(SENDTIME)) AS IYEAR,
               INT(MONTH(SENDTIME)) AS MON,
               INT(HOUR(SENDTIME)) AS HOUR,
               COUNT(ID),
			         VALUE(COUNT(CASE TRIM(ERRORCODE) WHEN ''DELIVRD'' THEN 1 WHEN ''0'' THEN 1 ELSE NULL END),0),
			         VALUE(COUNT(CASE SUBSTR(ERRORCODE,1,3) WHEN ''E1:'' THEN 1 WHEN ''E2:'' THEN 1 ELSE NULL END),0),
			         VALUE(COUNT(CASE LENGTH(TRIM(ERRORCODE))  WHEN 0 THEN 1 ELSE NULL END ),0),
			         MOBILEAREA,
			         SENDTYPE,
			         BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE
               FROM GW_MT_TASK_BAK
               WHERE SENDTIME BETWEEN '''||BEGTIME|| ''' AND '''||ENDTIME||''' GROUP BY
               USERID,TASKID,SPGATE,UNICOM,SPID,SVRTYPE';
	         IF ISP1 =1 THEN
			    SET STR=STR||' ,P1';
             END IF;
			 IF ISP2 =1 THEN
			    SET STR=STR||' ,P2';
             END IF;
			 IF ISP3 =1 THEN
			    SET STR=STR||' ,P3';
			   END IF;
			 IF ISP4 =1 THEN
			    SET STR=STR||' ,P4';
			   END IF;
	 SET STR=STR||',MOBILEAREA,SENDTYPE,BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE,
               INT(DATE(SENDTIME)),
               INT(YEAR(SENDTIME)),
               INT(MONTH(SENDTIME)),
               INT(HOUR(SENDTIME))';

       EXECUTE IMMEDIATE STR;
       --插入或更新统计表
	  SELECT MIN(IYMD) , MAX(IYMD) INTO MINTMIYMD,MAXTMIYMD FROM SESSION.TEMP_STATISTICS;
      DELETE FROM MT_DATAREPORT WHERE IYMD BETWEEN MINTMIYMD AND MAXTMIYMD;

      INSERT INTO MT_DATAREPORT(USERID,TASKID,SPGATE,SPISUNCM,SPID,SVRTYPE,P1,P2,P3,P4,IYMD,IHOUR,IMONTH,Y,ICOUNT,RSUCC,RFAIL1,RFAIL2,RNRET, SENDTYPE, MOBILEAREA,BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE)
      SELECT T.USERID,T.TASKID,T.SPGATE,T.SPISUNCM,T.SPID,T.SVRTYPE,T.P1,T.P2,T.P3,T.P4,T.IYMD,T.IHOUR,T.IMONTH,T.IYEAR,T.ICOUNT,T.SUCC,T.FAIL,(T.ICOUNT-T.SUCC-T.FAIL-T.NRET),T.NRET, T.SENDTYPE, T.MOBILEAREA,T.BATCHID ,T.AREACODE, T.TMPLID,T.CHGRADE,T.MSGTYPE
      FROM SESSION.TEMP_STATISTICS  T;
      COMMIT;
   END;


CALL DELPROC('GW_H_DATATRANV3');
CREATE PROCEDURE "GW_H_DATATRANV3"
 (IN "ISP1" INTEGER,
  IN "ISP2" INTEGER,
  IN "ISP3" INTEGER,
  IN "ISP4" INTEGER
 )
  SPECIFIC "GW_H_DATATRANV3"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  NAP:BEGIN NOT ATOMIC
  DECLARE PIPROCESSINGSTATUSCOUNT INTEGER; --PROCESSINGSTATUS表记录数(根据USEID设置值判断,为1正常)
  DECLARE PIUSEID                 INTEGER; --使用哪一个USEID作为当前状态处理
  DECLARE PICURRINDEX             BIGINT; --当前处理位置
  DECLARE PIMAXINDEX              BIGINT; --此次执行的最大位置
  DECLARE PICOUNTSTATUS           INTEGER; --统计状态0:正常,1:错误
  DECLARE PIDISTRACTSTATUS        INTEGER; --数据转移状态0:正常,1:错误
  DECLARE PIDELETESTATUS          INTEGER; --删除状态0:正常,1:错误
  DECLARE PIPROCESSFLAG           INTEGER; --转移方式0:处理今天（含今天)以前的，1为前一天以前的 ,2为前二天以前的...以此类推,

  --异常退出
  DECLARE PICOUNTEXCEPTION        INTEGER; --允许统计异常最大值
  DECLARE PIDISTRACTEXCEPTION     INTEGER; --允许数据转移异常最大值
  DECLARE PIDELETEEXCEPTION       INTEGER; --允许删除数据异常最大值
  DECLARE PIALLEXCEPTION          INTEGER; --允许所有异常最大值

  --批量转移临时变量
  DECLARE PI_CURINDEX           BIGINT;
  DECLARE PI_MAXINDEX           BIGINT;
  DECLARE PI_MININDEX           BIGINT;
  DECLARE EACHMAX               INTEGER; --每次处理最大数

  DECLARE MINYM   INTEGER;
  DECLARE MAXYM   INTEGER;
  DECLARE CURYM   INTEGER;
  DECLARE PITABLENAME VARCHAR(20);
  DECLARE MAXTIME TIMESTAMP;
  DECLARE MINTIME TIMESTAMP;
  DECLARE ISEXIST INTEGER;
  DECLARE PISTR   VARCHAR(256);

  --异常代码
  DECLARE SQLCODE INTEGER;
  DECLARE PIERROR VARCHAR(4000);
  DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
  BEGIN
	GET DIAGNOSTICS EXCEPTION 1 PIERROR = MESSAGE_TEXT;
  END ;

--------------------VER 3.2------------------------------------
--初始化
  SET PIPROCESSINGSTATUSCOUNT = 0;
  SET PIUSEID                 = 1;
  SET PICURRINDEX             = 0;
  SET PIMAXINDEX              = 0;
  SET PICOUNTSTATUS           = 1;
  SET PIDISTRACTSTATUS        = 1;
  SET PIDELETESTATUS          = 1;
  SET PIPROCESSFLAG           = 3;
  SET EACHMAX               = 500000;
  SET PICOUNTEXCEPTION        = 5;
  SET PIDISTRACTEXCEPTION     = 5;
  SET PIDELETEEXCEPTION       = 5;
  SET PIALLEXCEPTION          = 10;

      INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('SMS','GW_H_DATATRANV3','短信汇总调度存储过程执行开始');

      --先汇总

	  CALL GW_H_STATISTIV3(PIPROCESSFLAG,ISP1,ISP2,ISP3,ISP4);
	  IF PIERROR <> '' THEN
	    INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('SMS','短信下行汇总GW_H_STATISTIV3',PIERROR);
	  END IF;

      --再转移
      --先根据指定USEID判断是否有值
      SELECT COUNT(USEID) INTO PIPROCESSINGSTATUSCOUNT FROM PROCESSINGSTATUS WHERE USEID = PIUSEID;
      --如果没有先初始化PROCESSINGSTATUS,否则取当表中值
       IF (PIPROCESSINGSTATUSCOUNT = 0) THEN
       BEGIN
        CALL H_PROCESSINGSTATUS(PIUSEID,0,0,0,0,0);
	    SELECT CURRINDEX,MAXINDEX,COUNTSTATUS,DISTRACTSTATUS,DELETESTATUS
        INTO PICURRINDEX,PIMAXINDEX,PICOUNTSTATUS,PIDISTRACTSTATUS,PIDELETESTATUS
        FROM PROCESSINGSTATUS WHERE USEID = PIUSEID;
	  END;
      ELSE
        SELECT CURRINDEX,MAXINDEX,COUNTSTATUS,DISTRACTSTATUS,DELETESTATUS
        INTO PICURRINDEX,PIMAXINDEX,PICOUNTSTATUS,PIDISTRACTSTATUS,PIDELETESTATUS
        FROM PROCESSINGSTATUS WHERE USEID = PIUSEID;
      END IF;

     --转移符合当前时间的数据
     SELECT VALUE(MIN(ID),0) INTO PIMAXINDEX FROM GW_MT_TASK_BAK  WHERE  SENDTIME>=TIMESTAMP (TRIM(CAST((CURRENT DATE - PIPROCESSFLAG DAYS) AS CHAR(32)))||' 00:00:00.000000');
IF  PIMAXINDEX>0 THEN
SET PIMAXINDEX=PIMAXINDEX-1;
END IF;
     IF(PICURRINDEX<PIMAXINDEX)THEN
     SELECT MIN(SENDTIME),MAX(SENDTIME) INTO MINTIME,MAXTIME FROM GW_MT_TASK_BAK  WHERE ID<=PIMAXINDEX;
	    SET MINYM=CAST((SUBSTR(CHAR(MINTIME),1,4)||SUBSTR(CHAR(MINTIME),6,2))AS INT);
        SET MAXYM=CAST((SUBSTR(CHAR(MAXTIME),1,4)||SUBSTR(CHAR(MAXTIME),6,2))AS INT);
		  --创建不存在的历史表
		SET CURYM=MINYM;
		WHILE CURYM<=MAXYM DO
		      SET PITABLENAME = 'MTTASK'||CAST(CURYM AS CHAR(6));
		      SELECT COUNT(1) INTO ISEXIST FROM SYSCAT.TABLES WHERE TABNAME=PITABLENAME;

		  IF ISEXIST<1 THEN
		      SET PISTR='CALL CREATETABLE (1,'||CAST(CURYM AS CHAR(6))||')';
		      EXECUTE IMMEDIATE PISTR;
			  IF PIERROR <> '' THEN
			    INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('SMS','短信下行历史表创建：CREATETABLE',PIERROR);
	          END IF;
		  END IF;

		  IF INT(SUBSTR(CAST(CURYM AS CHAR(6)),5,2))=12 THEN
		       SET CURYM = CAST(CAST(CAST(SUBSTR(CAST(CURYM AS CHAR(6)),1,4)AS INT)+1 AS CHAR(4))||'01' AS INT);
		  ELSE
		       SET CURYM = CURYM+1;
		  END IF;
	   END WHILE;

	   --转移数据
	   IF (PIMAXINDEX-PICURRINDEX>=EACHMAX) THEN
          SET PI_MININDEX=PICURRINDEX;
          SET PI_CURINDEX=PI_MININDEX+EACHMAX;
       ELSE
          SET PI_MININDEX=PICURRINDEX;
          SET PI_CURINDEX=PIMAXINDEX;
       END IF;

    WHILE (PI_MININDEX < PIMAXINDEX) DO
	   SAVEPOINT A ON ROLLBACK RETAIN CURSORS;
       --转移数据
       CALL   GW_H_TRANSFERV1(PI_MININDEX,PI_CURINDEX);
       CALL   GW_H_DELTASKV1(PI_MININDEX,PI_CURINDEX);
       CALL   H_PROCESSINGSTATUS (PIUSEID,PI_CURINDEX,PI_CURINDEX,0,0,0);
	   IF PIERROR <> '' THEN
	      ROLLBACK TO SAVEPOINT A;
	      INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('SMS','短信下行数据转移',PIERROR);
	      SET  PIDISTRACTEXCEPTION = PIDISTRACTEXCEPTION - 1;
          SET PIALLEXCEPTION      = PIALLEXCEPTION - 1;
          IF(PIDISTRACTEXCEPTION <= 0 OR PIALLEXCEPTION <= 0) THEN
             RETURN;
          END IF;
	   ELSE
	 IF (PIMAXINDEX-PI_CURINDEX>=EACHMAX) THEN
            SET PI_CURINDEX=PI_CURINDEX+EACHMAX;
            SET PI_MININDEX=PI_MININDEX+EACHMAX;
          ELSE
            SET PI_CURINDEX=PIMAXINDEX;
            SET PI_MININDEX=PI_MININDEX+EACHMAX;
          END IF;
          COMMIT ;--事务提交
       END IF; --END OF IF PIERROR <> '' THEN
	END WHILE;
    END IF;
    -- 执行上行统计
    CALL  H_TRANSFERMO();

	--删除短信文件请求历史表数据
	DELETE FROM BATCH_MT_REQ_HIS WHERE RECVTIME<TIMESTAMP (TRIM(CAST((CURRENT DATE - 60 DAYS) AS CHAR(32)))||' 00:00:00.000000');
	IF PIERROR <> '' THEN
	  INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS) VALUES('SMS','短信删除BATCH_MT_REQ_HIS表记录',PIERROR);
    END IF;

	IF DAY(CURRENT DATE)=1 THEN
	  CALL GW_DELWAIT(EACHMAX);
	END IF;

	INSERT INTO TRANS_LOG(USETYPE, TRANSNAME, TSTATUS,RUNFLAG) VALUES('SMS','GW_H_DATATRANV3','短信汇总调度存储过程执行结束',1);
END NAP;


CALL DELPROC('GW_H_TRANSFERV1');
CREATE PROCEDURE "GW_H_TRANSFERV1"
 (IN "PIMININDEX" BIGINT,
  IN "PIMAXINDEX" BIGINT
 )
  SPECIFIC "GW_H_TRANSFERV1"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN

	DECLARE	PISTR VARCHAR(4000);
	DECLARE	PITABLENAME VARCHAR(20);
	DECLARE	MINYM INTEGER;
	DECLARE	MAXYM INTEGER;
	DECLARE	CURYM INTEGER;
  DECLARE MAXTIME VARCHAR(32);
  DECLARE MINTIME VARCHAR(32);
	DECLARE BEGTIME VARCHAR(32);
  DECLARE ENDTIME VARCHAR(32);
  --------------------VER 3.1-------------------------------------
  SELECT MIN(SENDTIME),MAX(SENDTIME) INTO MINTIME,MAXTIME FROM GW_MT_TASK_BAK  WHERE ID BETWEEN PIMININDEX AND PIMAXINDEX;

  SET MINYM=CAST((SUBSTR(CHAR(MINTIME),1,4)||SUBSTR(CHAR(MINTIME),6,2))AS INT);
  SET MAXYM=CAST((SUBSTR(CHAR(MAXTIME),1,4)||SUBSTR(CHAR(MAXTIME),6,2))AS INT);

  --转移
  SET CURYM = MINYM;
  WHILE CURYM<=MAXYM DO

  IF CAST(SUBSTR(CAST(CURYM AS CHAR(6)),5,2) AS INT)<>12 THEN
	    SET BEGTIME = SUBSTR(CHAR(CURYM),1,4)||'-'||SUBSTR(CHAR(CURYM),5,2)||'-'||'01 00:00:00.000000';
	    IF CAST(SUBSTR(CAST(CURYM AS CHAR(6)),5,2) AS INT)<9 THEN
	      SET ENDTIME = SUBSTR(CHAR(CURYM),1,4)||'-0'||TRIM(CHAR(INT(SUBSTR(CHAR(CURYM),5,2))+1))||'-'||'01 00:00:00.000000';
		ELSE
		  SET ENDTIME = SUBSTR(CHAR(CURYM),1,4)||'-'||TRIM(CHAR(INT(SUBSTR(CHAR(CURYM),5,2))+1))||'-'||'01 00:00:00.000000';
		END IF;
	  ELSE
	      SET BEGTIME = SUBSTR(CHAR(CURYM),1,4)||'-'||SUBSTR(CHAR(CURYM),5,2)||'-'||'01 00:00:00.000000';
	      SET ENDTIME = TRIM(CHAR(INT(SUBSTR(CHAR(CURYM),1,4))+1))||'-'||'01'||'-'||'01 00:00:00.000000';
	  END IF;

      SET PITABLENAME = 'MTTASK'||CAST(CURYM AS CHAR(6));

      SET PISTR= 'INSERT INTO '||PITABLENAME||' (ID,MDAY,USERID,SPGATE,CPNO,PHONE,SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,SENDSTATUS,SENDFLAG,RECVFLAG,DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,SENDTIME,RECVTIME,MESSAGE,TASKID,ECID,PTMSGID,MOBILEAREA,SPID,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
                SELECT ID,INT(DAY(M.SENDTIME)),USERID,SPGATE,CPNO,PHONE,SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,SENDSTATUS,SENDFLAG,RECVFLAG,DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,SENDTIME,RECVTIME,MESSAGE,TASKID,ECID,PTMSGID,MOBILEAREA,SPID,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME
                FROM GW_MT_TASK_BAK  M
                WHERE SENDTIME>='''||BEGTIME||''' AND SENDTIME<'''||ENDTIME||''' AND (M.ID <='||CHAR(PIMAXINDEX)||')  ';
      EXECUTE IMMEDIATE PISTR;

      IF CAST(SUBSTR(CAST(CURYM AS CHAR(6)),5,2) AS INT)=12 THEN
        SET CURYM = CAST(CAST(CAST(SUBSTR(CAST(CURYM AS CHAR(6)),1,4)AS INT)+1 AS CHAR(4))||'01' AS INT);
      ELSE
        SET CURYM = CURYM+1;
      END IF;
  END WHILE;
END;


CALL DELPROC('GW_RD_MTLVLQUEV1');
CREATE PROCEDURE "GW_RD_MTLVLQUEV1"
 (IN "PIDESTUID" INTEGER,
  IN "PISENDLEVEL" INTEGER,
  IN "PIMAXREADCNT" INTEGER,
  IN "PISTRUID" VARCHAR(4000),
  IN "PICURTIME" BIGINT,
  IN P_TABLENO INTEGER
 )
  SPECIFIC "GW_RD_MTLVLQUEV1"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  READS SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
	DECLARE PISQLSTR VARCHAR(6000);
	DECLARE P_TABNAME VARCHAR(6000);
	DECLARE RS1 CURSOR WITH RETURN FOR S1;

	 IF  P_TABLENO>=0  AND   P_TABLENO<=9 THEN
	   SET P_TABNAME='MT_LEVEL'||CAST(P_TABLENO AS CHAR(1))||'_QUEUE';
	 ELSE
	   SET P_TABNAME='MT_LEVEL0_QUEUE';
	 END IF;

	SET PISQLSTR = 'SELECT ID,UID,DESTUID,LOGINUID,ECID,TASKID,FEEFLAG,USERID,SPGATE,CPNO,PHONE,PTMSGID,RETFLAG,TPUDHI,PKNUMBER,PKTOTAL,SENDSTATUS,PHONECOUNT,SPLITFLAG,SENDLEVEL,LONGMSGSEQ,MSGFMT,MESSAGE,SENDTIME AS RECVMTTIME,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME FROM '||P_TABNAME||' WHERE DESTUID='||
		CAST(PIDESTUID AS CHAR(12))||' AND UID NOT IN ('||PISTRUID||')AND SENDLEVEL='||CAST(PISENDLEVEL AS CHAR(12))||' AND (ATTIME<='||CAST(PICURTIME AS CHAR(20))||' OR ATTIME<0) FETCH FIRST '||CAST(PIMAXREADCNT AS CHAR(12))||' ROW ONLY';
	PREPARE S1 FROM PISQLSTR;
	OPEN RS1;
END;

CALL DELPROC('GW_WR_MTTASKV3');
CREATE PROCEDURE "GW_WR_MTTASKV3"
 (IN "PIUID" INTEGER,
  IN "PIPTMSGID" BIGINT,
  IN "PISENDSTATUS" SMALLINT,
  IN "PIRETFLAG" SMALLINT,
  IN "PIPKTOTAL" SMALLINT,
  IN "PIPHONECOUNT" INTEGER,
  IN "PISPLITLEN" SMALLINT,
  IN "PIMULTILEN1" SMALLINT,
  IN "PIMULTILEN2" SMALLINT,
  IN "PISIGNLEN" SMALLINT,
  IN "PIECID" INTEGER,
  IN "PIUSERID" VARCHAR(11),
  IN "PISPGATE" VARCHAR(21),
  IN "PICPNO" VARCHAR(21),
  IN "PIRECVMTTIME" TIMESTAMP,
  IN "PIMESSAGE" VARCHAR(3000),
  IN "PISHOUJI" VARCHAR(3500),
  IN "PIFEEFLAG" SMALLINT,
  IN "PISENDLEVEL" SMALLINT,
  IN "PITASKID" INTEGER,
  IN "PIERCODE" CHARACTER(7),
  IN "PITPUDHI" SMALLINT,
  IN "PILONGMSGSEQ" SMALLINT,
  IN "PIMSGFMT" SMALLINT,
  IN "PIUNICOM" SMALLINT,
  IN "PIMOBILEAREA" INTEGER,
  IN "PIPKNUMBER" SMALLINT,
  IN "PISVRTYPE" VARCHAR(64),
  IN "PIP1" VARCHAR(64),
  IN "PIP2" VARCHAR(64),
  IN "PIP3" VARCHAR(64),
  IN "PIP4" VARCHAR(64),
  IN "PIUSERMSGID" BIGINT,
  IN "PIMODULEID" INTEGER,
  IN "PIATTIME" BIGINT,
  IN "PIVALIDTIME" BIGINT,
  IN "PISENDTYPE" INTEGER,
  IN "PIBATCHID" BIGINT,
  IN "PIAREACODE" INTEGER,
  IN "PICUSTID" VARCHAR(64),
  IN "PIEXDATA" VARCHAR(64),
  IN "PILONGMSG" VARCHAR(4000),
  IN "PITMPLID" BIGINT,
  IN "PICHGRADE" SMALLINT,
  IN "PIMSGTYPE" SMALLINT,
  IN "PIRMSVALIDTM" SMALLINT,
  IN "PIRMSRPTFLAG" SMALLINT,
  IN "PIPROTOCOLVER" SMALLINT,
  IN "PITMPLTYPE" SMALLINT,
  IN "PITITLE" VARCHAR(40),
  IN "PISHOWAY" VARCHAR(16),
  IN "PIDLDWAY" INTEGER,
  IN "PIDLDNEY" INTEGER,
  IN "PIISFREE" INTEGER,
  IN "PISHOWTIME" BIGINT
 )
  SPECIFIC "GW_WR_MTTASKV3"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN

DECLARE PITMPMSGID BIGINT;
DECLARE PILOCATION INT;
DECLARE PISTART INT;
DECLARE PIRESULTPHONE VARCHAR(21);
DECLARE PISTRSPLIT VARCHAR(2);
DECLARE PILEN INT;
DECLARE PIRESULTMSG VARCHAR(3000);
DECLARE PIPKNUM INT;
DECLARE PITMPNUM INT;
DECLARE GLOBAL TEMPORARY TABLE SESSION.TMPMTTASK(UID INT,
USERID VARCHAR(11),SPGATE VARCHAR(21),CPNO VARCHAR(21),
PHONE VARCHAR(21),PTMSGID BIGINT ,MESSAGE VARCHAR(3000),
SENDSTATUS SMALLINT,RETFLAG SMALLINT,PKNUMBER SMALLINT,
PKTOTAL SMALLINT,RECVMTTIME TIMESTAMP,ECID INT,
FEEFLAG SMALLINT,SENDLEVEL SMALLINT,TASKID INT,ERRORCODE CHAR(7),
TPUDHI SMALLINT,LONGMSGSEQ SMALLINT,MSGFMT SMALLINT,UNICOM SMALLINT,MOBILEAREA INT,
SVRTYPE VARCHAR(64),P1 VARCHAR(64),P2 VARCHAR(64),P3 VARCHAR(64),
P4 VARCHAR(64),USERMSGID BIGINT,MODULEID INT,ATTIME BIGINT,VALIDTIME BIGINT,SENDTYPE INTEGER,AREACODE INTEGER,CUSTID VARCHAR(64),EXDATA VARCHAR(64),LONGMSG VARCHAR(4000),TMPLID BIGINT,CHGRADE SMALLINT,MSGTYPE SMALLINT,RMSVALIDTM SMALLINT,RMSRPTFLAG SMALLINT,PROTOCOLVER SMALLINT,TMPLTYPE SMALLINT,TITLE VARCHAR(40),SHOWAY VARCHAR(16),DLDWAY INTEGER,DLDNEY INTEGER,ISFREE INTEGER,SHOWTIME BIGINT) ON COMMIT DELETE ROWS NOT LOGGED WITH REPLACE;

SET PILEN = LENGTH(PILONGMSG, CODEUNITS32)-PISIGNLEN;
SET PITMPNUM = 0;
SET PIPKNUM = 1;
SET PISTRSPLIT = ',';

IF PIPHONECOUNT < 1 THEN
	RETURN;
END IF;

IF PIMSGFMT=4 OR PIMSGFMT=248 OR PIMSGFMT=246 THEN
	SET PISPLITLEN=140;
	SET PIMULTILEN1=134;
	SET PIMULTILEN2=134;
	SET PISIGNLEN=0;
END IF;

IF PIMSGFMT=25  THEN
		IF NOT EXISTS (SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID=PIPTMSGID) THEN
		   INSERT INTO GW_MT_TASK_BAK(UID,USERID,SPGATE,CPNO,PHONE,PTMSGID,MESSAGE,SENDSTATUS,
		   RETFLAG,PKNUMBER,PKTOTAL,RECVMTTIME,ECID,FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,
		   TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
		   VALUES(PIUID,PIUSERID,PISPGATE,PICPNO,PISHOUJI,PIPTMSGID,PIMESSAGE,PISENDSTATUS,PIRETFLAG,PIPKNUMBER,PIPKTOTAL,
		   PIRECVMTTIME,PIECID,PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
		   PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
		END IF;
		RETURN;
END IF;

IF PIPHONECOUNT = 1
THEN
	IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
	THEN
		IF PIPKTOTAL = 1
		THEN
			INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE,
			SENDSTATUS, RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,
			TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
			SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
			VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PIPTMSGID, PIMESSAGE,
			PISENDSTATUS, PIRETFLAG, PIPKNUMBER, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,
			PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
			PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
		ELSE
			SET PIPKNUM = 1;
			SET PITMPMSGID = PIPTMSGID;
			IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
			THEN
				SET PIRESULTMSG = SUBSTRING(PIMESSAGE,1,PISPLITLEN, CODEUNITS32);
				SET PITMPMSGID = PITMPMSGID;
				IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				THEN
					INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
					RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
					MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
					VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
					PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,
					PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
				END IF;--END OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PIPTMSGID)
				IF  PILEN-PISPLITLEN+PISIGNLEN>=0
				  THEN
				    SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN, CODEUNITS32);
				  ELSE
				    SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, 0, CODEUNITS32);
				END IF;
				SET PITMPMSGID = PITMPMSGID+17179869184;
				SET PIPKNUM = PIPKNUM+1;
				IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
				THEN
					INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
					RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
					MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
					VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
					PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
					PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
				END IF;--END OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID)
			ELSE
				WHILE PIPKNUM <= PIPKTOTAL
				DO
					IF PIPKNUM = PIPKTOTAL
					THEN
						SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN, CODEUNITS32);
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					ELSEIF PIPKNUM = PIPKTOTAL-1
					THEN
						IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
						THEN
						    IF  PILEN-(PIPKNUM-1)*PIMULTILEN1-1 >=0 THEN
							   SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1, CODEUNITS32);
							ELSE
							   SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, 0, CODEUNITS32);
							END IF;
							SET PITMPNUM = PILEN-1;
						ELSE
							SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
							SET PITMPNUM = (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
						END IF;--END IF OF IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1;
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					ELSE
						SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
						SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
					END IF;--END IF OF IF PIPKNUM = PIPKTOTAL
					IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					THEN
						INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
						RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
						MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
						VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
						PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
						PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
					END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
					SET PIPKNUM = PIPKNUM+1;
				END WHILE;--END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
			END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1;

			INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
			RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,
			LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
			SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,
			A.PKNUMBER,A.PKTOTAL,A.RECVMTTIME, A.ECID, A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
			A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,A.AREACODE,A.CUSTID,A.EXDATA,A.LONGMSG,A.TMPLID,A.CHGRADE,A.MSGTYPE,A.RMSVALIDTM,A.RMSRPTFLAG,A.PROTOCOLVER,A.TMPLTYPE,A.TITLE,A.SHOWAY,A.DLDWAY,A.DLDNEY,A.ISFREE,A.SHOWTIME FROM SESSION.TMPMTTASK A;
		END IF;--END IF OF IF PIPKTOTAL = 1
	END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PIPTMSGID)
ELSE --
	SET PISHOUJI = PISTRSPLIT||PISHOUJI||PISTRSPLIT;
	SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI, CODEUNITS32);

	IF PIPKTOTAL < 1 --
	THEN
		RETURN;
	END IF;

	IF PIPKTOTAL >= 1 --
	THEN
		WHILE PILOCATION <> 0 --
		DO
			SET PISTART = PILOCATION;
			SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI,PISTART+1, CODEUNITS32);
			IF PILOCATION > 0
			THEN
				SET PIRESULTPHONE = SUBSTRING(PISHOUJI,PISTART+1,PILOCATION-PISTART-1, CODEUNITS32);--
				IF PIRESULTPHONE <> ''
				THEN
					SET PITMPMSGID = PIPTMSGID;
					IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
					THEN
						IF PIPKTOTAL = 1
						THEN
							INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS,
							RETFLAG, PKNUMBER, PKTOTAL, RECVMTTIME,ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,
							MSGFMT,UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
							VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIMESSAGE, PISENDSTATUS,
							PIRETFLAG, PIPKTOTAL, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
							PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
						ELSE
							SET PIPKNUM = 1;
							IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
							THEN
								SET PIRESULTMSG = SUBSTRING(PIMESSAGE,1, PISPLITLEN, CODEUNITS32);--
								SET PITMPMSGID = PITMPMSGID;
								IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								THEN
									INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
									PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
									UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
									VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS,
									PIRETFLAG, PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,
									PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
								END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								IF PILEN-PISPLITLEN+PISIGNLEN>=0 THEN
								  SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, PILEN-PISPLITLEN+PISIGNLEN, CODEUNITS32);
								ELSE
								  SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PISPLITLEN+1, 0, CODEUNITS32);
								END IF;
								SET PITMPMSGID = PITMPMSGID+17179869184;
								SET PIPKNUM = PIPKNUM+1;
								IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
								THEN
									INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
									PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
									UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
									VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS, PIRETFLAG,
									PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
									PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
								END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
							ELSE
								WHILE PIPKNUM <= PIPKTOTAL
								DO
									IF PIPKNUM = PIPKTOTAL
									THEN
										SET PIRESULTMSG = SUBSTRING(PIMESSAGE,PITMPNUM+1, PIMULTILEN2+PISIGNLEN, CODEUNITS32);
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									ELSEIF PIPKNUM = PIPKTOTAL-1
									THEN
										IF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
										THEN
											SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PILEN-(PIPKNUM-1)*PIMULTILEN1-1, CODEUNITS32);
											SET PITMPNUM = PILEN-1;
										ELSE
											SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
											SET PITMPNUM = (PIPKNUM-1)*PIMULTILEN1+PIMULTILEN1;
										END IF; --END IF OF PILEN-(PIPKNUM-1)*PIMULTILEN1 > PIMULTILEN2 AND PILEN-(PIPKNUM-1)*PIMULTILEN1 <= PIMULTILEN1
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									ELSE
										SET PIRESULTMSG = SUBSTRING(PIMESSAGE,(PIPKNUM-1)*PIMULTILEN1+1, PIMULTILEN1, CODEUNITS32);
										SET PITMPMSGID = PIPTMSGID+(PIPKNUM-1)*17179869184;
									END IF; --END IF OF IF PIPKNUM = PIPKTOTAL
									IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PITMPMSGID)
									THEN
										INSERT INTO SESSION.TMPMTTASK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
										PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
										UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
										VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PITMPMSGID, PIRESULTMSG, PISENDSTATUS, PIRETFLAG,
										PIPKNUM, PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG,PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,
										PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
									END IF;--END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
									SET PIPKNUM = PIPKNUM+1;
								END WHILE;-- END WHILE OF WHILE PIPKNUM <= PIPKTOTAL
							END IF;--END IF OF IF PIPKTOTAL = 2 AND PILEN <= PIMULTILEN1
						END	IF;--END IF OF IF PIPKTOTAL = 1
					END IF; --END IF OF IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK WHERE PTMSGID = PITMPMSGID)
				END IF; --END IF OF IF PIRESULTPHONE <> ''
				SET PIPTMSGID = PIPTMSGID+1;
			END	IF; --END IF OF IF PILOCATION > 0
		END WHILE; --END WHILE OF WHILE PILOCATION <> 0

		INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG,
		PKNUMBER, PKTOTAL, RECVMTTIME, ECID, FEEFLAG,SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,
		UNICOM,MOBILEAREA,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
		SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,A.PKNUMBER,
		A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,
		A.MSGFMT,A.UNICOM,A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,A.AREACODE,A.CUSTID,A.EXDATA,A.LONGMSG,A.TMPLID,A.CHGRADE,A.MSGTYPE,A.RMSVALIDTM,A.RMSRPTFLAG,A.PROTOCOLVER,A.TMPLTYPE,A.TITLE,A.SHOWAY,A.DLDWAY,A.DLDNEY,A.ISFREE,A.SHOWTIME FROM SESSION.TMPMTTASK A;
	END IF; --END IF OF IF PIPKTOTAL >= 1
END IF; --END IF OF IF PIPHONECOUNT = 1 --
END;


CALL DELPROC('GW_WR_MTTASKSRV3');
CREATE PROCEDURE "GW_WR_MTTASKSRV3"
 (IN "PIUID" INTEGER,
  IN "PIPTMSGID" BIGINT,
  IN "PISENDSTATUS" SMALLINT,
  IN "PIRETFLAG" SMALLINT,
  IN "PIPKTOTAL" SMALLINT,
  IN "PIPHONECOUNT" INTEGER,
  IN "PIECID" INTEGER,
  IN "PIUSERID" VARCHAR(11),
  IN "PISPGATE" VARCHAR(21),
  IN "PICPNO" VARCHAR(21),
  IN "PIRECVMTTIME" TIMESTAMP,
  IN "PIMESSAGE" VARCHAR(3000),
  IN "PISHOUJI" VARCHAR(3500),
  IN "PIFEEFLAG" SMALLINT,
  IN "PIPKNUMBER" SMALLINT,
  IN "PISENDLEVEL" SMALLINT,
  IN "PITASKID" INTEGER,
  IN "PIERCODE" CHARACTER(7),
  IN "PITPUDHI" SMALLINT,
  IN "PILONGMSGSEQ" SMALLINT,
  IN "PIMSGFMT" SMALLINT,
  IN "PIUNICOM" SMALLINT,
  IN "PIMOBILEAREA" INTEGER,
  IN "PISVRTYPE" VARCHAR(64),
  IN "PIP1" VARCHAR(64),
  IN "PIP2" VARCHAR(64),
  IN "PIP3" VARCHAR(64),
  IN "PIP4" VARCHAR(64),
  IN "PIUSERMSGID" BIGINT,
  IN "PIMODULEID" INTEGER,
  IN "PIATTIME" BIGINT,
  IN "PIVALIDTIME" BIGINT,
  IN "PISENDTYPE" INTEGER,
  IN "PIBATCHID" BIGINT,
  IN "PIAREACODE" INTEGER,
  IN "PICUSTID" VARCHAR(64),
  IN "PIEXDATA" VARCHAR(64),
  IN "PILONGMSG" VARCHAR(4000),
  IN "PITMPLID" BIGINT,
  IN "PICHGRADE" SMALLINT,
  IN "PIMSGTYPE" SMALLINT,
  IN "PIRMSVALIDTM" SMALLINT,
  IN "PIRMSRPTFLAG" SMALLINT,
  IN "PIPROTOCOLVER" SMALLINT,
  IN "PITMPLTYPE" SMALLINT,
  IN "PITITLE" VARCHAR(40),
  IN "PISHOWAY" VARCHAR(16),
  IN "PIDLDWAY" INTEGER,
  IN "PIDLDNEY" INTEGER,
  IN "PIISFREE" INTEGER,
  IN "PISHOWTIME" BIGINT
 )
  SPECIFIC "GW_WR_MTTASKSRV3"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN

DECLARE PILOCATION INT;
DECLARE PISTART INT;
DECLARE PIRESULTPHONE VARCHAR(21);
DECLARE PISTRSPLIT VARCHAR(2);
SET PISTRSPLIT = ',';
--SET PIRECVMTTIME =CURRENT TIMESTAMP;
DECLARE GLOBAL TEMPORARY TABLE SESSION.PITMP(UID INT,USERID VARCHAR(11),SPGATE VARCHAR(21),CPNO VARCHAR(21),PHONE VARCHAR(21),
PTMSGID BIGINT ,MESSAGE VARCHAR(3000),SENDSTATUS SMALLINT,RETFLAG SMALLINT,PKNUMBER SMALLINT,
PKTOTAL SMALLINT,RECVMTTIME TIMESTAMP,ECID INT,FEEFLAG SMALLINT,SENDLEVEL SMALLINT,TASKID INT,ERRORCODE CHAR(7),
TPUDHI SMALLINT,LONGMSGSEQ SMALLINT,MSGFMT SMALLINT,UNICOM SMALLINT,MOBILEAREA INT,
SVRTYPE VARCHAR(64),P1 VARCHAR(64),P2 VARCHAR(64),P3 VARCHAR(64),
P4 VARCHAR(64),USERMSGID BIGINT,MODULEID INT,ATTIME BIGINT,VALIDTIME BIGINT,SENDTYPE INTEGER)ON COMMIT DELETE ROWS NOT LOGGED WITH REPLACE;

IF PIPHONECOUNT < 1 THEN--
	RETURN;
END IF;

IF PIPHONECOUNT = 1 THEN--
	IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID) THEN
		INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG, PKNUMBER,
		PKTOTAL, RECVMTTIME, ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
		SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
		VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PISHOUJI, PIPTMSGID, PIMESSAGE, PISENDSTATUS, PIRETFLAG, PIPKNUMBER,
		PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG, PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
		PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
	END IF;
ELSE --
	SET PISHOUJI = PISTRSPLIT||PISHOUJI||PISTRSPLIT;
	SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI, CODEUNITS32);
	WHILE PILOCATION <> 0 --
	DO
	  SET PISTART = PILOCATION;
	  SET PILOCATION = LOCATE(PISTRSPLIT,PISHOUJI,PISTART+1, CODEUNITS32);
	  IF PILOCATION > 0
	  THEN
		  IF PILOCATION-PISTART-1 >=0 THEN
		    SET PIRESULTPHONE = SUBSTRING(PISHOUJI,PISTART+1,PILOCATION-PISTART-1, CODEUNITS32);
		  ELSE
		    SET PIRESULTPHONE = SUBSTRING(PISHOUJI,PISTART+1,0, CODEUNITS32);
		  END IF;
		  IF PIRESULTPHONE <> ''
		  THEN
			  IF NOT EXISTS(SELECT PTMSGID FROM GW_MT_TASK_BAK WHERE PTMSGID = PIPTMSGID) THEN
				  INSERT INTO SESSION.PITMP(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG, PKNUMBER,
				  PKTOTAL, RECVMTTIME,ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
				  SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE)
				  VALUES(PIUID,PIUSERID, PISPGATE, PICPNO, PIRESULTPHONE, PIPTMSGID, PIMESSAGE, PISENDSTATUS, PIRETFLAG, PIPKNUMBER,
				  PIPKTOTAL, PIRECVMTTIME, PIECID, PIFEEFLAG, PISENDLEVEL,PITASKID,PIERCODE,PITPUDHI,PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,
				  PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE);
			  END IF;
			  SET PIPTMSGID = PIPTMSGID+1;
		  END IF;
	    END IF;
	 END WHILE;

	 INSERT INTO GW_MT_TASK_BAK(UID,USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, SENDSTATUS, RETFLAG, PKNUMBER,
	 PKTOTAL, RECVMTTIME, ECID, FEEFLAG, SENDLEVEL,TASKID,ERRORCODE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,MOBILEAREA,
	 SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,RMSRPTFLAG,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
	 SELECT A.UID,A.USERID,A.SPGATE,A.CPNO,A.PHONE,A.PTMSGID,A.MESSAGE,A.SENDSTATUS,A.RETFLAG,A.PKNUMBER,
	 A.PKTOTAL,A.RECVMTTIME,A.ECID,A.FEEFLAG,A.SENDLEVEL,A.TASKID,A.ERRORCODE,A.TPUDHI,A.LONGMSGSEQ,A.MSGFMT,A.UNICOM,
	 A.MOBILEAREA,A.SVRTYPE,A.P1,A.P2,A.P3,A.P4,A.USERMSGID,A.MODULEID,A.ATTIME,A.VALIDTIME,A.SENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIRMSRPTFLAG,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME FROM SESSION.PITMP A;
END IF;
END;


CALL DELPROC('GW_WR_MTLVLQUEV3');
CREATE PROCEDURE "GW_WR_MTLVLQUEV3"
 (IN "PIUID" INTEGER,
  IN "PIPTMSGID" BIGINT,
  IN "PIRETFLAG" SMALLINT,
  IN "PIPKTOTAL" SMALLINT,
  IN "PIPHONECOUNT" INTEGER,
  IN "PISENDSTATUS" SMALLINT,
  IN "PISPLITFLAG" SMALLINT,
  IN "PIECID" INTEGER,
  IN "PIUSERID" VARCHAR(11),
  IN "PISPGATE" VARCHAR(21),
  IN "PICPNO" VARCHAR(21),
  IN "PIRECVMTTIME" TIMESTAMP,
  IN "PIPHONE" VARCHAR(3500),
  IN "PIMESSAGE" VARCHAR(3000),
  IN "PIFEEFLAG" SMALLINT,
  IN "PIDESTUID" INTEGER,
  IN "PILOGINUID" INTEGER,
  IN "PIPKNUMBER" SMALLINT,
  IN "PISENDLEVEL" SMALLINT,
  IN "PITPUDHI" SMALLINT,
  IN "PITASKID" INTEGER,
  IN "PILONGMSGSEQ" SMALLINT,
  IN "PIMSGFMT" SMALLINT,
  IN "PITOTALCOUNT" INTEGER,
  IN "PISVRTYPE" VARCHAR(64),
  IN "PIP1" VARCHAR(64),
  IN "PIP2" VARCHAR(64),
  IN "PIP3" VARCHAR(64),
  IN "PIP4" VARCHAR(64),
  IN "PIUSERMSGID" BIGINT,
  IN "PIMODULEID" INTEGER,
  IN "PIATTIME" BIGINT,
  IN "PIVALIDTIME" BIGINT,
  IN "PISENDTYPE" INTEGER,
  IN "PIBATCHID" BIGINT,
  IN "PIAREACODE" INTEGER,
  IN "PICUSTID" VARCHAR(64),
  IN "PIEXDATA" VARCHAR(64),
  IN "PILONGMSG" VARCHAR(4000),
  IN "PITMPLID" BIGINT,
  IN "PICHGRADE" SMALLINT,
  IN "PIMSGTYPE" SMALLINT,
  IN "PIRMSVALIDTM" SMALLINT,
  IN "PIPROTOCOLVER" SMALLINT,
  IN "PITMPLTYPE" SMALLINT,
  IN "PITITLE" VARCHAR(40),
  IN "PISHOWAY" VARCHAR(16),
  IN "PIDLDWAY" INTEGER,
  IN "PIDLDNEY" INTEGER,
  IN "PIISFREE" INTEGER,
  IN "PISHOWTIME" BIGINT,
  IN P_TABLENO INTEGER
 )
  SPECIFIC "GW_WR_MTLVLQUEV3"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
	IF P_TABLENO =0 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL0_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL0_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
   END IF;
ELSEIF P_TABLENO =1 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL1_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL1_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
   END IF;
ELSEIF P_TABLENO =2 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL2_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL2_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
   END IF;
ELSEIF P_TABLENO =3 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL3_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL3_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
   END IF;
ELSEIF P_TABLENO =4 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL4_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL4_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
   END IF;
ELSEIF P_TABLENO =5 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL5_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL5_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
   END IF;
ELSEIF P_TABLENO =6 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL6_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL6_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
   END IF;
ELSEIF P_TABLENO =7 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL7_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL7_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
   END IF;
ELSEIF P_TABLENO =8 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL8_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL8_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
   END IF;
ELSEIF P_TABLENO =9 THEN
   IF NOT EXISTS (SELECT PTMSGID FROM MT_LEVEL9_QUEUE WHERE PTMSGID=PIPTMSGID) THEN
      INSERT INTO MT_LEVEL9_QUEUE(UID, USERID, SPGATE, CPNO, PHONE, PTMSGID, MESSAGE, RETFLAG, PKTOTAL, TOTALCOUNT,
      PHONECOUNT, SENDTIME, SENDSTATUS, SPLITFLAG, ECID, FEEFLAG,DESTUID,LOGINUID,PKNUMBER,TPUDHI,SENDLEVEL,
      TASKID,LONGMSGSEQ,MSGFMT,SVRTYPE,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA,LONGMSG,TMPLID,CHGRADE,MSGTYPE,RMSVALIDTM,PROTOCOLVER,TMPLTYPE,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
      VALUES(PIUID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE, PIRETFLAG, PIPKTOTAL, PITOTALCOUNT,
      PIPHONECOUNT,PIRECVMTTIME, PISENDSTATUS, PISPLITFLAG, PIECID, PIFEEFLAG, PIDESTUID,PILOGINUID,PIPKNUMBER,
      PITPUDHI,PISENDLEVEL,PITASKID,PILONGMSGSEQ,PIMSGFMT,PISVRTYPE,PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA,PILONGMSG,PITMPLID,PICHGRADE,PIMSGTYPE,PIRMSVALIDTM,PIPROTOCOLVER,PITMPLTYPE,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
   END IF;
END IF;
END;


--表 mt_datareport添加索引
CALL DELPROC('ADDINDEX');
CREATE PROCEDURE ADDINDEX(TABLENAME VARCHAR(20),IDXNAME VARCHAR(100),CLUNAME VARCHAR(200))
begin
DECLARE STR VARCHAR (256);
DECLARE STR1 VARCHAR (256);
SELECT INDNAME INTO STR1 FROM SYSCAT.INDEXES WHERE TABNAME=UPPER(TABLENAME) AND INDNAME=UPPER(IDXNAME);
if  STR1 is  null THEN
  SET STR = ' CREATE  UNIQUE INDEX '||UPPER(IDXNAME)||' ON '||UPPER(TABLENAME)||' ('||UPPER(CLUNAME)||' ASC) PCTFREE 10   ALLOW REVERSE SCANS';
EXECUTE IMMEDIATE STR;
end if;
END;

--表 mt_datareport删除主键
CALL DELPROC('DLLPRIMARYKEY');
CREATE PROCEDURE DLLPRIMARYKEY(TABLENAME VARCHAR(20),IDXNAME VARCHAR(100))
begin
DECLARE STR VARCHAR (256);
DECLARE STR1 VARCHAR (256);
SELECT INDNAME INTO STR1 FROM SYSCAT.INDEXES WHERE TABNAME=UPPER(TABLENAME) AND INDNAME=UPPER(IDXNAME);
if  STR1 is  null THEN
else
  SET STR = 'alter table '||UPPER(TABLENAME)||' drop primary key';
EXECUTE IMMEDIATE STR;
end if;
END;

CALL DLLPRIMARYKEY('mt_datareport','PK_MT_DATAREPORT');
CALL ADDINDEX('mt_datareport','IX_MT_DATAREPORT_UNION','USERID,TASKID,SPGATE,IYMD,IHOUR,SPISUNCM,SVRTYPE,P1,P2,P3,P4,SPID,MOBILEAREA,SENDTYPE,BATCHID,AREACODE,TMPLID,CHGRADE,MSGTYPE');

CALL DELPROC('DLLPRIMARYKEY');
CALL DELPROC('ADDINDEX');

ALTER TABLE MT_TASK_C ALTER COLUMN MESSAGE SET DATA TYPE VARCHAR(4000);

CALL ADDCOLUMN('MT_TASK_C' ,'MSGTYPE','SMALLINT NOT NULL DEFAULT 0' );
CALL ADDCOLUMN('MT_TASK_C' ,'VALIDTM','SMALLINT NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_TASK_C' ,'TMPLID','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_TASK_C' ,'PROTOCOLVER','SMALLINT NOT NULL DEFAULT 0' );
CALL ADDCOLUMN('MT_TASK_C' ,'TITLE','VARCHAR(40) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_TASK_C' ,'SHOWAY','VARCHAR(16) NOT NULL DEFAULT ''''' );
CALL ADDCOLUMN('MT_TASK_C' ,'DLDWAY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_TASK_C' ,'DLDNEY','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_TASK_C' ,'ISFREE','INTEGER NOT NULL DEFAULT 0');
CALL ADDCOLUMN('MT_TASK_C' ,'SHOWTIME','BIGINT NOT NULL DEFAULT 0');

CALL DELPROC('GW_WRMTTASKCV3');
CREATE PROCEDURE "GW_WRMTTASKCV3"
 (IN "PIUID" INTEGER,
  IN "PIPTMSGID" BIGINT,
  IN "PISENDSTATUS" INTEGER,
  IN "PIRETFLAG" SMALLINT,
  IN "PIPKNUMBER" SMALLINT,
  IN "PIPKTOTAL" SMALLINT,
  IN "PIPHONECOUNT" INTEGER,
  IN "PIUSERID" VARCHAR(11),
  IN "PISPGATE" VARCHAR(21),
  IN "PICPNO" VARCHAR(21),
  IN "PIRECVTIME" TIMESTAMP,
  IN "PIPHONE" VARCHAR(3500),
  IN "PIMESSAGE" VARCHAR(4000),
  IN "PITPUDHI" SMALLINT,
  IN "PILOGINID" VARCHAR(11),
  IN "PITRANSMTTIME" TIMESTAMP,
  IN "PIMSGFMT" SMALLINT,
  IN "PILONGMSGSEQ" SMALLINT,
  IN "PIUSERMSGID" BIGINT,
  IN "PIMODULEID" INTEGER,
  IN "PISENDLEVEL" SMALLINT,
  IN "PIVALIDTIME" BIGINT,
  IN "PIUNICOM"     SMALLINT,
  IN "PITASKID"     INTEGER,
  IN "PIMOBILEAREA" INTEGER,
  IN "PINETERRORCNT" INTEGER,
  IN "PISUBMITERRORCNT" INTEGER,
  IN PICUSTID VARCHAR(64),
  IN PIEXDATA VARCHAR(64),
  IN "PIMSGTYPE" SMALLINT,
  IN "PIVALIDTM" SMALLINT,
  IN "PITMPLID" INTEGER,
  IN "PIPROTOCOLVER"		SMALLINT,
  IN "PITITLE"				VARCHAR(40),
  IN "PISHOWAY"				VARCHAR(16),
  IN "PIDLDWAY"				INTEGER,
  IN "PIDLDNEY"				INTEGER,
  IN "PIISFREE"				INTEGER,
  IN "PISHOWTIME"			BIGINT

 )
  SPECIFIC "GW_WRMTTASKCV3"
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
	IF NOT EXISTS(SELECT PTMSGID FROM MT_TASK_C WHERE PTMSGID = PIPTMSGID) THEN
	   INSERT INTO MT_TASK_C(UID, LOGINID, USERID, SPGATE, CPNO, SHOUJI, PTMSGID, MESSAGE,
	   SENDSTATUS, RETFLAG, PKNUMBER, PKTOTAL, SENDTIME,TPUDHI,LONGMSGSEQ,TRANSMTTIME,MSGFMT,USERMSGID,MODULEID,SENDLEVEL,VALIDTIME,UNICOM ,TASKID ,MOBILEAREA,NETERRORCNT,SUBMITERRORCNT,CUSTID,EXDATA,MSGTYPE,VALIDTM,TMPLID,PROTOCOLVER,TITLE,SHOWAY,DLDWAY,DLDNEY,ISFREE,SHOWTIME)
	   VALUES(PIUID, PILOGINID, PIUSERID, PISPGATE, PICPNO, PIPHONE, PIPTMSGID, PIMESSAGE,
	   PISENDSTATUS, PIRETFLAG, PIPKNUMBER, PIPKTOTAL, PIRECVTIME,PITPUDHI,PILONGMSGSEQ,PITRANSMTTIME,PIMSGFMT,PIUSERMSGID,PIMODULEID,PISENDLEVEL,PIVALIDTIME,PIUNICOM ,PITASKID ,PIMOBILEAREA,PINETERRORCNT,PISUBMITERRORCNT,PICUSTID,PIEXDATA,PIMSGTYPE,PIVALIDTM,PITMPLID,PIPROTOCOLVER,PITITLE,PISHOWAY,PIDLDWAY,PIDLDNEY,PIISFREE,PISHOWTIME);
	END IF;
END;

ALTER TABLE GT_PORT_USED ALTER COLUMN SIGNSTR SET DATA TYPE VARCHAR(60);
ALTER TABLE GT_PORT_USED ALTER COLUMN ENSIGNSTR SET DATA TYPE VARCHAR(60);

ALTER TABLE XT_GATE_QUEUE ALTER COLUMN SIGNSTR SET DATA TYPE VARCHAR(60);
ALTER TABLE XT_GATE_QUEUE ALTER COLUMN ENSIGNSTR SET DATA TYPE VARCHAR(60);


CALL DELPROC('GW_MTTASKSUPPV4');

CREATE PROCEDURE  GW_MTTASKSUPPV4
 (IN "PIOLDMSGID" BIGINT,
  IN "PINEWMSGID" BIGINT,
  IN "PISRCUID" INTEGER,
  IN "PISRCUSRID" VARCHAR(11),
  IN "PISRCSPGATE" VARCHAR(21),
  IN "PISRCSPNUMBER" VARCHAR(21),
  IN "PIDESTUID" INTEGER,
  IN "PIDESTUSRID" VARCHAR(11),
  IN "PIDESTSPGATE" VARCHAR(21),
  IN "PIDESTSPNUMBER" VARCHAR(21),
  IN "PIDESTFEEFLAG" INTEGER,
  IN "PISPLITLEN" SMALLINT,
  IN "PIMULTILEN1" SMALLINT,
  IN "PIMULTILEN2" SMALLINT,
  IN "PINEWSIGNLEN" SMALLINT,
  IN "PIOLDSIGNLEN" SMALLINT,
  IN "PISIGNATURE" VARCHAR(60),
  IN "PINEWSIGNPOS" INTEGER,
  IN "PIOLDSIGNPOS" INTEGER,
  IN "PIENSPLITLEN" INTEGER, --英文短信单条长度，小于等于0标识不支持英文短信
  IN "PIENMULTILEN1" INTEGER, --英文长短信拆分长度
  IN "PIENMULTILEN2" INTEGER, --英文长短信最后一条长度
  IN "PINEWENSIGNLEN" INTEGER, --补发英文签名长度
  IN "PIOLDENSIGNLEN" INTEGER, --原英文签名长度
  IN "PIENSIGNATURE" VARCHAR(60) --英文签名
 )
  SPECIFIC  GW_MTTASKSUPPV4
  LANGUAGE SQL
  NOT DETERMINISTIC
  CALLED ON NULL INPUT
  EXTERNAL ACTION
  OLD SAVEPOINT LEVEL
  MODIFIES SQL DATA
  INHERIT SPECIAL REGISTERS
  BEGIN
	DECLARE PISENDNUM INTEGER;
	DECLARE PIPKTOTAL INTEGER;
	DECLARE PIPKNUM	 INTEGER;
	DECLARE PIINITMSGID BIGINT;
	DECLARE PISINGLEMSG VARCHAR(720);
	DECLARE PISINGLEMSG1 VARCHAR(720);
	DECLARE PILONGMSG VARCHAR(3000);
	DECLARE PITOTALCNT INTEGER;
	DECLARE PILONGMSGLEN INTEGER;
	DECLARE PIECID INTEGER;
	DECLARE PIPHONE VARCHAR(21);
	DECLARE PISENDLEVEL SMALLINT;
	DECLARE PITASKID INTEGER;
	DECLARE PIRECVMTTIME TIMESTAMP;
	DECLARE PISRCCPNO  VARCHAR(21);
	DECLARE PIDESTCPNO VARCHAR(21);
	DECLARE PITPUDHI SMALLINT;
	DECLARE PITPPID SMALLINT;
	DECLARE PILONGMSGSEQ SMALLINT;
	DECLARE PIMSGFMT SMALLINT;
	DECLARE PIUNICOM SMALLINT;
	DECLARE PIMOBILEAREA INTEGER;
	DECLARE PISVRTYPE VARCHAR(64);
	DECLARE PIUSERMSGID BIGINT;
	DECLARE PISENDTYPE SMALLINT;
	DECLARE PIP1 VARCHAR(64);
	DECLARE PIP2 VARCHAR(64);
	DECLARE PIP3 VARCHAR(64);
	DECLARE PIP4 VARCHAR(64);
	DECLARE PIMODULEID INTEGER;
	DECLARE PIATTIME BIGINT;
	DECLARE PIVALIDTIME BIGINT;
	DECLARE PIRCOUNT1 INTEGER;
    DECLARE PIRCOUNT2 INTEGER;
  DECLARE PIBATCHID BIGINT;
  DECLARE PIAREACODE INTEGER;
  DECLARE PICUSTID VARCHAR(64);
	DECLARE PIEXDATA VARCHAR(64);

  DECLARE PISPLITLEN_V  INTEGER;
  DECLARE PIMULTILEN1_V  INTEGER;
  DECLARE PIMULTILEN2_V  INTEGER;
  DECLARE PINEWSIGNLEN_V  INTEGER;
  DECLARE PIOLDSIGNLEN_V  INTEGER;
  DECLARE PISIGNATURE_V  VARCHAR(62);

	SET PILONGMSG='';
	SET PIRECVMTTIME = CURRENT TIMESTAMP;
	SET PISRCCPNO  = SUBSTRING(PISRCSPNUMBER,LENGTH(PISRCSPGATE)+1,LENGTH(PISRCSPNUMBER)-LENGTH(PISRCSPGATE),CODEUNITS32);
	SET PIDESTCPNO = SUBSTRING(PIDESTSPNUMBER,LENGTH(PIDESTSPGATE)+1,LENGTH(PIDESTSPNUMBER)-LENGTH(PIDESTSPGATE),CODEUNITS32);
	DECLARE GLOBAL TEMPORARY TABLE SESSION.TMPTB_RDMTTASK (
	UID INTEGER,
	PTMSGID BIGINT,
	ECID INTEGER,
	TASKID INTEGER,
	USERID VARCHAR(11),
	SPGATE VARCHAR(21),
	CPNO VARCHAR(21),
	PHONE VARCHAR(21),
	SPMSGID BIGINT,
	RETFLAG SMALLINT,
	FEEFLAG SMALLINT,
	PKNUMBER SMALLINT,
	PKTOTAL SMALLINT,
	SENDSTATUS SMALLINT,
	SENDFLAG SMALLINT,
	RECVFLAG SMALLINT,
	PASSTHROUGH SMALLINT,
	DONEDATE CHAR(10),
	ERRORCODE CHAR(7),
	SENDLEVEL SMALLINT,
	SENDTYPE SMALLINT,
	UNICOM SMALLINT,
	RESENDCNT SMALLINT,
	RECVMTTIME TIMESTAMP,
	RECVTIME TIMESTAMP,
	USERMSGID BIGINT,
	MESSAGE VARCHAR(3000),
	TPUDHI SMALLINT,
	LONGMSGSEQ SMALLINT,
	MSGFMT SMALLINT,
	MOBILEAREA INTEGER,
	SVRTYPE VARCHAR(64),
	TPPID SMALLINT,
	P1 VARCHAR(64),
	P2 VARCHAR(64),
	P3 VARCHAR(64),
	P4 VARCHAR(64),
	MODULEID INTEGER,
	ATTIME BIGINT,
	VALIDTIME BIGINT,
	BATCHID BIGINT,
	AREACODE INTEGER,CUSTID VARCHAR(64),EXDATA VARCHAR(64))ON COMMIT DELETE ROWS NOT LOGGED WITH REPLACE;

	--取补发帐号的费用
	SELECT SENDNUM INTO PISENDNUM FROM USERFEE WHERE UCASE(USERID)=UCASE(PIDESTUSRID);
	--该模式可以把原始MSGID返给用户--用旧的MSGID复制一份记录插入临时表
	INSERT INTO SESSION.TMPTB_RDMTTASK(UID,PTMSGID,ECID,TASKID,USERID,SPGATE,CPNO,PHONE,
	SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,SENDSTATUS,SENDFLAG,RECVFLAG,
	DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,RESENDCNT,RECVMTTIME,RECVTIME,
	MESSAGE,TPUDHI,LONGMSGSEQ,MSGFMT,MOBILEAREA,SVRTYPE,TPPID,USERMSGID,
	P1,P2,P3,P4,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA)
	SELECT UID,PTMSGID,ECID,TASKID,USERID,SPGATE,CPNO,PHONE,
	SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,2,SENDFLAG,RECVFLAG,
	DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,RESENDCNT,RECVMTTIME,RECVTIME,
	MESSAGE,TPUDHI,LONGMSGSEQ,MSGFMT,MOBILEAREA,SVRTYPE,TPPID,USERMSGID,
	P1,P2,P3,P4,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA
	--只对0,8,15编码和人工实时、批量实时短信进行补发,其他不补发
	FROM GW_MT_TASK_BAK WHERE PTMSGID=PIOLDMSGID AND UCASE(USERID)=UCASE(PISRCUSRID) AND MSGFMT IN (0,8,15) AND RESENDCNT<1 AND LOCATE(PISRCSPNUMBER,RTRIM(SPGATE)||RTRIM(CPNO),1)=1 ;
	GET DIAGNOSTICS PIRCOUNT1 = ROW_COUNT;

	IF COALESCE(PIRCOUNT1,0)<=0 THEN
	INSERT INTO SESSION.TMPTB_RDMTTASK(UID,PTMSGID,ECID,TASKID,USERID,SPGATE,CPNO,PHONE,
	SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,SENDSTATUS,SENDFLAG,RECVFLAG,
	DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,RESENDCNT,RECVMTTIME,RECVTIME,
	MESSAGE,TPUDHI,LONGMSGSEQ,MSGFMT,MOBILEAREA,SVRTYPE,TPPID,USERMSGID,
	P1,P2,P3,P4,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA)
	SELECT UID,PTMSGID,ECID,TASKID,USERID,SPGATE,CPNO,PHONE,
	SPMSGID,RETFLAG,FEEFLAG,PKNUMBER,PKTOTAL,2,SENDFLAG,RECVFLAG,
	DONEDATE,ERRORCODE,SENDLEVEL,SENDTYPE,UNICOM,RESENDCNT,RECVMTTIME,RECVTIME,
	MESSAGE,TPUDHI,LONGMSGSEQ,MSGFMT,MOBILEAREA,SVRTYPE,TPPID,USERMSGID,
	P1,P2,P3,P4,MODULEID,ATTIME,VALIDTIME,BATCHID,AREACODE,'',''
	--只对0,8,15编码和人工实时、批量实时短信进行补发,其他不补发
	FROM MT_TASK WHERE PTMSGID=PIOLDMSGID AND UCASE(USERID)=UCASE(PISRCUSRID) AND MSGFMT IN (0,8,15) AND RESENDCNT<1 AND LOCATE(PISRCSPNUMBER,RTRIM(SPGATE)||RTRIM(CPNO),1)=1 ;
	GET DIAGNOSTICS PIRCOUNT1 = ROW_COUNT;
	END IF;

    DELETE FROM SESSION.TMPTB_RDMTTASK WHERE UNICOM=5 AND MSGFMT=0;
    GET DIAGNOSTICS PIRCOUNT2 = ROW_COUNT;

  IF PIRCOUNT1-PIRCOUNT2  <>0 THEN
	--BEGIN
		SELECT PKTOTAL ,PKNUMBER ,ECID ,PHONE ,SENDLEVEL ,TASKID ,TPUDHI ,LONGMSGSEQ ,MSGFMT ,UNICOM ,MOBILEAREA  ,SVRTYPE ,TPPID ,USERMSGID ,SENDTYPE ,P1 ,P2 ,P3 ,P4 ,MODULEID ,ATTIME ,VALIDTIME,BATCHID,AREACODE,CUSTID,EXDATA
		       INTO PIPKTOTAL ,PIPKNUM ,PIECID ,PIPHONE ,PISENDLEVEL ,PITASKID ,PITPUDHI ,PILONGMSGSEQ ,PIMSGFMT ,PIUNICOM ,PIMOBILEAREA  ,PISVRTYPE ,PITPPID ,PIUSERMSGID ,PISENDTYPE ,PIP1 ,PIP2 ,PIP3 ,PIP4 ,PIMODULEID ,PIATTIME ,PIVALIDTIME,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA
		       FROM SESSION.TMPTB_RDMTTASK WHERE PTMSGID=PIOLDMSGID;

    --如果原信息内容编码为0且英文签名长度大于等于0 按英文短信处理
     IF (0 = PIMSGFMT AND 0 <= PIOLDENSIGNLEN) THEN
       SET PIOLDSIGNLEN_V=PIOLDENSIGNLEN;
     ELSE
       SET PIOLDSIGNLEN_V=PIOLDSIGNLEN;
     END IF; --IF (0 == PIMSGFMT AND 0 <= PIOLDENSIGNLEN) THEN
     --如果原信息内容编码为0且补发路由单条长度大于0表示支持英文短信
     IF (0 = PIMSGFMT AND 0 < PIENSPLITLEN) THEN
       SET PISPLITLEN_V  =PIENSPLITLEN;
       SET PIMULTILEN1_V =PIENMULTILEN1;
       SET PIMULTILEN2_V =PIENMULTILEN2;
       SET PINEWSIGNLEN_V=PINEWENSIGNLEN;
       SET PISIGNATURE_V =PIENSIGNATURE;
     ELSE
       SET PISPLITLEN_V  =PISPLITLEN;
       SET PIMULTILEN1_V =PIMULTILEN1;
       SET PIMULTILEN2_V =PIMULTILEN2;
       SET PINEWSIGNLEN_V=PINEWSIGNLEN;
       SET PISIGNATURE_V =PISIGNATURE;
     END IF;

		 IF (PIPKTOTAL <= 1 AND ((PIPKTOTAL <= PISENDNUM AND PIDESTFEEFLAG=1) OR PIDESTFEEFLAG=2)) THEN --对于非长短信补发的处理
			--BEGIN PKTOTAL ,PKNUMBER ,ECID ,PHONE ,SENDLEVEL ,TASKID ,TPUDHI ,LONGMSGSEQ ,MSGFMT ,UNICOM ,MOBILEAREA  ,SVRTYPE ,TPPID ,USERMSGID ,SENDTYPE ,P1 ,P2 ,P3 ,P4 ,MODULEID ,ATTIME ,VALIDTIME
				SET PILONGMSG='';
				--取短信内容
				SELECT MESSAGE INTO PILONGMSG FROM SESSION.TMPTB_RDMTTASK WHERE PTMSGID=PIOLDMSGID;
				--更新替换MSGID
				UPDATE GW_MT_TASK_BAK SET RESENDCNT=1 WHERE PTMSGID=PIOLDMSGID;
				UPDATE MT_TASK SET RESENDCNT=1 WHERE PTMSGID=PIOLDMSGID;
				SET PILONGMSGLEN = LENGTH(PILONGMSG, CODEUNITS32)-PIOLDSIGNLEN_V; --减去签名的净长度

				IF PIOLDSIGNPOS=0 THEN--去掉原短信的签名
				   SET PILONGMSG=SUBSTRING(PILONGMSG,1,PILONGMSGLEN,CODEUNITS32);
				ELSE
				   SET PILONGMSG=SUBSTRING(PILONGMSG,1+PIOLDSIGNLEN_V,PILONGMSGLEN,CODEUNITS32);
				END IF;

				SET PILONGMSGLEN = LENGTH(PILONGMSG, CODEUNITS32);
				IF PILONGMSGLEN > 0 THEN
				--BEGIN
					--计算拆分条数
					IF PILONGMSGLEN<=PISPLITLEN_V THEN
					SET PIPKTOTAL=1;
					ELSE
					SET PIPKTOTAL=1+(PILONGMSGLEN-PIMULTILEN2_V+PIMULTILEN1_V-1)/(PIMULTILEN1_V);
					END IF; --END OF LONGMSGLEN<=SPLITLEN

					IF PINEWSIGNPOS=0 THEN--添加新短信的签名
					SET PILONGMSG = TRIM(PILONGMSG)||PISIGNATURE_V;
					ELSE
					SET PILONGMSG = PISIGNATURE_V||TRIM(PILONGMSG);
					END IF;

					--调用插入存储过程
					CALL GW_WR_MTTASKV2(PIDESTUID,PINEWMSGID,2,1,PIPKTOTAL,1,
									PISPLITLEN_V,PIMULTILEN1_V,PIMULTILEN2_V,PINEWSIGNLEN_V,PIECID,
									PIDESTUSRID,PIDESTSPGATE,PIDESTCPNO,PIRECVMTTIME,PILONGMSG,
									PIPHONE,PIDESTFEEFLAG,PISENDLEVEL,PITASKID,'',PITPUDHI,
									PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PIPKNUM,PISVRTYPE,
									PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA);
				--END;--END OF IF LONGMSGLEN > 0
				ELSE
					SET PILONGMSG='';
				END IF; --END OF IF LONGMSGLEN > 0
				SET PIPKNUM=1;
			--END ; --END OF PKTOTAL = 1
        /*
		ELSEIF (PIPKTOTAL > 1 AND ((PIPKTOTAL <= PISENDNUM AND PIDESTFEEFLAG=1) OR PIDESTFEEFLAG=2) AND PITPUDHI=1) THEN --对标准协议长短信的补发
		--BEGIN
			SET PILONGMSG='';
			--取短信内容
			SELECT MESSAGE INTO PILONGMSG FROM SESSION.TMPTB_RDMTTASK WHERE PTMSGID=PIOLDMSGID;
			--更新替换MSGID
			UPDATE GW_MT_TASK_BAK SET PTMSGID=PINEWMSGID,RESENDCNT=1 WHERE PTMSGID=PIOLDMSGID;
			IF (PIPKTOTAL=PIPKNUM) THEN--如果是最后一条，去掉旧签名，加上新签名
			--BEGIN
				SET PILONGMSGLEN = LENGTH(PILONGMSG, CODEUNITS32)-PIOLDSIGNLEN; --减去签名的净长度
				SET PILONGMSG=SUBSTRING(PILONGMSG,1,PILONGMSGLEN,CODEUNITS32);
				SET PILONGMSG =PILONGMSG||PISIGNATURE;
			END IF;
			SET PILONGMSGLEN = LENGTH(PILONGMSG, CODEUNITS32);
			IF PILONGMSGLEN > 0 THEN
			--BEGIN
				--调用插入存储过程
				CALL GW_WR_MTTASKSRV2(PIDESTUID,PIOLDMSGID,2,1,PIPKTOTAL,1,PIECID,
								PIDESTUSRID,PIDESTSPGATE,PIDESTCPNO,PIRECVMTTIME,PILONGMSG,
								PIPHONE,PIDESTFEEFLAG,PIPKNUM,PISENDLEVEL,PITASKID,'',PITPUDHI,
								PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PISVRTYPE,
								PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA);

			--END --END OF IF LONGMSGLEN > 0
			ELSE
				SET PILONGMSG='';
			END IF; --IF LONGMSGLEN > 0
		*/
		ELSEIF (PIPKTOTAL > 1 AND ((PIPKTOTAL <= PISENDNUM AND PIDESTFEEFLAG=1) OR PIDESTFEEFLAG=2) AND PITPUDHI=0) THEN--对非标准长短信协议的处理
		--BEGIN
			SET PILONGMSG='';
			--没有补发过且通道号跟源通道号相等
			IF EXISTS(SELECT * FROM SESSION.TMPTB_RDMTTASK WHERE PTMSGID=PIOLDMSGID) THEN
			--BEGIN
				--循环处理旧的几条短信，并且用新的MSGID更新旧的MSGID,然后调用存储过程用旧的MSGID生成新的几条短信，并返回旧的MSGID
				--计算起始MSGID
				SET PIINITMSGID = PIOLDMSGID-(PIPKNUM-1)*17179869184;
				SET PIPKNUM = 1;

				WHILE PIPKNUM <= PIPKTOTAL
				DO
					--取短信内容 --若长短信中间的某条缺失，则不补发(暂不考虑)
					SELECT MESSAGE INTO PISINGLEMSG FROM GW_MT_TASK_BAK WHERE PTMSGID=PIINITMSGID+(PIPKNUM-1)*17179869184;
					IF PISINGLEMSG IS NULL THEN
					  SELECT MESSAGE INTO PISINGLEMSG1 FROM MT_TASK WHERE PTMSGID=PIINITMSGID+(PIPKNUM-1)*17179869184;
					  IF PISINGLEMSG1 IS NOT NULL THEN
					    UPDATE MT_TASK SET RESENDCNT=1 WHERE PTMSGID=PIINITMSGID+(PIPKNUM-1)*17179869184;
					    --拼接短信内容
					    SET PILONGMSG = PILONGMSG||PISINGLEMSG1;
					  END IF;
					ELSE
					  UPDATE GW_MT_TASK_BAK SET RESENDCNT=1 WHERE PTMSGID=PIINITMSGID+(PIPKNUM-1)*17179869184;
					  --拼接短信内容
					  SET PILONGMSG = PILONGMSG||PISINGLEMSG;
					END IF; --IF SINGLEMSG = ''
					--更新替换MSGID
					SET PIPKNUM = PIPKNUM+1;
				END WHILE;--END OF WHILE PKNUM <= PKTOTAL

				SET PILONGMSGLEN = LENGTH(PILONGMSG, CODEUNITS32)-PIOLDSIGNLEN_V; --减去签名的净长度

				IF PIOLDSIGNPOS=0 THEN--去掉原短信的签名
                SET PILONGMSG=SUBSTRING(PILONGMSG,1,PILONGMSGLEN,CODEUNITS32);
				ELSE
				SET PILONGMSG=SUBSTRING(PILONGMSG,1+PIOLDSIGNLEN_V,PILONGMSGLEN,CODEUNITS32);
				END IF;

				SET PILONGMSGLEN = LENGTH(PILONGMSG, CODEUNITS32);
				IF PILONGMSGLEN > 0 THEN
				--BEGIN
					--计算拆分条数
					IF PILONGMSGLEN<=PISPLITLEN_V THEN
					SET PIPKTOTAL=1;
					ELSE
					SET PIPKTOTAL=1+(PILONGMSGLEN-PIMULTILEN2_V+PIMULTILEN1_V-1)/(PIMULTILEN1_V);
					END IF;

					IF PINEWSIGNPOS=0 THEN--添加新短信的签名
					SET PILONGMSG = TRIM(PILONGMSG)||PISIGNATURE_V;
					ELSE
					SET PILONGMSG = PISIGNATURE_V||TRIM(PILONGMSG);
					END IF;

					--调用插入存储过程
					CALL GW_WR_MTTASKV2 (PIDESTUID,PINEWMSGID,2,1,PIPKTOTAL,1,
									PISPLITLEN_V,PIMULTILEN1_V,PIMULTILEN2_V,PINEWSIGNLEN_V,PIECID,
									PIDESTUSRID,PIDESTSPGATE,PIDESTCPNO,PIRECVMTTIME,PILONGMSG,
									PIPHONE,PIDESTFEEFLAG,PISENDLEVEL,PITASKID,'',PITPUDHI,
									PILONGMSGSEQ,PIMSGFMT,PIUNICOM,PIMOBILEAREA,PIPKNUM,PISVRTYPE,
									PIP1,PIP2,PIP3,PIP4,PIUSERMSGID,PIMODULEID,PIATTIME,PIVALIDTIME ,PISENDTYPE,PIBATCHID,PIAREACODE,PICUSTID,PIEXDATA);
				--END --END OF IF LONGMSGLEN > 0
				ELSE
					SET PILONGMSG='';
				END IF;--END OF IF LONGMSGLEN > 0
				SET PIPKNUM=1 ;
			END IF;--END OF IF EXISTS(SELECT COUNT(*) FROM TMP WHERE PTMSGID=OLDMSGID AND RESENDCNT<1 AND (RTRIM(SPGATE)+RTRIM(CPNO))=SRCSPNUMBER)
		END IF;--END OF IF PKTOTAL > 1
	END IF;--END OF IF ROWCOUNT<>0
	PRET: BEGIN

	DECLARE C_3 CURSOR WITH RETURN FOR
	SELECT PIDESTUID AS UID,PINEWMSGID AS PTMSGID,ECID,TASKID,PIDESTUSRID AS USERID,PIDESTSPGATE AS SPGATE,
	PIDESTCPNO AS CPNO,PIPHONE AS PHONE,RETFLAG,PIDESTFEEFLAG AS FEEFLAG,PIPKNUM AS PKNUMBER,PIPKTOTAL AS PKTOTAL,
	SENDSTATUS,1 AS SENDLEVEL,PIRECVMTTIME AS RECVMTTIME,PILONGMSG AS MESSAGE,TPUDHI,LONGMSGSEQ,MSGFMT,UNICOM,
	MOBILEAREA,SVRTYPE,TPPID,P1,P2,P3,P4,USERMSGID,MODULEID,ATTIME,VALIDTIME,SENDTYPE,BATCHID,AREACODE,CUSTID,EXDATA FROM SESSION.TMPTB_RDMTTASK WHERE PILONGMSG<>'' ;
	OPEN C_3;
	END PRET;
END;

DROP PROCEDURE DELPROC;

BEGIN ATOMIC
DECLARE PIVERSION VARCHAR(32);
SET PIVERSION = '4.06.06';
IF NOT EXISTS (SELECT VERSION FROM VERSION_CMPP WHERE VERSION = PIVERSION) THEN
INSERT INTO VERSION_CMPP (VERSION,VERSIONDATE,UPGRADETIME)
VALUES (PIVERSION,CURRENT DATE,(TRIM(CHAR(YEAR(CURRENT TIMESTAMP)))||'-'|| (CASE MONTH(CURRENT TIMESTAMP) WHEN
1 THEN '01' WHEN 2 THEN '02' WHEN 3 THEN '03' WHEN 4 THEN '04' WHEN 5 THEN '05' WHEN 6 THEN '06'WHEN 7 THEN '07' WHEN 8 THEN '08' WHEN 9 THEN '09'   ELSE
TRIM(CHAR(MONTH(CURRENT TIMESTAMP))) END)||'-'||TRIM(CHAR(DAY(CURRENT TIMESTAMP)))||' '||TRIM(CHAR(HOUR(CURRENT TIMESTAMP)))||':'||TRIM(CHAR(MINUTE(CURRENT TIMESTAMP)))||':'||TRIM(CHAR(SECOND(CURRENT TIMESTAMP)))));
END IF;
END ;
/*网关升级脚本   END*/


/* EMP升级脚本START */
------------------------------2018-07-09 ---cheng  ---------------------------------------
----修改菜单路径---
CREATE PROCEDURE "UPDATEDATAEXISTS"
  BEGIN ATOMIC
    IF  EXISTS (SELECT * FROM lf_privilege WHERE privilege_id = 2608 and menusite = '/app_smsTaskRecord.htm')
    THEN
      UPDATE LF_PRIVILEGE SET MENUSITE = '/APP_APPSMSTASKRECORD.HTM' WHERE PRIVILEGE_ID = 2608;
    END IF;
  END;
CALL UPDATEDATAEXISTS;
DROP PROCEDURE UPDATEDATAEXISTS;
------------------------------2018-5-25 ---cheng  ---------------------------------------
-------LF_UDGROUP表删除外键------
CREATE PROCEDURE "DELETEEXIST"
  BEGIN
    IF  EXISTS ( SELECT PROCNAME FROM SYSCAT.PROCEDURES WHERE PROCNAME='DELUQKEY')
    THEN
      EXECUTE IMMEDIATE  'DROP  PROCEDURE DELUQKEY';
    END IF;
  END;
CALL DELETEEXIST;
DROP PROCEDURE DELETEEXIST;

CREATE PROCEDURE DELUQKEY
  BEGIN ATOMIC
    DECLARE fk_name varchar(1000);
    DECLARE FETCH_STATUS INT DEFAULT 0;
    DECLARE CURIDX CURSOR WITH HOLD FOR SELECT CONSTNAME FROM SYSCAT.references WHERE TABNAME='LF_LIST2GRO';
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET FETCH_STATUS = 1;

    OPEN CURIDX;
    FETCH CURIDX INTO fk_name;
    WHILE FETCH_STATUS=0 DO
      EXECUTE IMMEDIATE 'ALTER TABLE LF_LIST2GRO DROP CONSTRAINT '||fk_name;
      FETCH CURIDX INTO  fk_name;
    END WHILE;
    CLOSE CURIDX;
  END;
------ 将富信模板 类型 TMP_TYPE 由 5 改为 11 ----
CREATE PROCEDURE "UPDATEDATAEXISTS"
  BEGIN ATOMIC
    IF  EXISTS (SELECT * FROM LF_TEMPLATE WHERE TMP_TYPE = 5)
    THEN
      UPDATE LF_TEMPLATE SET TMP_TYPE = 11 WHERE TMP_TYPE = 5;
    END IF;
  END;
CALL UPDATEDATAEXISTS;
DROP PROCEDURE UPDATEDATAEXISTS;

------------------------------2018-5-22 ---cheng  ---------------------------------------
--------------------修改菜单映射------------------
CREATE PROCEDURE "UPDATEDATAEXISTS"
  BEGIN ATOMIC
    IF  EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 634)
    THEN
      UPDATE LF_PRIVILEGE SET MENUSITE = '/mbgl_mytemplate.htm' WHERE PRIVILEGE_ID = 634;--/mbgl_template.htm
    END IF;
  END;
CALL UPDATEDATAEXISTS;
DROP PROCEDURE UPDATEDATAEXISTS;

CREATE PROCEDURE "UPDATEDATAEXISTS"
  BEGIN ATOMIC
    IF  EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3100)
    THEN
      UPDATE LF_PRIVILEGE SET MENUSITE = '/rms_rmsSameMms.htm' WHERE PRIVILEGE_ID = 3100;--/rms_sameMms.htm
    END IF;
  END;
CALL UPDATEDATAEXISTS;
DROP PROCEDURE UPDATEDATAEXISTS;

CREATE PROCEDURE "UPDATEDATAEXISTS"
  BEGIN ATOMIC
    IF  EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3500)
    THEN
      UPDATE LF_PRIVILEGE SET MENUSITE = '/url_urlSendBatchSMS.htm' WHERE PRIVILEGE_ID = 3500;--/url_ssendBatchSMS.htm
    END IF;
  END;
CALL UPDATEDATAEXISTS;
DROP PROCEDURE UPDATEDATAEXISTS;

CREATE PROCEDURE "UPDATEDATAEXISTS"
  BEGIN ATOMIC
    IF  EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3506)
    THEN
      UPDATE LF_PRIVILEGE SET MENUSITE = '/url_urlSendDiffSMS.htm' WHERE PRIVILEGE_ID = 3506;--/url_ssendDiffSMS.htm
    END IF;
  END;
CALL UPDATEDATAEXISTS;
DROP PROCEDURE UPDATEDATAEXISTS;

------------------------------2018-4-27 ---cheng  ---------------------------------------
---LF_TEMPLATEVER字段增加默认值---
CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    set stmt = 'ALTER TABLE LF_TEMPLATE ADD VER VARCHAR(10) NOT NULL DEFAULT ''v1.0''';
    IF NOT EXISTS(SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME='LF_TEMPLATE' AND COLNAME='VER')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
------------------------------2018-4-12 ---pengyc  ---------------------------------------
--添加我的快捷菜单的脚本
CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN
    DECLARE TID VARCHAR(10);
    SET TID = (select max(TID) FROM LF_THIR_MENUCONTROL) + 1;
    IF NOT EXISTS (SELECT * FROM LF_THIR_MENUCONTROL WHERE MENU_NUM=25 AND PRI_MENU=93)
    THEN
      INSERT INTO LF_THIR_MENUCONTROL (TID,MENU_NUM,TITLE,PRI_MENU,PRI_ORDER,ZH_TW_TITLE,ZH_HK_TITLE)
      VALUES (TID,25,'企业富信',93,60,'企I富信','Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

--创建LF_SHORTTEMP表
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF(SELECT COUNT(*) FROM SYSCAT.TABLES WHERE TABNAME='LF_SHORTTEMP')=0
    THEN
      EXECUTE IMMEDIATE  '
      CREATE TABLE LF_SHORTTEMP(
        ID BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY (
                                       START WITH +1
                                       INCREMENT BY +1
                                       MINVALUE +1
                                       MAXVALUE +2147483647
                                       NO CYCLE
                                       NO CACHE
                                       NO ORDER ),	--ID自增ID
        USERID BIGINT DEFAULT 0 NOT NULL,	--USERID用户ID
        CORPCODE VARCHAR(32) DEFAULT '''' NOT NULL,	--CORPCODE企业账号
        TEMPID BIGINT DEFAULT 0 NOT NULL,	--TEMPID模板id
        TEMPNAME VARCHAR(32)DEFAULT '''' NOT NULL ,	--TEMPNAME模板名称
        ADDTIME TIMESTAMP DEFAULT CURRENT TIMESTAMP	NOT NULL	--ADDTIME添加的时间
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;


------------------------------2018-4-12 ---xuty  ---------------------------------------
-- 公共场景权限菜单
CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = '3550')
    THEN
      INSERT INTO LF_PRIVILEGE VALUES(3550,95,1,'查看','5100-1350-0','公共场景','富信应用','5100-1350','/rms_commTpl.htm','查看','view','公共场景','Common Template','富信用','Rms application');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT *  FROM LF_IMPOWER WHERE PRIVILEGE_ID = '3550')
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3550);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3550);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3550);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = '3551')
    THEN
      INSERT INTO LF_PRIVILEGE(PRIVILEGE_ID,RESOURCE_ID,COMMENTS,PRIV_CODE,MENUNAME,MODNAME,MENUCODE,ZH_TW_COMMENTS,ZH_HK_COMMENTS,ZH_TW_MENUNAME,ZH_HK_MENUNAME,ZH_TW_MODNAME,ZH_HK_MODNAME) VALUES(3551,95,'新建','5100-1300-1','公共场景','富信应用','5100-1300','新建','Add','公共场景','Template management','富信用','Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = '3552')
    THEN
      INSERT INTO LF_PRIVILEGE(PRIVILEGE_ID,RESOURCE_ID,COMMENTS,PRIV_CODE,MENUNAME,MODNAME,MENUCODE,ZH_TW_COMMENTS,ZH_HK_COMMENTS,ZH_TW_MENUNAME,ZH_HK_MENUNAME,ZH_TW_MODNAME,ZH_HK_MODNAME) VALUES(3552,95,'删除','5100-1300-2','公共场景','富信应用','5100-1300','删除','Delete','公共场景','Template management','富信用','Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT *  FROM LF_IMPOWER WHERE PRIVILEGE_ID = '3551')
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3551);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3551);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3551);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT *  FROM LF_IMPOWER WHERE PRIVILEGE_ID = '3552')
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(1,3552);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(2,3552);
      INSERT INTO LF_IMPOWER(ROLE_ID,PRIVILEGE_ID) VALUES(4,3552);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "UPDATEDATAEXISTS"
  BEGIN ATOMIC
    IF  EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = '633')
    THEN
      UPDATE LF_PRIVILEGE SET MENUNAME ='我的场景' ,ZH_TW_COMMENTS = '新建',ZH_TW_MENUNAME = '我的场景',ZH_HK_MENUNAME = 'My scene' WHERE PRIVILEGE_ID = '633';
    END IF;
  END;
CALL UPDATEDATAEXISTS;
DROP PROCEDURE UPDATEDATAEXISTS;

CREATE PROCEDURE "UPDATEDATAEXISTS"
  BEGIN ATOMIC
    IF  EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = '634')
    THEN
      UPDATE LF_PRIVILEGE SET MENUNAME ='我的场景' ,ZH_TW_COMMENTS = '查看',ZH_TW_MENUNAME = '我的场景',ZH_HK_MENUNAME = 'My scene' WHERE PRIVILEGE_ID = '634';
    END IF;
  END;
CALL UPDATEDATAEXISTS;
DROP PROCEDURE UPDATEDATAEXISTS;

CREATE PROCEDURE "UPDATEDATAEXISTS"
  BEGIN ATOMIC
    IF  EXISTS (SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = '635')
    THEN
      UPDATE LF_PRIVILEGE SET MENUNAME ='我的场景' ,ZH_TW_COMMENTS = '删除',ZH_TW_MENUNAME = '我的场景',ZH_HK_MENUNAME = 'My scene' WHERE PRIVILEGE_ID = '635';
    END IF;
  END;
CALL UPDATEDATAEXISTS;
DROP PROCEDURE UPDATEDATAEXISTS;



-- 模板表添加 行业-用途ID（关联LF_INDUSTRY_USE中的INDUSTRYID、USEID、USECOUNT）
CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_TEMPLATE ADD INDUSTRYID INT NOT NULL WITH DEFAULT -1';
    IF NOT EXISTS (SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME='LF_TEMPLATE' AND COLNAME='INDUSTRYID')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_TEMPLATE ADD USEID INT NOT NULL WITH DEFAULT -2';
    IF NOT EXISTS (SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME='LF_TEMPLATE' AND COLNAME='USEID')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_TEMPLATE ADD USECOUNT INT NOT NULL WITH DEFAULT 0';
    IF NOT EXISTS (SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME='LF_TEMPLATE' AND COLNAME='USECOUNT')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_TEMPLATE ADD ISSHORTTEMP INT NOT NULL WITH DEFAULT 0';
    IF NOT EXISTS (SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME='LF_TEMPLATE' AND COLNAME='ISSHORTTEMP')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

-- 行业、用途 管理表
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS (SELECT TABNAME FROM SYSCAT.TABLES WHERE TABNAME='LF_INDUSTRY_USE')
    THEN
      EXECUTE IMMEDIATE  '
      CREATE TABLE LF_INDUSTRY_USE (
        ID  BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY (
                                        START WITH +1
                                        INCREMENT BY +1
                                        MINVALUE +1
                                        MAXVALUE +2147483647
                                        NO CYCLE
                                        NO CACHE
                                        NO ORDER ),
        NAME VARCHAR(100) DEFAULT '''' NOT NULL,
        OPERATOR BIGINT DEFAULT 0 NOT NULL,
        TYPE SMALLINT DEFAULT 0 NOT NULL,
        CREATETM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
        UPDATETM TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    set stmt = 'ALTER TABLE LF_TEMPLATE ADD ISPUBLIC SMALLINT NOT NULL WITH DEFAULT 0';
    IF NOT EXISTS(SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME='LF_TEMPLATE' AND COLNAME='ISPUBLIC')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt varchar(255);
    set stmt = 'ALTER TABLE LF_TEMPLATE ADD EXLJSON VARCHAR(5000) DEFAULT '''' NOT NULL';
    IF NOT EXISTS(SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME='LF_TEMPLATE' AND COLNAME='EXLJSON')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;





------------------------------2018-4-12 ---caihq  ---------------------------------------

--修改相同内容发送为富信发送
UPDATE LF_PRIVILEGE SET RESOURCE_ID = 94,MENUNAME = '富信发送',ZH_TW_MENUNAME='富信l送',ZH_HK_MENUNAME='RMS Send',COMMENTS='查看',ZH_TW_COMMENTS='查看' WHERE PRIVILEGE_ID = '3100';


--添加二级菜单
CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    DECLARE id INTEGER;
    SET id = (SELECT MAX(LF.TID) FROM LF_THIR_MENUCONTROL LF) + 1;
    IF NOT EXISTS (SELECT * FROM LF_THIR_MENUCONTROL WHERE PRI_MENU=100)
    THEN
      INSERT INTO LF_THIR_MENUCONTROL (TID,MENU_NUM,TITLE,PRI_MENU,PRI_ORDER,ZH_TW_TITLE,ZH_HK_TITLE)
      VALUES (id,25,'企业富信',100,90,'企I富信','Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

--修改三个三级菜单到二级菜单（数据查询）下面
UPDATE LF_PRIVILEGE SET RESOURCE_ID = 100 , MODNAME = '数据查询' ,ZH_HK_MODNAME='Data query',ZH_TW_MODNAME='查' WHERE PRIVILEGE_ID IN (3101,3103,3104);

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_SKIN WHERE SKIN_CODE='default' AND THEME_CODE='frame4.0')
    THEN
      INSERT INTO LF_SKIN(SKIN_NAMNE,SKIN_CODE,THEME_CODE) VALUES('商务黑','default','frame4.0');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;
CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS (SELECT * FROM LF_THEME WHERE THEME_NAME='简约' AND THEME_CODE='frame4.0')
    THEN
      insert into LF_THEME (THEME_NAME, THEME_CODE, THEME_SRC) values ('简约', 'frame4.0', 'classic');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;
/* EMP升级脚本 END */


--增加LF_BUSMANAGER表的BUS_NAME字段的长度，由32增加为64
CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    IF EXISTS(SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME='LF_BUSMANAGER' AND COLNAME='BUS_NAME')
    THEN
      EXECUTE IMMEDIATE  'ALTER TABLE LF_BUSMANAGER ALTER COLUMN BUS_NAME SET DATA TYPE VARCHAR(64)';
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

--1.删除原有无效菜单
DELETE FROM LF_IMPOWER WHERE PRIVILEGE_ID in (3526,3527,3528);
DELETE FROM LF_PRIVILEGE WHERE PRIVILEGE_ID in (3526,3527,3528);
--2.删除公共场景的删除菜单按钮
DELETE FROM LF_IMPOWER WHERE PRIVILEGE_ID in(3552);
DELETE FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3552;
--3.更新菜单
UPDATE LF_PRIVILEGE SET MENUCODE = '5100-1350',PRIV_CODE='5100-1350-0' WHERE PRIVILEGE_ID = 3550;
UPDATE LF_PRIVILEGE SET MENUCODE = '5100-1350',PRIV_CODE='5100-1350-1' WHERE PRIVILEGE_ID = 3551;
----------- V6.23-V6.24END ------------------------


-----V71.00 START-------
UPDATE LF_PRIVILEGE SET RESOURCE_ID = 95 WHERE RESOURCE_ID = 100 AND MODNAME = '数据查询';
UPDATE LF_PRIVILEGE SET RESOURCE_ID = 94 WHERE RESOURCE_ID = 95 AND MODNAME = '富信应用';
UPDATE LF_PRIVILEGE SET PRIV_CODE = '5100-1600-0',MENUCODE='5100-1600' WHERE PRIVILEGE_ID = '3104';

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID = '3100')
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3100);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3100);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3100);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS(SELECT * FROM LF_IMPOWER WHERE PRIVILEGE_ID = '3102')
    THEN
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3102);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3102);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3102);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = '3108')
    THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME) VALUES (3108, 100, 1, '查看', '5100-1500-0', '群发历史查询', '数据查询', '5100-1500', '/rms_rmsTaskHistory.htm', '查看', 'View', '群lv史查', 'Task history view', '查', 'Data query');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3108);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3108);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3108);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

-- UPDATE LF_PRIVILEGE SET RESOURCE_ID=100,PRIV_CODE = '5100-2000-0',MENUCODE='5100-2000',MODNAME='计费档位管理',ZH_HK_MODNAME='Degree Manage',ZH_TW_MODNAME='Mn位管理' WHERE PRIVILEGE_ID = 3103;
-- 数据查询相关菜单 --
UPDATE LF_PRIVILEGE SET RESOURCE_ID = 95,MODNAME='数据查询' WHERE PRIVILEGE_ID IN(3104,3107,3108,3101);

----LF_TEMPLATE 添加字段
CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_TEMPLATE ADD CHGRADE INTEGER NOT NULL WITH DEFAULT -1';
    IF NOT EXISTS(SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_TEMPLATE' AND COLNAME ='CHGRADE')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_TEMPLATE ADD RMSRESSIZE INTEGER NOT NULL WITH DEFAULT 0';
    IF NOT EXISTS(SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_TEMPLATE' AND COLNAME ='RMSRESSIZE')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_TEMPLATE ADD H5RESSIZE INTEGER NOT NULL WITH DEFAULT 0';
    IF NOT EXISTS(SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_TEMPLATE' AND COLNAME ='H5RESSIZE')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_TEMPLATE ADD PARAMSNUM INTEGER NOT NULL WITH DEFAULT 0';
    IF NOT EXISTS(SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_TEMPLATE' AND COLNAME ='PARAMSNUM')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

-------- LF_CORP 添加字段 ---------------
CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt VARCHAR(250);
    SET stmt = 'ALTER TABLE LF_CORP ADD RPTFLAG INTEGER NOT NULL WITH DEFAULT 1';
    IF NOT EXISTS(SELECT COLNAME FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_CORP' AND COLNAME ='RPTFLAG')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

-- 移植托管版7.2的新编辑功能 Start --
-- 1.新增LF_SUB_TEMPLATE(子模板表)
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.TABLES WHERE TABNAME = 'LF_SUB_TEMPLATE')
    THEN
      EXECUTE IMMEDIATE 'CREATE TABLE LF_SUB_TEMPLATE(
        "ID"  BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY
                                (START WITH 1, INCREMENT BY 1, NO CACHE, MINVALUE 1, MAXVALUE 9223372036854775807, NO CYCLE, NO ORDER),
        TMP_TYPE DECIMAL(11) DEFAULT 1 NOT NULL,
        FRONTJSON VARCHAR(100) DEFAULT '' '' NOT NULL,
        INDUSTRY_ID DECIMAL(11) DEFAULT 0 NOT NULL,
        USE_ID DECIMAL(11) DEFAULT 0 NOT NULL,
        STATUS DECIMAL(11) DEFAULT 0 NOT NULL,
        ADD_TIME TIMESTAMP(8) DEFAULT  current timestamp NOT NULL,
        ENDJSON VARCHAR(100) DEFAULT '' '' NOT NULL,
        PRIORITY DECIMAL(15) DEFAULT 0 NOT NULL,
        FILEURL VARCHAR(255) DEFAULT '' '' NOT NULL,
        CONTENT VARCHAR(100) DEFAULT '' '' NOT NULL,
        CARD_HTML VARCHAR(10) DEFAULT '' '' NOT NULL,
        TM_ID DECIMAL(11) DEFAULT 0 NOT NULL,
        DEGREE DECIMAL(11) DEFAULT 0 NOT NULL,
        DEGREE_SIZE DECIMAL(11) DEFAULT 0 NOT NULL
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

-- 2.新增LF_HFIVE(H5表)
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.TABLES WHERE TABNAME =  'LF_HFIVE')
    THEN
      EXECUTE IMMEDIATE 'CREATE TABLE LF_HFIVE(
        HID  BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY
                                (START WITH 1, INCREMENT BY 1, NO CACHE, MINVALUE 1, MAXVALUE 9223372036854775807, NO CYCLE, NO ORDER),
        TITLE VARCHAR(50) DEFAULT '' '' NOT NULL,
        AUTHOR VARCHAR(50) DEFAULT '' '' NOT NULL,
        CREATETIME TIMESTAMP(8) DEFAULT current timestamp NOT NULL,
        COMMITTIME TIMESTAMP(8) DEFAULT current timestamp NOT NULL,
        URL VARCHAR(256) DEFAULT '' '' NOT NULL,
        UPDATETIME TIMESTAMP(8) DEFAULT current timestamp NOT NULL,
        USETIME TIMESTAMP(8) DEFAULT current timestamp NOT NULL,
        STAUS DECIMAL(3) DEFAULT 0 NOT NULL
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

-- 3.新增LF_TEMP_PARAM(模板参数表)
CREATE PROCEDURE "ADDTABLEEXISTS"
  BEGIN
    IF NOT EXISTS(SELECT * FROM SYSCAT.TABLES WHERE TABNAME = 'LF_TEMP_PARAM')
    THEN
      EXECUTE IMMEDIATE 'CREATE TABLE LF_TEMP_PARAM(
        "ID"  BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY
                                (START WITH 1, INCREMENT BY 1, NO CACHE, MINVALUE 1, MAXVALUE 9223372036854775807, NO CYCLE, NO ORDER),
        TM_ID DECIMAL(18) DEFAULT 0 NOT NULL,
        NAME VARCHAR(255) DEFAULT '' '' NOT NULL,
        MAX_LENGTH DECIMAL(11) DEFAULT 0 NOT NULL,
        MIN_LENGTH DECIMAL(11) DEFAULT 0 NOT NULL,
        TYPE DECIMAL(3) DEFAULT 1 NOT NULL,
        LENGTH_RESTRICT DECIMAL(3) DEFAULT 0 NOT NULL,
        FIX_LENGTH DECIMAL(11) DEFAULT 0 NOT NULL,
        HASLENGTH DECIMAL(11) DEFAULT 0 NOT NULL,
        REGCONTENT VARCHAR(50) DEFAULT '' '' NOT NULL
      )';
    END IF;
  END;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

-- 4.LF_INDUSTRY_USE表增加字段TMPTYPE
CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN ATOMIC
    DECLARE stmt varchar(250);
    SET stmt = 'ALTER TABLE LF_INDUSTRY_USE ADD TMPTYPE DECIMAL(11) DEFAULT 0 NOT NULL';
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_INDUSTRY_USE' AND COLNAME = 'TMPTYPE')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;
-- 5.增加菜单H5页面库 位于富信应用下
CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3552)
    THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME)
      VALUES (3552, 94, 1, '查看', '5100-1360-0', 'H5页面库', '富信应用', '5100-1360', '/page/toSiteIndex.htm', '查看', 'View', 'H5面', 'H5 page', '富信用', 'Rich Media');
    --     INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3552);
    --     INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3552);
    --     INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3552);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;


-- 5.修改菜单映射
-- 我的场景
UPDATE LF_PRIVILEGE SET MENUSITE = '/toMyTplndex.meditorPage' WHERE PRIVILEGE_ID = 634;
-- 公共场景
UPDATE LF_PRIVILEGE SET MENUSITE = '/toPublicTpIndex.meditorPage' WHERE PRIVILEGE_ID = 3550;
--富信发送
UPDATE LF_PRIVILEGE SET MENUSITE = '/rms_rmsSameMms.htm' WHERE PRIVILEGE_ID = 3100;
-- 6.LF_MTTASK表增加字段TEMP_TYPE
CREATE PROCEDURE  "ADDCOLUMNEXISTS"
  BEGIN
    DECLARE stmt varchar(250);
    SET stmt = 'ALTER TABLE LF_MTTASK ADD TEMP_TYPE DECIMAL(11) DEFAULT 0 NOT NULL';
    IF NOT EXISTS(SELECT * FROM SYSCAT.COLUMNS WHERE TABNAME = 'LF_MTTASK' AND COLNAME = 'TEMP_TYPE')
    THEN
      EXECUTE IMMEDIATE stmt;
    END IF;
  END;
CALL ADDCOLUMNEXISTS;
DROP PROCEDURE ADDCOLUMNEXISTS;

-- 移植托管版7.2的新编辑功能 End --

--修改公共场景为模板库
UPDATE LF_PRIVILEGE SET MENUNAME = '模板库',ZH_TW_MENUNAME = '模板' WHERE PRIVILEGE_ID IN (3550,3551);

--添加二级菜单
CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    DECLARE id INTEGER;
    SET id = (SELECT MAX(LF.TID) FROM LF_THIR_MENUCONTROL LF) + 1;
    IF NOT EXISTS (SELECT * FROM LF_THIR_MENUCONTROL WHERE PRI_MENU=94)
    THEN
      INSERT INTO LF_THIR_MENUCONTROL (TID,MENU_NUM,TITLE,PRI_MENU,PRI_ORDER,ZH_TW_TITLE,ZH_HK_TITLE)
      VALUES (id,25,'企业富信',94,70,'企I富信','Multimedia');
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

-- 添加群发任务查看-----
DELETE FROM LF_IMPOWER WHERE PRIVILEGE_ID = 3007;
DELETE FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = 3007;
CREATE PROCEDURE "INSERTDATAEXISTS"
  BEGIN ATOMIC
    IF NOT EXISTS(SELECT * FROM LF_PRIVILEGE WHERE PRIVILEGE_ID = '3107')
    THEN
      INSERT INTO LF_PRIVILEGE (PRIVILEGE_ID, RESOURCE_ID, OPERATE_ID, COMMENTS, PRIV_CODE, MENUNAME, MODNAME, MENUCODE, MENUSITE, ZH_TW_COMMENTS, ZH_HK_COMMENTS, ZH_TW_MENUNAME, ZH_HK_MENUNAME, ZH_TW_MODNAME, ZH_HK_MODNAME) VALUES (3107, 95, 1, '查看', '5100-1400-0', '群发任务查看', '数据查询', '5100-1400', '/rmsTaskRecord.htm', '查看', 'View', '群l任詹榭', 'Task view', '查', 'Data query');
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (1, 3107);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (2, 3107);
      INSERT INTO LF_IMPOWER(ROLE_ID, PRIVILEGE_ID) VALUES (4, 3107);
    END IF;
  END;
CALL INSERTDATAEXISTS;
DROP PROCEDURE INSERTDATAEXISTS;

-- 修改计费档位管理 ---
-- UPDATE LF_PRIVILEGE SET RESOURCE_ID = 100, OPERATE_ID = null, COMMENTS = '新建', PRIV_CODE = '5100-2000-1', MENUNAME = '计费档位管理', MODNAME = '计费档位管理', MENUCODE = '5100-2000', MENUSITE = null, ZH_TW_COMMENTS = '新建', ZH_HK_COMMENTS = 'Add', ZH_TW_MENUNAME = 'Mn位管理', ZH_HK_MENUNAME = 'Degree manager', ZH_TW_MODNAME = 'Mn位管理', ZH_HK_MODNAME = 'Degree Manage' WHERE PRIVILEGE_ID = 3105;
-- UPDATE LF_PRIVILEGE SET RESOURCE_ID = 100, OPERATE_ID = null, COMMENTS = '修改', PRIV_CODE = '5100-2000-3', MENUNAME = '计费档位管理', MODNAME = '计费档位管理', MENUCODE = '5100-2000', MENUSITE = null, ZH_TW_COMMENTS = '修改', ZH_HK_COMMENTS = 'Edit', ZH_TW_MENUNAME = 'Mn位管理', ZH_HK_MENUNAME = 'Degree manager', ZH_TW_MODNAME = 'Mn位管理', ZH_HK_MODNAME = 'Degree Manage' WHERE PRIVILEGE_ID = 3106;

----添加LF_TEMPCONTENT表
CREATE PROCEDURE "ADDTABLEEXISTS"
BEGIN
  IF NOT EXISTS(SELECT * FROM SYSCAT.TABLES WHERE TABNAME = 'LF_TEMPCONTENT')
    THEN
      EXECUTE IMMEDIATE 'CREATE TABLE LF_TEMPCONTENT (
        "ID"         BIGINT                      NOT NULL GENERATED BY DEFAULT AS IDENTITY
                                                            ( START WITH 1, INCREMENT BY 1, NO CACHE, MINVALUE 1, MAXVALUE 9223372036854775807, NO CYCLE, NO ORDER ),
        "TMID"       BIGINT DEFAULT 0            NOT NULL,
        "CONTTYPE"   INT DEFAULT 0               NOT NULL,
        "TMPCONTENT" varchar(2000) DEFAULT ''''  NOT NULL,
        "TMPTYPE"    INT DEFAULT 0               NOT NULL
      )';
  end if;
end;
CALL ADDTABLEEXISTS;
DROP PROCEDURE ADDTABLEEXISTS;

----------- V71.00 END ---------------------------


CREATE PROCEDURE "ADDVERSIONEXISTS"
  BEGIN ATOMIC
    DECLARE VERSION VARCHAR(32);
    DECLARE DBVERSION VARCHAR(32);
    DECLARE WBSVERSION VARCHAR(32);
    DECLARE SPGATEVERSION VARCHAR(32);
    DECLARE NUM INT;
    DECLARE TOTAL INT;
    SET VERSION = '7.1.0.421';
    SET DBVERSION = '71.00';
    SET WBSVERSION = '8.5.13.211';
    SET SPGATEVERSION = '6.1.46.338';
    SET NUM =1;
    SET TOTAL=1;
    --EMP产品版本记录
    --EMP-WEB
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,1000,VERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP-WEB');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=1000;
    END IF;
    --EMP_GATEWAY
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,2000,WBSVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP_GATEWAY');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=WBSVERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=2000;
    END IF;
    --SMT_SPGATE
    IF NOT EXISTS(SELECT * FROM LF_VERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000)
    THEN
      INSERT INTO LF_VERSION(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,3000,SPGATEVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'SMT_SPGATE');
    ELSE
      UPDATE LF_VERSION SET UPDATETIME=CURRENT TIMESTAMP,VERSION=SPGATEVERSION WHERE PRODUCT_ID=1000 AND PROCESS_ID=3000;
    END IF;
    --EMP产品版本历史记录
    --EMP-WEB
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=VERSION AND PRODUCT_ID=1000 AND PROCESS_ID=1000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO,ISRELEASE,VERSIONINFO)
      VALUES(1000,1000,VERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP-WEB',1,'1、修改富信发送页面。<br />2、添加公共模板。<br />3、优化菜单显示<br />');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP,ISRELEASE=1,VERSIONINFO='1、修改富信发送页面。<br />2、添加公共模板。<br />3、优化菜单显示<br />' WHERE VERSION=VERSION AND PRODUCT_ID=1000 AND PROCESS_ID=1000;
    END IF;
    --EMP_GATEWAY
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=WBSVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=2000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,2000,WBSVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'EMP_GATEWAY');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP WHERE VERSION=WBSVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=2000;
    END IF;
    --SMT_SPGATE
    IF NOT EXISTS(SELECT * FROM LF_VERSION_HIS WHERE VERSION=SPGATEVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=3000)
    THEN
      INSERT INTO LF_VERSION_HIS(PRODUCT_ID,PROCESS_ID,VERSION,UPDATETIME,CREATETIME,MEMO)
      VALUES(1000,3000,SPGATEVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,'SMT_SPGATE');
    ELSE
      UPDATE LF_VERSION_HIS SET UPDATETIME=CURRENT TIMESTAMP WHERE VERSION=SPGATEVERSION AND PRODUCT_ID=1000 AND PROCESS_ID=3000;
    END IF;
    IF NOT EXISTS(SELECT * FROM LF_DB_SCRIPT WHERE VERSION=DBVERSION AND CURRENT_NO=NUM AND TOTAL=TOTAL)
    THEN
      --EMP产品数据库版本信息表
      INSERT INTO LF_DB_SCRIPT(VERSION,UPDATETIME,CREATETIME,CURRENT_NO,TOTAL,STATE,MEMO)
      VALUES(DBVERSION,CURRENT TIMESTAMP,CURRENT TIMESTAMP,NUM,TOTAL,2,'版本号更改');
    ELSE
      UPDATE LF_DB_SCRIPT SET STATE=2,UPDATETIME=CURRENT TIMESTAMP,MEMO='版本号更改' WHERE  VERSION=DBVERSION AND CURRENT_NO=NUM AND TOTAL=TOTAL;
    END IF;
  END;
CALL ADDVERSIONEXISTS;
DROP PROCEDURE ADDVERSIONEXISTS;